<script>
	import { page, navigating } from "$app/stores"
	import { cart } from "$lib/stores.js"
	import Cart from "./Cart.svelte"

	export let products

	let dialog, active = false

	function toggle() {
		if (active) {
			document.body.style.overflow = 'auto'
			active = false
		} else {
			window.scrollTo(0, 0);
			document.body.style.overflow = 'hidden'
			active = true
		}
	}

	$: if ($navigating) {
		active = false
		document.body.style.overflow = 'auto'
	}
</script>

<header id="header" class:index={$page.url.pathname === '/'}>
	<div class="fc ma">
		<a href="/" title="Inicio">
			<svg id="logo" xmlns="http://www.w3.org/2000/svg" width="212" height="60" viewBox="0 0 305 87" fill="none"><g fill="#110600"><path d="M22.441 12.06c6.06-.99-3.79 3.27-2.53 6.18-1.15 6.69 6.6 8.64 6.97 1.59-.19-1.37.08-2.65.79-3.83 3.78-6.21 24.33-13.12 18.5.68-2.16 4.44-4.7 10.86-10.32 11.38-1.28.11-2.8.52-3.16 1.92-.85 2.82 1.49 5.65 4.47 5.4 3.09-.14 4.02-3.42 6.06-5.04.43.66.2 1.41.25 2.2 1.11-.55 2.03-1.35 3.28-1.81-.28 1.15-1.1 1.83-1.55 2.78.92 0 1.79-.25 2.64.16-.58 1.01-1.74 1.43-2.62 2.14 3.42 2.13 1.16 1.85-1.33 1.94.46 1.13.87 2.34-.84 1.58-3.95-3.53-9.93 2.92-13.44-1.92-3.7 8.25-.26 18.76 6.85 24.12-.59-9.25 4.14-5.14 9.29-2.44 1.23-2.14-6.2-5.85-.95-4.85-.11-1.03-.63-2.07-.39-3.06.86.3 1.25 1.23 1.94 1.85.35-.91.32-1.99 1.01-2.71.8.75.83 1.96 1.26 2.95.72-.62 1.28-1.19 2.18-1.43.04 1.07-.38 1.99-.67 3.03 4.21-.43-2.02 3.2-1.21 5.46.24 5.09-3.89 3.43-6.92 2.02-1.11 5.17 10.15 3.79 13.24 3.18 15.491-3.293 25.61-22.988 17.24-36.99-.57-1.27-1.62-2.66-1.21-4.11 11.06 10.45 6.24 29.32-3.7 39.02-8.32 9.22-18.98 10.7-30.63 10.38-.82.15-1.43.76-.25 1.03 11.5 2.75-1.05 5.37-.43 11.34 37.59 4.68 61-40.96 35.23-68.59-8.6-9.41-21.61-14.48-34.29-13.23-3.71.5-15.71 2.3-16.1 6.26.67-.46 2.22-1.36 3.12-1.88.31-.18.69.11.59.46-.2.75-.78 1.86-2.38 2.84h.01zm9.48 59.32c-16.74-6.86-22.06-28.76-12.44-43.46-6.64-2.77-.59-10.42-3.99-14.93-25.02 17.65-18.8 61.49 11.94 71.27.62-1.25 2.06-1.33 3.19-2.04-4.54-2.65 3.49-1.42 5.05-2.27.52-.37-.12-.74-.54-.71-7.66-.5-10.15-2.41-3.21-7.87v.01zm-3.64 12.96s0 .06-.01.09c.8.14 2.89.5 3.25-.67-.7-.02-2.54.54-3.24.58zM92.41 67.36h3.186l4.392 12.78h-3.024l-.99-2.862h-3.978l-.972 2.862H88l4.41-12.78zm3.078 7.884l-1.494-4.914-1.53 4.914h3.024zM100.906 67h2.88v9.774c0 1.199.99 1.269 1.872.828l.378 2.16c-1.972.92-5.13.851-5.13-1.98V67zm6.066 13.14v-9.45h2.88v9.45h-2.88zm0-10.53V67h2.88v2.61h-2.88zm19.791 10.53h-2.88v-5.31c0-.785-.267-1.782-1.224-1.782-.926 0-1.666.855-1.926 1.674v5.418h-2.88v-5.31c0-.786-.264-1.782-1.224-1.782-.919 0-1.652.873-1.926 1.674v5.418h-2.88v-9.45h2.592v1.584c.705-1.142 1.927-1.764 3.492-1.764 1.194 0 2.312.614 2.61 1.836.734-1.199 2.051-1.836 3.438-1.836 2.074 0 2.808 1.768 2.808 3.582v6.048zm4.258-.198c-1.799-.761-2.934-2.486-2.934-4.428 0-1.752.823-3.387 2.34-4.302.756-.468 1.668-.702 2.736-.702s1.974.228 2.718.684c1.47.886 2.322 2.486 2.322 4.194a3.56 3.56 0 0 1-.036.504l-.036.414h-6.984a2.06 2.06 0 0 0 2.106 1.944c.779 0 1.683-.373 1.998-1.134l2.448.684c-.473.97-1.356 1.758-2.574 2.196a5.92 5.92 0 0 1-4.104-.054zm.054-5.4h4.104c-.131-1.084-.915-1.962-2.052-1.962s-1.919.871-2.052 1.962zm17.542 5.598h-2.88v-5.31c0-.82-.303-1.782-1.278-1.782-.954 0-1.759.834-2.07 1.674v5.418h-2.88v-9.45h2.592v1.584c.721-1.119 2.023-1.764 3.672-1.764.929 0 1.88.345 2.34 1.206.401.708.504 1.573.504 2.376v6.048zm8.016-.504c-1.307.535-2.851.977-4.23.45-.939-.398-1.296-1.32-1.296-2.286v-4.932h-1.206V70.69h1.206v-3.006h2.88v3.006h1.926v2.178h-1.926v3.942c0 1.214 1.363.902 2.088.54l.558 2.286zm5.516.684c-1.595 0-2.873-.557-3.744-1.476-.861-.909-1.314-2.12-1.314-3.42 0-1.325.453-2.529 1.314-3.438.871-.919 2.149-1.476 3.744-1.476 1.608 0 2.862.564 3.726 1.476s1.332 2.118 1.332 3.438c0 1.296-.468 2.508-1.332 3.42s-2.118 1.476-3.726 1.476zm-2.106-4.896c0 1.241.756 2.466 2.106 2.466 1.336 0 2.088-1.244 2.088-2.466 0-1.23-.74-2.466-2.088-2.466s-2.106 1.225-2.106 2.466zm9.853 4.5c-.768-.264-1.416-.654-1.944-1.17l.99-1.818c.576.42 1.134.738 1.674.954.682.267 1.72.551 2.412.144a.6.6 0 0 0 .306-.558c0-.675-1.143-.84-1.638-.972l-1.8-.702c-.895-.425-1.44-1.11-1.44-2.124 0-1.291.677-2.252 1.836-2.772 1.224-.55 2.738-.509 3.996-.09.624.204 1.206.546 1.746 1.026l-1.116 1.8c-.786-.541-1.681-1.062-2.664-1.062-.491 0-1.116.159-1.116.756 0 .707.963.825 1.476.99.78.228 1.428.462 1.944.702.516.228.9.516 1.152.864.264.336.396.786.396 1.35 0 .96-.348 1.716-1.044 2.268-1.401 1.106-3.567.964-5.166.414zm15.074-7.092v7.308h-2.952V67.36h2.34l5.922 7.524V67.36h2.952v12.78h-2.412l-5.85-7.308zm10.382 3.906V70.69h2.88v5.418c0 2.406 2.475 2.051 3.384.414V70.69h2.88v6.246c0 .462.121.758.612.81v2.394c-1.505.274-2.874.147-3.042-1.638a3.99 3.99 0 0 1-1.62 1.386c-.636.288-1.35.432-2.142.432-.96 0-1.692-.306-2.196-.918s-.756-1.5-.756-2.664z"/><use xlink:href="#B"/><path d="M219.911 73.156c-.696 0-1.326.114-1.89.342-.564.216-.972.54-1.224.972v5.67h-2.88v-9.45h2.646v1.908c.324-.636.744-1.134 1.26-1.494.55-.384 1.394-.713 2.088-.54v2.592zm1.071 2.52c1.041-1.401 3.06-1.718 4.68-1.404.372.06.696.15.972.27 0-2.934-3.194-2.046-4.842-.972l-.864-1.836c.624-.408 1.272-.714 1.944-.918.684-.204 1.404-.306 2.16-.306 1.416 0 2.514.342 3.294 1.026.792.672 1.188 1.65 1.188 2.934v2.466c0 .462.12.758.612.81v2.394c-.765.153-1.793.325-2.466-.18a1.42 1.42 0 0 1-.522-.882l-.054-.414c-.802 1.03-2.02 1.656-3.33 1.656-1.137 0-2.244-.497-2.862-1.476-.6-.949-.585-2.26.09-3.168zm5.202 1.998c.264-.216.45-.498.45-.738v-.846c-.24-.096-.51-.168-.81-.216-.892-.186-1.61-.084-2.124.27-.509.333-.686.997-.342 1.512.245.368.678.594 1.242.594s1.159-.205 1.584-.576zm9.934 2.646c-2.057 0-3.972-1.077-4.734-3.042a5.23 5.23 0 0 1 .252-4.284c.905-1.65 2.642-2.484 4.482-2.484 1.812 0 3.593.83 4.428 2.502l-2.808.846c-.841-1.347-2.768-1.071-3.474.252-.384.77-.376 1.828.018 2.592.674 1.305 2.701 1.703 3.474.252l2.808.864c-.801 1.686-2.653 2.502-4.446 2.502zm8.036-.378c-1.801-.762-2.934-2.469-2.934-4.428 0-2.877 2.222-5.004 5.076-5.004 2.778 0 5.04 2.042 5.04 4.878a3.56 3.56 0 0 1-.036.504l-.036.414h-6.984c.097 1.134.96 1.944 2.106 1.944.779 0 1.683-.373 1.998-1.134l2.448.684c-.24.492-.582.93-1.026 1.314-1.492 1.285-3.848 1.556-5.652.828zm.054-5.4h4.104c-.131-1.084-.915-1.962-2.052-1.962s-1.92.871-2.052 1.962zm2.988-4.698l-1.836-.504.936-2.34h2.61l-1.71 2.844zm5.355 6.894V70.69h2.881v5.418c0 2.406 2.474 2.051 3.384.414V70.69h2.879v6.246c0 .462.121.758.612.81v2.394c-1.08.196-2.72.362-2.987-1.062l-.054-.576c-.432.624-.973 1.086-1.621 1.386-.636.288-1.35.432-2.142.432-.96 0-1.692-.306-2.196-.918s-.756-1.5-.756-2.664z"/><use xlink:href="#B" x="57.199"/><path d="M271.116 80.14v-9.45h2.88v9.45h-2.88zm0-10.53V67h2.88v2.61h-2.88zm7.228 10.314c-1.24-.525-2.133-1.462-2.592-2.646a5.22 5.22 0 0 1 .252-4.284c.904-1.65 2.641-2.484 4.482-2.484 1.811 0 3.592.83 4.428 2.502l-2.808.846c-.842-1.347-2.769-1.071-3.474.252a3.02 3.02 0 0 0 .018 2.592c.671 1.301 2.696 1.71 3.474.252l2.808.864c-.491 1.032-1.427 1.782-2.484 2.178-1.272.477-2.853.457-4.104-.072zm12.301.396c-1.389 0-2.772-.45-3.744-1.476-.861-.909-1.314-2.12-1.314-3.42 0-1.325.453-2.529 1.314-3.438.972-1.026 2.355-1.476 3.744-1.476 1.608 0 2.862.564 3.726 1.476s1.332 2.118 1.332 3.438c0 1.296-.468 2.508-1.332 3.42s-2.118 1.476-3.726 1.476zm-2.106-4.896c0 1.241.756 2.466 2.106 2.466 1.336 0 2.088-1.244 2.088-2.466 0-1.23-.74-2.466-2.088-2.466s-2.106 1.225-2.106 2.466zm12.211 4.896c-1.539 0-3.182-.471-4.302-1.566l.99-1.818c1.163.848 2.271 1.278 3.222 1.278.744 0 1.17-.234 1.17-.738 0-.412-.399-.589-.738-.702l-.9-.27c-.971-.324-2.238-.663-2.88-1.53-.593-.83-.433-2.142.108-2.952.648-.96 1.842-1.512 3.474-1.512 1.337 0 2.632.439 3.636 1.332l-1.116 1.8c-.786-.541-1.68-1.062-2.664-1.062-.408 0-.756.084-.972.324-.199.224-.199.64 0 .864.333.334.901.42 1.332.558.78.228 1.428.462 1.944.702.947.418 1.548 1.155 1.548 2.214 0 .96-.348 1.716-1.044 2.268-.684.54-1.62.81-2.808.81z"/></g><g fill="#e72832"><path d="M288.246 22.711h11.925v35.277h-11.925V22.711z"/><path fill-rule="evenodd" d="M250.553 9.295h-11.992v49.189h11.992c23.237 0 30.486-12.551 30.732-24.973.241-12.17-8.105-24.216-30.732-24.216zm18.24 24.499c0-8.86-4.739-14.662-17.97-14.662v29.766c12.398 0 17.97-6.244 17.97-15.104z"/><path d="M294.954.352l9.937 4.472-7.453 14.906-9.192-3.975L294.954.352zm-76.343 8.943h12v35.454c-3.75 19.225-36.499 18.726-39.749 0V9.295h12.25v33.706c1.25 7.99 13.999 8.489 15.499 0V9.295z"/><path fill-rule="evenodd" d="M172.975 9.295h-15.154s-9.937 24.843-14.161 48.692h12.174l1.739-8.447h15.651l1.739 8.447h12.421c-4.969-25.837-14.409-48.692-14.409-48.692zm-7.701 12.421s-2.236 3.23-5.714 17.887h11.428c-3.478-14.906-5.714-17.887-5.714-17.887z"/><path d="M123.041 8.799c8.695 0 15.651 3.975 15.651 3.975l-2.733 9.689s-10.434-7.204-20.868-1.739c-5.714 2.993-9.689 15.705-3.229 23.849 5.713 7.204 15.402 3.726 15.402 3.726v-8.198h-8.446V29.915h19.874v25.092c-10.683 5.217-27.824 5.962-36.271-3.23-13.26-14.43-5.962-42.978 20.62-42.978z"/></g><defs ><path id="B" d="M212.795 79.636c-2.036.833-5.526 1.341-5.526-1.836v-4.932h-1.206V70.69h1.206v-3.006h2.88v3.006h1.926v2.178h-1.926v3.942c0 1.214 1.363.902 2.088.54l.558 2.286z"/></defs></svg>
		</a>
		<div class="fc list" class:active>
			<a class="rl" href="/" aria-current={$page.url.pathname === '/'}>Inicio</a>
			<a class="rl" href="/tienda" aria-current={$page.url.pathname.startsWith('/tienda')}>Tienda</a>
			<a class="rl" href="/carrito" aria-current={$page.url.pathname.startsWith('/carrito')}>Mi Carrito</a>
		</div>
		<button class="rl" type="button" title="Carrito" on:click={dialog.showModal()}>
			<div class="fc quantity">
				{$cart.quantity}
			</div>
			<svg id="carrito" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#110600"><path d="M280-80q-33 0-56.5-23.5T200-160q0-33 23.5-56.5T280-240q33 0 56.5 23.5T360-160q0 33-23.5 56.5T280-80Zm400 0q-33 0-56.5-23.5T600-160q0-33 23.5-56.5T680-240q33 0 56.5 23.5T760-160q0 33-23.5 56.5T680-80ZM246-720l96 200h280l110-200H246Zm-38-80h590q23 0 35 20.5t1 41.5L692-482q-11 20-29.5 31T622-440H324l-44 80h480v80H280q-45 0-68-39.5t-2-78.5l54-98-144-304H40v-80h130l38 80Zm134 280h280-280Z"/></svg>
		</button>
		<dialog bind:this={dialog}>
			<Cart products={products}/>
		</dialog>
		<button id="burgerbtn" type="button" on:click={toggle} class:active title="Menú">
			<div id="bb1" class="bb"></div>
			<div id="bb2" class="bb"></div>
			<div id="bb3" class="bb"></div>
		</button>
	</div>
</header>

<style>
	dialog {
		--width: 420px;
		top: 0;
		width: var(--width);
		height: 100%;
		left: calc(100% - var(--width));
		margin: 0;
		border: none;
		max-height: 100%;
		padding: 32px;
	}
	dialog::backdrop {
		-webkit-backdrop-filter: blur(3px);
		backdrop-filter: blur(3px);
	}
	.ma {
		justify-content: space-between;
		height: 120px;
		background: white;
	}
	.list a {
		font-size: 14px;
		color: var(--disabled);
		text-decoration: none;
		padding: 0 12px;
	}
	.list a:hover {
		color: var(--text);
	}
	.list a[aria-current="true"] {
		color: var(--accent);
	}
	.list a:hover::before, .list a[aria-current="true"]::before {
		content: '';
		width: 20px;
		height: 2px;
		background: var(--text);
		position: absolute;
		bottom: -8px;
		left: 50%;
		transform: translateX(-50%);
	}
	.list a[aria-current="true"]::before {
		background: var(--accent);
	}
	.bb {
		background: var(--disabled);
		height: 2px;
		width: 24px;
		transition: 0.4s;
	}
	.index .ma {
		background: transparent;
	}
	.index path {
		fill: white;
	}
	.index #carrito path {
		fill: white;
	}
	.index .list a {
		color: white;
	}
	.index .list a::before {
    	background: white !important;
	}
	.index .bb {
		background: white;
	}
	.quantity {
		position: absolute;
		border-radius: 50%;
		background: var(--accent);
		color: white;
		aspect-ratio: 1;
		height: 22px;
		padding-top: 1px;
		top: 0;
		left: 50%;
		justify-content: center;
	}
	#carrito path {
		fill: var(--disabled);
	}
	#carrito:hover path {
		fill: var(--text);
	}
	.index #carrito:hover path {
		fill: white;
	}
	button {
		z-index: 4;
		padding: 8px 16px;
	}
	#burgerbtn {
		display: none;
		flex-direction: column;
		gap: 5px;
		position: absolute;
		right: 68px;
		padding: 8px;
	}
	.active #bb1 { transform: translate(0, 7px) rotate(-45deg) }
	.active #bb2 { opacity: 0 }
	.active #bb3 {
		transform: translate(0, -7px) rotate(45deg);
	}
	@media (max-width: 900px) {
		.ma {
			height: 90px;
		}
	}
	@media (max-width: 700px) {
		#burgerbtn {
			display: flex;
		}
		.list {
			display: none;
		}
		.list.active {
			display: flex;
			background: var(--accent);
			position: absolute;
			inset: 0;
			width: 100%;
			height: 100%;
			flex-direction: column;
			justify-content: center;
			gap: 20px;
			z-index: 4;
		}
		.list a {
			font-size: 18px;
		}
		.list.active * {
			color: white !important;
		}
		.list.active a::before {
			background: white !important;
		}
		.list.active~#burgerbtn .bb {
			background: white;
		}
		.list.active+.rl>#carrito path {
			fill: white;
		}
		dialog {
			width: 100%;
			left: 0;
			max-width: 100%;
		}
	}
</style>