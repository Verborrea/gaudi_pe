{"version":3,"file":"_server-CocMPrRl.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/api/buy/_server.js"],"sourcesContent":["import { j as json } from \"../../../../chunks/index.js\";\nimport nodemailer from \"nodemailer\";\nlet transporter = nodemailer.createTransport({\n  host: \"gaudi.pe\",\n  port: 465,\n  secure: true,\n  auth: {\n    user: \"mail@gaudi.pe\",\n    pass: \"Gaudi2024$\"\n  }\n});\nconst template = '<!DOCTYPE html><html lang=\"es\"><head><meta charset=\"UTF-8\"><meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"><title>Detalles de la Compra</title><style>body {font-family: Arial, sans-serif;background-color: #f4f4f4;color: #333;padding: 20px;}.container {width: 100%;max-width: 600px;margin: 0 auto;background-color: #ffffff;border-radius: 8px;box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);}.header {text-align: center;margin-bottom: 20px;}.header h1 {margin: 0;font-size: 24px;}.content {line-height: 1.6;}.content p {margin: 10px 0;}.items {margin: 20px 0;}.items ul {list-style-type: none;padding: 0;}.items ul li {background-color: #f9f9f9;margin: 5px 0;padding: 10px;border-radius: 5px;}.total {font-weight: bold;}</style></head><body><table class=\"container\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" align=\"center\"><tr><td style=\"padding: 20px;\" class=\"header\"><h1>Detalles de la Compra</h1></td></tr><tr><td style=\"padding: 20px;\" class=\"content\"><p><strong>Nombre:</strong> {{name}}</p><p><strong>DirecciÃ³n:</strong> {{address}}</p><p><strong>TelÃ©fono:</strong> {{phone}}</p><p><strong>Email:</strong> {{email}}</p><p><strong>Notas:</strong> {{notes}}</p><p><strong>Coordenadas:</strong> {{coords}}</p><div class=\"items\"><p><strong>ArtÃ­culos:</strong></p><ul>{{items}}</ul></div><p><strong>Subtotal:</strong> {{subtotal}}</p><p><strong>Costo de EnvÃ­o:</strong> {{costo_envio}}</p><p class=\"total\"><strong>Total:</strong> {{total}}</p></td></tr><tr><td style=\"padding: 20px;\" class=\"content\"><img style=\"display: block; margin:auto; width: 75%;\" src=\"{{yape}}\" alt=\"Yape\"></td></tr></table></body></html>';\nfunction replaceTemplate(template2, data) {\n  return template2.replace(/{{(.*?)}}/g, (_, key) => {\n    const value = data[key.trim()];\n    if (key.trim() === \"coords\" && Array.isArray(value)) {\n      return `Lng: ${value[0]}, Lat: ${value[1]}`;\n    }\n    if (Array.isArray(value)) {\n      return value.map((item) => `<li>${item.name}&nbsp;&nbsp;${(item.total * item.quantity).toFixed(2)}</li>`).join(\"\");\n    }\n    return value || \"\";\n  });\n}\nasync function POST({ request }) {\n  const datos = await request.json();\n  transporter.sendMail({\n    from: \"mail@gaudi.pe\",\n    to: datos.email,\n    subject: \"GaudÃ­ ðŸ¦Ž - Gracias por su compra ðŸ˜„!\",\n    text: `Hola ${datos.name.split(\" \")[0]}. Gracias por su compra ðŸ˜„ Su orden estÃ¡ siendo procesada. Le notificaremos apenas confirmemos su pago.`,\n    html: `<h1>Hola ${datos.name.split(\" \")[0]}</h1><h2>Gracias por su compra ðŸ˜„</h2><h3>Su orden estÃ¡ siendo procesada.</h3><p>Le notificaremos apenas confirmemos su pago.</p>`\n  }, (error, _) => {\n    if (error) {\n      return json({\n        status: \"error\",\n        error: {\n          code: 500,\n          message: error\n        }\n      });\n    }\n  });\n  transporter.sendMail({\n    from: \"mail@gaudi.pe\",\n    to: \"admin@gaudi.pe\",\n    subject: `Nuevo Pedido de ${datos.name}`,\n    html: replaceTemplate(template, datos)\n  }, (error, _) => {\n    if (error) {\n      return json({\n        status: \"error\",\n        error: {\n          code: 500,\n          message: error\n        }\n      });\n    }\n  });\n  return json({\n    status: \"success\",\n    message: \"El mail se enviÃ³ correctamente\"\n  });\n}\nexport {\n  POST\n};\n"],"names":[],"mappings":"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"}