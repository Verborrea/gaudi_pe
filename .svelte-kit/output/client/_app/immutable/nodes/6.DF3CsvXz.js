import{s as L8,n as am,c as O8,o as k8,C as Bo}from"../chunks/scheduler.DKRIXM0x.js";import{S as B8,i as F8,e as nn,s as pa,n as N8,c as on,d as Qi,f as ma,a as gs,m as nu,o as Li,h as bi,g as ou,t as Np,b as Vp,j as _3}from"../chunks/index.C8C-eI0O.js";import{e as go}from"../chunks/stores.CuPaPXIs.js";var t1=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function N6(z){return z&&z.__esModule&&Object.prototype.hasOwnProperty.call(z,"default")?z.default:z}function V8(z){if(z.__esModule)return z;var M=z.default;if(typeof M=="function"){var U=function J(){return this instanceof J?Reflect.construct(M,arguments,this.constructor):M.apply(this,arguments)};U.prototype=M.prototype}else U={};return Object.defineProperty(U,"__esModule",{value:!0}),Object.keys(z).forEach(function(J){var le=Object.getOwnPropertyDescriptor(z,J);Object.defineProperty(U,J,le.get?le:{enumerable:!0,get:function(){return z[J]}})}),U}var V6={exports:{}};(function(z,M){var U={};(function(J,le){z.exports=le()})(t1,function(){var J,le,he;function qe(s,ze){if(!J)J=ze;else if(!le)le=ze;else{var pt="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+J+")(sharedChunk); ("+le+")(sharedChunk); self.onerror = null;",Ze={};J(Ze),he=ze(Ze),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(he.workerUrl=window.URL.createObjectURL(new Blob([pt],{type:"text/javascript"})))}}qe(["exports"],function(s){var ze="3.4.0";let pt;const Ze={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(pt==null){const t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{pt=U.API_URL_REGEX!=null?new RegExp(U.API_URL_REGEX):t}catch{pt=t}}return pt},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Ze.API_URL)return null;try{const t=new URL(Ze.API_URL);return t.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":t.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"};function St(t){return Ze.API_URL_REGEX.test(t)}function ct(t){return t.indexOf("mapbox:")===0}function dr(t){return Ze.API_CDN_URL_REGEX.test(t)}function _r(t){return Ze.API_SPRITE_REGEX.test(t)}function ur(t){return Ze.API_STYLE_REGEX.test(t)&&!_r(t)}const Lr={create:"create",load:"load",fullLoad:"fullLoad"};function Dr(t){const e=t.name.split("?")[0];return dr(e)&&e.includes("mapbox-gl.js")?"javascript":dr(e)&&e.includes("mapbox-gl.css")?"css":function(r){return Ze.API_FONTS_REGEX.test(r)}(e)?"fontRange":_r(e)?"sprite":ur(e)?"style":function(r){return Ze.API_TILEJSON_REGEX.test(r)}(e)?"tilejson":"other"}function Br(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Vt={},Ut={};Object.defineProperty(Ut,"__esModule",{value:!0}),Ut.setMatrixArrayType=function(t){Ut.ARRAY_TYPE=ti=t},Ut.toRadian=function(t){return t*Oi},Ut.equals=function(t,e){return Math.abs(t-e)<=Fr*Math.max(1,Math.abs(t),Math.abs(e))},Ut.RANDOM=Ut.ARRAY_TYPE=Ut.EPSILON=void 0;var Fr=1e-6;Ut.EPSILON=Fr;var ti=typeof Float32Array<"u"?Float32Array:Array;Ut.ARRAY_TYPE=ti;var ai=Math.random;Ut.RANDOM=ai;var Oi=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var sr={};function vo(t){return vo=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},vo(t)}Object.defineProperty(sr,"__esModule",{value:!0}),sr.create=function(){var t=new Mi.ARRAY_TYPE(4);return Mi.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},sr.clone=function(t){var e=new Mi.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},sr.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},sr.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},sr.fromValues=function(t,e,r,n){var a=new Mi.ARRAY_TYPE(4);return a[0]=t,a[1]=e,a[2]=r,a[3]=n,a},sr.set=function(t,e,r,n,a){return t[0]=e,t[1]=r,t[2]=n,t[3]=a,t},sr.transpose=function(t,e){if(t===e){var r=e[1];t[1]=e[2],t[2]=r}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},sr.invert=function(t,e){var r=e[0],n=e[1],a=e[2],l=e[3],h=r*l-a*n;return h?(t[0]=l*(h=1/h),t[1]=-n*h,t[2]=-a*h,t[3]=r*h,t):null},sr.adjoint=function(t,e){var r=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=r,t},sr.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},sr.multiply=Vn,sr.rotate=function(t,e,r){var n=e[0],a=e[1],l=e[2],h=e[3],f=Math.sin(r),m=Math.cos(r);return t[0]=n*m+l*f,t[1]=a*m+h*f,t[2]=n*-f+l*m,t[3]=a*-f+h*m,t},sr.scale=function(t,e,r){var n=e[1],a=e[2],l=e[3],h=r[0],f=r[1];return t[0]=e[0]*h,t[1]=n*h,t[2]=a*f,t[3]=l*f,t},sr.fromRotation=function(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=-r,t[3]=n,t},sr.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t},sr.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},sr.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},sr.LDU=function(t,e,r,n){return t[2]=n[2]/n[0],r[0]=n[0],r[1]=n[1],r[3]=n[3]-t[2]*r[1],[t,e,r]},sr.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t},sr.subtract=yi,sr.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},sr.equals=function(t,e){var r=t[0],n=t[1],a=t[2],l=t[3],h=e[0],f=e[1],m=e[2],g=e[3];return Math.abs(r-h)<=Mi.EPSILON*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(n-f)<=Mi.EPSILON*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(a-m)<=Mi.EPSILON*Math.max(1,Math.abs(a),Math.abs(m))&&Math.abs(l-g)<=Mi.EPSILON*Math.max(1,Math.abs(l),Math.abs(g))},sr.multiplyScalar=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t},sr.multiplyScalarAndAdd=function(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t},sr.sub=sr.mul=void 0;var Mi=function(t,e){if(t&&t.__esModule)return t;if(t===null||vo(t)!=="object"&&typeof t!="function")return{default:t};var r=Sn(void 0);if(r&&r.has(t))return r.get(t);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if(l!=="default"&&Object.prototype.hasOwnProperty.call(t,l)){var h=a?Object.getOwnPropertyDescriptor(t,l):null;h&&(h.get||h.set)?Object.defineProperty(n,l,h):n[l]=t[l]}return n.default=t,r&&r.set(t,n),n}(Ut);function Sn(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,r=new WeakMap;return(Sn=function(n){return n?r:e})(t)}function Vn(t,e,r){var n=e[0],a=e[1],l=e[2],h=e[3],f=r[0],m=r[1],g=r[2],x=r[3];return t[0]=n*f+l*m,t[1]=a*f+h*m,t[2]=n*g+l*x,t[3]=a*g+h*x,t}function yi(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}sr.mul=Vn,sr.sub=yi;var Tr={};function ys(t){return ys=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ys(t)}Object.defineProperty(Tr,"__esModule",{value:!0}),Tr.create=function(){var t=new an.ARRAY_TYPE(6);return an.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t},Tr.clone=function(t){var e=new an.ARRAY_TYPE(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},Tr.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},Tr.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},Tr.fromValues=function(t,e,r,n,a,l){var h=new an.ARRAY_TYPE(6);return h[0]=t,h[1]=e,h[2]=r,h[3]=n,h[4]=a,h[5]=l,h},Tr.set=function(t,e,r,n,a,l,h){return t[0]=e,t[1]=r,t[2]=n,t[3]=a,t[4]=l,t[5]=h,t},Tr.invert=function(t,e){var r=e[0],n=e[1],a=e[2],l=e[3],h=e[4],f=e[5],m=r*l-n*a;return m?(t[0]=l*(m=1/m),t[1]=-n*m,t[2]=-a*m,t[3]=r*m,t[4]=(a*f-l*h)*m,t[5]=(n*h-r*f)*m,t):null},Tr.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},Tr.multiply=xs,Tr.rotate=function(t,e,r){var n=e[0],a=e[1],l=e[2],h=e[3],f=e[4],m=e[5],g=Math.sin(r),x=Math.cos(r);return t[0]=n*x+l*g,t[1]=a*x+h*g,t[2]=n*-g+l*x,t[3]=a*-g+h*x,t[4]=f,t[5]=m,t},Tr.scale=function(t,e,r){var n=e[1],a=e[2],l=e[3],h=e[4],f=e[5],m=r[0],g=r[1];return t[0]=e[0]*m,t[1]=n*m,t[2]=a*g,t[3]=l*g,t[4]=h,t[5]=f,t},Tr.translate=function(t,e,r){var n=e[0],a=e[1],l=e[2],h=e[3],f=e[4],m=e[5],g=r[0],x=r[1];return t[0]=n,t[1]=a,t[2]=l,t[3]=h,t[4]=n*g+l*x+f,t[5]=a*g+h*x+m,t},Tr.fromRotation=function(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=-r,t[3]=n,t[4]=0,t[5]=0,t},Tr.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t},Tr.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t},Tr.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},Tr.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)},Tr.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t},Tr.subtract=Uo,Tr.multiplyScalar=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t},Tr.multiplyScalarAndAdd=function(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t[4]=e[4]+r[4]*n,t[5]=e[5]+r[5]*n,t},Tr.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]},Tr.equals=function(t,e){var r=t[0],n=t[1],a=t[2],l=t[3],h=t[4],f=t[5],m=e[0],g=e[1],x=e[2],v=e[3],w=e[4],S=e[5];return Math.abs(r-m)<=an.EPSILON*Math.max(1,Math.abs(r),Math.abs(m))&&Math.abs(n-g)<=an.EPSILON*Math.max(1,Math.abs(n),Math.abs(g))&&Math.abs(a-x)<=an.EPSILON*Math.max(1,Math.abs(a),Math.abs(x))&&Math.abs(l-v)<=an.EPSILON*Math.max(1,Math.abs(l),Math.abs(v))&&Math.abs(h-w)<=an.EPSILON*Math.max(1,Math.abs(h),Math.abs(w))&&Math.abs(f-S)<=an.EPSILON*Math.max(1,Math.abs(f),Math.abs(S))},Tr.sub=Tr.mul=void 0;var an=function(t,e){if(t&&t.__esModule)return t;if(t===null||ys(t)!=="object"&&typeof t!="function")return{default:t};var r=pn(void 0);if(r&&r.has(t))return r.get(t);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if(l!=="default"&&Object.prototype.hasOwnProperty.call(t,l)){var h=a?Object.getOwnPropertyDescriptor(t,l):null;h&&(h.get||h.set)?Object.defineProperty(n,l,h):n[l]=t[l]}return n.default=t,r&&r.set(t,n),n}(Ut);function pn(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,r=new WeakMap;return(pn=function(n){return n?r:e})(t)}function xs(t,e,r){var n=e[0],a=e[1],l=e[2],h=e[3],f=e[4],m=e[5],g=r[0],x=r[1],v=r[2],w=r[3],S=r[4],A=r[5];return t[0]=n*g+l*x,t[1]=a*g+h*x,t[2]=n*v+l*w,t[3]=a*v+h*w,t[4]=n*S+l*A+f,t[5]=a*S+h*A+m,t}function Uo(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t}Tr.mul=xs,Tr.sub=Uo;var hr={};function vs(t){return vs=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},vs(t)}Object.defineProperty(hr,"__esModule",{value:!0}),hr.create=function(){var t=new ki.ARRAY_TYPE(9);return ki.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},hr.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},hr.clone=function(t){var e=new ki.ARRAY_TYPE(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},hr.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},hr.fromValues=function(t,e,r,n,a,l,h,f,m){var g=new ki.ARRAY_TYPE(9);return g[0]=t,g[1]=e,g[2]=r,g[3]=n,g[4]=a,g[5]=l,g[6]=h,g[7]=f,g[8]=m,g},hr.set=function(t,e,r,n,a,l,h,f,m,g){return t[0]=e,t[1]=r,t[2]=n,t[3]=a,t[4]=l,t[5]=h,t[6]=f,t[7]=m,t[8]=g,t},hr.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},hr.transpose=function(t,e){if(t===e){var r=e[1],n=e[2],a=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=n,t[7]=a}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},hr.invert=function(t,e){var r=e[0],n=e[1],a=e[2],l=e[3],h=e[4],f=e[5],m=e[6],g=e[7],x=e[8],v=x*h-f*g,w=-x*l+f*m,S=g*l-h*m,A=r*v+n*w+a*S;return A?(t[0]=v*(A=1/A),t[1]=(-x*n+a*g)*A,t[2]=(f*n-a*h)*A,t[3]=w*A,t[4]=(x*r-a*m)*A,t[5]=(-f*r+a*l)*A,t[6]=S*A,t[7]=(-g*r+n*m)*A,t[8]=(h*r-n*l)*A,t):null},hr.adjoint=function(t,e){var r=e[0],n=e[1],a=e[2],l=e[3],h=e[4],f=e[5],m=e[6],g=e[7],x=e[8];return t[0]=h*x-f*g,t[1]=a*g-n*x,t[2]=n*f-a*h,t[3]=f*m-l*x,t[4]=r*x-a*m,t[5]=a*l-r*f,t[6]=l*g-h*m,t[7]=n*m-r*g,t[8]=r*h-n*l,t},hr.determinant=function(t){var e=t[3],r=t[4],n=t[5],a=t[6],l=t[7],h=t[8];return t[0]*(h*r-n*l)+t[1]*(-h*e+n*a)+t[2]*(l*e-r*a)},hr.multiply=jo,hr.translate=function(t,e,r){var n=e[0],a=e[1],l=e[2],h=e[3],f=e[4],m=e[5],g=e[6],x=e[7],v=e[8],w=r[0],S=r[1];return t[0]=n,t[1]=a,t[2]=l,t[3]=h,t[4]=f,t[5]=m,t[6]=w*n+S*h+g,t[7]=w*a+S*f+x,t[8]=w*l+S*m+v,t},hr.rotate=function(t,e,r){var n=e[0],a=e[1],l=e[2],h=e[3],f=e[4],m=e[5],g=e[6],x=e[7],v=e[8],w=Math.sin(r),S=Math.cos(r);return t[0]=S*n+w*h,t[1]=S*a+w*f,t[2]=S*l+w*m,t[3]=S*h-w*n,t[4]=S*f-w*a,t[5]=S*m-w*l,t[6]=g,t[7]=x,t[8]=v,t},hr.scale=function(t,e,r){var n=r[0],a=r[1];return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=a*e[3],t[4]=a*e[4],t[5]=a*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},hr.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},hr.fromRotation=function(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=0,t[3]=-r,t[4]=n,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},hr.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},hr.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},hr.fromQuat=function(t,e){var r=e[0],n=e[1],a=e[2],l=e[3],h=r+r,f=n+n,m=a+a,g=r*h,x=n*h,v=n*f,w=a*h,S=a*f,A=a*m,P=l*h,R=l*f,L=l*m;return t[0]=1-v-A,t[3]=x-L,t[6]=w+R,t[1]=x+L,t[4]=1-g-A,t[7]=S-P,t[2]=w-R,t[5]=S+P,t[8]=1-g-v,t},hr.normalFromMat4=function(t,e){var r=e[0],n=e[1],a=e[2],l=e[3],h=e[4],f=e[5],m=e[6],g=e[7],x=e[8],v=e[9],w=e[10],S=e[11],A=e[12],P=e[13],R=e[14],L=e[15],V=r*f-n*h,q=r*m-a*h,G=r*g-l*h,ee=n*m-a*f,W=n*g-l*f,re=a*g-l*m,ne=x*P-v*A,de=x*R-w*A,ve=x*L-S*A,pe=v*R-w*P,Te=v*L-S*P,we=w*L-S*R,be=V*we-q*Te+G*pe+ee*ve-W*de+re*ne;return be?(t[0]=(f*we-m*Te+g*pe)*(be=1/be),t[1]=(m*ve-h*we-g*de)*be,t[2]=(h*Te-f*ve+g*ne)*be,t[3]=(a*Te-n*we-l*pe)*be,t[4]=(r*we-a*ve+l*de)*be,t[5]=(n*ve-r*Te-l*ne)*be,t[6]=(P*re-R*W+L*ee)*be,t[7]=(R*G-A*re-L*q)*be,t[8]=(A*W-P*G+L*V)*be,t):null},hr.projection=function(t,e,r){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/r,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t},hr.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},hr.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])},hr.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t},hr.subtract=mn,hr.multiplyScalar=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t},hr.multiplyScalarAndAdd=function(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t[4]=e[4]+r[4]*n,t[5]=e[5]+r[5]*n,t[6]=e[6]+r[6]*n,t[7]=e[7]+r[7]*n,t[8]=e[8]+r[8]*n,t},hr.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},hr.equals=function(t,e){var r=t[0],n=t[1],a=t[2],l=t[3],h=t[4],f=t[5],m=t[6],g=t[7],x=t[8],v=e[0],w=e[1],S=e[2],A=e[3],P=e[4],R=e[5],L=e[6],V=e[7],q=e[8];return Math.abs(r-v)<=ki.EPSILON*Math.max(1,Math.abs(r),Math.abs(v))&&Math.abs(n-w)<=ki.EPSILON*Math.max(1,Math.abs(n),Math.abs(w))&&Math.abs(a-S)<=ki.EPSILON*Math.max(1,Math.abs(a),Math.abs(S))&&Math.abs(l-A)<=ki.EPSILON*Math.max(1,Math.abs(l),Math.abs(A))&&Math.abs(h-P)<=ki.EPSILON*Math.max(1,Math.abs(h),Math.abs(P))&&Math.abs(f-R)<=ki.EPSILON*Math.max(1,Math.abs(f),Math.abs(R))&&Math.abs(m-L)<=ki.EPSILON*Math.max(1,Math.abs(m),Math.abs(L))&&Math.abs(g-V)<=ki.EPSILON*Math.max(1,Math.abs(g),Math.abs(V))&&Math.abs(x-q)<=ki.EPSILON*Math.max(1,Math.abs(x),Math.abs(q))},hr.sub=hr.mul=void 0;var ki=function(t,e){if(t&&t.__esModule)return t;if(t===null||vs(t)!=="object"&&typeof t!="function")return{default:t};var r=bs(void 0);if(r&&r.has(t))return r.get(t);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if(l!=="default"&&Object.prototype.hasOwnProperty.call(t,l)){var h=a?Object.getOwnPropertyDescriptor(t,l):null;h&&(h.get||h.set)?Object.defineProperty(n,l,h):n[l]=t[l]}return n.default=t,r&&r.set(t,n),n}(Ut);function bs(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,r=new WeakMap;return(bs=function(n){return n?r:e})(t)}function jo(t,e,r){var n=e[0],a=e[1],l=e[2],h=e[3],f=e[4],m=e[5],g=e[6],x=e[7],v=e[8],w=r[0],S=r[1],A=r[2],P=r[3],R=r[4],L=r[5],V=r[6],q=r[7],G=r[8];return t[0]=w*n+S*h+A*g,t[1]=w*a+S*f+A*x,t[2]=w*l+S*m+A*v,t[3]=P*n+R*h+L*g,t[4]=P*a+R*f+L*x,t[5]=P*l+R*m+L*v,t[6]=V*n+q*h+G*g,t[7]=V*a+q*f+G*x,t[8]=V*l+q*m+G*v,t}function mn(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t}hr.mul=jo,hr.sub=mn;var wt={};function Go(t){return Go=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Go(t)}Object.defineProperty(wt,"__esModule",{value:!0}),wt.create=function(){var t=new Vr.ARRAY_TYPE(16);return Vr.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},wt.clone=function(t){var e=new Vr.ARRAY_TYPE(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},wt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},wt.fromValues=function(t,e,r,n,a,l,h,f,m,g,x,v,w,S,A,P){var R=new Vr.ARRAY_TYPE(16);return R[0]=t,R[1]=e,R[2]=r,R[3]=n,R[4]=a,R[5]=l,R[6]=h,R[7]=f,R[8]=m,R[9]=g,R[10]=x,R[11]=v,R[12]=w,R[13]=S,R[14]=A,R[15]=P,R},wt.set=function(t,e,r,n,a,l,h,f,m,g,x,v,w,S,A,P,R){return t[0]=e,t[1]=r,t[2]=n,t[3]=a,t[4]=l,t[5]=h,t[6]=f,t[7]=m,t[8]=g,t[9]=x,t[10]=v,t[11]=w,t[12]=S,t[13]=A,t[14]=P,t[15]=R,t},wt.identity=ws,wt.transpose=function(t,e){if(t===e){var r=e[1],n=e[2],a=e[3],l=e[6],h=e[7],f=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=n,t[9]=l,t[11]=e[14],t[12]=a,t[13]=h,t[14]=f}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},wt.invert=function(t,e){var r=e[0],n=e[1],a=e[2],l=e[3],h=e[4],f=e[5],m=e[6],g=e[7],x=e[8],v=e[9],w=e[10],S=e[11],A=e[12],P=e[13],R=e[14],L=e[15],V=r*f-n*h,q=r*m-a*h,G=r*g-l*h,ee=n*m-a*f,W=n*g-l*f,re=a*g-l*m,ne=x*P-v*A,de=x*R-w*A,ve=x*L-S*A,pe=v*R-w*P,Te=v*L-S*P,we=w*L-S*R,be=V*we-q*Te+G*pe+ee*ve-W*de+re*ne;return be?(t[0]=(f*we-m*Te+g*pe)*(be=1/be),t[1]=(a*Te-n*we-l*pe)*be,t[2]=(P*re-R*W+L*ee)*be,t[3]=(w*W-v*re-S*ee)*be,t[4]=(m*ve-h*we-g*de)*be,t[5]=(r*we-a*ve+l*de)*be,t[6]=(R*G-A*re-L*q)*be,t[7]=(x*re-w*G+S*q)*be,t[8]=(h*Te-f*ve+g*ne)*be,t[9]=(n*ve-r*Te-l*ne)*be,t[10]=(A*W-P*G+L*V)*be,t[11]=(v*G-x*W-S*V)*be,t[12]=(f*de-h*pe-m*ne)*be,t[13]=(r*pe-n*de+a*ne)*be,t[14]=(P*q-A*ee-R*V)*be,t[15]=(x*ee-v*q+w*V)*be,t):null},wt.adjoint=function(t,e){var r=e[0],n=e[1],a=e[2],l=e[3],h=e[4],f=e[5],m=e[6],g=e[7],x=e[8],v=e[9],w=e[10],S=e[11],A=e[12],P=e[13],R=e[14],L=e[15];return t[0]=f*(w*L-S*R)-v*(m*L-g*R)+P*(m*S-g*w),t[1]=-(n*(w*L-S*R)-v*(a*L-l*R)+P*(a*S-l*w)),t[2]=n*(m*L-g*R)-f*(a*L-l*R)+P*(a*g-l*m),t[3]=-(n*(m*S-g*w)-f*(a*S-l*w)+v*(a*g-l*m)),t[4]=-(h*(w*L-S*R)-x*(m*L-g*R)+A*(m*S-g*w)),t[5]=r*(w*L-S*R)-x*(a*L-l*R)+A*(a*S-l*w),t[6]=-(r*(m*L-g*R)-h*(a*L-l*R)+A*(a*g-l*m)),t[7]=r*(m*S-g*w)-h*(a*S-l*w)+x*(a*g-l*m),t[8]=h*(v*L-S*P)-x*(f*L-g*P)+A*(f*S-g*v),t[9]=-(r*(v*L-S*P)-x*(n*L-l*P)+A*(n*S-l*v)),t[10]=r*(f*L-g*P)-h*(n*L-l*P)+A*(n*g-l*f),t[11]=-(r*(f*S-g*v)-h*(n*S-l*v)+x*(n*g-l*f)),t[12]=-(h*(v*R-w*P)-x*(f*R-m*P)+A*(f*w-m*v)),t[13]=r*(v*R-w*P)-x*(n*R-a*P)+A*(n*w-a*v),t[14]=-(r*(f*R-m*P)-h*(n*R-a*P)+A*(n*m-a*f)),t[15]=r*(f*w-m*v)-h*(n*w-a*v)+x*(n*m-a*f),t},wt.determinant=function(t){var e=t[0],r=t[1],n=t[2],a=t[3],l=t[4],h=t[5],f=t[6],m=t[7],g=t[8],x=t[9],v=t[10],w=t[11],S=t[12],A=t[13],P=t[14],R=t[15];return(e*h-r*l)*(v*R-w*P)-(e*f-n*l)*(x*R-w*A)+(e*m-a*l)*(x*P-v*A)+(r*f-n*h)*(g*R-w*S)-(r*m-a*h)*(g*P-v*S)+(n*m-a*f)*(g*A-x*S)},wt.multiply=bo,wt.translate=function(t,e,r){var n,a,l,h,f,m,g,x,v,w,S,A,P=r[0],R=r[1],L=r[2];return e===t?(t[12]=e[0]*P+e[4]*R+e[8]*L+e[12],t[13]=e[1]*P+e[5]*R+e[9]*L+e[13],t[14]=e[2]*P+e[6]*R+e[10]*L+e[14],t[15]=e[3]*P+e[7]*R+e[11]*L+e[15]):(a=e[1],l=e[2],h=e[3],f=e[4],m=e[5],g=e[6],x=e[7],v=e[8],w=e[9],S=e[10],A=e[11],t[0]=n=e[0],t[1]=a,t[2]=l,t[3]=h,t[4]=f,t[5]=m,t[6]=g,t[7]=x,t[8]=v,t[9]=w,t[10]=S,t[11]=A,t[12]=n*P+f*R+v*L+e[12],t[13]=a*P+m*R+w*L+e[13],t[14]=l*P+g*R+S*L+e[14],t[15]=h*P+x*R+A*L+e[15]),t},wt.scale=function(t,e,r){var n=r[0],a=r[1],l=r[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*a,t[5]=e[5]*a,t[6]=e[6]*a,t[7]=e[7]*a,t[8]=e[8]*l,t[9]=e[9]*l,t[10]=e[10]*l,t[11]=e[11]*l,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},wt.rotate=function(t,e,r,n){var a,l,h,f,m,g,x,v,w,S,A,P,R,L,V,q,G,ee,W,re,ne,de,ve,pe,Te=n[0],we=n[1],be=n[2],Ce=Math.hypot(Te,we,be);return Ce<Vr.EPSILON?null:(Te*=Ce=1/Ce,we*=Ce,be*=Ce,a=Math.sin(r),l=Math.cos(r),m=e[1],g=e[2],x=e[3],w=e[5],S=e[6],A=e[7],R=e[9],L=e[10],V=e[11],q=Te*Te*(h=1-l)+l,W=Te*we*h-be*a,re=we*we*h+l,ne=be*we*h+Te*a,de=Te*be*h+we*a,ve=we*be*h-Te*a,pe=be*be*h+l,t[0]=(f=e[0])*q+(v=e[4])*(G=we*Te*h+be*a)+(P=e[8])*(ee=be*Te*h-we*a),t[1]=m*q+w*G+R*ee,t[2]=g*q+S*G+L*ee,t[3]=x*q+A*G+V*ee,t[4]=f*W+v*re+P*ne,t[5]=m*W+w*re+R*ne,t[6]=g*W+S*re+L*ne,t[7]=x*W+A*re+V*ne,t[8]=f*de+v*ve+P*pe,t[9]=m*de+w*ve+R*pe,t[10]=g*de+S*ve+L*pe,t[11]=x*de+A*ve+V*pe,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},wt.rotateX=function(t,e,r){var n=Math.sin(r),a=Math.cos(r),l=e[4],h=e[5],f=e[6],m=e[7],g=e[8],x=e[9],v=e[10],w=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=l*a+g*n,t[5]=h*a+x*n,t[6]=f*a+v*n,t[7]=m*a+w*n,t[8]=g*a-l*n,t[9]=x*a-h*n,t[10]=v*a-f*n,t[11]=w*a-m*n,t},wt.rotateY=function(t,e,r){var n=Math.sin(r),a=Math.cos(r),l=e[0],h=e[1],f=e[2],m=e[3],g=e[8],x=e[9],v=e[10],w=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=l*a-g*n,t[1]=h*a-x*n,t[2]=f*a-v*n,t[3]=m*a-w*n,t[8]=l*n+g*a,t[9]=h*n+x*a,t[10]=f*n+v*a,t[11]=m*n+w*a,t},wt.rotateZ=function(t,e,r){var n=Math.sin(r),a=Math.cos(r),l=e[0],h=e[1],f=e[2],m=e[3],g=e[4],x=e[5],v=e[6],w=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=l*a+g*n,t[1]=h*a+x*n,t[2]=f*a+v*n,t[3]=m*a+w*n,t[4]=g*a-l*n,t[5]=x*a-h*n,t[6]=v*a-f*n,t[7]=w*a-m*n,t},wt.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},wt.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},wt.fromRotation=function(t,e,r){var n,a,l,h=r[0],f=r[1],m=r[2],g=Math.hypot(h,f,m);return g<Vr.EPSILON?null:(h*=g=1/g,f*=g,m*=g,n=Math.sin(e),a=Math.cos(e),t[0]=h*h*(l=1-a)+a,t[1]=f*h*l+m*n,t[2]=m*h*l-f*n,t[3]=0,t[4]=h*f*l-m*n,t[5]=f*f*l+a,t[6]=m*f*l+h*n,t[7]=0,t[8]=h*m*l+f*n,t[9]=f*m*l-h*n,t[10]=m*m*l+a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},wt.fromXRotation=function(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=r,t[7]=0,t[8]=0,t[9]=-r,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},wt.fromYRotation=function(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},wt.fromZRotation=function(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=0,t[3]=0,t[4]=-r,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},wt.fromRotationTranslation=wo,wt.fromQuat2=function(t,e){var r=new Vr.ARRAY_TYPE(3),n=-e[0],a=-e[1],l=-e[2],h=e[3],f=e[4],m=e[5],g=e[6],x=e[7],v=n*n+a*a+l*l+h*h;return v>0?(r[0]=2*(f*h+x*n+m*l-g*a)/v,r[1]=2*(m*h+x*a+g*n-f*l)/v,r[2]=2*(g*h+x*l+f*a-m*n)/v):(r[0]=2*(f*h+x*n+m*l-g*a),r[1]=2*(m*h+x*a+g*n-f*l),r[2]=2*(g*h+x*l+f*a-m*n)),wo(t,e,r),t},wt.getTranslation=function(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t},wt.getScaling=wa,wt.getRotation=function(t,e){var r=new Vr.ARRAY_TYPE(3);wa(r,e);var n=1/r[0],a=1/r[1],l=1/r[2],h=e[0]*n,f=e[1]*a,m=e[2]*l,g=e[4]*n,x=e[5]*a,v=e[6]*l,w=e[8]*n,S=e[9]*a,A=e[10]*l,P=h+x+A,R=0;return P>0?(R=2*Math.sqrt(P+1),t[3]=.25*R,t[0]=(v-S)/R,t[1]=(w-m)/R,t[2]=(f-g)/R):h>x&&h>A?(R=2*Math.sqrt(1+h-x-A),t[3]=(v-S)/R,t[0]=.25*R,t[1]=(f+g)/R,t[2]=(w+m)/R):x>A?(R=2*Math.sqrt(1+x-h-A),t[3]=(w-m)/R,t[0]=(f+g)/R,t[1]=.25*R,t[2]=(v+S)/R):(R=2*Math.sqrt(1+A-h-x),t[3]=(f-g)/R,t[0]=(w+m)/R,t[1]=(v+S)/R,t[2]=.25*R),t},wt.fromRotationTranslationScale=function(t,e,r,n){var a=e[0],l=e[1],h=e[2],f=e[3],m=a+a,g=l+l,x=h+h,v=a*m,w=a*g,S=a*x,A=l*g,P=l*x,R=h*x,L=f*m,V=f*g,q=f*x,G=n[0],ee=n[1],W=n[2];return t[0]=(1-(A+R))*G,t[1]=(w+q)*G,t[2]=(S-V)*G,t[3]=0,t[4]=(w-q)*ee,t[5]=(1-(v+R))*ee,t[6]=(P+L)*ee,t[7]=0,t[8]=(S+V)*W,t[9]=(P-L)*W,t[10]=(1-(v+A))*W,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t},wt.fromRotationTranslationScaleOrigin=function(t,e,r,n,a){var l=e[0],h=e[1],f=e[2],m=e[3],g=l+l,x=h+h,v=f+f,w=l*g,S=l*x,A=l*v,P=h*x,R=h*v,L=f*v,V=m*g,q=m*x,G=m*v,ee=n[0],W=n[1],re=n[2],ne=a[0],de=a[1],ve=a[2],pe=(1-(P+L))*ee,Te=(S+G)*ee,we=(A-q)*ee,be=(S-G)*W,Ce=(1-(w+L))*W,Ie=(R+V)*W,ke=(A+q)*re,Le=(R-V)*re,Se=(1-(w+P))*re;return t[0]=pe,t[1]=Te,t[2]=we,t[3]=0,t[4]=be,t[5]=Ce,t[6]=Ie,t[7]=0,t[8]=ke,t[9]=Le,t[10]=Se,t[11]=0,t[12]=r[0]+ne-(pe*ne+be*de+ke*ve),t[13]=r[1]+de-(Te*ne+Ce*de+Le*ve),t[14]=r[2]+ve-(we*ne+Ie*de+Se*ve),t[15]=1,t},wt.fromQuat=function(t,e){var r=e[0],n=e[1],a=e[2],l=e[3],h=r+r,f=n+n,m=a+a,g=r*h,x=n*h,v=n*f,w=a*h,S=a*f,A=a*m,P=l*h,R=l*f,L=l*m;return t[0]=1-v-A,t[1]=x+L,t[2]=w-R,t[3]=0,t[4]=x-L,t[5]=1-g-A,t[6]=S+P,t[7]=0,t[8]=w+R,t[9]=S-P,t[10]=1-g-v,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},wt.frustum=function(t,e,r,n,a,l,h){var f=1/(r-e),m=1/(a-n),g=1/(l-h);return t[0]=2*l*f,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*l*m,t[6]=0,t[7]=0,t[8]=(r+e)*f,t[9]=(a+n)*m,t[10]=(h+l)*g,t[11]=-1,t[12]=0,t[13]=0,t[14]=h*l*2*g,t[15]=0,t},wt.perspectiveNO=Ts,wt.perspectiveZO=function(t,e,r,n,a){var l,h=1/Math.tan(e/2);return t[0]=h/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,a!=null&&a!==1/0?(t[10]=a*(l=1/(n-a)),t[14]=a*n*l):(t[10]=-1,t[14]=-n),t},wt.perspectiveFromFieldOfView=function(t,e,r,n){var a=Math.tan(e.upDegrees*Math.PI/180),l=Math.tan(e.downDegrees*Math.PI/180),h=Math.tan(e.leftDegrees*Math.PI/180),f=Math.tan(e.rightDegrees*Math.PI/180),m=2/(h+f),g=2/(a+l);return t[0]=m,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=g,t[6]=0,t[7]=0,t[8]=-(h-f)*m*.5,t[9]=(a-l)*g*.5,t[10]=n/(r-n),t[11]=-1,t[12]=0,t[13]=0,t[14]=n*r/(r-n),t[15]=0,t},wt.orthoNO=li,wt.orthoZO=function(t,e,r,n,a,l,h){var f=1/(e-r),m=1/(n-a),g=1/(l-h);return t[0]=-2*f,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*m,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=g,t[11]=0,t[12]=(e+r)*f,t[13]=(a+n)*m,t[14]=l*g,t[15]=1,t},wt.lookAt=function(t,e,r,n){var a,l,h,f,m,g,x,v,w,S,A=e[0],P=e[1],R=e[2],L=n[0],V=n[1],q=n[2],G=r[0],ee=r[1],W=r[2];return Math.abs(A-G)<Vr.EPSILON&&Math.abs(P-ee)<Vr.EPSILON&&Math.abs(R-W)<Vr.EPSILON?ws(t):(x=A-G,v=P-ee,w=R-W,a=V*(w*=S=1/Math.hypot(x,v,w))-q*(v*=S),l=q*(x*=S)-L*w,h=L*v-V*x,(S=Math.hypot(a,l,h))?(a*=S=1/S,l*=S,h*=S):(a=0,l=0,h=0),f=v*h-w*l,m=w*a-x*h,g=x*l-v*a,(S=Math.hypot(f,m,g))?(f*=S=1/S,m*=S,g*=S):(f=0,m=0,g=0),t[0]=a,t[1]=f,t[2]=x,t[3]=0,t[4]=l,t[5]=m,t[6]=v,t[7]=0,t[8]=h,t[9]=g,t[10]=w,t[11]=0,t[12]=-(a*A+l*P+h*R),t[13]=-(f*A+m*P+g*R),t[14]=-(x*A+v*P+w*R),t[15]=1,t)},wt.targetTo=function(t,e,r,n){var a=e[0],l=e[1],h=e[2],f=n[0],m=n[1],g=n[2],x=a-r[0],v=l-r[1],w=h-r[2],S=x*x+v*v+w*w;S>0&&(x*=S=1/Math.sqrt(S),v*=S,w*=S);var A=m*w-g*v,P=g*x-f*w,R=f*v-m*x;return(S=A*A+P*P+R*R)>0&&(A*=S=1/Math.sqrt(S),P*=S,R*=S),t[0]=A,t[1]=P,t[2]=R,t[3]=0,t[4]=v*R-w*P,t[5]=w*A-x*R,t[6]=x*P-v*A,t[7]=0,t[8]=x,t[9]=v,t[10]=w,t[11]=0,t[12]=a,t[13]=l,t[14]=h,t[15]=1,t},wt.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},wt.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])},wt.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t[9]=e[9]+r[9],t[10]=e[10]+r[10],t[11]=e[11]+r[11],t[12]=e[12]+r[12],t[13]=e[13]+r[13],t[14]=e[14]+r[14],t[15]=e[15]+r[15],t},wt.subtract=Dl,wt.multiplyScalar=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12]*r,t[13]=e[13]*r,t[14]=e[14]*r,t[15]=e[15]*r,t},wt.multiplyScalarAndAdd=function(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t[4]=e[4]+r[4]*n,t[5]=e[5]+r[5]*n,t[6]=e[6]+r[6]*n,t[7]=e[7]+r[7]*n,t[8]=e[8]+r[8]*n,t[9]=e[9]+r[9]*n,t[10]=e[10]+r[10]*n,t[11]=e[11]+r[11]*n,t[12]=e[12]+r[12]*n,t[13]=e[13]+r[13]*n,t[14]=e[14]+r[14]*n,t[15]=e[15]+r[15]*n,t},wt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},wt.equals=function(t,e){var r=t[0],n=t[1],a=t[2],l=t[3],h=t[4],f=t[5],m=t[6],g=t[7],x=t[8],v=t[9],w=t[10],S=t[11],A=t[12],P=t[13],R=t[14],L=t[15],V=e[0],q=e[1],G=e[2],ee=e[3],W=e[4],re=e[5],ne=e[6],de=e[7],ve=e[8],pe=e[9],Te=e[10],we=e[11],be=e[12],Ce=e[13],Ie=e[14],ke=e[15];return Math.abs(r-V)<=Vr.EPSILON*Math.max(1,Math.abs(r),Math.abs(V))&&Math.abs(n-q)<=Vr.EPSILON*Math.max(1,Math.abs(n),Math.abs(q))&&Math.abs(a-G)<=Vr.EPSILON*Math.max(1,Math.abs(a),Math.abs(G))&&Math.abs(l-ee)<=Vr.EPSILON*Math.max(1,Math.abs(l),Math.abs(ee))&&Math.abs(h-W)<=Vr.EPSILON*Math.max(1,Math.abs(h),Math.abs(W))&&Math.abs(f-re)<=Vr.EPSILON*Math.max(1,Math.abs(f),Math.abs(re))&&Math.abs(m-ne)<=Vr.EPSILON*Math.max(1,Math.abs(m),Math.abs(ne))&&Math.abs(g-de)<=Vr.EPSILON*Math.max(1,Math.abs(g),Math.abs(de))&&Math.abs(x-ve)<=Vr.EPSILON*Math.max(1,Math.abs(x),Math.abs(ve))&&Math.abs(v-pe)<=Vr.EPSILON*Math.max(1,Math.abs(v),Math.abs(pe))&&Math.abs(w-Te)<=Vr.EPSILON*Math.max(1,Math.abs(w),Math.abs(Te))&&Math.abs(S-we)<=Vr.EPSILON*Math.max(1,Math.abs(S),Math.abs(we))&&Math.abs(A-be)<=Vr.EPSILON*Math.max(1,Math.abs(A),Math.abs(be))&&Math.abs(P-Ce)<=Vr.EPSILON*Math.max(1,Math.abs(P),Math.abs(Ce))&&Math.abs(R-Ie)<=Vr.EPSILON*Math.max(1,Math.abs(R),Math.abs(Ie))&&Math.abs(L-ke)<=Vr.EPSILON*Math.max(1,Math.abs(L),Math.abs(ke))},wt.sub=wt.mul=wt.ortho=wt.perspective=void 0;var Vr=function(t,e){if(t&&t.__esModule)return t;if(t===null||Go(t)!=="object"&&typeof t!="function")return{default:t};var r=ba(void 0);if(r&&r.has(t))return r.get(t);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if(l!=="default"&&Object.prototype.hasOwnProperty.call(t,l)){var h=a?Object.getOwnPropertyDescriptor(t,l):null;h&&(h.get||h.set)?Object.defineProperty(n,l,h):n[l]=t[l]}return n.default=t,r&&r.set(t,n),n}(Ut);function ba(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,r=new WeakMap;return(ba=function(n){return n?r:e})(t)}function ws(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function bo(t,e,r){var n=e[0],a=e[1],l=e[2],h=e[3],f=e[4],m=e[5],g=e[6],x=e[7],v=e[8],w=e[9],S=e[10],A=e[11],P=e[12],R=e[13],L=e[14],V=e[15],q=r[0],G=r[1],ee=r[2],W=r[3];return t[0]=q*n+G*f+ee*v+W*P,t[1]=q*a+G*m+ee*w+W*R,t[2]=q*l+G*g+ee*S+W*L,t[3]=q*h+G*x+ee*A+W*V,t[4]=(q=r[4])*n+(G=r[5])*f+(ee=r[6])*v+(W=r[7])*P,t[5]=q*a+G*m+ee*w+W*R,t[6]=q*l+G*g+ee*S+W*L,t[7]=q*h+G*x+ee*A+W*V,t[8]=(q=r[8])*n+(G=r[9])*f+(ee=r[10])*v+(W=r[11])*P,t[9]=q*a+G*m+ee*w+W*R,t[10]=q*l+G*g+ee*S+W*L,t[11]=q*h+G*x+ee*A+W*V,t[12]=(q=r[12])*n+(G=r[13])*f+(ee=r[14])*v+(W=r[15])*P,t[13]=q*a+G*m+ee*w+W*R,t[14]=q*l+G*g+ee*S+W*L,t[15]=q*h+G*x+ee*A+W*V,t}function wo(t,e,r){var n=e[0],a=e[1],l=e[2],h=e[3],f=n+n,m=a+a,g=l+l,x=n*f,v=n*m,w=n*g,S=a*m,A=a*g,P=l*g,R=h*f,L=h*m,V=h*g;return t[0]=1-(S+P),t[1]=v+V,t[2]=w-L,t[3]=0,t[4]=v-V,t[5]=1-(x+P),t[6]=A+R,t[7]=0,t[8]=w+L,t[9]=A-R,t[10]=1-(x+S),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function wa(t,e){var r=e[4],n=e[5],a=e[6],l=e[8],h=e[9],f=e[10];return t[0]=Math.hypot(e[0],e[1],e[2]),t[1]=Math.hypot(r,n,a),t[2]=Math.hypot(l,h,f),t}function Ts(t,e,r,n,a){var l,h=1/Math.tan(e/2);return t[0]=h/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,a!=null&&a!==1/0?(t[10]=(a+n)*(l=1/(n-a)),t[14]=2*a*n*l):(t[10]=-1,t[14]=-2*n),t}function li(t,e,r,n,a,l,h){var f=1/(e-r),m=1/(n-a),g=1/(l-h);return t[0]=-2*f,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*m,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*g,t[11]=0,t[12]=(e+r)*f,t[13]=(a+n)*m,t[14]=(h+l)*g,t[15]=1,t}function Dl(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t[9]=e[9]-r[9],t[10]=e[10]-r[10],t[11]=e[11]-r[11],t[12]=e[12]-r[12],t[13]=e[13]-r[13],t[14]=e[14]-r[14],t[15]=e[15]-r[15],t}wt.perspective=Ts,wt.ortho=li,wt.mul=bo,wt.sub=Dl;var It={},Et={};function Ta(t){return Ta=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ta(t)}Object.defineProperty(Et,"__esModule",{value:!0}),Et.create=Z,Et.clone=function(t){var e=new _n.ARRAY_TYPE(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},Et.length=K,Et.fromValues=function(t,e,r){var n=new _n.ARRAY_TYPE(3);return n[0]=t,n[1]=e,n[2]=r,n},Et.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},Et.set=function(t,e,r,n){return t[0]=e,t[1]=r,t[2]=n,t},Et.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t},Et.subtract=ce,Et.multiply=De,Et.divide=Oe,Et.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},Et.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},Et.min=function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t},Et.max=function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t},Et.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},Et.scale=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t},Et.scaleAndAdd=function(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t},Et.distance=Ue,Et.squaredDistance=dt,Et.squaredLength=Pe,Et.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},Et.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},Et.normalize=function(t,e){var r=e[0],n=e[1],a=e[2],l=r*r+n*n+a*a;return l>0&&(l=1/Math.sqrt(l)),t[0]=e[0]*l,t[1]=e[1]*l,t[2]=e[2]*l,t},Et.dot=ot,Et.cross=function(t,e,r){var n=e[0],a=e[1],l=e[2],h=r[0],f=r[1],m=r[2];return t[0]=a*m-l*f,t[1]=l*h-n*m,t[2]=n*f-a*h,t},Et.lerp=function(t,e,r,n){var a=e[0],l=e[1],h=e[2];return t[0]=a+n*(r[0]-a),t[1]=l+n*(r[1]-l),t[2]=h+n*(r[2]-h),t},Et.hermite=function(t,e,r,n,a,l){var h=l*l,f=h*(2*l-3)+1,m=h*(l-2)+l,g=h*(l-1),x=h*(3-2*l);return t[0]=e[0]*f+r[0]*m+n[0]*g+a[0]*x,t[1]=e[1]*f+r[1]*m+n[1]*g+a[1]*x,t[2]=e[2]*f+r[2]*m+n[2]*g+a[2]*x,t},Et.bezier=function(t,e,r,n,a,l){var h=1-l,f=h*h,m=l*l,g=f*h,x=3*l*f,v=3*m*h,w=m*l;return t[0]=e[0]*g+r[0]*x+n[0]*v+a[0]*w,t[1]=e[1]*g+r[1]*x+n[1]*v+a[1]*w,t[2]=e[2]*g+r[2]*x+n[2]*v+a[2]*w,t},Et.random=function(t,e){e=e||1;var r=2*_n.RANDOM()*Math.PI,n=2*_n.RANDOM()-1,a=Math.sqrt(1-n*n)*e;return t[0]=Math.cos(r)*a,t[1]=Math.sin(r)*a,t[2]=n*e,t},Et.transformMat4=function(t,e,r){var n=e[0],a=e[1],l=e[2],h=r[3]*n+r[7]*a+r[11]*l+r[15];return t[0]=(r[0]*n+r[4]*a+r[8]*l+r[12])/(h=h||1),t[1]=(r[1]*n+r[5]*a+r[9]*l+r[13])/h,t[2]=(r[2]*n+r[6]*a+r[10]*l+r[14])/h,t},Et.transformMat3=function(t,e,r){var n=e[0],a=e[1],l=e[2];return t[0]=n*r[0]+a*r[3]+l*r[6],t[1]=n*r[1]+a*r[4]+l*r[7],t[2]=n*r[2]+a*r[5]+l*r[8],t},Et.transformQuat=function(t,e,r){var n=r[0],a=r[1],l=r[2],h=e[0],f=e[1],m=e[2],g=a*m-l*f,x=l*h-n*m,v=n*f-a*h,w=a*v-l*x,S=l*g-n*v,A=n*x-a*g,P=2*r[3];return x*=P,v*=P,S*=2,A*=2,t[0]=h+(g*=P)+(w*=2),t[1]=f+x+S,t[2]=m+v+A,t},Et.rotateX=function(t,e,r,n){var a=[],l=[];return a[0]=e[0]-r[0],a[1]=e[1]-r[1],a[2]=e[2]-r[2],l[0]=a[0],l[1]=a[1]*Math.cos(n)-a[2]*Math.sin(n),l[2]=a[1]*Math.sin(n)+a[2]*Math.cos(n),t[0]=l[0]+r[0],t[1]=l[1]+r[1],t[2]=l[2]+r[2],t},Et.rotateY=function(t,e,r,n){var a=[],l=[];return a[0]=e[0]-r[0],a[1]=e[1]-r[1],a[2]=e[2]-r[2],l[0]=a[2]*Math.sin(n)+a[0]*Math.cos(n),l[1]=a[1],l[2]=a[2]*Math.cos(n)-a[0]*Math.sin(n),t[0]=l[0]+r[0],t[1]=l[1]+r[1],t[2]=l[2]+r[2],t},Et.rotateZ=function(t,e,r,n){var a=[],l=[];return a[0]=e[0]-r[0],a[1]=e[1]-r[1],a[2]=e[2]-r[2],l[0]=a[0]*Math.cos(n)-a[1]*Math.sin(n),l[1]=a[0]*Math.sin(n)+a[1]*Math.cos(n),l[2]=a[2],t[0]=l[0]+r[0],t[1]=l[1]+r[1],t[2]=l[2]+r[2],t},Et.angle=function(t,e){var r=t[0],n=t[1],a=t[2],l=e[0],h=e[1],f=e[2],m=Math.sqrt(r*r+n*n+a*a)*Math.sqrt(l*l+h*h+f*f),g=m&&ot(t,e)/m;return Math.acos(Math.min(Math.max(g,-1),1))},Et.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t},Et.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},Et.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},Et.equals=function(t,e){var r=t[0],n=t[1],a=t[2],l=e[0],h=e[1],f=e[2];return Math.abs(r-l)<=_n.EPSILON*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(n-h)<=_n.EPSILON*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(a-f)<=_n.EPSILON*Math.max(1,Math.abs(a),Math.abs(f))},Et.forEach=Et.sqrLen=Et.len=Et.sqrDist=Et.dist=Et.div=Et.mul=Et.sub=void 0;var _n=function(t,e){if(t&&t.__esModule)return t;if(t===null||Ta(t)!=="object"&&typeof t!="function")return{default:t};var r=Ve(void 0);if(r&&r.has(t))return r.get(t);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if(l!=="default"&&Object.prototype.hasOwnProperty.call(t,l)){var h=a?Object.getOwnPropertyDescriptor(t,l):null;h&&(h.get||h.set)?Object.defineProperty(n,l,h):n[l]=t[l]}return n.default=t,r&&r.set(t,n),n}(Ut);function Ve(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,r=new WeakMap;return(Ve=function(n){return n?r:e})(t)}function Z(){var t=new _n.ARRAY_TYPE(3);return _n.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function K(t){return Math.hypot(t[0],t[1],t[2])}function ce(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function De(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t}function Oe(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t}function Ue(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])}function dt(t,e){var r=e[0]-t[0],n=e[1]-t[1],a=e[2]-t[2];return r*r+n*n+a*a}function Pe(t){var e=t[0],r=t[1],n=t[2];return e*e+r*r+n*n}function ot(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}Et.sub=ce,Et.mul=De,Et.div=Oe,Et.dist=Ue,Et.sqrDist=dt,Et.len=K,Et.sqrLen=Pe;var ut,gt=(ut=Z(),function(t,e,r,n,a,l){var h,f;for(e||(e=3),r||(r=0),f=n?Math.min(n*e+r,t.length):t.length,h=r;h<f;h+=e)ut[0]=t[h],ut[1]=t[h+1],ut[2]=t[h+2],a(ut,ut,l),t[h]=ut[0],t[h+1]=ut[1],t[h+2]=ut[2];return t});Et.forEach=gt;var Ke={};function Sr(t){return Sr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Sr(t)}Object.defineProperty(Ke,"__esModule",{value:!0}),Ke.create=pr,Ke.clone=function(t){var e=new fr.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},Ke.fromValues=function(t,e,r,n){var a=new fr.ARRAY_TYPE(4);return a[0]=t,a[1]=e,a[2]=r,a[3]=n,a},Ke.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},Ke.set=function(t,e,r,n,a){return t[0]=e,t[1]=r,t[2]=n,t[3]=a,t},Ke.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t},Ke.subtract=mr,Ke.multiply=Er,Ke.divide=qr,Ke.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t},Ke.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t},Ke.min=function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t[3]=Math.min(e[3],r[3]),t},Ke.max=function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t[3]=Math.max(e[3],r[3]),t},Ke.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t},Ke.scale=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t},Ke.scaleAndAdd=function(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t},Ke.distance=xi,Ke.squaredDistance=Nr,Ke.length=Gi,Ke.squaredLength=Bi,Ke.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},Ke.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},Ke.normalize=function(t,e){var r=e[0],n=e[1],a=e[2],l=e[3],h=r*r+n*n+a*a+l*l;return h>0&&(h=1/Math.sqrt(h)),t[0]=r*h,t[1]=n*h,t[2]=a*h,t[3]=l*h,t},Ke.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},Ke.cross=function(t,e,r,n){var a=r[0]*n[1]-r[1]*n[0],l=r[0]*n[2]-r[2]*n[0],h=r[0]*n[3]-r[3]*n[0],f=r[1]*n[2]-r[2]*n[1],m=r[1]*n[3]-r[3]*n[1],g=r[2]*n[3]-r[3]*n[2],x=e[0],v=e[1],w=e[2],S=e[3];return t[0]=v*g-w*m+S*f,t[1]=-x*g+w*h-S*l,t[2]=x*m-v*h+S*a,t[3]=-x*f+v*l-w*a,t},Ke.lerp=function(t,e,r,n){var a=e[0],l=e[1],h=e[2],f=e[3];return t[0]=a+n*(r[0]-a),t[1]=l+n*(r[1]-l),t[2]=h+n*(r[2]-h),t[3]=f+n*(r[3]-f),t},Ke.random=function(t,e){var r,n,a,l,h,f;e=e||1;do h=(r=2*fr.RANDOM()-1)*r+(n=2*fr.RANDOM()-1)*n;while(h>=1);do f=(a=2*fr.RANDOM()-1)*a+(l=2*fr.RANDOM()-1)*l;while(f>=1);var m=Math.sqrt((1-h)/f);return t[0]=e*r,t[1]=e*n,t[2]=e*a*m,t[3]=e*l*m,t},Ke.transformMat4=function(t,e,r){var n=e[0],a=e[1],l=e[2],h=e[3];return t[0]=r[0]*n+r[4]*a+r[8]*l+r[12]*h,t[1]=r[1]*n+r[5]*a+r[9]*l+r[13]*h,t[2]=r[2]*n+r[6]*a+r[10]*l+r[14]*h,t[3]=r[3]*n+r[7]*a+r[11]*l+r[15]*h,t},Ke.transformQuat=function(t,e,r){var n=e[0],a=e[1],l=e[2],h=r[0],f=r[1],m=r[2],g=r[3],x=g*n+f*l-m*a,v=g*a+m*n-h*l,w=g*l+h*a-f*n,S=-h*n-f*a-m*l;return t[0]=x*g+S*-h+v*-m-w*-f,t[1]=v*g+S*-f+w*-h-x*-m,t[2]=w*g+S*-m+x*-f-v*-h,t[3]=e[3],t},Ke.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},Ke.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},Ke.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},Ke.equals=function(t,e){var r=t[0],n=t[1],a=t[2],l=t[3],h=e[0],f=e[1],m=e[2],g=e[3];return Math.abs(r-h)<=fr.EPSILON*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(n-f)<=fr.EPSILON*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(a-m)<=fr.EPSILON*Math.max(1,Math.abs(a),Math.abs(m))&&Math.abs(l-g)<=fr.EPSILON*Math.max(1,Math.abs(l),Math.abs(g))},Ke.forEach=Ke.sqrLen=Ke.len=Ke.sqrDist=Ke.dist=Ke.div=Ke.mul=Ke.sub=void 0;var fr=function(t,e){if(t&&t.__esModule)return t;if(t===null||Sr(t)!=="object"&&typeof t!="function")return{default:t};var r=br(void 0);if(r&&r.has(t))return r.get(t);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if(l!=="default"&&Object.prototype.hasOwnProperty.call(t,l)){var h=a?Object.getOwnPropertyDescriptor(t,l):null;h&&(h.get||h.set)?Object.defineProperty(n,l,h):n[l]=t[l]}return n.default=t,r&&r.set(t,n),n}(Ut);function br(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,r=new WeakMap;return(br=function(n){return n?r:e})(t)}function pr(){var t=new fr.ARRAY_TYPE(4);return fr.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function mr(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function Er(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t[3]=e[3]*r[3],t}function qr(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t[3]=e[3]/r[3],t}function xi(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2],e[3]-t[3])}function Nr(t,e){var r=e[0]-t[0],n=e[1]-t[1],a=e[2]-t[2],l=e[3]-t[3];return r*r+n*n+a*a+l*l}function Gi(t){return Math.hypot(t[0],t[1],t[2],t[3])}function Bi(t){var e=t[0],r=t[1],n=t[2],a=t[3];return e*e+r*r+n*n+a*a}Ke.sub=mr,Ke.mul=Er,Ke.div=qr,Ke.dist=xi,Ke.sqrDist=Nr,Ke.len=Gi,Ke.sqrLen=Bi;var En=function(){var t=pr();return function(e,r,n,a,l,h){var f,m;for(r||(r=4),n||(n=0),m=a?Math.min(a*r+n,e.length):e.length,f=n;f<m;f+=r)t[0]=e[f],t[1]=e[f+1],t[2]=e[f+2],t[3]=e[f+3],l(t,t,h),e[f]=t[0],e[f+1]=t[1],e[f+2]=t[2],e[f+3]=t[3];return e}}();function ci(t){return ci=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ci(t)}Ke.forEach=En,Object.defineProperty(It,"__esModule",{value:!0}),It.create=Xe,It.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},It.setAxisAngle=Ye,It.getAxisAngle=function(t,e){var r=2*Math.acos(e[3]),n=Math.sin(r/2);return n>Wr.EPSILON?(t[0]=e[0]/n,t[1]=e[1]/n,t[2]=e[2]/n):(t[0]=1,t[1]=0,t[2]=0),r},It.getAngle=function(t,e){var r=Ar(t,e);return Math.acos(2*r*r-1)},It.multiply=$e,It.rotateX=function(t,e,r){r*=.5;var n=e[0],a=e[1],l=e[2],h=e[3],f=Math.sin(r),m=Math.cos(r);return t[0]=n*m+h*f,t[1]=a*m+l*f,t[2]=l*m-a*f,t[3]=h*m-n*f,t},It.rotateY=function(t,e,r){r*=.5;var n=e[0],a=e[1],l=e[2],h=e[3],f=Math.sin(r),m=Math.cos(r);return t[0]=n*m-l*f,t[1]=a*m+h*f,t[2]=l*m+n*f,t[3]=h*m-a*f,t},It.rotateZ=function(t,e,r){r*=.5;var n=e[0],a=e[1],l=e[2],h=e[3],f=Math.sin(r),m=Math.cos(r);return t[0]=n*m+a*f,t[1]=a*m-n*f,t[2]=l*m+h*f,t[3]=h*m-l*f,t},It.calculateW=function(t,e){var r=e[0],n=e[1],a=e[2];return t[0]=r,t[1]=n,t[2]=a,t[3]=Math.sqrt(Math.abs(1-r*r-n*n-a*a)),t},It.exp=tt,It.ln=We,It.pow=function(t,e,r){return We(t,e),mt(t,t,r),tt(t,t),t},It.slerp=Pt,It.random=function(t){var e=Wr.RANDOM(),r=Wr.RANDOM(),n=Wr.RANDOM(),a=Math.sqrt(1-e),l=Math.sqrt(e);return t[0]=a*Math.sin(2*Math.PI*r),t[1]=a*Math.cos(2*Math.PI*r),t[2]=l*Math.sin(2*Math.PI*n),t[3]=l*Math.cos(2*Math.PI*n),t},It.invert=function(t,e){var r=e[0],n=e[1],a=e[2],l=e[3],h=r*r+n*n+a*a+l*l,f=h?1/h:0;return t[0]=-r*f,t[1]=-n*f,t[2]=-a*f,t[3]=l*f,t},It.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},It.fromMat3=Yt,It.fromEuler=function(t,e,r,n){var a=.5*Math.PI/180;e*=a,r*=a,n*=a;var l=Math.sin(e),h=Math.cos(e),f=Math.sin(r),m=Math.cos(r),g=Math.sin(n),x=Math.cos(n);return t[0]=l*m*x-h*f*g,t[1]=h*f*x+l*m*g,t[2]=h*m*g-l*f*x,t[3]=h*m*x+l*f*g,t},It.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},It.setAxes=It.sqlerp=It.rotationTo=It.equals=It.exactEquals=It.normalize=It.sqrLen=It.squaredLength=It.len=It.length=It.lerp=It.dot=It.scale=It.mul=It.add=It.set=It.copy=It.fromValues=It.clone=void 0;var Wr=je(Ut),Ae=je(hr),Me=je(Et),Be=je(Ke);function Ge(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,r=new WeakMap;return(Ge=function(n){return n?r:e})(t)}function je(t,e){if(t&&t.__esModule)return t;if(t===null||ci(t)!=="object"&&typeof t!="function")return{default:t};var r=Ge(e);if(r&&r.has(t))return r.get(t);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if(l!=="default"&&Object.prototype.hasOwnProperty.call(t,l)){var h=a?Object.getOwnPropertyDescriptor(t,l):null;h&&(h.get||h.set)?Object.defineProperty(n,l,h):n[l]=t[l]}return n.default=t,r&&r.set(t,n),n}function Xe(){var t=new Wr.ARRAY_TYPE(4);return Wr.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Ye(t,e,r){r*=.5;var n=Math.sin(r);return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=Math.cos(r),t}function $e(t,e,r){var n=e[0],a=e[1],l=e[2],h=e[3],f=r[0],m=r[1],g=r[2],x=r[3];return t[0]=n*x+h*f+a*g-l*m,t[1]=a*x+h*m+l*f-n*g,t[2]=l*x+h*g+n*m-a*f,t[3]=h*x-n*f-a*m-l*g,t}function tt(t,e){var r=e[0],n=e[1],a=e[2],l=e[3],h=Math.sqrt(r*r+n*n+a*a),f=Math.exp(l),m=h>0?f*Math.sin(h)/h:0;return t[0]=r*m,t[1]=n*m,t[2]=a*m,t[3]=f*Math.cos(h),t}function We(t,e){var r=e[0],n=e[1],a=e[2],l=e[3],h=Math.sqrt(r*r+n*n+a*a),f=h>0?Math.atan2(h,l)/h:0;return t[0]=r*f,t[1]=n*f,t[2]=a*f,t[3]=.5*Math.log(r*r+n*n+a*a+l*l),t}function Pt(t,e,r,n){var a,l,h,f,m,g=e[0],x=e[1],v=e[2],w=e[3],S=r[0],A=r[1],P=r[2],R=r[3];return(l=g*S+x*A+v*P+w*R)<0&&(l=-l,S=-S,A=-A,P=-P,R=-R),1-l>Wr.EPSILON?(a=Math.acos(l),h=Math.sin(a),f=Math.sin((1-n)*a)/h,m=Math.sin(n*a)/h):(f=1-n,m=n),t[0]=f*g+m*S,t[1]=f*x+m*A,t[2]=f*v+m*P,t[3]=f*w+m*R,t}function Yt(t,e){var r,n=e[0]+e[4]+e[8];if(n>0)r=Math.sqrt(n+1),t[3]=.5*r,t[0]=(e[5]-e[7])*(r=.5/r),t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{var a=0;e[4]>e[0]&&(a=1),e[8]>e[3*a+a]&&(a=2);var l=(a+1)%3,h=(a+2)%3;r=Math.sqrt(e[3*a+a]-e[3*l+l]-e[3*h+h]+1),t[a]=.5*r,t[3]=(e[3*l+h]-e[3*h+l])*(r=.5/r),t[l]=(e[3*l+a]+e[3*a+l])*r,t[h]=(e[3*h+a]+e[3*a+h])*r}return t}It.clone=Be.clone,It.fromValues=Be.fromValues,It.copy=Be.copy,It.set=Be.set,It.add=Be.add,It.mul=$e;var mt=Be.scale;It.scale=mt;var Ar=Be.dot;It.dot=Ar,It.lerp=Be.lerp;var Hr=Be.length;It.length=Hr,It.len=Hr;var zr=Be.squaredLength;It.squaredLength=zr,It.sqrLen=zr;var ri=Be.normalize;It.normalize=ri,It.exactEquals=Be.exactEquals,It.equals=Be.equals;var Jr,rr,ln,An=(Jr=Me.create(),rr=Me.fromValues(1,0,0),ln=Me.fromValues(0,1,0),function(t,e,r){var n=Me.dot(e,r);return n<-.999999?(Me.cross(Jr,rr,e),Me.len(Jr)<1e-6&&Me.cross(Jr,ln,e),Me.normalize(Jr,Jr),Ye(t,Jr,Math.PI),t):n>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(Me.cross(Jr,e,r),t[0]=Jr[0],t[1]=Jr[1],t[2]=Jr[2],t[3]=1+n,ri(t,t))});It.rotationTo=An;var wi,$o,Sa=(wi=Xe(),$o=Xe(),function(t,e,r,n,a,l){return Pt(wi,e,a,l),Pt($o,r,n,l),Pt(t,wi,$o,2*l*(1-l)),t});It.sqlerp=Sa;var $i,jd=($i=Ae.create(),function(t,e,r,n){return $i[0]=r[0],$i[3]=r[1],$i[6]=r[2],$i[1]=n[0],$i[4]=n[1],$i[7]=n[2],$i[2]=-e[0],$i[5]=-e[1],$i[8]=-e[2],ri(t,Yt(t,$i))});It.setAxes=jd;var Wt={};function fu(t){return fu=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},fu(t)}Object.defineProperty(Wt,"__esModule",{value:!0}),Wt.create=function(){var t=new qi.ARRAY_TYPE(8);return qi.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t},Wt.clone=function(t){var e=new qi.ARRAY_TYPE(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e},Wt.fromValues=function(t,e,r,n,a,l,h,f){var m=new qi.ARRAY_TYPE(8);return m[0]=t,m[1]=e,m[2]=r,m[3]=n,m[4]=a,m[5]=l,m[6]=h,m[7]=f,m},Wt.fromRotationTranslationValues=function(t,e,r,n,a,l,h){var f=new qi.ARRAY_TYPE(8);f[0]=t,f[1]=e,f[2]=r,f[3]=n;var m=.5*a,g=.5*l,x=.5*h;return f[4]=m*n+g*r-x*e,f[5]=g*n+x*t-m*r,f[6]=x*n+m*e-g*t,f[7]=-m*t-g*e-x*r,f},Wt.fromRotationTranslation=s1,Wt.fromTranslation=function(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*e[0],t[5]=.5*e[1],t[6]=.5*e[2],t[7]=0,t},Wt.fromRotation=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},Wt.fromMat4=function(t,e){var r=Kn.create();n1.getRotation(r,e);var n=new qi.ARRAY_TYPE(3);return n1.getTranslation(n,e),s1(t,r,n),t},Wt.copy=a1,Wt.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},Wt.set=function(t,e,r,n,a,l,h,f,m){return t[0]=e,t[1]=r,t[2]=n,t[3]=a,t[4]=l,t[5]=h,t[6]=f,t[7]=m,t},Wt.getDual=function(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t},Wt.setDual=function(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t},Wt.getTranslation=function(t,e){var r=e[4],n=e[5],a=e[6],l=e[7],h=-e[0],f=-e[1],m=-e[2],g=e[3];return t[0]=2*(r*g+l*h+n*m-a*f),t[1]=2*(n*g+l*f+a*h-r*m),t[2]=2*(a*g+l*m+r*f-n*h),t},Wt.translate=function(t,e,r){var n=e[0],a=e[1],l=e[2],h=e[3],f=.5*r[0],m=.5*r[1],g=.5*r[2],x=e[4],v=e[5],w=e[6],S=e[7];return t[0]=n,t[1]=a,t[2]=l,t[3]=h,t[4]=h*f+a*g-l*m+x,t[5]=h*m+l*f-n*g+v,t[6]=h*g+n*m-a*f+w,t[7]=-n*f-a*m-l*g+S,t},Wt.rotateX=function(t,e,r){var n=-e[0],a=-e[1],l=-e[2],h=e[3],f=e[4],m=e[5],g=e[6],x=e[7],v=f*h+x*n+m*l-g*a,w=m*h+x*a+g*n-f*l,S=g*h+x*l+f*a-m*n,A=x*h-f*n-m*a-g*l;return Kn.rotateX(t,e,r),t[4]=v*(h=t[3])+A*(n=t[0])+w*(l=t[2])-S*(a=t[1]),t[5]=w*h+A*a+S*n-v*l,t[6]=S*h+A*l+v*a-w*n,t[7]=A*h-v*n-w*a-S*l,t},Wt.rotateY=function(t,e,r){var n=-e[0],a=-e[1],l=-e[2],h=e[3],f=e[4],m=e[5],g=e[6],x=e[7],v=f*h+x*n+m*l-g*a,w=m*h+x*a+g*n-f*l,S=g*h+x*l+f*a-m*n,A=x*h-f*n-m*a-g*l;return Kn.rotateY(t,e,r),t[4]=v*(h=t[3])+A*(n=t[0])+w*(l=t[2])-S*(a=t[1]),t[5]=w*h+A*a+S*n-v*l,t[6]=S*h+A*l+v*a-w*n,t[7]=A*h-v*n-w*a-S*l,t},Wt.rotateZ=function(t,e,r){var n=-e[0],a=-e[1],l=-e[2],h=e[3],f=e[4],m=e[5],g=e[6],x=e[7],v=f*h+x*n+m*l-g*a,w=m*h+x*a+g*n-f*l,S=g*h+x*l+f*a-m*n,A=x*h-f*n-m*a-g*l;return Kn.rotateZ(t,e,r),t[4]=v*(h=t[3])+A*(n=t[0])+w*(l=t[2])-S*(a=t[1]),t[5]=w*h+A*a+S*n-v*l,t[6]=S*h+A*l+v*a-w*n,t[7]=A*h-v*n-w*a-S*l,t},Wt.rotateByQuatAppend=function(t,e,r){var n=r[0],a=r[1],l=r[2],h=r[3],f=e[0],m=e[1],g=e[2],x=e[3];return t[0]=f*h+x*n+m*l-g*a,t[1]=m*h+x*a+g*n-f*l,t[2]=g*h+x*l+f*a-m*n,t[3]=x*h-f*n-m*a-g*l,t[4]=(f=e[4])*h+(x=e[7])*n+(m=e[5])*l-(g=e[6])*a,t[5]=m*h+x*a+g*n-f*l,t[6]=g*h+x*l+f*a-m*n,t[7]=x*h-f*n-m*a-g*l,t},Wt.rotateByQuatPrepend=function(t,e,r){var n=e[0],a=e[1],l=e[2],h=e[3],f=r[0],m=r[1],g=r[2],x=r[3];return t[0]=n*x+h*f+a*g-l*m,t[1]=a*x+h*m+l*f-n*g,t[2]=l*x+h*g+n*m-a*f,t[3]=h*x-n*f-a*m-l*g,t[4]=n*(x=r[7])+h*(f=r[4])+a*(g=r[6])-l*(m=r[5]),t[5]=a*x+h*m+l*f-n*g,t[6]=l*x+h*g+n*m-a*f,t[7]=h*x-n*f-a*m-l*g,t},Wt.rotateAroundAxis=function(t,e,r,n){if(Math.abs(n)<qi.EPSILON)return a1(t,e);var a=Math.hypot(r[0],r[1],r[2]);n*=.5;var l=Math.sin(n),h=l*r[0]/a,f=l*r[1]/a,m=l*r[2]/a,g=Math.cos(n),x=e[0],v=e[1],w=e[2],S=e[3];t[0]=x*g+S*h+v*m-w*f,t[1]=v*g+S*f+w*h-x*m,t[2]=w*g+S*m+x*f-v*h,t[3]=S*g-x*h-v*f-w*m;var A=e[4],P=e[5],R=e[6],L=e[7];return t[4]=A*g+L*h+P*m-R*f,t[5]=P*g+L*f+R*h-A*m,t[6]=R*g+L*m+A*f-P*h,t[7]=L*g-A*h-P*f-R*m,t},Wt.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t},Wt.multiply=l1,Wt.scale=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t},Wt.lerp=function(t,e,r,n){var a=1-n;return c1(e,r)<0&&(n=-n),t[0]=e[0]*a+r[0]*n,t[1]=e[1]*a+r[1]*n,t[2]=e[2]*a+r[2]*n,t[3]=e[3]*a+r[3]*n,t[4]=e[4]*a+r[4]*n,t[5]=e[5]*a+r[5]*n,t[6]=e[6]*a+r[6]*n,t[7]=e[7]*a+r[7]*n,t},Wt.invert=function(t,e){var r=zl(e);return t[0]=-e[0]/r,t[1]=-e[1]/r,t[2]=-e[2]/r,t[3]=e[3]/r,t[4]=-e[4]/r,t[5]=-e[5]/r,t[6]=-e[6]/r,t[7]=e[7]/r,t},Wt.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t},Wt.normalize=function(t,e){var r=zl(e);if(r>0){r=Math.sqrt(r);var n=e[0]/r,a=e[1]/r,l=e[2]/r,h=e[3]/r,f=e[4],m=e[5],g=e[6],x=e[7],v=n*f+a*m+l*g+h*x;t[0]=n,t[1]=a,t[2]=l,t[3]=h,t[4]=(f-n*v)/r,t[5]=(m-a*v)/r,t[6]=(g-l*v)/r,t[7]=(x-h*v)/r}return t},Wt.str=function(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"},Wt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]},Wt.equals=function(t,e){var r=t[0],n=t[1],a=t[2],l=t[3],h=t[4],f=t[5],m=t[6],g=t[7],x=e[0],v=e[1],w=e[2],S=e[3],A=e[4],P=e[5],R=e[6],L=e[7];return Math.abs(r-x)<=qi.EPSILON*Math.max(1,Math.abs(r),Math.abs(x))&&Math.abs(n-v)<=qi.EPSILON*Math.max(1,Math.abs(n),Math.abs(v))&&Math.abs(a-w)<=qi.EPSILON*Math.max(1,Math.abs(a),Math.abs(w))&&Math.abs(l-S)<=qi.EPSILON*Math.max(1,Math.abs(l),Math.abs(S))&&Math.abs(h-A)<=qi.EPSILON*Math.max(1,Math.abs(h),Math.abs(A))&&Math.abs(f-P)<=qi.EPSILON*Math.max(1,Math.abs(f),Math.abs(P))&&Math.abs(m-R)<=qi.EPSILON*Math.max(1,Math.abs(m),Math.abs(R))&&Math.abs(g-L)<=qi.EPSILON*Math.max(1,Math.abs(g),Math.abs(L))},Wt.sqrLen=Wt.squaredLength=Wt.len=Wt.length=Wt.dot=Wt.mul=Wt.setReal=Wt.getReal=void 0;var qi=pu(Ut),Kn=pu(It),n1=pu(wt);function o1(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,r=new WeakMap;return(o1=function(n){return n?r:e})(t)}function pu(t,e){if(t&&t.__esModule)return t;if(t===null||fu(t)!=="object"&&typeof t!="function")return{default:t};var r=o1(e);if(r&&r.has(t))return r.get(t);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if(l!=="default"&&Object.prototype.hasOwnProperty.call(t,l)){var h=a?Object.getOwnPropertyDescriptor(t,l):null;h&&(h.get||h.set)?Object.defineProperty(n,l,h):n[l]=t[l]}return n.default=t,r&&r.set(t,n),n}function s1(t,e,r){var n=.5*r[0],a=.5*r[1],l=.5*r[2],h=e[0],f=e[1],m=e[2],g=e[3];return t[0]=h,t[1]=f,t[2]=m,t[3]=g,t[4]=n*g+a*m-l*f,t[5]=a*g+l*h-n*m,t[6]=l*g+n*f-a*h,t[7]=-n*h-a*f-l*m,t}function a1(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function l1(t,e,r){var n=e[0],a=e[1],l=e[2],h=e[3],f=r[4],m=r[5],g=r[6],x=r[7],v=e[4],w=e[5],S=e[6],A=e[7],P=r[0],R=r[1],L=r[2],V=r[3];return t[0]=n*V+h*P+a*L-l*R,t[1]=a*V+h*R+l*P-n*L,t[2]=l*V+h*L+n*R-a*P,t[3]=h*V-n*P-a*R-l*L,t[4]=n*x+h*f+a*g-l*m+v*V+A*P+w*L-S*R,t[5]=a*x+h*m+l*f-n*g+w*V+A*R+S*P-v*L,t[6]=l*x+h*g+n*m-a*f+S*V+A*L+v*R-w*P,t[7]=h*x-n*f-a*m-l*g+A*V-v*P-w*R-S*L,t}Wt.getReal=Kn.copy,Wt.setReal=Kn.copy,Wt.mul=l1;var c1=Kn.dot;Wt.dot=c1;var u1=Kn.length;Wt.length=u1,Wt.len=u1;var zl=Kn.squaredLength;Wt.squaredLength=zl,Wt.sqrLen=zl;var kt={};function mu(t){return mu=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},mu(t)}Object.defineProperty(kt,"__esModule",{value:!0}),kt.create=d1,kt.clone=function(t){var e=new qo.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},kt.fromValues=function(t,e){var r=new qo.ARRAY_TYPE(2);return r[0]=t,r[1]=e,r},kt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},kt.set=function(t,e,r){return t[0]=e,t[1]=r,t},kt.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t},kt.subtract=f1,kt.multiply=p1,kt.divide=m1,kt.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},kt.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},kt.min=function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t},kt.max=function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t},kt.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},kt.scale=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t},kt.scaleAndAdd=function(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t},kt.distance=_1,kt.squaredDistance=g1,kt.length=y1,kt.squaredLength=Rl,kt.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},kt.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},kt.normalize=function(t,e){var r=e[0],n=e[1],a=r*r+n*n;return a>0&&(a=1/Math.sqrt(a)),t[0]=e[0]*a,t[1]=e[1]*a,t},kt.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},kt.cross=function(t,e,r){var n=e[0]*r[1]-e[1]*r[0];return t[0]=t[1]=0,t[2]=n,t},kt.lerp=function(t,e,r,n){var a=e[0],l=e[1];return t[0]=a+n*(r[0]-a),t[1]=l+n*(r[1]-l),t},kt.random=function(t,e){e=e||1;var r=2*qo.RANDOM()*Math.PI;return t[0]=Math.cos(r)*e,t[1]=Math.sin(r)*e,t},kt.transformMat2=function(t,e,r){var n=e[0],a=e[1];return t[0]=r[0]*n+r[2]*a,t[1]=r[1]*n+r[3]*a,t},kt.transformMat2d=function(t,e,r){var n=e[0],a=e[1];return t[0]=r[0]*n+r[2]*a+r[4],t[1]=r[1]*n+r[3]*a+r[5],t},kt.transformMat3=function(t,e,r){var n=e[0],a=e[1];return t[0]=r[0]*n+r[3]*a+r[6],t[1]=r[1]*n+r[4]*a+r[7],t},kt.transformMat4=function(t,e,r){var n=e[0],a=e[1];return t[0]=r[0]*n+r[4]*a+r[12],t[1]=r[1]*n+r[5]*a+r[13],t},kt.rotate=function(t,e,r,n){var a=e[0]-r[0],l=e[1]-r[1],h=Math.sin(n),f=Math.cos(n);return t[0]=a*f-l*h+r[0],t[1]=a*h+l*f+r[1],t},kt.angle=function(t,e){var r=t[0],n=t[1],a=e[0],l=e[1],h=Math.sqrt(r*r+n*n)*Math.sqrt(a*a+l*l);return Math.acos(Math.min(Math.max(h&&(r*a+n*l)/h,-1),1))},kt.zero=function(t){return t[0]=0,t[1]=0,t},kt.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},kt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]},kt.equals=function(t,e){var r=t[0],n=t[1],a=e[0],l=e[1];return Math.abs(r-a)<=qo.EPSILON*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(n-l)<=qo.EPSILON*Math.max(1,Math.abs(n),Math.abs(l))},kt.forEach=kt.sqrLen=kt.sqrDist=kt.dist=kt.div=kt.mul=kt.sub=kt.len=void 0;var qo=function(t,e){if(t&&t.__esModule)return t;if(t===null||mu(t)!=="object"&&typeof t!="function")return{default:t};var r=h1(void 0);if(r&&r.has(t))return r.get(t);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if(l!=="default"&&Object.prototype.hasOwnProperty.call(t,l)){var h=a?Object.getOwnPropertyDescriptor(t,l):null;h&&(h.get||h.set)?Object.defineProperty(n,l,h):n[l]=t[l]}return n.default=t,r&&r.set(t,n),n}(Ut);function h1(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,r=new WeakMap;return(h1=function(n){return n?r:e})(t)}function d1(){var t=new qo.ARRAY_TYPE(2);return qo.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0),t}function f1(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function p1(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t}function m1(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t}function _1(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1])}function g1(t,e){var r=e[0]-t[0],n=e[1]-t[1];return r*r+n*n}function y1(t){return Math.hypot(t[0],t[1])}function Rl(t){var e=t[0],r=t[1];return e*e+r*r}kt.len=y1,kt.sub=f1,kt.mul=p1,kt.div=m1,kt.dist=_1,kt.sqrDist=g1,kt.sqrLen=Rl;var Gd=function(){var t=d1();return function(e,r,n,a,l,h){var f,m;for(r||(r=2),n||(n=0),m=a?Math.min(a*r+n,e.length):e.length,f=n;f<m;f+=r)t[0]=e[f],t[1]=e[f+1],l(t,t,h),e[f]=t[0],e[f+1]=t[1];return e}}();function Ll(t){return Ll=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ll(t)}kt.forEach=Gd,Object.defineProperty(Vt,"__esModule",{value:!0}),s.aa=Vt.vec4=s.Q=Vt.vec3=Vt.vec2=Vt.quat2=s.bl=Vt.quat=s.a9=Vt.mat4=s.ct=Vt.mat3=Vt.mat2d=s.b7=Vt.mat2=Vt.glMatrix=void 0;var $d=Un(Ut);Vt.glMatrix=$d;var qd=Un(sr);s.b7=Vt.mat2=qd;var Zd=Un(Tr);Vt.mat2d=Zd;var vt=Un(hr);s.ct=Vt.mat3=vt;var _u=Un(wt);s.a9=Vt.mat4=_u;var Dt=Un(It);s.bl=Vt.quat=Dt;var Ol=Un(Wt);Vt.quat2=Ol;var Gt=Un(kt);Vt.vec2=Gt;var gu=Un(Et);s.Q=Vt.vec3=gu;var yu=Un(Ke);function Mt(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,r=new WeakMap;return(Mt=function(n){return n?r:e})(t)}function Un(t,e){if(t&&t.__esModule)return t;if(t===null||Ll(t)!=="object"&&typeof t!="function")return{default:t};var r=Mt(e);if(r&&r.has(t))return r.get(t);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if(l!=="default"&&Object.prototype.hasOwnProperty.call(t,l)){var h=a?Object.getOwnPropertyDescriptor(t,l):null;h&&(h.get||h.set)?Object.defineProperty(n,l,h):n[l]=t[l]}return n.default=t,r&&r.set(t,n),n}s.aa=Vt.vec4=yu;var Wd=Zo;function Zo(t,e,r,n){this.cx=3*t,this.bx=3*(r-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(n-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=r,this.p2y=n}Zo.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(e===void 0&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var r=t,n=0;n<8;n++){var a=this.sampleCurveX(r)-t;if(Math.abs(a)<e)return r;var l=this.sampleCurveDerivativeX(r);if(Math.abs(l)<1e-6)break;r-=a/l}var h=0,f=1;for(r=t,n=0;n<20&&(a=this.sampleCurveX(r),!(Math.abs(a-t)<e));n++)t>a?h=r:f=r,r=.5*(f-h)+h;return r},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var x1=Br(Wd),kl=Mn;function Mn(t,e){this.x=t,this.y=e}Mn.prototype={clone:function(){return new Mn(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,r=t.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),r=Math.sin(t),n=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=n,this},_rotateAround:function(t,e){var r=Math.cos(t),n=Math.sin(t),a=e.y+n*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-n*(this.y-e.y),this.y=a,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Mn.convert=function(t){return t instanceof Mn?t:Array.isArray(t)?new Mn(t[0],t[1]):t};var He=Br(kl);const xu=Math.PI/180,vu=180/Math.PI;function er(t){return t*xu}function Zi(t){return t*vu}const v1=[[0,0],[1,0],[1,1],[0,1]];function Bl(t){if(t<=0)return 0;if(t>=1)return 1;const e=t*t,r=e*t;return 4*(t<.5?r:3*(t-e)+r-.75)}function b1(t,e,r,n){const a=new x1(t,e,r,n);return function(l){return a.solve(l)}}const In=b1(.25,.1,.25,1);function Ht(t,e,r){return Math.min(r,Math.max(e,t))}function Ea(t,e,r){return(r=Ht((r-t)/(e-t),0,1))*r*(3-2*r)}function eo(t,e,r){const n=r-e,a=((t-e)%n+n)%n+e;return a===e?r:a}function bu(t,e,r){if(!t.length)return r(null,[]);let n=t.length;const a=new Array(t.length);let l=null;t.forEach((h,f)=>{e(h,(m,g)=>{m&&(l=m),a[f]=g,--n==0&&r(l,a)})})}function gn(t,...e){for(const r of e)for(const n in r)t[n]=r[n];return t}let w1=1;function ar(){return w1++}function Fl(){return function t(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function wu(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function T1(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function Tu(t,e){t.forEach(r=>{e[r]&&(e[r]=e[r].bind(e))})}function Wo(t,e){return t.indexOf(e,t.length-e.length)!==-1}function Ss(t,e,r){const n={};for(const a in t)n[a]=e.call(this,t[a],a,t);return n}function Aa(t,e,r){const n={};for(const a in t)e.call(this,t[a],a,t)&&(n[a]=t[a]);return n}function to(t){return Array.isArray(t)?t.map(to):typeof t=="object"&&t?Ss(t,to):t}const Su={};function Qr(t){Su[t]||(typeof console<"u"&&console.warn(t),Su[t]=!0)}function To(t,e,r){return(r.y-t.y)*(e.x-t.x)>(e.y-t.y)*(r.x-t.x)}function Ma(t){let e=0;for(let r,n,a=0,l=t.length,h=l-1;a<l;h=a++)r=t[a],n=t[h],e+=(n.x-r.x)*(r.y+n.y);return e}function Ia([t,e,r]){const n=er(e+90),a=er(r);return{x:t*Math.cos(n)*Math.sin(a),y:t*Math.sin(n)*Math.sin(a),z:t*Math.cos(a),azimuthal:e,polar:r}}function ro(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function cn(t){const e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,n,a,l)=>{const h=a||l;return e[n]=!h||h.toLowerCase(),""}),e["max-age"]){const r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e}let Nl,Vl,Ul,Pa,So,Es,jl=null;function Eu(t){try{const e=self[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function Ho(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}function Qo(t,e,r,n){for(;e<r;){const a=e+r>>1;t[a]<n?e=a+1:r=a}return e}function Au(t,e,r,n){for(;e<r;){const a=e+r>>1;t[a]<=n?e=a+1:r=a}return e}function Pn(t){return t>0?1/(1.001-t):1+t}function S1(t){return t>0?1-1/(1.001-t):-t}function Gl(){return Nl==null&&(Nl=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Nl}const jn={now:()=>Pa!==void 0?Pa:performance.now(),setNow(t){Pa=t},restoreNow(){Pa=void 0},frame(t){const e=requestAnimationFrame(t);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(t,e=0){const{width:r,height:n}=t;So||(So=document.createElement("canvas"));const a=So.getContext("2d",{willReadFrequently:!0});if(!a)throw new Error("failed to create canvas 2d context");return(r>So.width||n>So.height)&&(So.width=r,So.height=n),a.clearRect(-e,-e,r+2*e,n+2*e),a.drawImage(t,0,0,r,n),a.getImageData(-e,-e,r+2*e,n+2*e)},resolveURL:t=>(Vl||(Vl=document.createElement("a")),Vl.href=t,Vl.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Ul==null&&(Ul=window.matchMedia("(prefers-reduced-motion: reduce)")),Ul.matches)},hasCanvasFingerprintNoise(){if(Es!==void 0)return Es;if(!Gl())return Es=!1,!1;const t=new OffscreenCanvas(85,1),e=t.getContext("2d",{willReadFrequently:!0});let r=0;for(let a=0;a<t.width;++a)e.fillStyle=`rgba(${r++},${r++},${r++}, 255)`,e.fillRect(a,0,1,1);const n=e.getImageData(0,0,t.width,t.height);r=0;for(let a=0;a<n.data.length;++a)if(a%4!=3&&r++!==n.data[a])return Es=!0,!0;return Es=!1,!1}};function $l(t,e){const r=t.indexOf("?");if(r<0)return`${t}?${new URLSearchParams(e).toString()}`;const n=new URLSearchParams(t.slice(r));for(const a in e)n.set(a,e[a]);return`${t.slice(0,r)}?${n.toString()}`}function ql(t,e={persistentParams:[]}){const r=t.indexOf("?");if(r<0)return t;const n=new URLSearchParams,a=new URLSearchParams(t.slice(r));for(const h of e.persistentParams){const f=a.get(h);f&&n.set(h,f)}const l=n.toString();return`${t.slice(0,r)}${l.length>0?`?${l}`:""}`}const As="mapbox-tiles";let Zl=500,E1=50,io,Wl;function Mu(){try{return caches}catch{}}function Ms(){const t=Mu();t&&!io&&(io=t.open(As))}let Iu=1/0;const Xo={supported:!1,testSupport:function(t){!Pu&&Is&&(A1?I1(t):Ca=t)}};let Ca,Is,Pu=!1,A1=!1;const M1=typeof self<"u"?self:{};function I1(t){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,Is),t.isContextLost())return;Xo.supported=!0}catch{}t.deleteTexture(e),Pu=!0}M1.document&&(Is=M1.document.createElement("img"),Is.onload=function(){Ca&&I1(Ca),Ca=null,A1=!0},Is.onerror=function(){Pu=!0,Ca=null},Is.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Hl={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(Hl);class Ql extends Error{constructor(e,r,n){r===401&&St(n)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=r,this.url=n}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Ps=ro()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,Da=function(t,e){if(!(/^file:/.test(r=t.url)||/^file:/.test(Ps())&&!/^\w+:/.test(r))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(n,a){const l=new AbortController,h=new Request(n.url,{method:n.method||"GET",body:n.body,credentials:n.credentials,headers:n.headers,referrer:Ps(),referrerPolicy:n.referrerPolicy,signal:l.signal});let f=!1,m=!1;const g=(x=h.url).indexOf("sku=")>0&&St(x);var x;n.type==="json"&&h.headers.set("Accept","application/json");const v=(S,A,P)=>{if(m)return;if(S&&S.message!=="SecurityError"&&Qr(S.toString()),A&&P)return w(A);const R=Date.now();fetch(h).then(L=>{if(L.ok){const V=g?L.clone():null;return w(L,V,R)}return a(new Ql(L.statusText,L.status,n.url))}).catch(L=>{L.name!=="AbortError"&&a(new Error(`${L.message} ${n.url}`))})},w=(S,A,P)=>{(n.type==="arrayBuffer"?S.arrayBuffer():n.type==="json"?S.json():S.text()).then(R=>{m||(A&&P&&function(L,V,q){if(Ms(),!io)return;const G=cn(V.headers.get("Cache-Control")||"");if(G["no-store"])return;const ee={status:V.status,statusText:V.statusText,headers:new Headers};V.headers.forEach((ne,de)=>ee.headers.set(de,ne)),G["max-age"]&&ee.headers.set("Expires",new Date(q+1e3*G["max-age"]).toUTCString());const W=ee.headers.get("Expires");if(!W||new Date(W).getTime()-q<42e4)return;let re=ql(L.url,{persistentParams:["language","worldview"]});if(V.status===206){const ne=L.headers.get("Range");if(!ne)return;ee.status=200,re=$l(re,{range:ne})}(function(ne,de){if(Wl===void 0)try{new Response(new ReadableStream),Wl=!0}catch{Wl=!1}Wl?de(ne.body):ne.blob().then(de)})(V,ne=>{const de=new Response(ne,ee);Ms(),io&&io.then(ve=>ve.put(re,de)).catch(ve=>Qr(ve.message))})}(h,A,P),f=!0,a(null,R,S.headers.get("Cache-Control"),S.headers.get("Expires")))}).catch(R=>{m||a(new Error(R.message))})};return g?function(S,A){if(Ms(),!io)return A(null);io.then(P=>{let R=ql(S.url,{persistentParams:["language","worldview"]});const L=S.headers.get("Range");L&&(R=$l(R,{range:L})),P.match(R).then(V=>{const q=function(G){if(!G)return!1;const ee=new Date(G.headers.get("Expires")||0),W=cn(G.headers.get("Cache-Control")||"");return ee>Date.now()&&!W["no-cache"]}(V);P.delete(R),q&&P.put(R,V.clone()),A(null,V,q)}).catch(A)}).catch(A)}(h,v):v(null,null),{cancel:()=>{m=!0,f||l.abort()}}}(t,e);if(ro()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var r;return function(n,a){const l=new XMLHttpRequest;l.open(n.method||"GET",n.url,!0),n.type==="arrayBuffer"&&(l.responseType="arraybuffer");for(const h in n.headers)l.setRequestHeader(h,n.headers[h]);return n.type==="json"&&(l.responseType="text",l.setRequestHeader("Accept","application/json")),l.withCredentials=n.credentials==="include",l.onerror=()=>{a(new Error(l.statusText))},l.onload=()=>{if((l.status>=200&&l.status<300||l.status===0)&&l.response!==null){let h=l.response;if(n.type==="json")try{h=JSON.parse(l.response)}catch(f){return a(f)}a(null,h,l.getResponseHeader("Cache-Control"),l.getResponseHeader("Expires"))}else a(new Ql(l.statusText,l.status,n.url))},l.send(n.body),{cancel:()=>l.abort()}}(t,e)},za=function(t,e){return Da(gn(t,{type:"arrayBuffer"}),e)};function Cu(t){const e=document.createElement("a");return e.href=t,e.protocol===location.protocol&&e.host===location.host}const P1="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Xl,Ra;Xl=[],Ra=0;const Du=function(t,e){if(Xo.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),Ra>=Ze.MAX_PARALLEL_IMAGE_REQUESTS){const l={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Xl.push(l),l}Ra++;let r=!1;const n=()=>{if(!r)for(r=!0,Ra--;Xl.length&&Ra<Ze.MAX_PARALLEL_IMAGE_REQUESTS;){const l=Xl.shift(),{requestParameters:h,callback:f,cancelled:m}=l;m||(l.cancel=Du(h,f).cancel)}},a=za(t,(l,h,f,m)=>{n(),l?e(l):h&&(self.createImageBitmap?function(g,x){const v=new Blob([new Uint8Array(g)],{type:"image/png"});createImageBitmap(v).then(w=>{x(null,w)}).catch(w=>{x(new Error(`Could not load image because of ${w.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(h,(g,x)=>e(g,x,f,m)):function(g,x){const v=new Image;v.onload=()=>{x(null,v),URL.revokeObjectURL(v.src),v.onload=null,requestAnimationFrame(()=>{v.src=P1})},v.onerror=()=>x(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const w=new Blob([new Uint8Array(g)],{type:"image/png"});v.src=g.byteLength?URL.createObjectURL(w):P1}(h,(g,x)=>e(g,x,f,m)))});return{cancel:()=>{a.cancel(),n()}}},La="01",Yl="NO_ACCESS_TOKEN",zu=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Cn(t){const e=t.match(zu);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function Cs(t){const e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}const Oa="mapbox.eventData";function Ru(t){if(!t)return null;const e=t.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(atob(e[1]).split("").map(r=>"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Ds{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const r=Ru(Ze.ACCESS_TOKEN);let n="";return n=r&&r.u?btoa(encodeURIComponent(r.u).replace(/%([0-9A-F]{2})/g,(a,l)=>String.fromCharCode(+("0x"+l)))):Ze.ACCESS_TOKEN||"",e?`${Oa}.${e}:${n}`:`${Oa}:${n}`}fetchEventData(){const e=Eu("localStorage"),r=this.getStorageKey(),n=this.getStorageKey("uuid");if(e)try{const a=localStorage.getItem(r);a&&(this.eventData=JSON.parse(a));const l=localStorage.getItem(n);l&&(this.anonId=l)}catch{Qr("Unable to read from LocalStorage")}}saveEventData(){const e=Eu("localStorage"),r=this.getStorageKey(),n=this.getStorageKey("uuid"),a=this.anonId;if(e&&a)try{localStorage.setItem(n,a),Object.keys(this.eventData).length>=1&&localStorage.setItem(r,JSON.stringify(this.eventData))}catch{Qr("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,r,n,a){if(!Ze.EVENTS_URL)return;const l=Cn(Ze.EVENTS_URL);l.params.push(`access_token=${a||Ze.ACCESS_TOKEN||""}`);const h={event:this.type,created:new Date(e).toISOString()},f=r?gn(h,r):h,m={url:Cs(l),headers:{"Content-Type":"text/plain"},body:JSON.stringify([f])};this.pendingRequest=function(g,x){return Da(gn(g,{method:"POST"}),x)}(m,g=>{this.pendingRequest=null,n(g),this.saveEventData(),this.processRequests(a)})}queueRequest(e,r){this.queue.push(e),this.processRequests(r)}}const Jl=new class extends Ds{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){Ze.EVENTS_URL&&Ze.ACCESS_TOKEN&&Array.isArray(t)&&t.some(r=>ct(r)||St(r))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=Ru(Ze.ACCESS_TOKEN),r=e?e.u:Ze.ACCESS_TOKEN;let n=r!==this.eventData.tokenU;T1(this.anonId)||(this.anonId=Fl(),n=!0);const a=this.queue.shift();if(this.eventData.lastSuccess){const l=new Date(this.eventData.lastSuccess),h=new Date(a),f=(a-this.eventData.lastSuccess)/864e5;n=n||f>=1||f<-1||l.getDate()!==h.getDate()}else n=!0;n?this.postEvent(a,{sdkIdentifier:"mapbox-gl-js",sdkVersion:ze,skuId:La,"enabled.telemetry":!1,userId:this.anonId},l=>{l||(this.eventData.lastSuccess=a,this.eventData.tokenU=r)},t):this.processRequests()}},Xi=Jl.postTurnstileEvent.bind(Jl),Eo=new class extends Ds{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,r,n){this.skuToken=e,this.errorCb=n,Ze.EVENTS_URL&&(r||Ze.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},r):this.errorCb(new Error(Yl)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:r}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),T1(this.anonId)||(this.anonId=Fl()),this.postEvent(r,{sdkIdentifier:"mapbox-gl-js",sdkVersion:ze,skuId:La,skuToken:this.skuToken,userId:this.anonId},n=>{n?this.errorCb(n):e&&(this.success[e]=!0)},t))}remove(){this.errorCb=null}},Yi=Eo.postMapLoadEvent.bind(Eo),C1=new class extends Ds{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(t){let e=this.mapInstanceIdMap.get(t);return e||(e=Fl(),this.mapInstanceIdMap.set(t,e)),e}getEventId(t){const e=this.eventIdPerMapInstanceMap.get(t)||0;return this.eventIdPerMapInstanceMap.set(t,e+1),e}postStyleLoadEvent(t,e){const{map:r,style:n,importedStyles:a}=e;if(!Ze.EVENTS_URL||!t&&!Ze.ACCESS_TOKEN)return;const l=this.getMapInstanceId(r),h={mapInstanceId:l,eventId:this.getEventId(l),style:n};a.length&&(h.importedStyles=a),this.queueRequest({timestamp:Date.now(),payload:h},t)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:e,payload:r}=this.queue.shift();this.postEvent(e,r,()=>{},t)}},Hd=C1.postStyleLoadEvent.bind(C1),D1=new class extends Ds{constructor(){super("gljs.performance")}postPerformanceEvent(t,e){Ze.EVENTS_URL&&(t||Ze.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},t)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:e,performanceData:r}=this.queue.shift(),n=function(a){const l=performance.getEntriesByType("resource"),h=performance.getEntriesByType("mark"),f=function(S){const A={};if(S){for(const P in S)if(P!=="other")for(const R of S[P]){const L=`${P}ResolveRangeMin`,V=`${P}ResolveRangeMax`,q=`${P}RequestCount`,G=`${P}RequestCachedCount`;A[L]=Math.min(A[L]||1/0,R.startTime),A[V]=Math.max(A[V]||-1/0,R.responseEnd);const ee=W=>{A[W]===void 0&&(A[W]=0),++A[W]};R.transferSize!==void 0&&R.transferSize===0&&ee(G),ee(q)}}return A}(function(S,A){const P={};if(S)for(const R of S){const L=A(R);P[L]===void 0&&(P[L]=[]),P[L].push(R)}return P}(l,Dr)),m=window.devicePixelRatio,g=navigator.connection||navigator.mozConnection||navigator.webkitConnection,x=g?g.effectiveType:void 0,v={counters:[],metadata:[],attributes:[]},w=(S,A,P)=>{P!=null&&S.push({name:A,value:P.toString()})};for(const S in f)w(v.counters,S,f[S]);if(a.interactionRange[0]!==1/0&&a.interactionRange[1]!==-1/0&&(w(v.counters,"interactionRangeMin",a.interactionRange[0]),w(v.counters,"interactionRangeMax",a.interactionRange[1])),h)for(const S of Object.keys(Lr)){const A=Lr[S],P=h.find(R=>R.name===A);P&&w(v.counters,A,P.startTime)}return w(v.counters,"visibilityHidden",a.visibilityHidden),w(v.attributes,"style",function(S){if(S)for(const A of S){const P=A.name.split("?")[0];if(ur(P)){const R=P.split("/").slice(-2);if(R.length===2)return`mapbox://styles/${R[0]}/${R[1]}`}}}(l)),w(v.attributes,"terrainEnabled",a.terrainEnabled?"true":"false"),w(v.attributes,"fogEnabled",a.fogEnabled?"true":"false"),w(v.attributes,"projection",a.projection),w(v.attributes,"zoom",a.zoom),w(v.metadata,"devicePixelRatio",m),w(v.metadata,"connectionEffectiveType",x),w(v.metadata,"navigatorUserAgent",navigator.userAgent),w(v.metadata,"screenWidth",window.screen.width),w(v.metadata,"screenHeight",window.screen.height),w(v.metadata,"windowWidth",window.innerWidth),w(v.metadata,"windowHeight",window.innerHeight),w(v.metadata,"mapWidth",a.width/m),w(v.metadata,"mapHeight",a.height/m),w(v.metadata,"webglRenderer",a.renderer),w(v.metadata,"webglVendor",a.vendor),w(v.metadata,"sdkVersion",ze),w(v.metadata,"sdkIdentifier","mapbox-gl-js"),v}(r);for(const a of n.metadata);for(const a of n.counters);for(const a of n.attributes);this.postEvent(e,n,()=>{},t)}},Kl=D1.postPerformanceEvent.bind(D1),ec=new class extends Ds{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,r,n){if(!Ze.API_URL||!Ze.SESSION_PATH)return;const a=Cn(Ze.API_URL+Ze.SESSION_PATH);a.params.push(`sku=${e||""}`),a.params.push(`access_token=${n||Ze.ACCESS_TOKEN||""}`);const l={url:Cs(a),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(h,f){return Da(gn(h,{method:"GET"}),f)}(l,h=>{this.pendingRequest=null,r(h),this.saveEventData(),this.processRequests(n)})}getSessionAPI(t,e,r,n){this.skuToken=e,this.errorCb=n,Ze.SESSION_PATH&&Ze.API_URL&&(r||Ze.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},r):this.errorCb(new Error(Yl)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:r}=this.queue.shift();e&&this.success[e]||this.getSession(r,this.skuToken,n=>{n?this.errorCb(n):e&&(this.success[e]=!0)},t)}remove(){this.errorCb=null}},Lu=ec.getSessionAPI.bind(ec),tc=new Set;var Gn={exports:{}},z1={exports:{}};z1.exports=function(t,e){var r,n,a,l,h,f,m,g;for(n=t.length-(r=3&t.length),a=e,h=3432918353,f=461845907,g=0;g<n;)m=255&t.charCodeAt(g)|(255&t.charCodeAt(++g))<<8|(255&t.charCodeAt(++g))<<16|(255&t.charCodeAt(++g))<<24,++g,a=27492+(65535&(l=5*(65535&(a=(a^=m=(65535&(m=(m=(65535&m)*h+(((m>>>16)*h&65535)<<16)&4294967295)<<15|m>>>17))*f+(((m>>>16)*f&65535)<<16)&4294967295)<<13|a>>>19))+((5*(a>>>16)&65535)<<16)&4294967295))+((58964+(l>>>16)&65535)<<16);switch(m=0,r){case 3:m^=(255&t.charCodeAt(g+2))<<16;case 2:m^=(255&t.charCodeAt(g+1))<<8;case 1:a^=m=(65535&(m=(m=(65535&(m^=255&t.charCodeAt(g)))*h+(((m>>>16)*h&65535)<<16)&4294967295)<<15|m>>>17))*f+(((m>>>16)*f&65535)<<16)&4294967295}return a^=t.length,a=2246822507*(65535&(a^=a>>>16))+((2246822507*(a>>>16)&65535)<<16)&4294967295,a=3266489909*(65535&(a^=a>>>13))+((3266489909*(a>>>16)&65535)<<16)&4294967295,(a^=a>>>16)>>>0};var Qd=z1.exports,Ou={exports:{}};Ou.exports=function(t,e){for(var r,n=t.length,a=e^n,l=0;n>=4;)r=1540483477*(65535&(r=255&t.charCodeAt(l)|(255&t.charCodeAt(++l))<<8|(255&t.charCodeAt(++l))<<16|(255&t.charCodeAt(++l))<<24))+((1540483477*(r>>>16)&65535)<<16),a=1540483477*(65535&a)+((1540483477*(a>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),n-=4,++l;switch(n){case 3:a^=(255&t.charCodeAt(l+2))<<16;case 2:a^=(255&t.charCodeAt(l+1))<<8;case 1:a=1540483477*(65535&(a^=255&t.charCodeAt(l)))+((1540483477*(a>>>16)&65535)<<16)}return a=1540483477*(65535&(a^=a>>>13))+((1540483477*(a>>>16)&65535)<<16),(a^=a>>>15)>>>0};var ku=Qd,Dn=Ou.exports;Gn.exports=ku,Gn.exports.murmur3=ku,Gn.exports.murmur2=Dn;var ka=Br(Gn.exports);function Bu(t,e,r){r[t]&&r[t].indexOf(e)!==-1||(r[t]=r[t]||[],r[t].push(e))}function rc(t,e,r){if(r&&r[t]){const n=r[t].indexOf(e);n!==-1&&r[t].splice(n,1)}}class Ao{constructor(e,r={}){gn(this,r),this.type=e}}class ic extends Ao{constructor(e,r={}){super("error",gn({error:e},r))}}class Yo{on(e,r){return this._listeners=this._listeners||{},Bu(e,r,this._listeners),this}off(e,r){return rc(e,r,this._listeners),rc(e,r,this._oneTimeListeners),this}once(e,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},Bu(e,r,this._oneTimeListeners),this):new Promise(n=>this.once(e,n))}fire(e,r){typeof e=="string"&&(e=new Ao(e,r||{}));const n=e.type;if(this.listens(n)){e.target=this;const a=this._listeners&&this._listeners[n]?this._listeners[n].slice():[];for(const f of a)f.call(this,e);const l=this._oneTimeListeners&&this._oneTimeListeners[n]?this._oneTimeListeners[n].slice():[];for(const f of l)rc(n,f,this._oneTimeListeners),f.call(this,e);const h=this._eventedParent;h&&(gn(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),h.fire(e))}else e instanceof ic&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}s.z=void 0;var Fu={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Ba(t){return(t=Math.round(t))<0?0:t>255?255:t}function nc(t){return Ba(t[t.length-1]==="%"?parseFloat(t)/100*255:parseInt(t))}function Fa(t){return(e=t[t.length-1]==="%"?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function oc(t,e,r){return r<0?r+=1:r>1&&(r-=1),6*r<1?t+(e-t)*r*6:2*r<1?e:3*r<2?t+(e-t)*(2/3-r)*6:t}try{s.z={}.parseCSSColor=function(t){var e,r=t.replace(/ /g,"").toLowerCase();if(r in Fu)return Fu[r].slice();if(r[0]==="#")return r.length===4?(e=parseInt(r.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:r.length===7&&(e=parseInt(r.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var n=r.indexOf("("),a=r.indexOf(")");if(n!==-1&&a+1===r.length){var l=r.substr(0,n),h=r.substr(n+1,a-(n+1)).split(","),f=1;switch(l){case"rgba":if(h.length!==4)return null;f=Fa(h.pop());case"rgb":return h.length!==3?null:[nc(h[0]),nc(h[1]),nc(h[2]),f];case"hsla":if(h.length!==4)return null;f=Fa(h.pop());case"hsl":if(h.length!==3)return null;var m=(parseFloat(h[0])%360+360)%360/360,g=Fa(h[1]),x=Fa(h[2]),v=x<=.5?x*(g+1):x+g-x*g,w=2*x-v;return[Ba(255*oc(w,v,m+1/3)),Ba(255*oc(w,v,m)),Ba(255*oc(w,v,m-1/3)),f];default:return null}}return null}}catch{}class gr{constructor(e,r,n,a=1){this.r=e,this.g=r,this.b=n,this.a=a}static parse(e){if(!e)return;if(e instanceof gr)return e;if(typeof e!="string")return;const r=s.z(e);return r?new gr(r[0]/255*r[3],r[1]/255*r[3],r[2]/255*r[3],r[3]):void 0}toString(){const[e,r,n,a]=this.toArray();return`rgba(${Math.round(e)},${Math.round(r)},${Math.round(n)},${a})`}toArray(){const{r:e,g:r,b:n,a}=this;return a===0?[0,0,0,0]:[255*e/a,255*r/a,255*n/a,a]}toArray01(){const{r:e,g:r,b:n,a}=this;return a===0?[0,0,0,0]:[e/a,r/a,n/a,a]}toArray01Scaled(e){const{r,g:n,b:a,a:l}=this;return l===0?[0,0,0]:[r/l*e,n/l*e,a/l*e]}toArray01PremultipliedAlpha(){const{r:e,g:r,b:n,a}=this;return[e,r,n,a]}toArray01Linear(){const{r:e,g:r,b:n,a}=this;return a===0?[0,0,0,0]:[Math.pow(e/a,2.2),Math.pow(r/a,2.2),Math.pow(n/a,2.2),a]}}function jt(t,e,r){return t*(1-r)+e*r}function Na(t,e,r){return t.map((n,a)=>jt(n,e[a],r))}gr.black=new gr(0,0,0,1),gr.white=new gr(1,1,1,1),gr.transparent=new gr(0,0,0,0),gr.red=new gr(1,0,0,1),gr.blue=new gr(0,0,1,1);var Va=Object.freeze({__proto__:null,array:Na,color:function(t,e,r){return new gr(jt(t.r,e.r,r),jt(t.g,e.g,r),jt(t.b,e.b,r),jt(t.a,e.a,r))},number:jt});function sc(t,...e){for(const r of e)for(const n in r)t[n]=r[n];return t}class zn extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}class Mo{constructor(e,r=[]){this.parent=e,this.bindings={};for(const[n,a]of r)this.bindings[n]=a}concat(e){return new Mo(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const $t={kind:"null"},it={kind:"number"},lr={kind:"string"},cr={kind:"boolean"},un={kind:"color"},zs={kind:"object"},tr={kind:"value"},Ua={kind:"collator"},Rs={kind:"formatted"},Ls={kind:"resolvedImage"};function vi(t,e){return{kind:"array",itemType:t,N:e}}function Kr(t){if(t.kind==="array"){const e=Kr(t.itemType);return typeof t.N=="number"?`array<${e}, ${t.N}>`:t.itemType.kind==="value"?"array":`array<${e}>`}return t.kind}const R1=[$t,it,lr,cr,un,Rs,zs,vi(tr),Ls];function ja(t,e){if(e.kind==="error")return null;if(t.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!ja(t.itemType,e.itemType))&&(typeof t.N!="number"||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if(t.kind==="value"){for(const r of R1)if(!ja(r,e))return null}}return`Expected ${Kr(t)} but found ${Kr(e)} instead.`}function Ga(t,e){return e.some(r=>r.kind===t.kind)}function Jo(t,e){return e.some(r=>r==="null"?t===null:r==="array"?Array.isArray(t):r==="object"?t&&!Array.isArray(t)&&typeof t=="object":r===typeof t)}class Nu{constructor(e,r,n){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=n,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class ac{constructor(e,r,n,a,l){this.text=e.normalize?e.normalize():e,this.image=r,this.scale=n,this.fontStack=a,this.textColor=l}}class Ii{constructor(e){this.sections=e}static fromString(e){return new Ii([new ac(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.namePrimary.length!==0)}static factory(e){return e instanceof Ii?e:Ii.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const r of this.sections){if(r.image){e.push(["image",r.image.namePrimary]);continue}e.push(r.text);const n={};r.fontStack&&(n["text-font"]=["literal",r.fontStack.split(",")]),r.scale&&(n["font-scale"]=r.scale),r.textColor&&(n["text-color"]=["rgba"].concat(r.textColor.toArray())),e.push(n)}return e}}class hn{constructor(e){this.namePrimary=e.namePrimary,e.nameSecondary&&(this.nameSecondary=e.nameSecondary),this.available=e.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(e,r){return e?new hn({namePrimary:e,nameSecondary:r,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function L1(t,e,r,n){return typeof t=="number"&&t>=0&&t<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?n===void 0||typeof n=="number"&&n>=0&&n<=1?null:`Invalid rgba value [${[t,e,r,n].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof n=="number"?[t,e,r,n]:[t,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Os(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof gr||t instanceof Nu||t instanceof Ii||t instanceof hn)return!0;if(Array.isArray(t)){for(const e of t)if(!Os(e))return!1;return!0}if(typeof t=="object"){for(const e in t)if(!Os(t[e]))return!1;return!0}return!1}function ui(t){if(t===null)return $t;if(typeof t=="string")return lr;if(typeof t=="boolean")return cr;if(typeof t=="number")return it;if(t instanceof gr)return un;if(t instanceof Nu)return Ua;if(t instanceof Ii)return Rs;if(t instanceof hn)return Ls;if(Array.isArray(t)){const e=t.length;let r;for(const n of t){const a=ui(n);if(r){if(r===a)continue;r=tr;break}r=a}return vi(r||tr,e)}return zs}function yn(t){const e=typeof t;return t===null?"":e==="string"||e==="number"||e==="boolean"?String(t):t instanceof gr||t instanceof Ii||t instanceof hn?t.toString():JSON.stringify(t)}class $n{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(e.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Os(e[1]))return r.error("invalid value");const n=e[1];let a=ui(n);const l=r.expectedType;return a.kind!=="array"||a.N!==0||!l||l.kind!=="array"||typeof l.N=="number"&&l.N!==0||(a=l),new $n(a,n)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof gr?["rgba"].concat(this.value.toArray()):this.value instanceof Ii?this.value.serialize():this.value}}class pi{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const lc={string:lr,number:it,boolean:cr,object:zs};class Rn{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let n,a=1;const l=e[0];if(l==="array"){let f,m;if(e.length>2){const g=e[1];if(typeof g!="string"||!(g in lc)||g==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);f=lc[g],a++}else f=tr;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);m=e[2],a++}n=vi(f,m)}else n=lc[l];const h=[];for(;a<e.length;a++){const f=r.parse(e[a],a,tr);if(!f)return null;h.push(f)}return new Rn(n,h)}evaluate(e){for(let r=0;r<this.args.length;r++){const n=this.args[r].evaluate(e);if(!ja(this.type,ui(n)))return n;if(r===this.args.length-1)throw new pi(`Expected value to be of type ${Kr(this.type)}, but found ${Kr(ui(n))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,r=[e.kind];if(e.kind==="array"){const n=e.itemType;if(n.kind==="string"||n.kind==="number"||n.kind==="boolean"){r.push(n.kind);const a=e.N;(typeof a=="number"||this.args.length>1)&&r.push(a)}}return r.concat(this.args.map(n=>n.serialize()))}}class $a{constructor(e){this.type=Rs,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const n=e[1];if(!Array.isArray(n)&&typeof n=="object")return r.error("First argument must be an image or text section.");const a=[];let l=!1;for(let h=1;h<=e.length-1;++h){const f=e[h];if(l&&typeof f=="object"&&!Array.isArray(f)){l=!1;let m=null;if(f["font-scale"]&&(m=r.parse(f["font-scale"],1,it),!m))return null;let g=null;if(f["text-font"]&&(g=r.parse(f["text-font"],1,vi(lr)),!g))return null;let x=null;if(f["text-color"]&&(x=r.parse(f["text-color"],1,un),!x))return null;const v=a[a.length-1];v.scale=m,v.font=g,v.textColor=x}else{const m=r.parse(e[h],1,tr);if(!m)return null;const g=m.type.kind;if(g!=="string"&&g!=="value"&&g!=="null"&&g!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");l=!0,a.push({content:m,scale:null,font:null,textColor:null})}}return new $a(a)}evaluate(e){return new Ii(this.sections.map(r=>{const n=r.content.evaluate(e);return ui(n)===Ls?new ac("",n,null,null,null):new ac(yn(n),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null)}))}eachChild(e){for(const r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const r of this.sections){e.push(r.content.serialize());const n={};r.scale&&(n["font-scale"]=r.scale.serialize()),r.font&&(n["text-font"]=r.font.serialize()),r.textColor&&(n["text-color"]=r.textColor.serialize()),e.push(n)}return e}}class ks{constructor(e,r){this.type=Ls,this.inputPrimary=e,this.inputSecondary=r}static parse(e,r){if(e.length<2)return r.error("Expected two or more arguments.");const n=r.parse(e[1],1,lr);if(!n)return r.error("No image name provided.");if(e.length===2)return new ks(n);const a=r.parse(e[2],1,lr);return a?new ks(n,a):r.error("Secondary image variant is not a string.")}evaluate(e){const r=hn.fromString(this.inputPrimary.evaluate(e),this.inputSecondary?this.inputSecondary.evaluate(e):void 0);return r&&e.availableImages&&(r.available=e.availableImages.indexOf(r.namePrimary)>-1,r.nameSecondary&&r.available&&e.availableImages&&(r.available=e.availableImages.indexOf(r.nameSecondary)>-1)),r}eachChild(e){e(this.inputPrimary),this.inputSecondary&&e(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function Io(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}const Xd={"to-boolean":cr,"to-color":un,"to-number":it,"to-string":lr};class no{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const n=e[0],a=[];let l=$t;if(n==="to-array"){if(!Array.isArray(e[1]))return null;const h=e[1].length;if(r.expectedType){if(r.expectedType.kind!=="array")return r.error(`Expected ${r.expectedType.kind} but found array.`);l=vi(r.expectedType.itemType,h)}else{if(!(h>0&&Os(e[1][0])))return null;l=vi(ui(e[1][0]),h)}for(let f=0;f<h;f++){const m=e[1][f];let g;if(Io(m)==="array")g=r.parse(m,void 0,l.itemType);else{const x=Io(m);if(x!==l.itemType.kind)return r.error(`Expected ${l.itemType.kind} but found ${x}.`);g=r.registry.literal.parse(["literal",m===void 0?null:m],r)}if(!g)return null;a.push(g)}}else{if((n==="to-boolean"||n==="to-string")&&e.length!==2)return r.error("Expected one argument.");l=Xd[n];for(let h=1;h<e.length;h++){const f=r.parse(e[h],h,tr);if(!f)return null;a.push(f)}}return new no(l,a)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let r,n;for(const a of this.args){if(r=a.evaluate(e),n=null,r instanceof gr)return r;if(typeof r=="string"){const l=e.parseColor(r);if(l)return l}else if(Array.isArray(r)&&(n=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:L1(r[0],r[1],r[2],r[3]),!n))return new gr(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new pi(n||`Could not parse color from value '${typeof r=="string"?r:String(JSON.stringify(r))}'`)}if(this.type.kind==="number"){let r=null;for(const n of this.args){if(r=n.evaluate(e),r===null)return 0;const a=Number(r);if(!isNaN(a))return a}throw new pi(`Could not convert ${JSON.stringify(r)} to number.`)}return this.type.kind==="formatted"?Ii.fromString(yn(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?hn.fromString(yn(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(r=>r.evaluate(e)):yn(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new $a([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new ks(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(r=>{e.push(r.serialize())}),e}}const Yd=["Unknown","Point","LineString","Polygon"];class Vu{constructor(e,r){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=r}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Yd[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,r=this.featureDistanceData.scale,{x:n,y:a}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(n*r-e[0])+this.featureDistanceData.bearing[1]*(a*r-e[1])}return 0}parseColor(e){let r=this._parseColorCache[e];return r||(r=this._parseColorCache[e]=gr.parse(e)),r}getConfig(e){return this.options?this.options.get(e):null}}class Ji{constructor(e,r,n,a,l){this.name=e,this.type=r,this._evaluate=n,this.args=a,this._overloadIndex=l}evaluate(e){if(!this._evaluate){const r=Ji.definitions[this.name];this._evaluate=Array.isArray(r)?r[2]:r.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,r){const n=e[0],a=Ji.definitions[n];if(!a)return r.error(`Unknown expression "${n}". If you wanted a literal array, use ["literal", [...]].`,0);const l=Array.isArray(a)?a[0]:a.type,h=Array.isArray(a)?[[a[1],a[2]]]:a.overloads,f=[];let m=null,g=-1;for(const[x,v]of h){if(Array.isArray(x)&&x.length!==e.length-1)continue;f.push(x),g++,m=new gc(r.registry,r.path,null,r.scope,void 0,r._scope,r.options);const w=[];let S=!1;for(let A=1;A<e.length;A++){const P=e[A],R=Array.isArray(x)?x[A-1]:x.type,L=m.parse(P,1+w.length,R);if(!L){S=!0;break}w.push(L)}if(!S)if(Array.isArray(x)&&x.length!==w.length)m.error(`Expected ${x.length} arguments, but found ${w.length} instead.`);else{for(let A=0;A<w.length;A++){const P=Array.isArray(x)?x[A]:x.type,R=w[A];m.concat(A+1).checkSubtype(P,R.type)}if(m.errors.length===0)return new Ji(n,l,v,w,g)}}if(f.length===1)r.errors.push(...m.errors);else{const x=(f.length?f:h.map(([w])=>w)).map(Jd).join(" | "),v=[];for(let w=1;w<e.length;w++){const S=r.parse(e[w],1+v.length);if(!S)return null;v.push(Kr(S.type))}r.error(`Expected arguments of type ${x}, but found (${v.join(", ")}) instead.`)}return null}static register(e,r){Ji.definitions=r;for(const n in r)e[n]=Ji}}function Jd(t){return Array.isArray(t)?`(${t.map(Kr).join(", ")})`:`(${Kr(t.type)}...)`}class qa{constructor(e,r,n){this.type=Ua,this.locale=n,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(e.length!==2)return r.error("Expected one argument.");const n=e[1];if(typeof n!="object"||Array.isArray(n))return r.error("Collator options argument must be an object.");const a=r.parse(n["case-sensitive"]!==void 0&&n["case-sensitive"],1,cr);if(!a)return null;const l=r.parse(n["diacritic-sensitive"]!==void 0&&n["diacritic-sensitive"],1,cr);if(!l)return null;let h=null;return n.locale&&(h=r.parse(n.locale,1,lr),!h)?null:new qa(a,l,h)}evaluate(e){return new Nu(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}var Uu={exports:{}};Uu.exports=function(){function t(n,a,l,h,f){for(;h>l;){if(h-l>600){var m=h-l+1,g=a-l+1,x=Math.log(m),v=.5*Math.exp(2*x/3),w=.5*Math.sqrt(x*v*(m-v)/m)*(g-m/2<0?-1:1);t(n,a,Math.max(l,Math.floor(a-g*v/m+w)),Math.min(h,Math.floor(a+(m-g)*v/m+w)),f)}var S=n[a],A=l,P=h;for(e(n,l,a),f(n[h],S)>0&&e(n,l,h);A<P;){for(e(n,A,P),A++,P--;f(n[A],S)<0;)A++;for(;f(n[P],S)>0;)P--}f(n[l],S)===0?e(n,l,P):e(n,++P,h),P<=a&&(l=P+1),a<=P&&(h=P-1)}}function e(n,a,l){var h=n[a];n[a]=n[l],n[l]=h}function r(n,a){return n<a?-1:n>a?1:0}return function(n,a,l,h,f){t(n,a,l||0,h||n.length-1,f||r)}}();var O1=Br(Uu.exports);function Kd(t){let e=0;for(let r,n,a=0,l=t.length,h=l-1;a<l;h=a++)r=t[a],n=t[h],e+=(n.x-r.x)*(r.y+n.y);return e}function Za(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function Wa(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function ef(t,e,r){const n=t[0]-e[0],a=t[1]-e[1],l=t[0]-r[0],h=t[1]-r[1];return n*h-l*a==0&&n*l<=0&&a*h<=0}function Ko(t,e,r=!1){let n=!1;for(let f=0,m=e.length;f<m;f++){const g=e[f];for(let x=0,v=g.length,w=v-1;x<v;w=x++){const S=g[w],A=g[x];if(ef(t,S,A))return r;(l=S)[1]>(a=t)[1]!=(h=A)[1]>a[1]&&a[0]<(h[0]-l[0])*(a[1]-l[1])/(h[1]-l[1])+l[0]&&(n=!n)}}var a,l,h;return n}function ju(t,e,r,n){const a=n[0]-r[0],l=n[1]-r[1],h=(t[0]-r[0])*l-a*(t[1]-r[1]),f=(e[0]-r[0])*l-a*(e[1]-r[1]);return h>0&&f<0||h<0&&f>0}function Bs(t,e,r,n){return(a=[n[0]-r[0],n[1]-r[1]])[0]*(l=[e[0]-t[0],e[1]-t[1]])[1]-a[1]*l[0]!=0&&!(!ju(t,e,r,n)||!ju(r,n,t,e));var a,l}const Po=8192;function tf(t,e){const r=(180+t[0])/360,n=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,a=Math.pow(2,e.z);return[Math.round(r*a*Po),Math.round(n*a*Po)]}function rf(t,e){for(let r=0;r<e.length;r++)if(Ko(t,e[r]))return!0;return!1}function Gu(t,e,r){for(const n of r)for(let a=0,l=n.length,h=l-1;a<l;h=a++)if(Bs(t,e,n[h],n[a]))return!0;return!1}function cc(t,e){for(let r=0;r<t.length;++r)if(!Ko(t[r],e))return!1;for(let r=0;r<t.length-1;++r)if(Gu(t[r],t[r+1],e))return!1;return!0}function k1(t,e){for(let r=0;r<e.length;r++)if(cc(t,e[r]))return!0;return!1}function $u(t,e,r){const n=[];for(let a=0;a<t.length;a++){const l=[];for(let h=0;h<t[a].length;h++){const f=tf(t[a][h],r);Za(e,f),l.push(f)}n.push(l)}return n}function Ha(t,e,r){const n=[];for(let a=0;a<t.length;a++){const l=$u(t[a],e,r);n.push(l)}return n}function qu(t,e,r,n){if(t[0]<r[0]||t[0]>r[2]){const a=.5*n;let l=t[0]-r[0]>a?-n:r[0]-t[0]>a?n:0;l===0&&(l=t[0]-r[2]>a?-n:r[2]-t[0]>a?n:0),t[0]+=l}Za(e,t)}function Qa(t,e,r,n){const a=Math.pow(2,n.z)*Po,l=[n.x*Po,n.y*Po],h=[];if(!t)return h;for(const f of t)for(const m of f){const g=[m.x+l[0],m.y+l[1]];qu(g,e,r,a),h.push(g)}return h}function Zu(t,e,r,n){const a=Math.pow(2,n.z)*Po,l=[n.x*Po,n.y*Po],h=[];if(!t)return h;for(const m of t){const g=[];for(const x of m){const v=[x.x+l[0],x.y+l[1]];Za(e,v),g.push(v)}h.push(g)}if(e[2]-e[0]<=a/2){(f=e)[0]=f[1]=1/0,f[2]=f[3]=-1/0;for(const m of h)for(const g of m)qu(g,e,r,a)}var f;return h}class es{constructor(e,r){this.type=cr,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Os(e[1])){const n=e[1];if(n.type==="FeatureCollection")for(let a=0;a<n.features.length;++a){const l=n.features[a].geometry.type;if(l==="Polygon"||l==="MultiPolygon")return new es(n,n.features[a].geometry)}else if(n.type==="Feature"){const a=n.geometry.type;if(a==="Polygon"||a==="MultiPolygon")return new es(n,n.geometry)}else if(n.type==="Polygon"||n.type==="MultiPolygon")return new es(n,n)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(r,n){const a=[1/0,1/0,-1/0,-1/0],l=[1/0,1/0,-1/0,-1/0],h=r.canonicalID();if(!h)return!1;if(n.type==="Polygon"){const f=$u(n.coordinates,l,h),m=Qa(r.geometry(),a,l,h);if(!Wa(a,l))return!1;for(const g of m)if(!Ko(g,f))return!1}if(n.type==="MultiPolygon"){const f=Ha(n.coordinates,l,h),m=Qa(r.geometry(),a,l,h);if(!Wa(a,l))return!1;for(const g of m)if(!rf(g,f))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(r,n){const a=[1/0,1/0,-1/0,-1/0],l=[1/0,1/0,-1/0,-1/0],h=r.canonicalID();if(!h)return!1;if(n.type==="Polygon"){const f=$u(n.coordinates,l,h),m=Zu(r.geometry(),a,l,h);if(!Wa(a,l))return!1;for(const g of m)if(!cc(g,f))return!1}if(n.type==="MultiPolygon"){const f=Ha(n.coordinates,l,h),m=Zu(r.geometry(),a,l,h);if(!Wa(a,l))return!1;for(const g of m)if(!k1(g,f))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var B1={exports:{}};(function(t,e){t.exports=function(){var r={kilometers:1,miles:.621371192237334,nauticalmiles:.5399568034557235,meters:1e3,metres:1e3,yards:1093.6132983377079,feet:3280.839895013123,inches:39370.078740157485},n=1/298.257223563,a=n*(2-n),l=Math.PI/180,h=function(v,w){if(v===void 0)throw new Error("No latitude given.");if(w&&!r[w])throw new Error("Unknown unit "+w+". Use one of: "+Object.keys(r).join(", "));var S=6378.137*l*(w?r[w]:1),A=Math.cos(v*l),P=1/(1-a*(1-A*A)),R=Math.sqrt(P);this.kx=S*R*A,this.ky=S*R*P*(1-a)},f={units:{configurable:!0}};function m(v,w){return v[0]===w[0]&&v[1]===w[1]}function g(v,w,S){var A=x(w[0]-v[0]);return[v[0]+A*S,v[1]+(w[1]-v[1])*S]}function x(v){for(;v<-180;)v+=360;for(;v>180;)v-=360;return v}return h.fromTile=function(v,w,S){var A=Math.PI*(1-2*(v+.5)/Math.pow(2,w)),P=Math.atan(.5*(Math.exp(A)-Math.exp(-A)))/l;return new h(P,S)},f.units.get=function(){return r},h.prototype.distance=function(v,w){var S=x(v[0]-w[0])*this.kx,A=(v[1]-w[1])*this.ky;return Math.sqrt(S*S+A*A)},h.prototype.bearing=function(v,w){var S=x(w[0]-v[0])*this.kx;return Math.atan2(S,(w[1]-v[1])*this.ky)/l},h.prototype.destination=function(v,w,S){var A=S*l;return this.offset(v,Math.sin(A)*w,Math.cos(A)*w)},h.prototype.offset=function(v,w,S){return[v[0]+w/this.kx,v[1]+S/this.ky]},h.prototype.lineDistance=function(v){for(var w=0,S=0;S<v.length-1;S++)w+=this.distance(v[S],v[S+1]);return w},h.prototype.area=function(v){for(var w=0,S=0;S<v.length;S++)for(var A=v[S],P=0,R=A.length,L=R-1;P<R;L=P++)w+=x(A[P][0]-A[L][0])*(A[P][1]+A[L][1])*(S?-1:1);return Math.abs(w)/2*this.kx*this.ky},h.prototype.along=function(v,w){var S=0;if(w<=0)return v[0];for(var A=0;A<v.length-1;A++){var P=v[A],R=v[A+1],L=this.distance(P,R);if((S+=L)>w)return g(P,R,(w-(S-L))/L)}return v[v.length-1]},h.prototype.pointToSegmentDistance=function(v,w,S){var A=w[0],P=w[1],R=x(S[0]-A)*this.kx,L=(S[1]-P)*this.ky,V=0;return R===0&&L===0||((V=(x(v[0]-A)*this.kx*R+(v[1]-P)*this.ky*L)/(R*R+L*L))>1?(A=S[0],P=S[1]):V>0&&(A+=R/this.kx*V,P+=L/this.ky*V)),R=x(v[0]-A)*this.kx,L=(v[1]-P)*this.ky,Math.sqrt(R*R+L*L)},h.prototype.pointOnLine=function(v,w){for(var S,A,P,R,L=1/0,V=0;V<v.length-1;V++){var q=v[V][0],G=v[V][1],ee=x(v[V+1][0]-q)*this.kx,W=(v[V+1][1]-G)*this.ky,re=0;ee===0&&W===0||((re=(x(w[0]-q)*this.kx*ee+(w[1]-G)*this.ky*W)/(ee*ee+W*W))>1?(q=v[V+1][0],G=v[V+1][1]):re>0&&(q+=ee/this.kx*re,G+=W/this.ky*re));var ne=(ee=x(w[0]-q)*this.kx)*ee+(W=(w[1]-G)*this.ky)*W;ne<L&&(L=ne,S=q,A=G,P=V,R=re)}return{point:[S,A],index:P,t:Math.max(0,Math.min(1,R))}},h.prototype.lineSlice=function(v,w,S){var A=this.pointOnLine(S,v),P=this.pointOnLine(S,w);if(A.index>P.index||A.index===P.index&&A.t>P.t){var R=A;A=P,P=R}var L=[A.point],V=A.index+1,q=P.index;!m(S[V],L[0])&&V<=q&&L.push(S[V]);for(var G=V+1;G<=q;G++)L.push(S[G]);return m(S[q],P.point)||L.push(P.point),L},h.prototype.lineSliceAlong=function(v,w,S){for(var A=0,P=[],R=0;R<S.length-1;R++){var L=S[R],V=S[R+1],q=this.distance(L,V);if((A+=q)>v&&P.length===0&&P.push(g(L,V,(v-(A-q))/q)),A>=w)return P.push(g(L,V,(w-(A-q))/q)),P;A>v&&P.push(V)}return P},h.prototype.bufferPoint=function(v,w){var S=w/this.ky,A=w/this.kx;return[v[0]-A,v[1]-S,v[0]+A,v[1]+S]},h.prototype.bufferBBox=function(v,w){var S=w/this.ky,A=w/this.kx;return[v[0]-A,v[1]-S,v[2]+A,v[3]+S]},h.prototype.insideBBox=function(v,w){return x(v[0]-w[0])>=0&&x(v[0]-w[2])<=0&&v[1]>=w[1]&&v[1]<=w[3]},Object.defineProperties(h,f),h}()})(B1);var Xa=Br(B1.exports),uc={exports:{}};(function(t,e){t.exports=function(){var r=function(a,l){if(a===void 0&&(a=[]),l===void 0&&(l=n),this.data=a,this.length=this.data.length,this.compare=l,this.length>0)for(var h=(this.length>>1)-1;h>=0;h--)this._down(h)};function n(a,l){return a<l?-1:a>l?1:0}return r.prototype.push=function(a){this.data.push(a),this.length++,this._up(this.length-1)},r.prototype.pop=function(){if(this.length!==0){var a=this.data[0],l=this.data.pop();return this.length--,this.length>0&&(this.data[0]=l,this._down(0)),a}},r.prototype.peek=function(){return this.data[0]},r.prototype._up=function(a){for(var l=this.data,h=this.compare,f=l[a];a>0;){var m=a-1>>1,g=l[m];if(h(f,g)>=0)break;l[a]=g,a=m}l[a]=f},r.prototype._down=function(a){for(var l=this.data,h=this.compare,f=this.length>>1,m=l[a];a<f;){var g=1+(a<<1),x=l[g],v=g+1;if(v<this.length&&h(l[v],x)<0&&(g=v,x=l[v]),h(x,m)>=0)break;l[a]=x,a=g}l[a]=m},r}()})(uc);var hc=Br(uc.exports),Qe=8192;function ts(t,e){return e.dist-t.dist}const Wu=100,Hu=50;function F1(t){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}function dc(t){return t[1]-t[0]+1}function oo(t,e){const r=t[1]>=t[0]&&t[1]<e;return r||console.warn("Distance Expression: Index is out of range"),r}function fc(t,e){if(t[0]>t[1])return[null,null];const r=dc(t);if(e){if(r===2)return[t,null];const n=Math.floor(r/2);return[[t[0],t[0]+n],[t[0]+n,t[1]]]}{if(r===1)return[t,null];const n=Math.floor(r/2)-1;return[[t[0],t[0]+n],[t[0]+n+1,t[1]]]}}function so(t,e){const r=[1/0,1/0,-1/0,-1/0];if(!oo(e,t.length))return r;for(let n=e[0];n<=e[1];++n)Za(r,t[n]);return r}function pc(t){const e=[1/0,1/0,-1/0,-1/0];for(let r=0;r<t.length;++r)for(let n=0;n<t[r].length;++n)Za(e,t[r][n]);return e}function Fs(t,e,r){if(F1(t)||F1(e))return NaN;let n=0,a=0;return t[2]<e[0]&&(n=e[0]-t[2]),t[0]>e[2]&&(n=t[0]-e[2]),t[1]>e[3]&&(a=t[1]-e[3]),t[3]<e[1]&&(a=e[1]-t[3]),r.distance([0,0],[n,a])}function nf(t){return 360*t-180}function of(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function Qu(t,e){const r=Math.pow(2,e.z),n=(t.y/Qe+e.y)/r;return[nf((t.x/Qe+e.x)/r),of(n)]}function sf(t,e){const r=[];for(let n=0;n<t.length;++n)r.push(Qu(t[n],e));return r}function N1(t,e,r){const n=r.pointOnLine(e,t).point;return r.distance(t,n)}function V1(t,e,r,n,a){const l=r.slice(n[0],n[1]+1);let h=1/0;for(let f=e[0];f<=e[1];++f)if((h=Math.min(h,N1(t[f],l,a)))===0)return 0;return h}function Xu(t,e,r,n,a){const l=Math.min(a.pointToSegmentDistance(t,r,n),a.pointToSegmentDistance(e,r,n)),h=Math.min(a.pointToSegmentDistance(r,t,e),a.pointToSegmentDistance(n,t,e));return Math.min(l,h)}function Ns(t,e,r,n,a){if(!oo(e,t.length)||!oo(n,r.length))return NaN;let l=1/0;for(let h=e[0];h<e[1];++h)for(let f=n[0];f<n[1];++f){if(Bs(t[h],t[h+1],r[f],r[f+1]))return 0;l=Math.min(l,Xu(t[h],t[h+1],r[f],r[f+1],a))}return l}function U1(t,e,r,n,a){if(!oo(e,t.length)||!oo(n,r.length))return NaN;let l=1/0;for(let h=e[0];h<=e[1];++h)for(let f=n[0];f<=n[1];++f)if((l=Math.min(l,a.distance(t[h],r[f])))===0)return l;return l}function j1(t,e,r){if(Ko(t,e,!0))return 0;let n=1/0;for(const a of e){const l=a.length;if(l<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(a[0]!==a[l-1]&&(n=Math.min(n,r.pointToSegmentDistance(t,a[l-1],a[0])))===0||(n=Math.min(n,N1(t,a,r)))===0)return n}return n}function mc(t,e,r,n){if(!oo(e,t.length))return NaN;for(let l=e[0];l<=e[1];++l)if(Ko(t[l],r,!0))return 0;let a=1/0;for(let l=e[0];l<e[1];++l)for(const h of r)for(let f=0,m=h.length,g=m-1;f<m;g=f++){if(Bs(t[l],t[l+1],h[g],h[f]))return 0;a=Math.min(a,Xu(t[l],t[l+1],h[g],h[f],n))}return a}function G1(t,e){for(const r of t)for(let n=0;n<=r.length-1;++n)if(Ko(r[n],e,!0))return!0;return!1}function af(t,e,r,n=1/0){const a=pc(t),l=pc(e);if(n!==1/0&&Fs(a,l,r)>=n)return n;if(Wa(a,l)){if(G1(t,e))return 0}else if(G1(e,t))return 0;let h=n;for(const f of t)for(let m=0,g=f.length,x=g-1;m<g;x=m++)for(const v of e)for(let w=0,S=v.length,A=S-1;w<S;A=w++){if(Bs(f[x],f[m],v[A],v[w]))return 0;h=Math.min(h,Xu(f[x],f[m],v[A],v[w],r))}return h}function Ln(t,e,r,n,a,l,h){if(l===null||h===null)return;const f=Fs(so(n,l),so(a,h),r);f<e&&t.push({dist:f,range1:l,range2:h})}function $1(t,e,r,n,a=1/0){let l=Math.min(n.distance(t[0],r[0][0]),a);if(l===0)return l;const h=new hc([{dist:0,range1:[0,t.length-1],range2:[0,0]}],ts),f=e?Hu:Wu,m=pc(r);for(;h.length;){const g=h.pop();if(g.dist>=l)continue;const x=g.range1;if(dc(x)<=f){if(!oo(x,t.length))return NaN;if(e){const v=mc(t,x,r,n);if((l=Math.min(l,v))===0)return l}else for(let v=x[0];v<=x[1];++v){const w=j1(t[v],r,n);if((l=Math.min(l,w))===0)return l}}else{const v=fc(x,e);if(v[0]!==null){const w=Fs(so(t,v[0]),m,n);w<l&&h.push({dist:w,range1:v[0],range2:[0,0]})}if(v[1]!==null){const w=Fs(so(t,v[1]),m,n);w<l&&h.push({dist:w,range1:v[1],range2:[0,0]})}}}return l}function rs(t,e,r,n,a,l=1/0){let h=Math.min(l,a.distance(t[0],r[0]));if(h===0)return h;const f=new hc([{dist:0,range1:[0,t.length-1],range2:[0,r.length-1]}],ts),m=e?Hu:Wu,g=n?Hu:Wu;for(;f.length;){const x=f.pop();if(x.dist>=h)continue;const v=x.range1,w=x.range2;if(dc(v)<=m&&dc(w)<=g){if(!oo(v,t.length)||!oo(w,r.length))return NaN;if(e&&n?h=Math.min(h,Ns(t,v,r,w,a)):e||n?e&&!n?h=Math.min(h,V1(r,w,t,v,a)):!e&&n&&(h=Math.min(h,V1(t,v,r,w,a))):h=Math.min(h,U1(t,v,r,w,a)),h===0)return h}else{const S=fc(v,e),A=fc(w,n);Ln(f,h,a,t,r,S[0],A[0]),Ln(f,h,a,t,r,S[0],A[1]),Ln(f,h,a,t,r,S[1],A[0]),Ln(f,h,a,t,r,S[1],A[1])}}return h}function Yu(t,e,r,n,a=1/0){let l=a;const h=so(t,[0,t.length-1]);for(const f of r)if(!(l!==1/0&&Fs(h,so(f,[0,f.length-1]),n)>=l)&&(l=Math.min(l,rs(t,e,f,!0,n,l)),l===0))return l;return l}function _c(t,e,r,n,a=1/0){let l=a;const h=so(t,[0,t.length-1]);for(const f of r){if(l!==1/0&&Fs(h,pc(f),n)>=l)continue;const m=$1(t,e,f,n,l);if(isNaN(m))return m;if((l=Math.min(l,m))===0)return l}return l}function Ju(t){return t==="Point"||t==="MultiPoint"||t==="LineString"||t==="MultiLineString"||t==="Polygon"||t==="MultiPolygon"}class is{constructor(e,r){this.type=it,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(Os(e[1])){const n=e[1];if(n.type==="FeatureCollection"){for(let a=0;a<n.features.length;++a)if(Ju(n.features[a].geometry.type))return new is(n,n.features[a].geometry)}else if(n.type==="Feature"){if(Ju(n.geometry.type))return new is(n,n.geometry)}else if(Ju(n.type))return new is(n,n)}return r.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const r=e.geometry(),n=e.canonicalID();if(r!=null&&n!=null){if(e.geometryType()==="Point")return function(a,l,h){const f=[];for(const g of a)for(const x of g)f.push(Qu(x,l));const m=new Xa(f[0][1],"meters");return h.type==="Point"||h.type==="MultiPoint"||h.type==="LineString"?rs(f,!1,h.type==="Point"?[h.coordinates]:h.coordinates,h.type==="LineString",m):h.type==="MultiLineString"?Yu(f,!1,h.coordinates,m):h.type==="Polygon"||h.type==="MultiPolygon"?_c(f,!1,h.type==="Polygon"?[h.coordinates]:h.coordinates,m):null}(r,n,this.geometries);if(e.geometryType()==="LineString")return function(a,l,h){const f=[];for(const g of a){const x=[];for(const v of g)x.push(Qu(v,l));f.push(x)}const m=new Xa(f[0][0][1],"meters");if(h.type==="Point"||h.type==="MultiPoint"||h.type==="LineString")return Yu(h.type==="Point"?[h.coordinates]:h.coordinates,h.type==="LineString",f,m);if(h.type==="MultiLineString"){let g=1/0;for(let x=0;x<h.coordinates.length;x++){const v=Yu(h.coordinates[x],!0,f,m,g);if(isNaN(v))return v;if((g=Math.min(g,v))===0)return g}return g}if(h.type==="Polygon"||h.type==="MultiPolygon"){let g=1/0;for(let x=0;x<f.length;x++){const v=_c(f[x],!0,h.type==="Polygon"?[h.coordinates]:h.coordinates,m,g);if(isNaN(v))return v;if((g=Math.min(g,v))===0)return g}return g}return null}(r,n,this.geometries);if(e.geometryType()==="Polygon")return function(a,l,h){const f=[];for(const g of function(x,v){const w=x.length;if(w<=1)return[x];const S=[];let A,P;for(let R=0;R<w;R++){const L=Kd(x[R]);L!==0&&(x[R].area=Math.abs(L),P===void 0&&(P=L<0),P===L<0?(A&&S.push(A),A=[x[R]]):A.push(x[R]))}return A&&S.push(A),S}(a)){const x=[];for(let v=0;v<g.length;++v)x.push(sf(g[v],l));f.push(x)}const m=new Xa(f[0][0][0][1],"meters");if(h.type==="Point"||h.type==="MultiPoint"||h.type==="LineString")return _c(h.type==="Point"?[h.coordinates]:h.coordinates,h.type==="LineString",f,m);if(h.type==="MultiLineString"){let g=1/0;for(let x=0;x<h.coordinates.length;x++){const v=_c(h.coordinates[x],!0,f,m,g);if(isNaN(v))return v;if((g=Math.min(g,v))===0)return g}return g}return h.type==="Polygon"||h.type==="MultiPolygon"?function(g,x,v){let w=1/0;for(const S of g)for(const A of x){const P=af(S,A,v,w);if(isNaN(P))return P;if((w=Math.min(w,P))===0)return w}return w}(h.type==="Polygon"?[h.coordinates]:h.coordinates,f,m):null}(r,n,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Ku(t,e){switch(t){case"string":return yn(e);case"number":return+e;case"boolean":return!!e;case"color":return gr.parse(e);case"formatted":return Ii.fromString(yn(e));case"resolvedImage":return hn.fromString(yn(e))}return e}function eh(t,e,r,n){return n!==void 0&&(t=n*Math.round(t/n)),e!==void 0&&t<e&&(t=e),r!==void 0&&t>r&&(t=r),t}class Co{constructor(e,r,n){this.type=e,this.key=r,this.scope=n}static parse(e,r){let n=r.expectedType;if(n==null&&(n=tr),e.length<2||e.length>3)return r.error("Invalid number of arguments for 'config' expression.");const a=r.parse(e[1],1);if(!(a instanceof $n))return r.error("Key name of 'config' expression must be a string literal.");if(e.length>=3){const l=r.parse(e[2],2);return l instanceof $n?new Co(n,yn(a.value),yn(l.value)):r.error("Scope of 'config' expression must be a string literal.")}return new Co(n,yn(a.value))}evaluate(e){const r=[this.key,this.scope,e.scope].filter(Boolean).join(""),n=e.getConfig(r);if(!n)return null;const{type:a,value:l,values:h,minValue:f,maxValue:m,stepValue:g}=n,x=n.default.evaluate(e);let v=x;if(l){const w=e.scope;e.scope=(w||"").split("").slice(1).join(""),v=l.evaluate(e),e.scope=w}return a&&(v=Ku(a,v)),v===void 0||f===void 0&&m===void 0&&g===void 0||(typeof v=="number"?v=eh(v,f,m,g):Array.isArray(v)&&(v=v.map(w=>typeof w=="number"?eh(w,f,m,g):w))),l!==void 0&&v!==void 0&&h&&!h.includes(v)&&(v=x,a&&(v=Ku(a,v))),(a&&a!==this.type||v!==void 0&&ui(v)!==this.type)&&(v=Ku(this.type.kind,v)),v}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.key),e}}function Do(t){if(t instanceof Ji&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof es||t instanceof is)return!1;let e=!0;return t.eachChild(r=>{e&&!Do(r)&&(e=!1)}),e}function Ya(t){if(t instanceof Ji&&t.name==="feature-state")return!1;let e=!0;return t.eachChild(r=>{e&&!Ya(r)&&(e=!1)}),e}function Ja(t){if(t instanceof Co)return!1;let e=!0;return t.eachChild(r=>{e&&!Ja(r)&&(e=!1)}),e}function Ka(t,e){if(t instanceof Ji&&e.indexOf(t.name)>=0)return!1;let r=!0;return t.eachChild(n=>{r&&!Ka(n,e)&&(r=!1)}),r}class dn{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const n=e[1];return r.scope.has(n)?new dn(n,r.scope.get(n)):r.error(`Unknown variable "${n}". Make sure "${n}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class gc{constructor(e,r=[],n,a=new Mo,l=[],h,f){this.registry=e,this.path=r,this.key=r.map(m=>`[${m}]`).join(""),this.scope=a,this.errors=l,this.expectedType=n,this._scope=h,this.options=f}parse(e,r,n,a,l={}){return r||n?this.concat(r,n,a)._parse(e,l):this._parse(e,l)}_parse(e,r){function n(a,l,h){return h==="assert"?new Rn(l,[a]):h==="coerce"?new no(l,[a]):a}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const a=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(a){let l=a.parse(e,this);if(!l)return null;if(this.expectedType){const h=this.expectedType,f=l.type;if(h.kind!=="string"&&h.kind!=="number"&&h.kind!=="boolean"&&h.kind!=="object"&&h.kind!=="array"||f.kind!=="value")if(h.kind!=="color"&&h.kind!=="formatted"&&h.kind!=="resolvedImage"||f.kind!=="value"&&f.kind!=="string"){if(this.checkSubtype(h,f))return null}else l=n(l,h,r.typeAnnotation||"coerce");else l=n(l,h,r.typeAnnotation||"assert")}if(!(l instanceof $n)&&l.type.kind!=="resolvedImage"&&yc(l)){const h=new Vu(this._scope,this.options);try{l=new $n(l.type,l.evaluate(h))}catch(f){return this.error(f.message),null}}return l}return no.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,n){const a=typeof e=="number"?this.path.concat(e):this.path,l=n?this.scope.concat(n):this.scope;return new gc(this.registry,a,r||null,l,this.errors,this._scope,this.options)}error(e,...r){const n=`${this.key}${r.map(a=>`[${a}]`).join("")}`;this.errors.push(new zn(n,e))}checkSubtype(e,r){const n=ja(e,r);return n&&this.error(n),n}}function yc(t){if(t instanceof dn)return yc(t.boundExpression);if(t instanceof Ji&&t.name==="error"||t instanceof qa||t instanceof es||t instanceof is||t instanceof Co)return!1;const e=t instanceof no||t instanceof Rn;let r=!0;return t.eachChild(n=>{r=e?r&&yc(n):r&&n instanceof $n}),!!r&&Do(t)&&Ka(t,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function xc(t,e){const r=t.length-1;let n,a,l=0,h=r,f=0;for(;l<=h;)if(f=Math.floor((l+h)/2),n=t[f],a=t[f+1],n<=e){if(f===r||e<a)return f;l=f+1}else{if(!(n>e))throw new pi("Input is not a number.");h=f-1}return 0}class el{constructor(e,r,n){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(const[a,l]of n)this.labels.push(a),this.outputs.push(l)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");const n=r.parse(e[1],1,it);if(!n)return null;const a=[];let l=null;r.expectedType&&r.expectedType.kind!=="value"&&(l=r.expectedType);for(let h=1;h<e.length;h+=2){const f=h===1?-1/0:e[h],m=e[h+1],g=h,x=h+1;if(typeof f!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',g);if(a.length&&a[a.length-1][0]>=f)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',g);const v=r.parse(m,x,l);if(!v)return null;l=l||v.type,a.push([f,v])}return new el(l,n,a)}evaluate(e){const r=this.labels,n=this.outputs;if(r.length===1)return n[0].evaluate(e);const a=this.input.evaluate(e);if(a<=r[0])return n[0].evaluate(e);const l=r.length;return a>=r[l-1]?n[l-1].evaluate(e):n[xc(r,a)].evaluate(e)}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let r=0;r<this.labels.length;r++)r>0&&e.push(this.labels[r]),e.push(this.outputs[r].serialize());return e}}const q1=.95047,Z1=1.08883,vc=4/29,ns=6/29,W1=3*ns*ns,H1=ns*ns*ns,lf=Math.PI/180,Q1=180/Math.PI;function Vs(t){return t>H1?Math.pow(t,1/3):t/W1+vc}function th(t){return t>ns?t*t*t:W1*(t-vc)}function rh(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function ih(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function X1(t){const e=ih(t.r),r=ih(t.g),n=ih(t.b),a=Vs((.4124564*e+.3575761*r+.1804375*n)/q1),l=Vs((.2126729*e+.7151522*r+.072175*n)/1);return{l:116*l-16,a:500*(a-l),b:200*(l-Vs((.0193339*e+.119192*r+.9503041*n)/Z1)),alpha:t.a}}function Y1(t){let e=(t.l+16)/116,r=isNaN(t.a)?e:e+t.a/500,n=isNaN(t.b)?e:e-t.b/200;return e=1*th(e),r=q1*th(r),n=Z1*th(n),new gr(rh(3.2404542*r-1.5371385*e-.4985314*n),rh(-.969266*r+1.8760108*e+.041556*n),rh(.0556434*r-.2040259*e+1.0572252*n),t.alpha)}function bc(t,e,r){const n=e-t;return t+r*(n>180||n<-180?n-360*Math.round(n/360):n)}const zo={forward:X1,reverse:Y1,interpolate:function(t,e,r){return{l:jt(t.l,e.l,r),a:jt(t.a,e.a,r),b:jt(t.b,e.b,r),alpha:jt(t.alpha,e.alpha,r)}}},Pi={forward:function(t){const{l:e,a:r,b:n}=X1(t),a=Math.atan2(n,r)*Q1;return{h:a<0?a+360:a,c:Math.sqrt(r*r+n*n),l:e,alpha:t.a}},reverse:function(t){const e=t.h*lf,r=t.c;return Y1({l:t.l,a:Math.cos(e)*r,b:Math.sin(e)*r,alpha:t.alpha})},interpolate:function(t,e,r){return{h:bc(t.h,e.h,r),c:jt(t.c,e.c,r),l:jt(t.l,e.l,r),alpha:jt(t.alpha,e.alpha,r)}}};var tl=Object.freeze({__proto__:null,hcl:Pi,lab:zo});class fn{constructor(e,r,n,a,l){this.type=e,this.operator=r,this.interpolation=n,this.input=a,this.labels=[],this.outputs=[];for(const[h,f]of l)this.labels.push(h),this.outputs.push(f)}static interpolationFactor(e,r,n,a){let l=0;if(e.name==="exponential")l=nh(r,e.base,n,a);else if(e.name==="linear")l=nh(r,1,n,a);else if(e.name==="cubic-bezier"){const h=e.controlPoints;l=new x1(h[0],h[1],h[2],h[3]).solve(nh(r,1,n,a))}return l}static parse(e,r){let[n,a,l,...h]=e;if(!Array.isArray(a)||a.length===0)return r.error("Expected an interpolation type expression.",1);if(a[0]==="linear")a={name:"linear"};else if(a[0]==="exponential"){const g=a[1];if(typeof g!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);a={name:"exponential",base:g}}else{if(a[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(a[0])}`,1,0);{const g=a.slice(1);if(g.length!==4||g.some(x=>typeof x!="number"||x<0||x>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);a={name:"cubic-bezier",controlPoints:g}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(l=r.parse(l,2,it),!l)return null;const f=[];let m=null;n==="interpolate-hcl"||n==="interpolate-lab"?m=un:r.expectedType&&r.expectedType.kind!=="value"&&(m=r.expectedType);for(let g=0;g<h.length;g+=2){const x=h[g],v=h[g+1],w=g+3,S=g+4;if(typeof x!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',w);if(f.length&&f[f.length-1][0]>=x)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',w);const A=r.parse(v,S,m);if(!A)return null;m=m||A.type,f.push([x,A])}return m.kind==="number"||m.kind==="color"||m.kind==="array"&&m.itemType.kind==="number"&&typeof m.N=="number"?new fn(m,n,a,l,f):r.error(`Type ${Kr(m)} is not interpolatable.`)}evaluate(e){const r=this.labels,n=this.outputs;if(r.length===1)return n[0].evaluate(e);const a=this.input.evaluate(e);if(a<=r[0])return n[0].evaluate(e);const l=r.length;if(a>=r[l-1])return n[l-1].evaluate(e);const h=xc(r,a),f=fn.interpolationFactor(this.interpolation,a,r[h],r[h+1]),m=n[h].evaluate(e),g=n[h+1].evaluate(e);return this.operator==="interpolate"?Va[this.type.kind.toLowerCase()](m,g,f):this.operator==="interpolate-hcl"?Pi.reverse(Pi.interpolate(Pi.forward(m),Pi.forward(g),f)):zo.reverse(zo.interpolate(zo.forward(m),zo.forward(g),f))}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const r=[this.operator,e,this.input.serialize()];for(let n=0;n<this.labels.length;n++)r.push(this.labels[n],this.outputs[n].serialize());return r}}function nh(t,e,r,n){const a=n-r,l=t-r;return a===0?0:e===1?l/a:(Math.pow(e,l)-1)/(Math.pow(e,a)-1)}class wc{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expectected at least one argument.");let n=null;const a=r.expectedType;a&&a.kind!=="value"&&(n=a);const l=[];for(const f of e.slice(1)){const m=r.parse(f,1+l.length,n,void 0,{typeAnnotation:"omit"});if(!m)return null;n=n||m.type,l.push(m)}const h=a&&l.some(f=>ja(a,f.type));return new wc(h?tr:n,l)}evaluate(e){let r,n=null,a=0;for(const l of this.args){if(a++,n=l.evaluate(e),n&&n instanceof hn&&!n.available&&(r||(r=n),n=null,a===this.args.length))return r;if(n!==null)break}return n}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(r=>{e.push(r.serialize())}),e}}class Tc{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const n=[];for(let l=1;l<e.length-1;l+=2){const h=e[l];if(typeof h!="string")return r.error(`Expected string, but found ${typeof h} instead.`,l);if(/[^a-zA-Z0-9_]/.test(h))return r.error("Variable names must contain only alphanumeric characters or '_'.",l);const f=r.parse(e[l+1],l+1);if(!f)return null;n.push([h,f])}const a=r.parse(e[e.length-1],e.length-1,r.expectedType,n);return a?new Tc(n,a):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[r,n]of this.bindings)e.push(r,n.serialize());return e.push(this.result.serialize()),e}}class rl{constructor(e,r,n){this.type=e,this.index=r,this.input=n}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const n=r.parse(e[1],1,it),a=r.parse(e[2],2,vi(r.expectedType||tr));return n&&a?new rl(a.type.itemType,n,a):null}evaluate(e){const r=this.index.evaluate(e),n=this.input.evaluate(e);if(r<0)throw new pi(`Array index out of bounds: ${r} < 0.`);if(r>=n.length)throw new pi(`Array index out of bounds: ${r} > ${n.length-1}.`);if(r!==Math.floor(r))throw new pi(`Array index must be an integer, but found ${r} instead.`);return n[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class oh{constructor(e,r){this.type=cr,this.needle=e,this.haystack=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const n=r.parse(e[1],1,tr),a=r.parse(e[2],2,tr);return n&&a?Ga(n.type,[cr,lr,it,$t,tr])?new oh(n,a):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Kr(n.type)} instead`):null}evaluate(e){const r=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(n==null)return!1;if(!Jo(r,["boolean","string","number","null"]))throw new pi(`Expected first argument to be of type boolean, string, number or null, but found ${Kr(ui(r))} instead.`);if(!Jo(n,["string","array"]))throw new pi(`Expected second argument to be of type array or string, but found ${Kr(ui(n))} instead.`);return n.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Us{constructor(e,r,n){this.type=it,this.needle=e,this.haystack=r,this.fromIndex=n}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const n=r.parse(e[1],1,tr),a=r.parse(e[2],2,tr);if(!n||!a)return null;if(!Ga(n.type,[cr,lr,it,$t,tr]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Kr(n.type)} instead`);if(e.length===4){const l=r.parse(e[3],3,it);return l?new Us(n,a,l):null}return new Us(n,a)}evaluate(e){const r=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(!Jo(r,["boolean","string","number","null"]))throw new pi(`Expected first argument to be of type boolean, string, number or null, but found ${Kr(ui(r))} instead.`);if(!Jo(n,["string","array"]))throw new pi(`Expected second argument to be of type array or string, but found ${Kr(ui(n))} instead.`);if(this.fromIndex){const a=this.fromIndex.evaluate(e);return n.indexOf(r,a)}return n.indexOf(r)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class sh{constructor(e,r,n,a,l,h){this.inputType=e,this.type=r,this.input=n,this.cases=a,this.outputs=l,this.otherwise=h}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let n,a;r.expectedType&&r.expectedType.kind!=="value"&&(a=r.expectedType);const l={},h=[];for(let g=2;g<e.length-1;g+=2){let x=e[g];const v=e[g+1];Array.isArray(x)||(x=[x]);const w=r.concat(g);if(x.length===0)return w.error("Expected at least one branch label.");for(const A of x){if(typeof A!="number"&&typeof A!="string")return w.error("Branch labels must be numbers or strings.");if(typeof A=="number"&&Math.abs(A)>Number.MAX_SAFE_INTEGER)return w.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof A=="number"&&Math.floor(A)!==A)return w.error("Numeric branch labels must be integer values.");if(n){if(w.checkSubtype(n,ui(A)))return null}else n=ui(A);if(l[String(A)]!==void 0)return w.error("Branch labels must be unique.");l[String(A)]=h.length}const S=r.parse(v,g,a);if(!S)return null;a=a||S.type,h.push(S)}const f=r.parse(e[1],1,tr);if(!f)return null;const m=r.parse(e[e.length-1],e.length-1,a);return m?f.type.kind!=="value"&&r.concat(1).checkSubtype(n,f.type)?null:new sh(n,a,f,l,h,m):null}evaluate(e){const r=this.input.evaluate(e);return(ui(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],r=Object.keys(this.cases).sort(),n=[],a={};for(const h of r){const f=a[this.cases[h]];f===void 0?(a[this.cases[h]]=n.length,n.push([this.cases[h],[h]])):n[f][1].push(h)}const l=h=>this.inputType.kind==="number"?Number(h):h;for(const[h,f]of n)e.push(f.length===1?l(f[0]):f.map(l)),e.push(this.outputs[h].serialize());return e.push(this.otherwise.serialize()),e}}class ah{constructor(e,r,n){this.type=e,this.branches=r,this.otherwise=n}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let n;r.expectedType&&r.expectedType.kind!=="value"&&(n=r.expectedType);const a=[];for(let h=1;h<e.length-1;h+=2){const f=r.parse(e[h],h,cr);if(!f)return null;const m=r.parse(e[h+1],h+1,n);if(!m)return null;a.push([f,m]),n=n||m.type}const l=r.parse(e[e.length-1],e.length-1,n);return l?new ah(n,a,l):null}evaluate(e){for(const[r,n]of this.branches)if(r.evaluate(e))return n.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[r,n]of this.branches)e(r),e(n);e(this.otherwise)}outputDefined(){return this.branches.every(([e,r])=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(r=>{e.push(r.serialize())}),e}}class js{constructor(e,r,n,a){this.type=e,this.input=r,this.beginIndex=n,this.endIndex=a}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const n=r.parse(e[1],1,tr),a=r.parse(e[2],2,it);if(!n||!a)return null;if(!Ga(n.type,[vi(tr),lr,tr]))return r.error(`Expected first argument to be of type array or string, but found ${Kr(n.type)} instead`);if(e.length===4){const l=r.parse(e[3],3,it);return l?new js(n.type,n,a,l):null}return new js(n.type,n,a)}evaluate(e){const r=this.input.evaluate(e),n=this.beginIndex.evaluate(e);if(!Jo(r,["string","array"]))throw new pi(`Expected first argument to be of type array or string, but found ${Kr(ui(r))} instead.`);if(this.endIndex){const a=this.endIndex.evaluate(e);return r.slice(n,a)}return r.slice(n)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function J1(t,e){return t==="=="||t==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function lh(t,e,r,n){return n.compare(e,r)===0}function os(t,e,r){const n=t!=="=="&&t!=="!=";return class U6{constructor(l,h,f){this.type=cr,this.lhs=l,this.rhs=h,this.collator=f,this.hasUntypedArgument=l.type.kind==="value"||h.type.kind==="value"}static parse(l,h){if(l.length!==3&&l.length!==4)return h.error("Expected two or three arguments.");const f=l[0];let m=h.parse(l[1],1,tr);if(!m)return null;if(!J1(f,m.type))return h.concat(1).error(`"${f}" comparisons are not supported for type '${Kr(m.type)}'.`);let g=h.parse(l[2],2,tr);if(!g)return null;if(!J1(f,g.type))return h.concat(2).error(`"${f}" comparisons are not supported for type '${Kr(g.type)}'.`);if(m.type.kind!==g.type.kind&&m.type.kind!=="value"&&g.type.kind!=="value")return h.error(`Cannot compare types '${Kr(m.type)}' and '${Kr(g.type)}'.`);n&&(m.type.kind==="value"&&g.type.kind!=="value"?m=new Rn(g.type,[m]):m.type.kind!=="value"&&g.type.kind==="value"&&(g=new Rn(m.type,[g])));let x=null;if(l.length===4){if(m.type.kind!=="string"&&g.type.kind!=="string"&&m.type.kind!=="value"&&g.type.kind!=="value")return h.error("Cannot use collator to compare non-string types.");if(x=h.parse(l[3],3,Ua),!x)return null}return new U6(m,g,x)}evaluate(l){const h=this.lhs.evaluate(l),f=this.rhs.evaluate(l);if(n&&this.hasUntypedArgument){const m=ui(h),g=ui(f);if(m.kind!==g.kind||m.kind!=="string"&&m.kind!=="number")throw new pi(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${m.kind}, ${g.kind}) instead.`)}if(this.collator&&!n&&this.hasUntypedArgument){const m=ui(h),g=ui(f);if(m.kind!=="string"||g.kind!=="string")return e(l,h,f)}return this.collator?r(l,h,f,this.collator.evaluate(l)):e(l,h,f)}eachChild(l){l(this.lhs),l(this.rhs),this.collator&&l(this.collator)}outputDefined(){return!0}serialize(){const l=[t];return this.eachChild(h=>{l.push(h.serialize())}),l}}}const cf=os("==",function(t,e,r){return e===r},lh),ch=os("!=",function(t,e,r){return e!==r},function(t,e,r,n){return!lh(0,e,r,n)}),Sc=os("<",function(t,e,r){return e<r},function(t,e,r,n){return n.compare(e,r)<0}),K1=os(">",function(t,e,r){return e>r},function(t,e,r,n){return n.compare(e,r)>0}),uf=os("<=",function(t,e,r){return e<=r},function(t,e,r,n){return n.compare(e,r)<=0}),e0=os(">=",function(t,e,r){return e>=r},function(t,e,r,n){return n.compare(e,r)>=0});class uh{constructor(e,r,n,a,l,h){this.type=lr,this.number=e,this.locale=r,this.currency=n,this.unit=a,this.minFractionDigits=l,this.maxFractionDigits=h}static parse(e,r){if(e.length!==3)return r.error("Expected two arguments.");const n=r.parse(e[1],1,it);if(!n)return null;const a=e[2];if(typeof a!="object"||Array.isArray(a))return r.error("NumberFormat options argument must be an object.");let l=null;if(a.locale&&(l=r.parse(a.locale,1,lr),!l))return null;let h=null;if(a.currency&&(h=r.parse(a.currency,1,lr),!h))return null;let f=null;if(a.unit&&(f=r.parse(a.unit,1,lr),!f))return null;let m=null;if(a["min-fraction-digits"]&&(m=r.parse(a["min-fraction-digits"],1,it),!m))return null;let g=null;return a["max-fraction-digits"]&&(g=r.parse(a["max-fraction-digits"],1,it),!g)?null:new uh(n,l,h,f,m,g)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class il{constructor(e){this.type=it,this.input=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const n=r.parse(e[1],1);return n?n.type.kind!=="array"&&n.type.kind!=="string"&&n.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${Kr(n.type)} instead.`):new il(n):null}evaluate(e){const r=this.input.evaluate(e);if(typeof r=="string"||Array.isArray(r))return r.length;throw new pi(`Expected value to be of type string or array, but found ${Kr(ui(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(r=>{e.push(r.serialize())}),e}}function t0(t){return function(){t=1831565813+(t|=0)|0;let e=Math.imul(t^t>>>15,1|t);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const Gs={"==":cf,"!=":ch,">":K1,"<":Sc,">=":e0,"<=":uf,array:Rn,at:rl,boolean:Rn,case:ah,coalesce:wc,collator:qa,format:$a,image:ks,in:oh,"index-of":Us,interpolate:fn,"interpolate-hcl":fn,"interpolate-lab":fn,length:il,let:Tc,literal:$n,match:sh,number:Rn,"number-format":uh,object:Rn,slice:js,step:el,string:Rn,"to-boolean":no,"to-color":no,"to-number":no,"to-string":no,var:dn,within:es,distance:is,config:Co};function r0(t,[e,r,n,a]){e=e.evaluate(t),r=r.evaluate(t),n=n.evaluate(t);const l=a?a.evaluate(t):1,h=L1(e,r,n,l);if(h)throw new pi(h);return new gr(e/255*l,r/255*l,n/255*l,l)}function i0(t,[e,r,n,a]){e=e.evaluate(t),r=r.evaluate(t),n=n.evaluate(t);const l=a?a.evaluate(t):1,h=function(g,x,v,w){return typeof g=="number"&&g>=0&&g<=360?typeof x=="number"&&x>=0&&x<=100&&typeof v=="number"&&v>=0&&v<=100?w===void 0||typeof w=="number"&&w>=0&&w<=1?null:`Invalid hsla value [${[g,x,v,w].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof w=="number"?[g,x,v,w]:[g,x,v]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof w=="number"?[g,x,v,w]:[g,x,v]).join(", ")}]: 'h' must be between 0 and 360.`}(e,r,n,l);if(h)throw new pi(h);const f=`hsla(${e}, ${r}%, ${n}%, ${l})`,m=gr.parse(f);if(!m)throw new pi(`Failed to parse HSLA color: ${f}`);return m}function hh(t,e){return t in e}function dh(t,e){const r=e[t];return r===void 0?null:r}function ss(t){return{type:t}}function n0(t){return{result:"success",value:t}}function as(t){return{result:"error",value:t}}function o0(t,e){return!!t&&!!t.parameters&&t.parameters.indexOf(e)>-1}function Ec(t){return t["property-type"]==="data-driven"}function s0(t){return o0(t.expression,"measure-light")}function a0(t){return o0(t.expression,"zoom")}function $s(t){return!!t.expression&&t.expression.interpolated}function fh(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function hf(t){return t}function nl(t,e){const r=e.type==="color",n=t.stops&&typeof t.stops[0][0]=="object",a=n||!(n||t.property!==void 0),l=t.type||($s(e)?"exponential":"interval");if(r&&((t=sc({},t)).stops&&(t.stops=t.stops.map(g=>[g[0],gr.parse(g[1])])),t.default=gr.parse(t.default?t.default:e.default)),t.colorSpace&&t.colorSpace!=="rgb"&&!tl[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let h,f,m;if(l==="exponential")h=ph;else if(l==="interval")h=df;else if(l==="categorical"){h=l0,f=Object.create(null);for(const g of t.stops)f[g[0]]=g[1];m=typeof t.stops[0][0]}else{if(l!=="identity")throw new Error(`Unknown function type "${l}"`);h=c0}if(n){const g={},x=[];for(let S=0;S<t.stops.length;S++){const A=t.stops[S],P=A[0].zoom;g[P]===void 0&&(g[P]={zoom:P,type:t.type,property:t.property,default:t.default,stops:[]},x.push(P)),g[P].stops.push([A[0].value,A[1]])}const v=[];for(const S of x)v.push([g[S].zoom,nl(g[S],e)]);const w={name:"linear"};return{kind:"composite",interpolationType:w,interpolationFactor:fn.interpolationFactor.bind(void 0,w),zoomStops:v.map(S=>S[0]),evaluate:({zoom:S},A)=>ph({stops:v,base:t.base},e,S).evaluate(S,A)}}if(a){const g=l==="exponential"?{name:"exponential",base:t.base!==void 0?t.base:1}:null;return{kind:"camera",interpolationType:g,interpolationFactor:fn.interpolationFactor.bind(void 0,g),zoomStops:t.stops.map(x=>x[0]),evaluate:({zoom:x})=>h(t,e,x,f,m)}}return{kind:"source",evaluate(g,x){const v=x&&x.properties?x.properties[t.property]:void 0;return v===void 0?ol(t.default,e.default):h(t,e,v,f,m)}}}function ol(t,e,r){return t!==void 0?t:e!==void 0?e:r!==void 0?r:void 0}function l0(t,e,r,n,a){return ol(typeof r===a?n[r]:void 0,t.default,e.default)}function df(t,e,r){if(Io(r)!=="number")return ol(t.default,e.default);const n=t.stops.length;if(n===1||r<=t.stops[0][0])return t.stops[0][1];if(r>=t.stops[n-1][0])return t.stops[n-1][1];const a=xc(t.stops.map(l=>l[0]),r);return t.stops[a][1]}function ph(t,e,r){const n=t.base!==void 0?t.base:1;if(Io(r)!=="number")return ol(t.default,e.default);const a=t.stops.length;if(a===1||r<=t.stops[0][0])return t.stops[0][1];if(r>=t.stops[a-1][0])return t.stops[a-1][1];const l=xc(t.stops.map(x=>x[0]),r),h=function(x,v,w,S){const A=S-w,P=x-w;return A===0?0:v===1?P/A:(Math.pow(v,P)-1)/(Math.pow(v,A)-1)}(r,n,t.stops[l][0],t.stops[l+1][0]),f=t.stops[l][1],m=t.stops[l+1][1];let g=Va[e.type]||hf;if(t.colorSpace&&t.colorSpace!=="rgb"){const x=tl[t.colorSpace];g=(v,w)=>x.reverse(x.interpolate(x.forward(v),x.forward(w),h))}return typeof f.evaluate=="function"?{evaluate(...x){const v=f.evaluate.apply(void 0,x),w=m.evaluate.apply(void 0,x);if(v!==void 0&&w!==void 0)return g(v,w,h)}}:g(f,m,h)}function c0(t,e,r){return e.type==="color"?r=gr.parse(r):e.type==="formatted"?r=Ii.fromString(r.toString()):e.type==="resolvedImage"?r=hn.fromString(r.toString()):Io(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0),ol(r,t.default,e.default)}Ji.register(Gs,{error:[{kind:"error"},[lr],(t,[e])=>{throw new pi(e.evaluate(t))}],typeof:[lr,[tr],(t,[e])=>Kr(ui(e.evaluate(t)))],"to-rgba":[vi(it,4),[un],(t,[e])=>e.evaluate(t).toArray()],rgb:[un,[it,it,it],r0],rgba:[un,[it,it,it,it],r0],hsl:[un,[it,it,it],i0],hsla:[un,[it,it,it,it],i0],has:{type:cr,overloads:[[[lr],(t,[e])=>hh(e.evaluate(t),t.properties())],[[lr,zs],(t,[e,r])=>hh(e.evaluate(t),r.evaluate(t))]]},get:{type:tr,overloads:[[[lr],(t,[e])=>dh(e.evaluate(t),t.properties())],[[lr,zs],(t,[e,r])=>dh(e.evaluate(t),r.evaluate(t))]]},"feature-state":[tr,[lr],(t,[e])=>dh(e.evaluate(t),t.featureState||{})],properties:[zs,[],t=>t.properties()],"geometry-type":[lr,[],t=>t.geometryType()],id:[tr,[],t=>t.id()],zoom:[it,[],t=>t.globals.zoom],pitch:[it,[],t=>t.globals.pitch||0],"distance-from-center":[it,[],t=>t.distanceFromCenter()],"measure-light":[it,[lr],(t,[e])=>t.measureLight(e.evaluate(t))],"heatmap-density":[it,[],t=>t.globals.heatmapDensity||0],"line-progress":[it,[],t=>t.globals.lineProgress||0],"raster-value":[it,[],t=>t.globals.rasterValue||0],"raster-particle-speed":[it,[],t=>t.globals.rasterParticleSpeed||0],"sky-radial-progress":[it,[],t=>t.globals.skyRadialProgress||0],accumulated:[tr,[],t=>t.globals.accumulated===void 0?null:t.globals.accumulated],"+":[it,ss(it),(t,e)=>{let r=0;for(const n of e)r+=n.evaluate(t);return r}],"*":[it,ss(it),(t,e)=>{let r=1;for(const n of e)r*=n.evaluate(t);return r}],"-":{type:it,overloads:[[[it,it],(t,[e,r])=>e.evaluate(t)-r.evaluate(t)],[[it],(t,[e])=>-e.evaluate(t)]]},"/":[it,[it,it],(t,[e,r])=>e.evaluate(t)/r.evaluate(t)],"%":[it,[it,it],(t,[e,r])=>e.evaluate(t)%r.evaluate(t)],ln2:[it,[],()=>Math.LN2],pi:[it,[],()=>Math.PI],e:[it,[],()=>Math.E],"^":[it,[it,it],(t,[e,r])=>Math.pow(e.evaluate(t),r.evaluate(t))],sqrt:[it,[it],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[it,[it],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[it,[it],(t,[e])=>Math.log(e.evaluate(t))],log2:[it,[it],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[it,[it],(t,[e])=>Math.sin(e.evaluate(t))],cos:[it,[it],(t,[e])=>Math.cos(e.evaluate(t))],tan:[it,[it],(t,[e])=>Math.tan(e.evaluate(t))],asin:[it,[it],(t,[e])=>Math.asin(e.evaluate(t))],acos:[it,[it],(t,[e])=>Math.acos(e.evaluate(t))],atan:[it,[it],(t,[e])=>Math.atan(e.evaluate(t))],min:[it,ss(it),(t,e)=>Math.min(...e.map(r=>r.evaluate(t)))],max:[it,ss(it),(t,e)=>Math.max(...e.map(r=>r.evaluate(t)))],abs:[it,[it],(t,[e])=>Math.abs(e.evaluate(t))],round:[it,[it],(t,[e])=>{const r=e.evaluate(t);return r<0?-Math.round(-r):Math.round(r)}],floor:[it,[it],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[it,[it],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[cr,[lr,tr],(t,[e,r])=>t.properties()[e.value]===r.value],"filter-id-==":[cr,[tr],(t,[e])=>t.id()===e.value],"filter-type-==":[cr,[lr],(t,[e])=>t.geometryType()===e.value],"filter-<":[cr,[lr,tr],(t,[e,r])=>{const n=t.properties()[e.value],a=r.value;return typeof n==typeof a&&n<a}],"filter-id-<":[cr,[tr],(t,[e])=>{const r=t.id(),n=e.value;return typeof r==typeof n&&r<n}],"filter->":[cr,[lr,tr],(t,[e,r])=>{const n=t.properties()[e.value],a=r.value;return typeof n==typeof a&&n>a}],"filter-id->":[cr,[tr],(t,[e])=>{const r=t.id(),n=e.value;return typeof r==typeof n&&r>n}],"filter-<=":[cr,[lr,tr],(t,[e,r])=>{const n=t.properties()[e.value],a=r.value;return typeof n==typeof a&&n<=a}],"filter-id-<=":[cr,[tr],(t,[e])=>{const r=t.id(),n=e.value;return typeof r==typeof n&&r<=n}],"filter->=":[cr,[lr,tr],(t,[e,r])=>{const n=t.properties()[e.value],a=r.value;return typeof n==typeof a&&n>=a}],"filter-id->=":[cr,[tr],(t,[e])=>{const r=t.id(),n=e.value;return typeof r==typeof n&&r>=n}],"filter-has":[cr,[tr],(t,[e])=>e.value in t.properties()],"filter-has-id":[cr,[],t=>t.id()!==null&&t.id()!==void 0],"filter-type-in":[cr,[vi(lr)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[cr,[vi(tr)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[cr,[lr,vi(tr)],(t,[e,r])=>r.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[cr,[lr,vi(tr)],(t,[e,r])=>function(n,a,l,h){for(;l<=h;){const f=l+h>>1;if(a[f]===n)return!0;a[f]>n?h=f-1:l=f+1}return!1}(t.properties()[e.value],r.value,0,r.value.length-1)],all:{type:cr,overloads:[[[cr,cr],(t,[e,r])=>e.evaluate(t)&&r.evaluate(t)],[ss(cr),(t,e)=>{for(const r of e)if(!r.evaluate(t))return!1;return!0}]]},any:{type:cr,overloads:[[[cr,cr],(t,[e,r])=>e.evaluate(t)||r.evaluate(t)],[ss(cr),(t,e)=>{for(const r of e)if(r.evaluate(t))return!0;return!1}]]},"!":[cr,[cr],(t,[e])=>!e.evaluate(t)],"is-supported-script":[cr,[lr],(t,[e])=>{const r=t.globals&&t.globals.isSupportedScript;return!r||r(e.evaluate(t))}],upcase:[lr,[lr],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[lr,[lr],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[lr,ss(tr),(t,e)=>e.map(r=>yn(r.evaluate(t))).join("")],"resolved-locale":[lr,[Ua],(t,[e])=>e.evaluate(t).resolvedLocale()],random:[it,[it,it,tr],(t,e)=>{const[r,n,a]=e.map(h=>h.evaluate(t));if(r>n||r===n)return r;let l;if(typeof a=="string")l=function(h){let f=0;if(h.length===0)return f;for(let m=0;m<h.length;m++)f=(f<<5)-f+h.charCodeAt(m),f|=0;return f}(a);else{if(typeof a!="number")throw new pi(`Invalid seed input: ${a}`);l=a}return r+t0(l)()*(n-r)}]});class Ac{constructor(e,r,n,a){this.expression=e,this._warningHistory={},this._evaluator=new Vu(n,a),this._defaultValue=r?function(l){return l.type==="color"&&(fh(l.default)||Array.isArray(l.default))?new gr(0,0,0,0):l.type==="color"?gr.parse(l.default)||null:l.default===void 0?null:l.default}(r):null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(e,r,n,a,l,h,f,m){return this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=n,this._evaluator.canonical=a||null,this._evaluator.availableImages=l||null,this._evaluator.formattedSection=h,this._evaluator.featureTileCoord=f||null,this._evaluator.featureDistanceData=m||null,this.expression.evaluate(this._evaluator)}evaluate(e,r,n,a,l,h,f,m){this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=n||null,this._evaluator.canonical=a||null,this._evaluator.availableImages=l||null,this._evaluator.formattedSection=h||null,this._evaluator.featureTileCoord=f||null,this._evaluator.featureDistanceData=m||null;try{const g=this.expression.evaluate(this._evaluator);if(g==null||typeof g=="number"&&g!=g)return this._defaultValue;if(this._enumValues&&!(g in this._enumValues))throw new pi(`Expected value to be one of ${Object.keys(this._enumValues).map(x=>JSON.stringify(x)).join(", ")}, but found ${JSON.stringify(g)} instead.`);return g}catch(g){return this._warningHistory[g.message]||(this._warningHistory[g.message]=!0,typeof console<"u"&&console.warn(g.message)),this._defaultValue}}}function Mc(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in Gs}function qs(t,e,r,n){const a=new gc(Gs,[],e?function(h){const f={color:un,string:lr,number:it,enum:lr,boolean:cr,formatted:Rs,resolvedImage:Ls};return h.type==="array"?vi(f[h.value]||tr,h.length):f[h.type]}(e):void 0,void 0,void 0,r,n),l=a.parse(t,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return l?n0(new Ac(l,e,r,n)):as(a.errors)}class sl{constructor(e,r,n){this.kind=e,this._styleExpression=r,this.isLightConstant=n,this.isStateDependent=e!=="constant"&&!Ya(r.expression),this.isConfigDependent=!Ja(r.expression)}evaluateWithoutErrorHandling(e,r,n,a,l,h){return this._styleExpression.evaluateWithoutErrorHandling(e,r,n,a,l,h)}evaluate(e,r,n,a,l,h){return this._styleExpression.evaluate(e,r,n,a,l,h)}}class al{constructor(e,r,n,a,l){this.kind=e,this.zoomStops=n,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!Ya(r.expression),this.isLightConstant=l,this.isConfigDependent=!Ja(r.expression),this.interpolationType=a}evaluateWithoutErrorHandling(e,r,n,a,l,h){return this._styleExpression.evaluateWithoutErrorHandling(e,r,n,a,l,h)}evaluate(e,r,n,a,l,h){return this._styleExpression.evaluate(e,r,n,a,l,h)}interpolationFactor(e,r,n){return this.interpolationType?fn.interpolationFactor(this.interpolationType,e,r,n):0}}function u0(t,e,r,n){if((t=qs(t,e,r,n)).result==="error")return t;const a=t.value.expression,l=Do(a);if(!l&&!Ec(e))return as([new zn("","data expressions not supported")]);const h=Ka(a,["zoom","pitch","distance-from-center"]);if(!h&&!a0(e))return as([new zn("","zoom expressions not supported")]);const f=Ka(a,["measure-light"]);if(!f&&!s0(e))return as([new zn("","measure-light expression not supported")]);const m=e.expression&&e.expression.relaxZoomRestriction,g=Ic(a);return g||h||m?g instanceof zn?as([g]):g instanceof fn&&!$s(e)?as([new zn("",'"interpolate" expressions cannot be used with this property')]):n0(g?new al(l?"camera":"composite",t.value,g.labels,g instanceof fn?g.interpolation:void 0,f):new sl(l?"constant":"source",t.value,f)):as([new zn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class ll{constructor(e,r){this._parameters=e,this._specification=r,sc(this,nl(this._parameters,this._specification))}static deserialize(e){return new ll(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Ic(t){let e=null;if(t instanceof Tc)e=Ic(t.result);else if(t instanceof wc){for(const r of t.args)if(e=Ic(r),e)break}else(t instanceof el||t instanceof fn)&&t.input instanceof Ji&&t.input.name==="zoom"&&(e=t);return e instanceof zn||t.eachChild(r=>{const n=Ic(r);n instanceof zn?e=n:e&&n&&e!==n&&(e=new zn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var h0=qn,Ro=3;function qn(t,e,r){var n=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var a=new Int32Array(this.arrayBuffer);t=a[0],this.d=(e=a[1])+2*(r=a[2]);for(var l=0;l<this.d*this.d;l++){var h=a[Ro+l],f=a[Ro+l+1];n.push(h===f?null:a.subarray(h,f))}var m=a[Ro+n.length+1];this.keys=a.subarray(a[Ro+n.length],m),this.bboxes=a.subarray(m),this.insert=this._insertReadonly}else{this.d=e+2*r;for(var g=0;g<this.d*this.d;g++)n.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=r,this.scale=e/t,this.uid=0;var x=r/e*t;this.min=-x,this.max=t+x}qn.prototype.insert=function(t,e,r,n,a){this._forEachCell(e,r,n,a,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(r),this.bboxes.push(n),this.bboxes.push(a)},qn.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},qn.prototype._insertCell=function(t,e,r,n,a,l){this.cells[a].push(l)},qn.prototype.query=function(t,e,r,n,a){var l=this.min,h=this.max;if(t<=l&&e<=l&&h<=r&&h<=n&&!a)return Array.prototype.slice.call(this.keys);var f=[];return this._forEachCell(t,e,r,n,this._queryCell,f,{},a),f},qn.prototype._queryCell=function(t,e,r,n,a,l,h,f){var m=this.cells[a];if(m!==null)for(var g=this.keys,x=this.bboxes,v=0;v<m.length;v++){var w=m[v];if(h[w]===void 0){var S=4*w;(f?f(x[S+0],x[S+1],x[S+2],x[S+3]):t<=x[S+2]&&e<=x[S+3]&&r>=x[S+0]&&n>=x[S+1])?(h[w]=!0,l.push(g[w])):h[w]=!1}}},qn.prototype._forEachCell=function(t,e,r,n,a,l,h,f){for(var m=this._convertToCellCoord(t),g=this._convertToCellCoord(e),x=this._convertToCellCoord(r),v=this._convertToCellCoord(n),w=m;w<=x;w++)for(var S=g;S<=v;S++){var A=this.d*S+w;if((!f||f(this._convertFromCellCoord(w),this._convertFromCellCoord(S),this._convertFromCellCoord(w+1),this._convertFromCellCoord(S+1)))&&a.call(this,t,e,r,n,A,l,h,f))return}},qn.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},qn.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},qn.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=Ro+this.cells.length+1+1,r=0,n=0;n<this.cells.length;n++)r+=this.cells[n].length;var a=new Int32Array(e+r+this.keys.length+this.bboxes.length);a[0]=this.extent,a[1]=this.n,a[2]=this.padding;for(var l=e,h=0;h<t.length;h++){var f=t[h];a[Ro+h]=l,a.set(f,l),l+=f.length}return a[Ro+t.length]=l,a.set(this.keys,l),a[Ro+t.length+1]=l+=this.keys.length,a.set(this.bboxes,l),l+=this.bboxes.length,a.buffer};var Zs=Br(h0);const Pc={};function nt(t,e,r={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),Pc[e]={klass:t,omit:r.omit||[]}}nt(Object,"Object"),Zs.serialize=function(t,e){const r=t.toArrayBuffer();return e&&e.add(r),{buffer:r}},Zs.deserialize=function(t){return new Zs(t.buffer)},Object.defineProperty(Zs,"name",{value:"Grid"}),nt(Zs,"Grid"),nt(gr,"Color"),nt(Error,"Error"),nt(Ii,"Formatted"),nt(ac,"FormattedSection"),nt(Ql,"AJAXError"),nt(hn,"ResolvedImage"),nt(ll,"StylePropertyFunction"),nt(Ac,"StyleExpression",{omit:["_evaluator"]}),nt(al,"ZoomDependentExpression"),nt(sl,"ZoomConstantExpression"),nt(Ji,"CompoundExpression",{omit:["_evaluate"]});for(const t in Gs)Pc[Gs[t]._classRegistryKey]||nt(Gs[t],`Expression${t}`);function d0(t){return t&&typeof ArrayBuffer<"u"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function f0(t){return self.ImageBitmap&&t instanceof ImageBitmap}function cl(t,e){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(d0(t)||f0(t))return e&&e.add(t),t;if(ArrayBuffer.isView(t)){const r=t;return e&&e.add(r.buffer),r}if(t instanceof ImageData)return e&&e.add(t.data.buffer),t;if(Array.isArray(t)){const r=[];for(const n of t)r.push(cl(n,e));return r}if(t instanceof Map){const r={$name:"Map"};for(const[n,a]of t.entries())r[n]=cl(a);return r}if(typeof t=="object"){const r=t.constructor,n=r._classRegistryKey;if(!n)throw new Error(`can't serialize object of unregistered class ${n}`);const a=r.serialize?r.serialize(t,e):{};if(!r.serialize){for(const l in t)t.hasOwnProperty(l)&&(Pc[n].omit.indexOf(l)>=0||(a[l]=cl(t[l],e)));t instanceof Error&&(a.message=t.message)}if(a.$name)throw new Error("$name property is reserved for worker serialization logic.");return n!=="Object"&&(a.$name=n),a}throw new Error("can't serialize object of type "+typeof t)}function c(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||d0(t)||f0(t)||ArrayBuffer.isView(t)||t instanceof ImageData)return t;if(Array.isArray(t))return t.map(c);if(typeof t=="object"){const e=t.$name||"Object";if(e==="Map"){const a=new Map;for(const l of Object.keys(t))l!=="$name"&&a.set(l,c(t[l]));return a}const{klass:r}=Pc[e];if(!r)throw new Error(`can't deserialize unregistered class ${e}`);if(r.deserialize)return r.deserialize(t);const n=Object.create(r.prototype);for(const a of Object.keys(t))a!=="$name"&&(n[a]=c(t[a]));return n}throw new Error("can't deserialize object of type "+typeof t)}const i={"Latin-1 Supplement":t=>t>=128&&t<=255,Arabic:t=>t>=1536&&t<=1791,"Arabic Supplement":t=>t>=1872&&t<=1919,"Arabic Extended-A":t=>t>=2208&&t<=2303,"Hangul Jamo":t=>t>=4352&&t<=4607,"Unified Canadian Aboriginal Syllabics":t=>t>=5120&&t<=5759,Khmer:t=>t>=6016&&t<=6143,"Unified Canadian Aboriginal Syllabics Extended":t=>t>=6320&&t<=6399,"General Punctuation":t=>t>=8192&&t<=8303,"Letterlike Symbols":t=>t>=8448&&t<=8527,"Number Forms":t=>t>=8528&&t<=8591,"Miscellaneous Technical":t=>t>=8960&&t<=9215,"Control Pictures":t=>t>=9216&&t<=9279,"Optical Character Recognition":t=>t>=9280&&t<=9311,"Enclosed Alphanumerics":t=>t>=9312&&t<=9471,"Geometric Shapes":t=>t>=9632&&t<=9727,"Miscellaneous Symbols":t=>t>=9728&&t<=9983,"Miscellaneous Symbols and Arrows":t=>t>=11008&&t<=11263,"CJK Radicals Supplement":t=>t>=11904&&t<=12031,"Kangxi Radicals":t=>t>=12032&&t<=12255,"Ideographic Description Characters":t=>t>=12272&&t<=12287,"CJK Symbols and Punctuation":t=>t>=12288&&t<=12351,Hiragana:t=>t>=12352&&t<=12447,Katakana:t=>t>=12448&&t<=12543,Bopomofo:t=>t>=12544&&t<=12591,"Hangul Compatibility Jamo":t=>t>=12592&&t<=12687,Kanbun:t=>t>=12688&&t<=12703,"Bopomofo Extended":t=>t>=12704&&t<=12735,"CJK Strokes":t=>t>=12736&&t<=12783,"Katakana Phonetic Extensions":t=>t>=12784&&t<=12799,"Enclosed CJK Letters and Months":t=>t>=12800&&t<=13055,"CJK Compatibility":t=>t>=13056&&t<=13311,"CJK Unified Ideographs Extension A":t=>t>=13312&&t<=19903,"Yijing Hexagram Symbols":t=>t>=19904&&t<=19967,"CJK Unified Ideographs":t=>t>=19968&&t<=40959,"Yi Syllables":t=>t>=40960&&t<=42127,"Yi Radicals":t=>t>=42128&&t<=42191,"Hangul Jamo Extended-A":t=>t>=43360&&t<=43391,"Hangul Syllables":t=>t>=44032&&t<=55215,"Hangul Jamo Extended-B":t=>t>=55216&&t<=55295,"Private Use Area":t=>t>=57344&&t<=63743,"CJK Compatibility Ideographs":t=>t>=63744&&t<=64255,"Arabic Presentation Forms-A":t=>t>=64336&&t<=65023,"Vertical Forms":t=>t>=65040&&t<=65055,"CJK Compatibility Forms":t=>t>=65072&&t<=65103,"Small Form Variants":t=>t>=65104&&t<=65135,"Arabic Presentation Forms-B":t=>t>=65136&&t<=65279,"Halfwidth and Fullwidth Forms":t=>t>=65280&&t<=65519,"CJK Unified Ideographs Extension B":t=>t>=131072&&t<=173791};function o(t){for(const e of t)if(p(e.charCodeAt(0)))return!0;return!1}function u(t){for(const e of t)if(!d(e.charCodeAt(0)))return!1;return!0}function d(t){return!(i.Arabic(t)||i["Arabic Supplement"](t)||i["Arabic Extended-A"](t)||i["Arabic Presentation Forms-A"](t)||i["Arabic Presentation Forms-B"](t))}function p(t){return!(t!==746&&t!==747&&(t<4352||!(i["Bopomofo Extended"](t)||i.Bopomofo(t)||i["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||i["CJK Compatibility Ideographs"](t)||i["CJK Compatibility"](t)||i["CJK Radicals Supplement"](t)||i["CJK Strokes"](t)||!(!i["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||i["CJK Unified Ideographs Extension A"](t)||i["CJK Unified Ideographs"](t)||i["Enclosed CJK Letters and Months"](t)||i["Hangul Compatibility Jamo"](t)||i["Hangul Jamo Extended-A"](t)||i["Hangul Jamo Extended-B"](t)||i["Hangul Jamo"](t)||i["Hangul Syllables"](t)||i.Hiragana(t)||i["Ideographic Description Characters"](t)||i.Kanbun(t)||i["Kangxi Radicals"](t)||i["Katakana Phonetic Extensions"](t)||i.Katakana(t)&&t!==12540||!(!i["Halfwidth and Fullwidth Forms"](t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!i["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||i["Unified Canadian Aboriginal Syllabics"](t)||i["Unified Canadian Aboriginal Syllabics Extended"](t)||i["Vertical Forms"](t)||i["Yijing Hexagram Symbols"](t)||i["Yi Syllables"](t)||i["Yi Radicals"](t))))}function _(t){return!(p(t)||function(e){return!!(i["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||i["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||i["Letterlike Symbols"](e)||i["Number Forms"](e)||i["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||i["Control Pictures"](e)&&e!==9251||i["Optical Character Recognition"](e)||i["Enclosed Alphanumerics"](e)||i["Geometric Shapes"](e)||i["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||i["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||i["CJK Symbols and Punctuation"](e)||i.Katakana(e)||i["Private Use Area"](e)||i["CJK Compatibility Forms"](e)||i["Small Form Variants"](e)||i["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(t))}function y(t){return t>=1424&&t<=2303||i["Arabic Presentation Forms-A"](t)||i["Arabic Presentation Forms-B"](t)}function b(t,e){return!(!e&&y(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||i.Khmer(t))}function T(t){for(const e of t)if(y(e.charCodeAt(0)))return!0;return!1}const E="deferred",I="loading",C="loaded";let D=null,k="unavailable",O=null;const B=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(k="error"),D&&D(t)};function F(){j.fire(new Ao("pluginStateChange",{pluginStatus:k,pluginURL:O}))}const j=new Yo,Q=function(){return k},H=function(){if(k!==E||!O)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");k=I,F(),O&&za({url:O},t=>{t?B(t):(k=C,F())})},Y={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>k===C||Y.applyArabicShaping!=null,isLoading:()=>k===I,setState(t){k=t.pluginStatus,O=t.pluginURL},isParsed:()=>Y.applyArabicShaping!=null&&Y.processBidirectionalText!=null&&Y.processStyledBidirectionalText!=null,getPluginURL:()=>O};class N{constructor(e,r){this.zoom=e,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.transition=r.transition,this.pitch=r.pitch,this.brightness=r.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(r,n){for(const a of r)if(!b(a.charCodeAt(0),n))return!1;return!0}(e,Y.isLoaded())}}class ${constructor(e,r,n,a){this.property=e,this.value=r,this.expression=function(l,h,f,m){if(fh(l))return new ll(l,h);if(Mc(l)||Array.isArray(l)&&l.length>0){const g=u0(l,h,f,m);if(g.result==="error")throw new Error(g.value.map(x=>`${x.key}: ${x.message}`).join(", "));return g.value}{let g=l;return typeof l=="string"&&h.type==="color"&&(g=gr.parse(l)),{kind:"constant",isConfigDependent:!1,evaluate:()=>g}}}(r===void 0?e.specification.default:r,e.specification,n,a)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,r,n){return this.property.possiblyEvaluate(this,e,r,n)}}class ie{constructor(e,r,n){this.property=e,this.value=new $(e,void 0,r,n)}transitioned(e,r){return new ae(this.property,this.value,r,gn({},e.transition,this.transition),e.now)}untransitioned(){return new ae(this.property,this.value,null,{},0)}}class te{constructor(e,r,n){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=r,this._options=n,this.isConfigDependent=!1}getValue(e){return to(this._values[e].value.value)}setValue(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new ie(this._values[e].property,this._scope,this._options)),this._values[e].value=new $(this._values[e].property,r===null?void 0:to(r),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].value.expression.isConfigDependent}setTransitionOrValue(e,r){r&&(this._options=r);const n=this._properties.properties;if(e)for(const a in e){const l=e[a];if(Wo(a,"-transition")){const h=a.slice(0,-11);n[h]&&this.setTransition(h,l)}else n[a]&&this.setValue(a,l)}}getTransition(e){return to(this._values[e].transition)}setTransition(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new ie(this._values[e].property)),this._values[e].transition=to(r)||void 0}serialize(){const e={};for(const r of Object.keys(this._values)){const n=this.getValue(r);n!==void 0&&(e[r]=n);const a=this.getTransition(r);a!==void 0&&(e[`${r}-transition`]=a)}return e}transitioned(e,r){const n=new ge(this._properties);for(const a of Object.keys(this._values))n._values[a]=this._values[a].transitioned(e,r._values[a]);return n}untransitioned(){const e=new ge(this._properties);for(const r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class ae{constructor(e,r,n,a,l){const h=a.delay||0,f=a.duration||0;l=l||0,this.property=e,this.value=r,this.begin=l+h,this.end=this.begin+f,e.specification.transition&&(a.delay||a.duration)&&(this.prior=n)}possiblyEvaluate(e,r,n){const a=e.now||0,l=this.value.possiblyEvaluate(e,r,n),h=this.prior;if(h){if(a>this.end)return this.prior=null,l;if(this.value.isDataDriven())return this.prior=null,l;if(a<this.begin)return h.possiblyEvaluate(e,r,n);{const f=(a-this.begin)/(this.end-this.begin);return this.property.interpolate(h.possiblyEvaluate(e,r,n),l,Bl(f))}}return l}}class ge{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,n){const a=new xe(this._properties);for(const l of Object.keys(this._values))a._values[l]=this._values[l].possiblyEvaluate(e,r,n);return a}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class se{constructor(e,r,n){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=r,this._options=n,this.isConfigDependent=!1}getValue(e){return to(this._values[e].value)}setValue(e,r){this._values[e]=new $(this._values[e].property,r===null?void 0:to(r),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].expression.isConfigDependent}serialize(){const e={};for(const r of Object.keys(this._values)){const n=this.getValue(r);n!==void 0&&(e[r]=n)}return e}possiblyEvaluate(e,r,n){const a=new xe(this._properties);for(const l of Object.keys(this._values))a._values[l]=this._values[l].possiblyEvaluate(e,r,n);return a}}class me{constructor(e,r,n){this.property=e,this.value=r,this.parameters=n}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,r,n,a){return this.property.evaluate(this.value,this.parameters,e,r,n,a)}}class xe{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class oe{constructor(e){this.specification=e}possiblyEvaluate(e,r){return e.expression.evaluate(r)}interpolate(e,r,n){const a=Va[this.specification.type];return a?a(e,r,n):e}}class fe{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,n,a){return new me(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(r,null,{},n,a)}:e.expression,r)}interpolate(e,r,n){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new me(this,{kind:"constant",value:void 0},e.parameters);const a=Va[this.specification.type];return a?new me(this,{kind:"constant",value:a(e.value.value,r.value.value,n)},e.parameters):e}evaluate(e,r,n,a,l,h){return e.kind==="constant"?e.value:e.evaluate(r,n,a,l,h)}}class Re{constructor(e){this.specification=e}possiblyEvaluate(e,r,n,a){return!!e.expression.evaluate(r,null,{},n,a)}interpolate(){return!1}}class ue{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const r=new N(0,{});for(const n in e){const a=e[n];a.specification.overridable&&this.overridableProperties.push(n);const l=this.defaultPropertyValues[n]=new $(a,void 0),h=this.defaultTransitionablePropertyValues[n]=new ie(a);this.defaultTransitioningPropertyValues[n]=h.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=l.possiblyEvaluate(r)}}}function _e(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function ye(t){if(Array.isArray(t))return t.map(ye);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const r in t)e[r]=ye(t[r]);return e}return _e(t)}nt(fe,"DataDrivenProperty"),nt(oe,"DataConstantProperty"),nt(Re,"ColorRampProperty");var X=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Ee(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!Ee(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Je(t,e="fill"){if(t==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Ee(t)||(t=Jt(t));const r=t;let n=!0;try{n=function(g){if(!ht(g))return g;let x=ye(g);return _t(x),x=st(x),x}(r)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(r,null,2)}
        `)}const a=X[`filter_${e}`],l=qs(n,a);let h=null;if(l.result==="error")throw new Error(l.value.map(g=>`${g.key}: ${g.message}`).join(", "));h=(g,x,v)=>l.value.evaluate(g,x,{},v);let f=null,m=null;if(n!==r){const g=qs(r,a);if(g.result==="error")throw new Error(g.value.map(x=>`${x.key}: ${x.message}`).join(", "));f=(x,v,w,S,A)=>g.value.evaluate(x,v,{},w,void 0,void 0,S,A),m=!Do(g.value.expression)}return{filter:h,dynamicFilter:f||void 0,needGeometry:Ct(n),needFeature:!!m}}function st(t){if(!Array.isArray(t))return t;const e=function(r){if(xt.has(r[0])){for(let n=1;n<r.length;n++)if(ht(r[n]))return!0}return r}(t);return e===!0?e:e.map(r=>st(r))}function _t(t){let e=!1;const r=[];if(t[0]==="case"){for(let n=1;n<t.length-1;n+=2)e=e||ht(t[n]),r.push(t[n+1]);r.push(t[t.length-1])}else if(t[0]==="match"){e=e||ht(t[1]);for(let n=2;n<t.length-1;n+=2)r.push(t[n+1]);r.push(t[t.length-1])}else if(t[0]==="step"){e=e||ht(t[1]);for(let n=1;n<t.length-1;n+=2)r.push(t[n+1])}e&&(t.length=0,t.push("any",...r));for(let n=1;n<t.length;n++)_t(t[n])}function ht(t){if(!Array.isArray(t))return!1;if((e=t[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let r=1;r<t.length;r++)if(ht(t[r]))return!0;return!1}const xt=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Qt(t,e){return t<e?-1:t>e?1:0}function Ct(t){if(!Array.isArray(t))return!1;if(t[0]==="within"||t[0]==="distance")return!0;for(let e=1;e<t.length;e++)if(Ct(t[e]))return!0;return!1}function Jt(t){if(!t)return!0;const e=t[0];return t.length<=1?e!=="any":e==="=="?Xt(t[1],t[2],"=="):e==="!="?hi(Xt(t[1],t[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Xt(t[1],t[2],e):e==="any"?(r=t.slice(1),["any"].concat(r.map(Jt))):e==="all"?["all"].concat(t.slice(1).map(Jt)):e==="none"?["all"].concat(t.slice(1).map(Jt).map(hi)):e==="in"?Ur(t[1],t.slice(2)):e==="!in"?hi(Ur(t[1],t.slice(2))):e==="has"?yr(t[1]):e!=="!has"||hi(yr(t[1]));var r}function Xt(t,e,r){switch(t){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,t,e]}}function Ur(t,e){if(e.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(r=>typeof r!=typeof e[0])?["filter-in-large",t,["literal",e.sort(Qt)]]:["filter-in-small",t,["literal",e]]}}function yr(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function hi(t){return["!",t]}const ii="";function Mr(t,e){return e?`${t}${ii}${e}`:t}const xr="-transition",Bt=new Set(["fill","line","background","hillshade","raster"]);class Nt extends Yo{constructor(e,r,n,a){if(super(),this.id=e.id,this.fqid=Mr(this.id,n),this.type=e.type,this.scope=n,this.options=a,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.isConfigDependent=!1,e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),e.slot&&(this.slot=e.slot),r.layout&&(this._unevaluatedLayout=new se(r.layout,this.scope,a),this.isConfigDependent=this.isConfigDependent||this._unevaluatedLayout.isConfigDependent),r.paint)){this._transitionablePaint=new te(r.paint,this.scope,a);for(const l in e.paint)this.setPaintProperty(l,e.paint[l]);for(const l in e.layout)this.setLayoutProperty(l,e.layout[l]);this.isConfigDependent=this.isConfigDependent||this._transitionablePaint.isConfigDependent,this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new xe(r.paint)}}onAdd(e){}onRemove(e){}isDraped(e){return Bt.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,r){if(this.type==="custom"&&e==="visibility")return void(this.visibility=r);const n=this._unevaluatedLayout;n._properties.properties[e]&&(n.setValue(e,r),this.isConfigDependent=this.isConfigDependent||n.isConfigDependent,e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(e){return Wo(e,xr)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r){const n=this._transitionablePaint,a=n._properties.properties;if(Wo(e,xr)){const v=e.slice(0,-11);return a[v]&&n.setTransition(v,r||void 0),!1}if(!a[e])return!1;const l=n._values[e],h=l.value.isDataDriven(),f=l.value;n.setValue(e,r),this.isConfigDependent=this.isConfigDependent||n.isConfigDependent,this._handleSpecialPaintPropertyUpdate(e);const m=n._values[e].value,g=m.isDataDriven(),x=Wo(e,"pattern")||e==="line-dasharray";return g||h||x||this._handleOverridablePaintPropertyUpdate(e,f,m)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,r){return null}_handleOverridablePaintPropertyUpdate(e,r,n){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,r){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){return Aa({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,r)=>!(e===void 0||r==="layout"&&!Object.keys(e).length||r==="paint"&&!Object.keys(e).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const e in this.paint._values){const r=this.paint.get(e);if(r instanceof me&&Ec(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Je(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(e){}queryIntersectsFeature(e,r,n,a,l,h,f,m,g){}queryIntersectsMatchingFeature(e,r,n,a){}}const Or={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Ir{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class qt{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&(e.isTransferred=!0,r.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Rt(t,e=1){let r=0,n=0;return{members:t.map(a=>{const l=Or[a.type].BYTES_PER_ELEMENT,h=r=Wi(r,Math.max(e,l)),f=a.components||1;return n=Math.max(n,l),r+=l*f,{name:a.name,type:a.type,components:f,offset:h}}),size:Wi(r,Math.max(n,e)),alignment:e}}function Wi(t,e){return Math.ceil(t/e)*e}class Ci extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){const n=this.length;return this.resize(n+1),this.emplace(n,e,r)}emplace(e,r,n){const a=2*e;return this.int16[a+0]=r,this.int16[a+1]=n,e}}Ci.prototype.bytesPerElement=4,nt(Ci,"StructArrayLayout2i4");class mi extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,n){const a=this.length;return this.resize(a+1),this.emplace(a,e,r,n)}emplace(e,r,n,a){const l=3*e;return this.int16[l+0]=r,this.int16[l+1]=n,this.int16[l+2]=a,e}}mi.prototype.bytesPerElement=6,nt(mi,"StructArrayLayout3i6");class Di extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,n,a){const l=this.length;return this.resize(l+1),this.emplace(l,e,r,n,a)}emplace(e,r,n,a,l){const h=4*e;return this.int16[h+0]=r,this.int16[h+1]=n,this.int16[h+2]=a,this.int16[h+3]=l,e}}Di.prototype.bytesPerElement=8,nt(Di,"StructArrayLayout4i8");class Hi extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,n,a,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,n,a,l)}emplace(e,r,n,a,l,h){const f=5*e;return this.int16[f+0]=r,this.int16[f+1]=n,this.int16[f+2]=a,this.int16[f+3]=l,this.int16[f+4]=h,e}}Hi.prototype.bytesPerElement=10,nt(Hi,"StructArrayLayout5i10");class Fi extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,n,a,l,h,f){const m=this.length;return this.resize(m+1),this.emplace(m,e,r,n,a,l,h,f)}emplace(e,r,n,a,l,h,f,m){const g=6*e,x=12*e,v=3*e;return this.int16[g+0]=r,this.int16[g+1]=n,this.uint8[x+4]=a,this.uint8[x+5]=l,this.uint8[x+6]=h,this.uint8[x+7]=f,this.float32[v+2]=m,e}}Fi.prototype.bytesPerElement=12,nt(Fi,"StructArrayLayout2i4ub1f12");class _i extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,n,a){const l=this.length;return this.resize(l+1),this.emplace(l,e,r,n,a)}emplace(e,r,n,a,l){const h=4*e;return this.float32[h+0]=r,this.float32[h+1]=n,this.float32[h+2]=a,this.float32[h+3]=l,e}}_i.prototype.bytesPerElement=16,nt(_i,"StructArrayLayout4f16");class Ti extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){const n=this.length;return this.resize(n+1),this.emplace(n,e,r)}emplace(e,r,n){const a=2*e;return this.float32[a+0]=r,this.float32[a+1]=n,e}}Ti.prototype.bytesPerElement=8,nt(Ti,"StructArrayLayout2f8");class Si extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,n,a,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,n,a,l)}emplace(e,r,n,a,l,h){const f=6*e,m=3*e;return this.uint16[f+0]=r,this.uint16[f+1]=n,this.uint16[f+2]=a,this.uint16[f+3]=l,this.float32[m+2]=h,e}}Si.prototype.bytesPerElement=12,nt(Si,"StructArrayLayout4ui1f12");class Zn extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,n,a){const l=this.length;return this.resize(l+1),this.emplace(l,e,r,n,a)}emplace(e,r,n,a,l){const h=4*e;return this.uint16[h+0]=r,this.uint16[h+1]=n,this.uint16[h+2]=a,this.uint16[h+3]=l,e}}Zn.prototype.bytesPerElement=8,nt(Zn,"StructArrayLayout4ui8");class On extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,n,a,l,h){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,n,a,l,h)}emplace(e,r,n,a,l,h,f){const m=6*e;return this.int16[m+0]=r,this.int16[m+1]=n,this.int16[m+2]=a,this.int16[m+3]=l,this.int16[m+4]=h,this.int16[m+5]=f,e}}On.prototype.bytesPerElement=12,nt(On,"StructArrayLayout6i12");class Wn extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,n,a,l,h,f,m,g,x,v,w){const S=this.length;return this.resize(S+1),this.emplace(S,e,r,n,a,l,h,f,m,g,x,v,w)}emplace(e,r,n,a,l,h,f,m,g,x,v,w,S){const A=12*e;return this.int16[A+0]=r,this.int16[A+1]=n,this.int16[A+2]=a,this.int16[A+3]=l,this.uint16[A+4]=h,this.uint16[A+5]=f,this.uint16[A+6]=m,this.uint16[A+7]=g,this.int16[A+8]=x,this.int16[A+9]=v,this.int16[A+10]=w,this.int16[A+11]=S,e}}Wn.prototype.bytesPerElement=24,nt(Wn,"StructArrayLayout4i4ui4i24");class Hn extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,n,a,l,h){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,n,a,l,h)}emplace(e,r,n,a,l,h,f){const m=10*e,g=5*e;return this.int16[m+0]=r,this.int16[m+1]=n,this.int16[m+2]=a,this.float32[g+2]=l,this.float32[g+3]=h,this.float32[g+4]=f,e}}Hn.prototype.bytesPerElement=20,nt(Hn,"StructArrayLayout3i3f20");class Lo extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}Lo.prototype.bytesPerElement=4,nt(Lo,"StructArrayLayout1ul4");class xn extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){const n=this.length;return this.resize(n+1),this.emplace(n,e,r)}emplace(e,r,n){const a=2*e;return this.uint16[a+0]=r,this.uint16[a+1]=n,e}}xn.prototype.bytesPerElement=4,nt(xn,"StructArrayLayout2ui4");class ul extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,n,a,l,h,f,m,g,x,v,w,S){const A=this.length;return this.resize(A+1),this.emplace(A,e,r,n,a,l,h,f,m,g,x,v,w,S)}emplace(e,r,n,a,l,h,f,m,g,x,v,w,S,A){const P=20*e,R=10*e;return this.int16[P+0]=r,this.int16[P+1]=n,this.int16[P+2]=a,this.int16[P+3]=l,this.int16[P+4]=h,this.float32[R+3]=f,this.float32[R+4]=m,this.float32[R+5]=g,this.float32[R+6]=x,this.int16[P+14]=v,this.uint32[R+8]=w,this.uint16[P+18]=S,this.uint16[P+19]=A,e}}ul.prototype.bytesPerElement=40,nt(ul,"StructArrayLayout5i4f1i1ul2ui40");class Ws extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,n,a,l,h,f){const m=this.length;return this.resize(m+1),this.emplace(m,e,r,n,a,l,h,f)}emplace(e,r,n,a,l,h,f,m){const g=8*e;return this.int16[g+0]=r,this.int16[g+1]=n,this.int16[g+2]=a,this.int16[g+4]=l,this.int16[g+5]=h,this.int16[g+6]=f,this.int16[g+7]=m,e}}Ws.prototype.bytesPerElement=16,nt(Ws,"StructArrayLayout3i2i2i16");class hl extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,n,a,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,n,a,l)}emplace(e,r,n,a,l,h){const f=4*e,m=8*e;return this.float32[f+0]=r,this.float32[f+1]=n,this.float32[f+2]=a,this.int16[m+6]=l,this.int16[m+7]=h,e}}hl.prototype.bytesPerElement=16,nt(hl,"StructArrayLayout2f1f2i16");class ao extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,n,a){const l=this.length;return this.resize(l+1),this.emplace(l,e,r,n,a)}emplace(e,r,n,a,l){const h=12*e,f=3*e;return this.uint8[h+0]=r,this.uint8[h+1]=n,this.float32[f+1]=a,this.float32[f+2]=l,e}}ao.prototype.bytesPerElement=12,nt(ao,"StructArrayLayout2ub2f12");class gi extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,n){const a=this.length;return this.resize(a+1),this.emplace(a,e,r,n)}emplace(e,r,n,a){const l=3*e;return this.uint16[l+0]=r,this.uint16[l+1]=n,this.uint16[l+2]=a,e}}gi.prototype.bytesPerElement=6,nt(gi,"StructArrayLayout3ui6");class dl extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,n,a,l,h,f,m,g,x,v,w,S,A,P,R,L,V,q,G,ee){const W=this.length;return this.resize(W+1),this.emplace(W,e,r,n,a,l,h,f,m,g,x,v,w,S,A,P,R,L,V,q,G,ee)}emplace(e,r,n,a,l,h,f,m,g,x,v,w,S,A,P,R,L,V,q,G,ee,W){const re=30*e,ne=15*e,de=60*e;return this.int16[re+0]=r,this.int16[re+1]=n,this.int16[re+2]=a,this.float32[ne+2]=l,this.float32[ne+3]=h,this.uint16[re+8]=f,this.uint16[re+9]=m,this.uint32[ne+5]=g,this.uint32[ne+6]=x,this.uint32[ne+7]=v,this.uint16[re+16]=w,this.uint16[re+17]=S,this.uint16[re+18]=A,this.float32[ne+10]=P,this.float32[ne+11]=R,this.uint8[de+48]=L,this.uint8[de+49]=V,this.uint8[de+50]=q,this.uint32[ne+13]=G,this.int16[re+28]=ee,this.uint8[de+58]=W,e}}dl.prototype.bytesPerElement=60,nt(dl,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class ff extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,n,a,l,h,f,m,g,x,v,w,S,A,P,R,L,V,q,G,ee,W,re,ne,de,ve,pe,Te,we,be,Ce,Ie){const ke=this.length;return this.resize(ke+1),this.emplace(ke,e,r,n,a,l,h,f,m,g,x,v,w,S,A,P,R,L,V,q,G,ee,W,re,ne,de,ve,pe,Te,we,be,Ce,Ie)}emplace(e,r,n,a,l,h,f,m,g,x,v,w,S,A,P,R,L,V,q,G,ee,W,re,ne,de,ve,pe,Te,we,be,Ce,Ie,ke){const Le=20*e,Se=40*e,at=80*e;return this.float32[Le+0]=r,this.float32[Le+1]=n,this.int16[Se+4]=a,this.int16[Se+5]=l,this.int16[Se+6]=h,this.int16[Se+7]=f,this.int16[Se+8]=m,this.int16[Se+9]=g,this.int16[Se+10]=x,this.int16[Se+11]=v,this.int16[Se+12]=w,this.uint16[Se+13]=S,this.uint16[Se+14]=A,this.uint16[Se+15]=P,this.uint16[Se+16]=R,this.uint16[Se+17]=L,this.uint16[Se+18]=V,this.uint16[Se+19]=q,this.uint16[Se+20]=G,this.uint16[Se+21]=ee,this.uint16[Se+22]=W,this.uint16[Se+23]=re,this.uint16[Se+24]=ne,this.uint16[Se+25]=de,this.uint16[Se+26]=ve,this.uint16[Se+27]=pe,this.uint32[Le+14]=Te,this.float32[Le+15]=we,this.float32[Le+16]=be,this.float32[Le+17]=Ce,this.float32[Le+18]=Ie,this.uint8[at+76]=ke,e}}ff.prototype.bytesPerElement=80,nt(ff,"StructArrayLayout2f9i15ui1ul4f1ub80");class mh extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}mh.prototype.bytesPerElement=4,nt(mh,"StructArrayLayout1f4");class fl extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,n,a,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,n,a,l)}emplace(e,r,n,a,l,h){const f=5*e;return this.float32[f+0]=r,this.float32[f+1]=n,this.float32[f+2]=a,this.float32[f+3]=l,this.float32[f+4]=h,e}}fl.prototype.bytesPerElement=20,nt(fl,"StructArrayLayout5f20");class pf extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,n,a,l,h,f){const m=this.length;return this.resize(m+1),this.emplace(m,e,r,n,a,l,h,f)}emplace(e,r,n,a,l,h,f,m){const g=7*e;return this.float32[g+0]=r,this.float32[g+1]=n,this.float32[g+2]=a,this.float32[g+3]=l,this.float32[g+4]=h,this.float32[g+5]=f,this.float32[g+6]=m,e}}pf.prototype.bytesPerElement=28,nt(pf,"StructArrayLayout7f28");class mf extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,n,a){const l=this.length;return this.resize(l+1),this.emplace(l,e,r,n,a)}emplace(e,r,n,a,l){const h=6*e;return this.uint32[3*e+0]=r,this.uint16[h+2]=n,this.uint16[h+3]=a,this.uint16[h+4]=l,e}}mf.prototype.bytesPerElement=12,nt(mf,"StructArrayLayout1ul3ui12");class _f extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}_f.prototype.bytesPerElement=2,nt(_f,"StructArrayLayout1ui2");class pl extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,n){const a=this.length;return this.resize(a+1),this.emplace(a,e,r,n)}emplace(e,r,n,a){const l=3*e;return this.float32[l+0]=r,this.float32[l+1]=n,this.float32[l+2]=a,e}}pl.prototype.bytesPerElement=12,nt(pl,"StructArrayLayout3f12");class gf extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,n,a,l,h,f,m,g,x,v,w,S,A,P,R){const L=this.length;return this.resize(L+1),this.emplace(L,e,r,n,a,l,h,f,m,g,x,v,w,S,A,P,R)}emplace(e,r,n,a,l,h,f,m,g,x,v,w,S,A,P,R,L){const V=16*e;return this.float32[V+0]=r,this.float32[V+1]=n,this.float32[V+2]=a,this.float32[V+3]=l,this.float32[V+4]=h,this.float32[V+5]=f,this.float32[V+6]=m,this.float32[V+7]=g,this.float32[V+8]=x,this.float32[V+9]=v,this.float32[V+10]=w,this.float32[V+11]=S,this.float32[V+12]=A,this.float32[V+13]=P,this.float32[V+14]=R,this.float32[V+15]=L,e}}gf.prototype.bytesPerElement=64,nt(gf,"StructArrayLayout16f64");class p0 extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,n,a,l,h,f){const m=this.length;return this.resize(m+1),this.emplace(m,e,r,n,a,l,h,f)}emplace(e,r,n,a,l,h,f,m){const g=10*e,x=5*e;return this.uint16[g+0]=r,this.uint16[g+1]=n,this.uint16[g+2]=a,this.uint16[g+3]=l,this.float32[x+2]=h,this.float32[x+3]=f,this.float32[x+4]=m,e}}p0.prototype.bytesPerElement=20,nt(p0,"StructArrayLayout4ui3f20");class yf extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.int16[1*e+0]=r,e}}yf.prototype.bytesPerElement=2,nt(yf,"StructArrayLayout1i2");class xf extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint8[1*e+0]=r,e}}xf.prototype.bytesPerElement=1,nt(xf,"StructArrayLayout1ub1");class Hm extends Ir{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Hm.prototype.size=40;class Qm extends ul{get(e){return new Hm(this,e)}}nt(Qm,"CollisionBoxArray");class Xm extends Ir{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Xm.prototype.size=60;class Ym extends dl{get(e){return new Xm(this,e)}}nt(Ym,"PlacedSymbolArray");class Jm extends Ir{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}Jm.prototype.size=80;class Km extends ff{get(e){return new Jm(this,e)}}nt(Km,"SymbolInstanceArray");class e_ extends mh{getoffsetX(e){return this.float32[1*e+0]}}nt(e_,"GlyphOffsetArray");class t_ extends Ci{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}nt(t_,"SymbolLineVertexArray");class r_ extends Ir{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}r_.prototype.size=12;class i_ extends mf{get(e){return new r_(this,e)}}nt(i_,"FeatureIndexArray");class n_ extends xn{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}nt(n_,"FillExtrusionCentroidArray");const Kg=Rt([{name:"a_pos",components:2,type:"Int16"}],4),e7=Rt([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class ni{constructor(e=[]){this.segments=e}_prepareSegment(e,r,n,a){let l=this.segments[this.segments.length-1];return e>ni.MAX_VERTEX_ARRAY_LENGTH&&Qr(`Max vertices per segment is ${ni.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!l||l.vertexLength+e>ni.MAX_VERTEX_ARRAY_LENGTH||l.sortKey!==a)&&(l={vertexOffset:r,primitiveOffset:n,vertexLength:0,primitiveLength:0},a!==void 0&&(l.sortKey=a),this.segments.push(l)),l}prepareSegment(e,r,n,a){return this._prepareSegment(e,r.length,n.length,a)}get(){return this.segments}destroy(){for(const e of this.segments)for(const r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,n,a){return new ni([{vertexOffset:e,primitiveOffset:r,vertexLength:n,primitiveLength:a,vaos:{},sortKey:0}])}}function o_(t,e){return 256*(t=Ht(Math.floor(t),0,255))+Ht(Math.floor(e),0,255)}ni.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,nt(ni,"SegmentVector");const t7=Rt([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),r7=Rt([{name:"a_dash",components:4,type:"Uint16"}]);class _h{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,r,n,a){this.ids.push(s_(e)),this.positions.push(r,n,a)}eachPosition(e,r){const n=s_(e);let a=0,l=this.ids.length-1;for(;a<l;){const h=a+l>>1;this.ids[h]>=n?l=h:a=h+1}for(;this.ids[a]===n;)r(this.positions[3*a],this.positions[3*a+1],this.positions[3*a+2]),a++}static serialize(e,r){const n=new Float64Array(e.ids),a=new Uint32Array(e.positions);return vf(n,a,0,n.length-1),r&&(r.add(n.buffer),r.add(a.buffer)),{ids:n,positions:a}}static deserialize(e){const r=new _h;let n;r.ids=e.ids,r.positions=e.positions;for(const a of r.ids)a!==n&&r.uniqueIds.push(a),n=a;return r.indexed=!0,r}}function s_(t){const e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:ka(String(t))}function vf(t,e,r,n){for(;r<n;){const a=t[r+n>>1];let l=r-1,h=n+1;for(;;){do l++;while(t[l]<a);do h--;while(t[h]>a);if(l>=h)break;m0(t,l,h),m0(e,3*l,3*h),m0(e,3*l+1,3*h+1),m0(e,3*l+2,3*h+2)}h-r<n-h?(vf(t,e,r,h),r=h+1):(vf(t,e,h+1,n),n=h)}}function m0(t,e,r){const n=t[e];t[e]=t[r],t[r]=n}nt(_h,"FeaturePositionMap");class ls{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,r){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,r),this.initialized=!0),!!this.location}set(e,r,n){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class _0 extends ls{constructor(e){super(e),this.current=0}set(e,r,n){this.fetchUniformLocation(e,r)&&this.current!==n&&(this.current=n,this.gl.uniform1i(this.location,n))}}class Ki extends ls{constructor(e){super(e),this.current=0}set(e,r,n){this.fetchUniformLocation(e,r)&&this.current!==n&&(this.current=n,this.gl.uniform1f(this.location,n))}}class Hs extends ls{constructor(e){super(e),this.current=[0,0]}set(e,r,n){this.fetchUniformLocation(e,r)&&(n[0]===this.current[0]&&n[1]===this.current[1]||(this.current=n,this.gl.uniform2f(this.location,n[0],n[1])))}}class bf extends ls{constructor(e){super(e),this.current=[0,0,0]}set(e,r,n){this.fetchUniformLocation(e,r)&&(n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]||(this.current=n,this.gl.uniform3f(this.location,n[0],n[1],n[2])))}}class a_ extends ls{constructor(e){super(e),this.current=[0,0,0,0]}set(e,r,n){this.fetchUniformLocation(e,r)&&(n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]&&n[3]===this.current[3]||(this.current=n,this.gl.uniform4f(this.location,n[0],n[1],n[2],n[3])))}}class l_ extends ls{constructor(e){super(e),this.current=gr.transparent}set(e,r,n){this.fetchUniformLocation(e,r)&&(n.r===this.current.r&&n.g===this.current.g&&n.b===this.current.b&&n.a===this.current.a||(this.current=n,this.gl.uniform4f(this.location,n.r,n.g,n.b,n.a)))}}const i7=new Float32Array(16);class gh extends ls{constructor(e){super(e),this.current=i7}set(e,r,n){if(this.fetchUniformLocation(e,r)){if(n[12]!==this.current[12]||n[0]!==this.current[0])return this.current=n,void this.gl.uniformMatrix4fv(this.location,!1,n);for(let a=1;a<16;a++)if(n[a]!==this.current[a]){this.current=n,this.gl.uniformMatrix4fv(this.location,!1,n);break}}}}const n7=new Float32Array(9),o7=new Float32Array(4);class wf extends ls{constructor(e){super(e),this.current=o7}set(e,r,n){if(this.fetchUniformLocation(e,r)){for(let a=0;a<4;a++)if(n[a]!==this.current[a]){this.current=n,this.gl.uniformMatrix2fv(this.location,!1,n);break}}}}function Tf(t){return[o_(255*t.r,255*t.g),o_(255*t.b,255*t.a)]}class yh{constructor(e,r,n){this.value=e,this.uniformNames=r.map(a=>`u_${a}`),this.type=n}setUniform(e,r,n,a,l){r.set(e,l,a.constantOr(this.value))}getBinding(e,r){return this.type==="color"?new l_(e):new Ki(e)}}class Cc{constructor(e,r){this.uniformNames=r.map(n=>`u_${n}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,r,n,a,l){const h=l==="u_pattern"||l==="u_dash"?this.pattern:l==="u_pixel_ratio"?this.pixelRatio:null;h&&r.set(e,l,h)}getBinding(e,r){return r==="u_pattern"||r==="u_dash"?new a_(e):new Ki(e)}}class cs{constructor(e,r,n,a){this.expression=e,this.type=n,this.maxValue=0,this.paintVertexAttributes=r.map(l=>({name:`a_${l}`,type:"Float32",components:n==="color"?2:1,offset:0})),this.paintVertexArray=new a}populatePaintArray(e,r,n,a,l,h,f){const m=this.paintVertexArray.length,g=this.expression.evaluate(new N(0,{brightness:h}),r,{},l,a,f);this.paintVertexArray.resize(e),this._setPaintValue(m,e,g)}updatePaintArray(e,r,n,a,l,h,f){const m=this.expression.evaluate({zoom:0,brightness:f},n,a,void 0,l);this._setPaintValue(e,r,m)}_setPaintValue(e,r,n){if(this.type==="color"){const a=Tf(n);for(let l=e;l<r;l++)this.paintVertexArray.emplace(l,a[0],a[1])}else{for(let a=e;a<r;a++)this.paintVertexArray.emplace(a,n);this.maxValue=Math.max(this.maxValue,Math.abs(n))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class lo{constructor(e,r,n,a,l,h){this.expression=e,this.uniformNames=r.map(f=>`u_${f}_t`),this.type=n,this.useIntegerZoom=a,this.zoom=l,this.maxValue=0,this.paintVertexAttributes=r.map(f=>({name:`a_${f}`,type:"Float32",components:n==="color"?4:2,offset:0})),this.paintVertexArray=new h}populatePaintArray(e,r,n,a,l,h,f){const m=this.expression.evaluate(new N(this.zoom,{brightness:h}),r,{},l,a,f),g=this.expression.evaluate(new N(this.zoom+1,{brightness:h}),r,{},l,a,f),x=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(x,e,m,g)}updatePaintArray(e,r,n,a,l,h,f){const m=this.expression.evaluate({zoom:this.zoom,brightness:f},n,a,void 0,l),g=this.expression.evaluate({zoom:this.zoom+1,brightness:f},n,a,void 0,l);this._setPaintValue(e,r,m,g)}_setPaintValue(e,r,n,a){if(this.type==="color"){const l=Tf(n),h=Tf(a);for(let f=e;f<r;f++)this.paintVertexArray.emplace(f,l[0],l[1],h[0],h[1])}else{for(let l=e;l<r;l++)this.paintVertexArray.emplace(l,n,a);this.maxValue=Math.max(this.maxValue,Math.abs(n),Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r,n,a,l){const h=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,f=Ht(this.expression.interpolationFactor(h,this.zoom,this.zoom+1),0,1);r.set(e,l,f)}getBinding(e,r){return new Ki(e)}}class Qs{constructor(e,r,n,a,l){this.expression=e,this.layerId=l,this.paintVertexAttributes=(n==="array"?r7:t7).members;for(let h=0;h<r.length;++h);this.paintVertexArray=new a}populatePaintArray(e,r,n){const a=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(a,e,r.patterns&&r.patterns[this.layerId],n)}updatePaintArray(e,r,n,a,l,h,f){this._setPaintValues(e,r,n.patterns&&n.patterns[this.layerId],h)}_setPaintValues(e,r,n,a){if(!a||!n)return;const l=a[n];if(!l)return;const{tl:h,br:f,pixelRatio:m}=l;for(let g=e;g<r;g++)this.paintVertexArray.emplace(g,h[0],h[1],f[0],f[1],m)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ml{constructor(e,r,n=()=>!0){this.binders={},this._buffers=[];const a=[];for(const l in e.paint._values){const h=e.paint.get(l);if(!n(l)||!(h instanceof me&&Ec(h.property.specification)))continue;const f=a7(l,e.type),m=h.value,g=h.property.specification.type,x=!!h.property.useIntegerZoom,v=l==="line-dasharray"||l.endsWith("pattern"),w=l==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(m.kind!=="constant"||w)if(m.kind==="source"||w||v){const S=c_(l,g,"source");this.binders[l]=v?new Qs(m,f,g,S,e.id):new cs(m,f,g,S),a.push(`/a_${l}`)}else{const S=c_(l,g,"composite");this.binders[l]=new lo(m,f,g,x,r,S),a.push(`/z_${l}`)}else this.binders[l]=v?new Cc(m.value,f):new yh(m.value,f,g),a.push(`/u_${l}`)}this.cacheKey=a.sort().join("")}getMaxValue(e){const r=this.binders[e];return r instanceof cs||r instanceof lo?r.maxValue:0}populatePaintArrays(e,r,n,a,l,h,f){for(const m in this.binders){const g=this.binders[m];(g instanceof cs||g instanceof lo||g instanceof Qs)&&g.populatePaintArray(e,r,n,a,l,h,f)}}setConstantPatternPositions(e){for(const r in this.binders){const n=this.binders[r];n instanceof Cc&&n.setConstantPatternPositions(e)}}updatePaintArrays(e,r,n,a,l,h,f,m){let g=!1;const x=Object.keys(e),v=x.length!==0,w=v?x:r.uniqueIds;for(const S in this.binders){const A=this.binders[S];if((A instanceof cs||A instanceof lo||A instanceof Qs)&&(A.expression.isStateDependent===!0||A.expression.isLightConstant===!1)){const P=l.paint.get(S);A.expression=P.value;for(const R of w){const L=e[R.toString()];r.eachPosition(R,(V,q,G)=>{const ee=a.feature(V);A.updatePaintArray(q,G,ee,L,h,f,m)})}if(!v)for(const R of n.uniqueIds){const L=e[R.toString()];n.eachPosition(R,(V,q,G)=>{const ee=a.feature(V);A.updatePaintArray(q,G,ee,L,h,f,m)})}g=!0}}return g}defines(){const e=[];for(const r in this.binders){const n=this.binders[r];(n instanceof yh||n instanceof Cc)&&e.push(...n.uniformNames.map(a=>`#define HAS_UNIFORM_${a}`))}return e}getBinderAttributes(){const e=[];for(const r in this.binders){const n=this.binders[r];if(n instanceof cs||n instanceof lo||n instanceof Qs)for(let a=0;a<n.paintVertexAttributes.length;a++)e.push(n.paintVertexAttributes[a].name)}return e}getBinderUniforms(){const e=[];for(const r in this.binders){const n=this.binders[r];if(n instanceof yh||n instanceof Cc||n instanceof lo)for(const a of n.uniformNames)e.push(a)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const r=[];for(const n in this.binders){const a=this.binders[n];if(a instanceof yh||a instanceof Cc||a instanceof lo)for(const l of a.uniformNames)r.push({name:l,property:n,binding:a.getBinding(e,l)})}return r}setUniforms(e,r,n,a,l){for(const{name:h,property:f,binding:m}of n)this.binders[f].setUniform(e,m,l,a.get(f),h)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const r=this.binders[e];(r instanceof cs||r instanceof lo||r instanceof Qs)&&r.paintVertexBuffer&&this._buffers.push(r.paintVertexBuffer)}}upload(e){for(const r in this.binders){const n=this.binders[r];(n instanceof cs||n instanceof lo||n instanceof Qs)&&n.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const r=this.binders[e];(r instanceof cs||r instanceof lo||r instanceof Qs)&&r.destroy()}}}class Xs{constructor(e,r,n=()=>!0){this.programConfigurations={};for(const a of e)this.programConfigurations[a.id]=new ml(a,r,n);this.needsUpload=!1,this._featureMap=new _h,this._featureMapWithoutIds=new _h,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,r,n,a,l,h,f,m){for(const g in this.programConfigurations)this.programConfigurations[g].populatePaintArrays(e,r,a,l,h,f,m);r.id!==void 0?this._featureMap.add(r.id,n,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,n,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,n,a,l,h){for(const f of n)this.needsUpload=this.programConfigurations[f.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,r,f,a,l,h||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const s7={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function a7(t,e){return s7[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}const l7={"line-pattern":{source:Si,composite:Si},"fill-pattern":{source:Si,composite:Si},"fill-extrusion-pattern":{source:Si,composite:Si},"line-dasharray":{source:Zn,composite:Zn}},c7={color:{source:Ti,composite:_i},number:{source:mh,composite:Ti}};function c_(t,e,r){const n=l7[t];return n&&n[r]||c7[e][r]}nt(yh,"ConstantBinder"),nt(Cc,"PatternConstantBinder"),nt(cs,"SourceExpressionBinder"),nt(Qs,"PatternCompositeBinder"),nt(lo,"CompositeExpressionBinder"),nt(ml,"ProgramConfiguration",{omit:["_buffers"]}),nt(Xs,"ProgramConfigurationSet");const en=Qe/Math.PI/2,Sf=5,u_=6,u7=16383,Dc=64,Ef=[Dc,32,16],Qn=-en,Xn=en;function zc(t,e,r,n=en){return r=er(r),[t*Math.sin(r)*n,-e*n,t*Math.cos(r)*n]}function _l(t,e,r){return zc(Math.cos(er(t)),Math.sin(er(t)),e,r)}const Rc=63710088e-1,Af=2*Math.PI*Rc;class ir{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ir(eo(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const r=Math.PI/180,n=this.lat*r,a=e.lat*r,l=Math.sin(n)*Math.sin(a)+Math.cos(n)*Math.cos(a)*Math.cos((e.lng-this.lng)*r);return Rc*Math.acos(Math.min(l,1))}toBounds(e=0){const r=360*e/40075017,n=r/Math.cos(Math.PI/180*this.lat);return new Ys({lng:this.lng-n,lat:this.lat-r},{lng:this.lng+n,lat:this.lat+r})}toEcef(e){return _l(this.lat,this.lng,en+e*en/Rc)}static convert(e){if(e instanceof ir)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new ir(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new ir(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class Ys{constructor(e,r){if(e)if(r)this.setSouthWest(e).setNorthEast(r);else if(e.length===4){const n=e;this.setSouthWest([n[0],n[1]]).setNorthEast([n[2],n[3]])}else{const n=e;this.setSouthWest(n[0]).setNorthEast(n[1])}}setNorthEast(e){return this._ne=e instanceof ir?new ir(e.lng,e.lat):ir.convert(e),this}setSouthWest(e){return this._sw=e instanceof ir?new ir(e.lng,e.lat):ir.convert(e),this}extend(e){const r=this._sw,n=this._ne;let a,l;if(e instanceof ir)a=e,l=e;else{if(!(e instanceof Ys))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Ys.convert(e)):this.extend(ir.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(ir.convert(e)):this;if(a=e._sw,l=e._ne,!a||!l)return this}return r||n?(r.lng=Math.min(a.lng,r.lng),r.lat=Math.min(a.lat,r.lat),n.lng=Math.max(l.lng,n.lng),n.lat=Math.max(l.lat,n.lat)):(this._sw=new ir(a.lng,a.lat),this._ne=new ir(l.lng,l.lat)),this}getCenter(){return new ir((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new ir(this.getWest(),this.getNorth())}getSouthEast(){return new ir(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:r,lat:n}=ir.convert(e);let a=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(a=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=n&&n<=this._ne.lat&&a}static convert(e){return!e||e instanceof Ys?e:new Ys(e)}}var h_={};(function(t,e){(function(r){function n(l,h,f){var m=a(256*l,256*(h=Math.pow(2,f)-h-1),f),g=a(256*(l+1),256*(h+1),f);return m[0]+","+m[1]+","+g[0]+","+g[1]}function a(l,h,f){var m=2*Math.PI*6378137/256/Math.pow(2,f);return[l*m-2*Math.PI*6378137/2,h*m-2*Math.PI*6378137/2]}r.getURL=function(l,h,f,m,g,x){return x=x||{},l+"?"+["bbox="+n(f,m,g),"format="+(x.format||"image/png"),"service="+(x.service||"WMS"),"version="+(x.version||"1.1.1"),"request="+(x.request||"GetMap"),"srs="+(x.srs||"EPSG:3857"),"width="+(x.width||256),"height="+(x.height||256),"layers="+h].join("&")},r.getTileBBox=n,r.getMercCoords=a,Object.defineProperty(r,"__esModule",{value:!0})})(e)})(0,h_);var h7=h_;class gl{constructor(e,r,n){this.z=e,this.x=r,this.y=n,this.key=xh(0,e,e,r,n)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r){const n=h7.getTileBBox(this.x,this.y,this.z),a=function(l,h,f){let m,g="";for(let x=l;x>0;x--)m=1<<x-1,g+=(h&m?1:0)+(f&m?2:0);return g}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(r==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",a).replace("{bbox-epsg-3857}",n)}toString(){return`${this.z}/${this.x}/${this.y}`}}class d_{constructor(e,r){this.wrap=e,this.canonical=r,this.key=xh(e,r.z,r.z,r.x,r.y)}}class Ni{constructor(e,r,n,a,l){this.overscaledZ=e,this.wrap=r,this.canonical=new gl(n,+a,+l),this.key=r===0&&e===n?this.canonical.key:xh(r,e,n,a,l)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const r=this.canonical.z-e;return e>this.canonical.z?new Ni(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Ni(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(e,r=!0){if(this.overscaledZ===e&&r)return this.key;if(e>this.canonical.z)return xh(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y);{const n=this.canonical.z-e;return xh(this.wrap*+r,e,e,this.canonical.x>>n,this.canonical.y>>n)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const r=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new Ni(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,n=2*this.canonical.x,a=2*this.canonical.y;return[new Ni(r,this.wrap,r,n,a),new Ni(r,this.wrap,r,n+1,a),new Ni(r,this.wrap,r,n,a+1),new Ni(r,this.wrap,r,n+1,a+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Ni(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Ni(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new d_(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function xh(t,e,r,n,a){const l=1<<Math.min(r,22);let h=l*(a%l)+n%l;return t&&r<22&&(h+=l*l*((t<0?-2*t-1:2*t)%(1<<2*(22-r)))),16*(32*h+r)+(e-r)}const d7=[t=>{let e=t.canonical.x-1,r=t.wrap;return e<0&&(e=(1<<t.canonical.z)-1,r--),new Ni(t.overscaledZ,r,t.canonical.z,e,t.canonical.y)},t=>{let e=t.canonical.x+1,r=t.wrap;return e===1<<t.canonical.z&&(e=0,r++),new Ni(t.overscaledZ,r,t.canonical.z,e,t.canonical.y)},t=>new Ni(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,(t.canonical.y===0?1<<t.canonical.z:t.canonical.y)-1),t=>new Ni(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y===(1<<t.canonical.z)-1?0:t.canonical.y+1)];nt(gl,"CanonicalTileID"),nt(Ni,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const f7=0,p7=25.5;function Mf(t){return Af*Math.cos(t*Math.PI/180)}function Js(t){return(180+t)/360}function us(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function tn(t,e){return t/Mf(e)}function vn(t){return 360*t-180}function zi(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function f_(t,e){return t*Mf(zi(e))}const oi=85.051129;function p_(t){return Math.cos(er(Ht(t,-oi,oi)))}function yl(t,e){const r=Ht(e,f7,p7),n=Math.pow(2,r);return p_(t)*Af/(512*n)}function m_(t){return 1/Math.cos(t*Math.PI/180)}function g0(t,e=0){const r=Math.exp(Math.PI*(1-(t.y+e/Qe)/(1<<t.z)*2));return 80150034*r/(r*r+1)/Qe/(1<<t.z)}class Vi{constructor(e,r,n=0){this.x=+e,this.y=+r,this.z=+n}static fromLngLat(e,r=0){const n=ir.convert(e);return new Vi(Js(n.lng),us(n.lat),tn(r,n.lat))}toLngLat(){return new ir(vn(this.x),zi(this.y))}toAltitude(){return f_(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Af*m_(zi(this.y))}}function If(t,e,r,n,a,l,h,f,m){const g=(e+n)/2,x=(r+a)/2,v=new He(g,x);f(v),function(w,S,A,P,R,L){const V=A-R,q=P-L;return Math.abs((P-S)*V-(A-w)*q)/Math.hypot(V,q)}(v.x,v.y,l.x,l.y,h.x,h.y)>=m?(If(t,e,r,g,x,l,v,f,m),If(t,g,x,n,a,v,h,f,m)):t.push(h)}function __(t,e,r){let n=t[0],a=n.x,l=n.y;e(n);const h=[n];for(let f=1;f<t.length;f++){const m=t[f],{x:g,y:x}=m;e(m),If(h,a,l,g,x,n,m,e,r),a=g,l=x,n=m}return h}function Pf(t,e,r,n){if(n(e,r)){const a=e.add(r)._mult(.5);Pf(t,e,a,n),Pf(t,a,r,n)}else t.push(r)}function m7(t,e){let r=t[0];const n=[r];for(let a=1;a<t.length;a++){const l=t[a];Pf(n,r,l,e),r=l}return n}const Cf=Math.pow(2,14)-1,g_=-Cf-1;function _7(t,e){const r=Math.round(t.x*e),n=Math.round(t.y*e);return t.x=Ht(r,g_,Cf),t.y=Ht(n,g_,Cf),(r<t.x||r>t.x+1||n<t.y||n>t.y+1)&&Qr("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function hs(t,e,r){const n=t.loadGeometry(),a=t.extent,l=Qe/a;if(e&&r&&r.projection.isReprojectedInTileSpace){const h=1<<e.z,{scale:f,x:m,y:g,projection:x}=r,v=w=>{const S=vn((e.x+w.x/a)/h),A=zi((e.y+w.y/a)/h),P=x.project(S,A);w.x=(P.x*f-m)*a,w.y=(P.y*f-g)*a};for(let w=0;w<n.length;w++)if(t.type!==1)n[w]=__(n[w],v,1);else{const S=[];for(const A of n[w])A.x<0||A.x>=a||A.y<0||A.y>=a||(v(A),S.push(A));n[w]=S}}for(const h of n)for(const f of h)_7(f,l);return n}function Ks(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?hs(t):[]}}function y0(t,e,r,n,a){t.emplaceBack(2*e+(n+1)/2,2*r+(a+1)/2)}function x0(t,e,r){t.emplaceBack(e.x,e.y,e.z,r[0]*16384,r[1]*16384,r[2]*16384)}class Df{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Ci,this.indexArray=new gi,this.segments=new ni,this.programConfigurations=new Xs(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,n,a){const l=this.layers[0],h=[];let f=null;l.type==="circle"&&(f=l.layout.get("circle-sort-key"));for(const{feature:g,id:x,index:v,sourceLayerIndex:w}of e){const S=this.layers[0]._featureFilter.needGeometry,A=Ks(g,S);if(!this.layers[0]._featureFilter.filter(new N(this.zoom),A,n))continue;const P=f?f.evaluate(A,{},n):void 0,R={id:x,properties:g.properties,type:g.type,sourceLayerIndex:w,index:v,geometry:S?A.geometry:hs(g,n,a),patterns:{},sortKey:P};h.push(R)}f&&h.sort((g,x)=>g.sortKey-x.sortKey);let m=null;a.projection.name==="globe"&&(this.globeExtVertexArray=new On,m=a.projection);for(const g of h){const{geometry:x,index:v,sourceLayerIndex:w}=g,S=e[v].feature;this.addFeature(g,x,v,r.availableImages,n,m,r.brightness),r.featureIndex.insert(S,x,v,w,this.index)}}update(e,r,n,a,l){const h=Object.keys(e).length!==0;h&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,r,h?this.stateDependentLayers:this.layers,n,a,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Kg.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,e7.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,r,n,a,l,h,f){for(const m of r)for(const g of m){const x=g.x,v=g.y;if(x<0||x>=Qe||v<0||v>=Qe)continue;if(h){const A=h.projectTilePoint(x,v,l),P=h.upVector(l,x,v),R=this.globeExtVertexArray;x0(R,A,P),x0(R,A,P),x0(R,A,P),x0(R,A,P)}const w=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),S=w.vertexLength;y0(this.layoutVertexArray,x,v,-1,-1),y0(this.layoutVertexArray,x,v,1,-1),y0(this.layoutVertexArray,x,v,1,1),y0(this.layoutVertexArray,x,v,-1,1),this.indexArray.emplaceBack(S,S+1,S+2),this.indexArray.emplaceBack(S,S+2,S+3),w.vertexLength+=4,w.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,{},a,l,f)}}function zf(t,e){for(let r=0;r<t.length;r++)if(xl(e,t[r]))return!0;for(let r=0;r<e.length;r++)if(xl(t,e[r]))return!0;return!!Rf(t,e)}function g7(t,e,r){return!!xl(t,e)||!!Lf(e,t,r)}function y_(t,e){if(t.length===1)return v_(e,t[0]);for(let r=0;r<e.length;r++){const n=e[r];for(let a=0;a<n.length;a++)if(xl(t,n[a]))return!0}for(let r=0;r<t.length;r++)if(v_(e,t[r]))return!0;for(let r=0;r<e.length;r++)if(Rf(t,e[r]))return!0;return!1}function y7(t,e,r){if(t.length>1){if(Rf(t,e))return!0;for(let n=0;n<e.length;n++)if(Lf(e[n],t,r))return!0}for(let n=0;n<t.length;n++)if(Lf(t[n],e,r))return!0;return!1}function Rf(t,e){if(t.length===0||e.length===0)return!1;for(let r=0;r<t.length-1;r++){const n=t[r],a=t[r+1];for(let l=0;l<e.length-1;l++)if(x7(n,a,e[l],e[l+1]))return!0}return!1}function x7(t,e,r,n){return To(t,r,n)!==To(e,r,n)&&To(t,e,r)!==To(t,e,n)}function Lf(t,e,r){const n=r*r;if(e.length===1)return t.distSqr(e[0])<n;for(let a=1;a<e.length;a++)if(x_(t,e[a-1],e[a])<n)return!0;return!1}function x_(t,e,r){const n=e.distSqr(r);if(n===0)return t.distSqr(e);const a=((t.x-e.x)*(r.x-e.x)+(t.y-e.y)*(r.y-e.y))/n;return t.distSqr(a<0?e:a>1?r:r.sub(e)._mult(a)._add(e))}function v_(t,e){let r,n,a,l=!1;for(let h=0;h<t.length;h++){r=t[h];for(let f=0,m=r.length-1;f<r.length;m=f++)n=r[f],a=r[m],n.y>e.y!=a.y>e.y&&e.x<(a.x-n.x)*(e.y-n.y)/(a.y-n.y)+n.x&&(l=!l)}return l}function xl(t,e){let r=!1;for(let n=0,a=t.length-1;n<t.length;a=n++){const l=t[n],h=t[a];l.y>e.y!=h.y>e.y&&e.x<(h.x-l.x)*(e.y-l.y)/(h.y-l.y)+l.x&&(r=!r)}return r}function b_(t,e,r,n,a){for(const h of t)if(e<=h.x&&r<=h.y&&n>=h.x&&a>=h.y)return!0;const l=[new He(e,r),new He(e,a),new He(n,a),new He(n,r)];if(t.length>2){for(const h of l)if(xl(t,h))return!0}for(let h=0;h<t.length-1;h++)if(v7(t[h],t[h+1],l))return!0;return!1}function v7(t,e,r){const n=r[0],a=r[2];if(t.x<n.x&&e.x<n.x||t.x>a.x&&e.x>a.x||t.y<n.y&&e.y<n.y||t.y>a.y&&e.y>a.y)return!1;const l=To(t,e,r[0]);return l!==To(t,e,r[1])||l!==To(t,e,r[2])||l!==To(t,e,r[3])}function Lc(t,e,r,n,a,l){let h=e.y-t.y,f=t.x-e.x;if(l=l||0){const m=h*h+f*f;if(m===0)return!0;const g=Math.sqrt(m);h/=g,f/=g}return!((r.x-t.x)*h+(r.y-t.y)*f-l<0||(n.x-t.x)*h+(n.y-t.y)*f-l<0||(a.x-t.x)*h+(a.y-t.y)*f-l<0)}function Of(t,e,r,n,a,l,h){return!(Lc(t,e,n,a,l,h)||Lc(e,r,n,a,l,h)||Lc(r,t,n,a,l,h)||Lc(n,a,t,e,r,h)||Lc(a,l,t,e,r,h)||Lc(l,n,t,e,r,h))}function Oc(t,e,r){const n=e.paint.get(t).value;return n.kind==="constant"?n.value:r.programConfigurations.get(e.id).getMaxValue(t)}function v0(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function w_(t,e,r,n,a){if(!e[0]&&!e[1])return t;const l=He.convert(e)._mult(a);r==="viewport"&&l._rotate(-n);const h=[];for(let f=0;f<t.length;f++)h.push(t[f].sub(l));return h}function T_(t,e,r,n){const a=He.convert(t)._mult(n);return e==="viewport"&&a._rotate(-r),a}nt(Df,"CircleBucket",{omit:["layers"]});const b7=new ue({"circle-sort-key":new fe(X.layout_circle["circle-sort-key"]),visibility:new oe(X.layout_circle.visibility)});var w7={paint:new ue({"circle-radius":new fe(X.paint_circle["circle-radius"]),"circle-color":new fe(X.paint_circle["circle-color"]),"circle-blur":new fe(X.paint_circle["circle-blur"]),"circle-opacity":new fe(X.paint_circle["circle-opacity"]),"circle-translate":new oe(X.paint_circle["circle-translate"]),"circle-translate-anchor":new oe(X.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new oe(X.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new oe(X.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new fe(X.paint_circle["circle-stroke-width"]),"circle-stroke-color":new fe(X.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new fe(X.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new oe(X.paint_circle["circle-emissive-strength"])}),layout:b7};class kf{constructor(e,r){this.pos=e,this.dir=r}intersectsPlane(e,r,n){const a=s.Q.dot(r,this.dir);if(Math.abs(a)<1e-6)return!1;const l=((e[0]-this.pos[0])*r[0]+(e[1]-this.pos[1])*r[1]+(e[2]-this.pos[2])*r[2])/a;return n[0]=this.pos[0]+this.dir[0]*l,n[1]=this.pos[1]+this.dir[1]*l,n[2]=this.pos[2]+this.dir[2]*l,!0}closestPointOnSphere(e,r,n){if(s.Q.equals(this.pos,e)||r===0)return n[0]=n[1]=n[2]=0,!1;const[a,l,h]=this.dir,f=this.pos[0]-e[0],m=this.pos[1]-e[1],g=this.pos[2]-e[2],x=a*a+l*l+h*h,v=2*(f*a+m*l+g*h),w=v*v-4*x*(f*f+m*m+g*g-r*r);if(w<0){const S=Math.max(-v/2,0),A=f+a*S,P=m+l*S,R=g+h*S,L=Math.hypot(A,P,R);return n[0]=A*r/L,n[1]=P*r/L,n[2]=R*r/L,!1}{const S=(-v-Math.sqrt(w))/(2*x);if(S<0){const A=Math.hypot(f,m,g);return n[0]=f*r/A,n[1]=m*r/A,n[2]=g*r/A,!1}return n[0]=f+a*S,n[1]=m+l*S,n[2]=g+h*S,!0}}}class Bf{constructor(e,r,n,a,l){this.TL=e,this.TR=r,this.BR=n,this.BL=a,this.horizon=l}static fromInvProjectionMatrix(e,r,n){const a=[-1,1,1],l=[1,1,1],h=[1,-1,1],f=[-1,-1,1],m=s.Q.transformMat4(a,a,e),g=s.Q.transformMat4(l,l,e),x=s.Q.transformMat4(h,h,e),v=s.Q.transformMat4(f,f,e);return new Bf(m,g,x,v,r/n)}}function vh(t,e,r){let n=1/0,a=-1/0;const l=[];for(const h of t){s.Q.sub(l,h,e);const f=s.Q.dot(l,r);n=Math.min(n,f),a=Math.max(a,f)}return[n,a]}function S_(t,e){let r=!0;for(let n=0;n<t.planes.length;n++){const a=t.planes[n];let l=0;for(let h=0;h<e.length;h++)l+=s.Q.dot(a,e[h])+a[3]>=0;if(l===0)return 0;l!==e.length&&(r=!1)}return r?2:1}function E_(t,e){for(const r of t.projections){const n=vh(e,t.points[0],r.axis);if(r.projection[1]<n[0]||r.projection[0]>n[1])return 0}return 1}function A_(t,e){let r=0;const n=[0,0,0,0];for(let a=0;a<t.length;a++)n[0]=t[a][0],n[1]=t[a][1],n[2]=t[a][2],n[3]=1,s.aa.dot(n,e)>=0&&r++;return r}class Ff{constructor(e,r){this.points=e||new Array(8).fill([0,0,0]),this.planes=r||new Array(6).fill([0,0,0,0]),this.bounds=jr.fromPoints(this.points),this.projections=[],this.frustumEdges=[s.Q.sub([],this.points[2],this.points[3]),s.Q.sub([],this.points[0],this.points[3]),s.Q.sub([],this.points[4],this.points[0]),s.Q.sub([],this.points[5],this.points[1]),s.Q.sub([],this.points[6],this.points[2]),s.Q.sub([],this.points[7],this.points[3])];for(const n of this.frustumEdges){const a=[0,-n[2],n[1]],l=[n[2],0,-n[0]];this.projections.push({axis:a,projection:vh(this.points,this.points[0],a)}),this.projections.push({axis:l,projection:vh(this.points,this.points[0],l)})}}static fromInvProjectionMatrix(e,r,n,a){const l=Math.pow(2,n),h=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(g=>{const x=s.aa.transformMat4([],g,e),v=1/x[3]/r*l;return s.aa.mul(x,x,[v,v,a?1/x[3]:v,v])}),f=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(g=>{const x=s.Q.sub([],h[g[0]],h[g[1]]),v=s.Q.sub([],h[g[2]],h[g[1]]),w=s.Q.normalize([],s.Q.cross([],x,v)),S=-s.Q.dot(w,h[g[1]]);return w.concat(S)}),m=[];for(let g=0;g<h.length;g++)m.push([h[g][0],h[g][1],h[g][2]]);return new Ff(m,f)}intersectsPrecise(e,r,n){for(let a=0;a<r.length;a++)if(!A_(e,r[a]))return 0;for(let a=0;a<this.planes.length;a++)if(!A_(e,this.planes[a]))return 0;for(const a of n)for(const l of this.frustumEdges){const h=s.Q.cross([],a,l),f=s.Q.length(h);if(f===0)continue;s.Q.scale(h,h,1/f);const m=vh(this.points,this.points[0],h),g=vh(e,this.points[0],h);if(m[0]>g[1]||g[0]>m[1])return 0}return 1}}class jr{static fromPoints(e){const r=[1/0,1/0,1/0],n=[-1/0,-1/0,-1/0];for(const a of e)s.Q.min(r,r,a),s.Q.max(n,n,a);return new jr(r,n)}static fromTileIdAndHeight(e,r,n){const a=1<<e.canonical.z,l=e.canonical.x,h=e.canonical.y;return new jr([l/a,h/a,r],[(l+1)/a,(h+1)/a,n])}static applyTransform(e,r){const n=e.getCorners();for(let a=0;a<n.length;++a)s.Q.transformMat4(n[a],n[a],r);return jr.fromPoints(n)}static projectAabbCorners(e,r){const n=e.getCorners();for(let a=0;a<n.length;++a)s.Q.transformMat4(n[a],n[a],r);return n}constructor(e,r){this.min=e,this.max=r,this.center=s.Q.scale([],s.Q.add([],this.min,this.max),.5)}quadrant(e){const r=[e%2==0,e<2],n=s.Q.clone(this.min),a=s.Q.clone(this.max);for(let l=0;l<r.length;l++)n[l]=r[l]?this.min[l]:this.center[l],a[l]=r[l]?this.center[l]:this.max[l];return a[2]=this.max[2],new jr(n,a)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,r=this.max;return[[e[0],e[1],e[2]],[r[0],e[1],e[2]],[r[0],r[1],e[2]],[e[0],r[1],e[2]],[e[0],e[1],r[2]],[r[0],e[1],r[2]],[r[0],r[1],r[2]],[e[0],r[1],r[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?S_(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?S_(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,r){return r||this.intersects(e)?E_(e,this.getCorners()):0}intersectsPreciseFlat(e,r){return r||this.intersectsFlat(e)?E_(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let r=0;r<3;++r)if(this.min[r]>e.max[r]||e.min[r]>this.max[r])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let r=0;r<3;r++)this.min[r]=Math.min(this.min[r],e.min[r]),this.max[r]=Math.max(this.max[r],e.max[r])}encapsulatePoint(e){for(let r=0;r<3;r++)this.min[r]=Math.min(this.min[r],e[r]),this.max[r]=Math.max(this.max[r],e[r])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}nt(jr,"Aabb");const T7=Rt([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:b0}=T7,S7=Rt([{name:"a_pos_3",components:3,type:"Int16"}]);var M_=Rt([{name:"a_pos",type:"Int16",components:2}]);function w0(t){return t*en/Rc}const E7=[new jr([Qn,Qn,Qn],[Xn,Xn,Xn]),new jr([Qn,Qn,Qn],[0,0,Xn]),new jr([0,Qn,Qn],[Xn,0,Xn]),new jr([Qn,0,Qn],[0,Xn,Xn]),new jr([0,0,Qn],[Xn,Xn,Xn])];function I_(t,e,r,n=!0){const a=s.Q.scale([],t._camera.position,t.worldSize),l=[e,r,1,1];s.aa.transformMat4(l,l,t.pixelMatrixInverse),s.aa.scale(l,l,1/l[3]);const h=s.Q.sub([],l,a),f=s.Q.normalize([],h),m=t.globeMatrix,g=[m[12],m[13],m[14]],x=s.Q.sub([],g,a),v=s.Q.length(x),w=s.Q.normalize([],x),S=t.worldSize/(2*Math.PI),A=s.Q.dot(w,f),P=Math.asin(S/v);if(P<Math.acos(A)){if(!n)return null;const pe=[],Te=[];s.Q.scale(pe,f,v/A),s.Q.normalize(Te,s.Q.sub(Te,pe,x)),s.Q.normalize(f,s.Q.add(f,x,s.Q.scale(f,Te,Math.tan(P)*v)))}const R=[];new kf(a,f).closestPointOnSphere(g,S,R);const L=s.Q.normalize([],Ho(m,0)),V=s.Q.normalize([],Ho(m,1)),q=s.Q.normalize([],Ho(m,2)),G=s.Q.dot(L,R),ee=s.Q.dot(V,R),W=s.Q.dot(q,R),re=Zi(Math.asin(-ee/S));let ne=Zi(Math.atan2(G,W));ne=t.center.lng+function(pe,Te){const we=(Te-pe+180)%360-180;return we<-180?we+360:we}(t.center.lng,ne);const de=Js(ne),ve=Ht(us(re),0,1);return new Vi(de,ve)}class A7{constructor(e,r,n){this.a=s.Q.sub([],e,n),this.b=s.Q.sub([],r,n),this.center=n;const a=s.Q.normalize([],this.a),l=s.Q.normalize([],this.b);this.angle=Math.acos(s.Q.dot(a,l))}}function Nf(t,e){if(t.angle===0)return null;let r;return r=t.a[e]===0?1/t.angle*.5*Math.PI:1/t.angle*Math.atan(t.b[e]/t.a[e]/Math.sin(t.angle)-1/Math.tan(t.angle)),r<0||r>1?null:function(n,a,l,h){const f=Math.sin(l);return n*(Math.sin((1-h)*l)/f)+a*(Math.sin(h*l)/f)}(t.a[e],t.b[e],t.angle,Ht(r,0,1))+t.center[e]}function Oo(t){if(t.z<=1)return E7[t.z+2*t.y+t.x];const e=Vf(T0(t));return jr.fromPoints(e)}function ds(t,e,r){return s.Q.scale(t,t,1-r),s.Q.scaleAndAdd(t,t,e,r)}function P_(t,e,r){for(const n of t)s.Q.transformMat4(n,n,e),s.Q.scale(n,n,r)}function C_(t,e,r,n){const a=e/t.worldSize,l=t.globeMatrix;if(r.z<=1){const de=Oo(r).getCorners();return P_(de,l,a),jr.fromPoints(de)}const h=T0(r,n),f=Vf(h,en+w0(t._tileCoverLift));P_(f,l,a);const m=Number.MAX_VALUE,g=[-m,-m,-m],x=[m,m,m];if(h.contains(t.center)){for(const pe of f)s.Q.min(x,x,pe),s.Q.max(g,g,pe);g[2]=0;const de=t.point,ve=[de.x*a,de.y*a,0];return s.Q.min(x,x,ve),s.Q.max(g,g,ve),new jr(x,g)}if(t._tileCoverLift>0){for(const de of f)s.Q.min(x,x,de),s.Q.max(g,g,de);return new jr(x,g)}const v=[l[12]*a,l[13]*a,l[14]*a],w=h.getCenter(),S=Ht(t.center.lat,-oi,oi),A=Ht(w.lat,-oi,oi),P=Js(t.center.lng),R=us(S);let L=P-Js(w.lng);const V=R-us(A);L>.5?L-=1:L<-.5&&(L+=1);let q=0;if(Math.abs(L)>Math.abs(V))q=L>=0?1:3;else{q=V>=0?0:2;const de=[l[4]*a,l[5]*a,l[6]*a],ve=-Math.sin(er(V>=0?h.getSouth():h.getNorth()))*en;s.Q.scaleAndAdd(v,v,de,ve)}const G=f[q],ee=f[(q+1)%4],W=new A7(G,ee,v),re=[Nf(W,0)||G[0],Nf(W,1)||G[1],Nf(W,2)||G[2]],ne=ea(t.zoom);if(ne>0){const de=function({x:pe,y:Te,z:we},be,Ce,Ie,ke){const Le=1/(1<<we);let Se=pe*Le,at=Se+Le,rt=Te*Le,Fe=rt+Le,bt=0;const ft=(Se+at)/2-Ie;return ft>.5?bt=-1:ft<-.5&&(bt=1),Se=((Se+bt)*be-(Ie*=be))*Ce+Ie,at=((at+bt)*be-Ie)*Ce+Ie,rt=(rt*be-(ke*=be))*Ce+ke,Fe=(Fe*be-ke)*Ce+ke,[[Se,Fe,0],[at,Fe,0],[at,rt,0],[Se,rt,0]]}(r,e,t._pixelsPerMercatorPixel,P,R);for(let pe=0;pe<f.length;pe++)ds(f[pe],de[pe],ne);const ve=s.Q.add([],de[q],de[(q+1)%4]);s.Q.scale(ve,ve,.5),ds(re,ve,ne)}for(const de of f)s.Q.min(x,x,de),s.Q.max(g,g,de);return x[2]=Math.min(G[2],ee[2]),s.Q.min(x,x,re),s.Q.max(g,g,re),new jr(x,g)}function T0({x:t,y:e,z:r},n=!1){const a=1/(1<<r),l=new ir(vn(t*a),e===(1<<r)-1&&n?-90:zi((e+1)*a)),h=new ir(vn((t+1)*a),e===0&&n?90:zi(e*a));return new Ys(l,h)}function Vf(t,e=en){const r=er(t.getNorth()),n=er(t.getSouth()),a=Math.cos(r),l=Math.cos(n),h=Math.sin(r),f=Math.sin(n),m=t.getWest(),g=t.getEast();return[zc(l,f,m,e),zc(l,f,g,e),zc(a,h,g,e),zc(a,h,m,e)]}function bh(t,e,r,n){const a=1<<r.z,l=(t/Qe+r.x)/a;return _l(zi((e/Qe+r.y)/a),vn(l),n)}function S0({min:t,max:e}){return u7/Math.max(e[0]-t[0],e[1]-t[1],e[2]-t[2])}const D_=new Float64Array(16);function E0(t){const e=S0(t),r=s.a9.fromScaling(D_,[e,e,e]);return s.a9.translate(r,r,s.Q.negate([],t.min))}function Uf(t){const e=s.a9.fromTranslation(D_,t.min),r=1/S0(t);return s.a9.scale(e,e,[r,r,r])}function jf(t){const e=Qe/(2*Math.PI);return t/(2*Math.PI)/e}function z_(t,e){return Qe/(512*Math.pow(2,t))*S0(Oo(e))}function R_(t,e,r,n,a){const l=jf(r),h=[t,e,-r/(2*Math.PI)],f=s.a9.identity(new Float64Array(16));return s.a9.translate(f,f,h),s.a9.scale(f,f,[l,l,l]),s.a9.rotateX(f,f,er(-a)),s.a9.rotateY(f,f,er(-n)),f}function ea(t){return Ea(Sf,u_,t)}function L_(t,e){const r=_l(e.lat,e.lng),n=function(l){const h=_l(l._center.lat,l._center.lng),f=s.Q.fromValues(0,1,0);let m=s.Q.cross([],f,h);const g=s.a9.fromRotation([],-l.angle,h);m=s.Q.transformMat4(m,m,g),s.a9.fromRotation(g,-l._pitch,m);const x=s.Q.normalize([],h);return s.Q.scale(x,x,w0(l.cameraToCenterDistance/l.pixelsPerMeter)),s.Q.transformMat4(x,x,g),s.Q.add([],h,x)}(t),a=s.Q.subtract([],n,r);return s.Q.angle(a,r)}function Gf(t,e){return L_(t,e)>Math.PI/2*1.01}const O_=er(85),M7=Math.cos(O_),I7=Math.sin(O_),P7=s.a9.create(),k_=t=>{const e=[];return t.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),t.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function B_(t,e,r,n,a,l,h,f,m){if(l&&t.queryGeometry.isAboveHorizon)return!1;l&&(m*=t.pixelToTileUnitsFactor);const g=t.tileID.canonical,x=r.projection.upVectorScale(g,r.center.lat,r.worldSize).metersToTile;for(const v of e)for(const w of v){const S=w.add(f),A=a&&r.elevation?r.elevation.exaggeration()*a.getElevationAt(S.x,S.y,!0):0,P=r.projection.projectTilePoint(S.x,S.y,g);if(A>0){const q=r.projection.upVector(g,S.x,S.y);P.x+=q[0]*x*A,P.y+=q[1]*x*A,P.z+=q[2]*x*A}const R=l?S:C7(P.x,P.y,P.z,n),L=l?t.tilespaceRays.map(q=>z7(q,A)):t.queryGeometry.screenGeometry,V=s.aa.transformMat4([],[P.x,P.y,P.z,1],n);if(!h&&l?m*=V[3]/r.cameraToCenterDistance:h&&!l&&(m*=r.cameraToCenterDistance/V[3]),l){const q=zi((w.y/Qe+g.y)/(1<<g.z));m/=r.projection.pixelsPerMeter(q,1)/tn(1,q)}if(g7(L,R,m))return!0}return!1}function C7(t,e,r,n){const a=s.aa.transformMat4([],[t,e,r,1],n);return new He(a[0]/a[3],a[1]/a[3])}const F_=s.Q.fromValues(0,0,0),D7=s.Q.fromValues(0,0,1);function z7(t,e){const r=s.Q.create();return F_[2]=e,t.intersectsPlane(F_,D7,r),new He(r[0],r[1])}class N_ extends Df{}function V_(t,{width:e,height:r},n,a){if(a){if(a instanceof Uint8ClampedArray)a=new Uint8Array(a.buffer);else if(a.length!==e*r*n)throw new RangeError("mismatched image size")}else a=new Uint8Array(e*r*n);return t.width=e,t.height=r,t.data=a,t}function U_(t,e,r){const{width:n,height:a}=e;n===t.width&&a===t.height||($f(t,e,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,n),height:Math.min(t.height,a)},r),t.width=n,t.height=a,t.data=e.data)}function $f(t,e,r,n,a,l,h){if(a.width===0||a.height===0)return e;if(a.width>t.width||a.height>t.height||r.x>t.width-a.width||r.y>t.height-a.height)throw new RangeError("out of range source coordinates for image copy");if(a.width>e.width||a.height>e.height||n.x>e.width-a.width||n.y>e.height-a.height)throw new RangeError("out of range destination coordinates for image copy");const f=t.data,m=e.data,g=l===4&&h;for(let x=0;x<a.height;x++){const v=((r.y+x)*t.width+r.x)*l,w=((n.y+x)*e.width+n.x)*l;if(g)for(let S=0;S<a.width;S++){const A=v+S*l+3,P=w+S*l;m[P+0]=255,m[P+1]=255,m[P+2]=255,m[P+3]=f[A]}else for(let S=0;S<a.width*l;S++)m[w+S]=f[v+S]}return e}nt(N_,"HeatmapBucket",{omit:["layers"]});class ta{constructor(e,r){V_(this,e,1,r)}resize(e){U_(this,new ta(e),1)}clone(){return new ta({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,n,a,l){$f(e,r,n,a,l,1)}}class kn{constructor(e,r){V_(this,e,4,r)}resize(e){U_(this,new kn(e),4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new kn({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,n,a,l,h){$f(e,r,n,a,l,4,h)}}class j_{constructor(e,r){this.width=e.width,this.height=e.height,this.data=r instanceof Uint8Array?new Float32Array(r.buffer):r}}nt(ta,"AlphaImage"),nt(kn,"RGBAImage");const R7=new ue({visibility:new oe(X.layout_heatmap.visibility)});var L7={paint:new ue({"heatmap-radius":new fe(X.paint_heatmap["heatmap-radius"]),"heatmap-weight":new fe(X.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new oe(X.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Re(X.paint_heatmap["heatmap-color"]),"heatmap-opacity":new oe(X.paint_heatmap["heatmap-opacity"])}),layout:R7};function wh(t){const e={},r=t.resolution||256,n=t.clips?t.clips.length:1,a=t.image||new kn({width:r,height:n}),l=(h,f,m)=>{e[t.evaluationKey]=m;const g=t.expression.evaluate(e);g&&(a.data[h+f+0]=Math.floor(255*g.r/g.a),a.data[h+f+1]=Math.floor(255*g.g/g.a),a.data[h+f+2]=Math.floor(255*g.b/g.a),a.data[h+f+3]=Math.floor(255*g.a))};if(t.clips)for(let h=0,f=0;h<n;++h,f+=4*r)for(let m=0,g=0;m<r;m++,g+=4){const x=m/(r-1),{start:v,end:w}=t.clips[h];l(f,g,v*(1-x)+w*x)}else for(let h=0,f=0;h<r;h++,f+=4)l(0,f,h/(r-1));return a}const O7=new ue({visibility:new oe(X.layout_hillshade.visibility)});var k7={paint:new ue({"hillshade-illumination-direction":new oe(X.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new oe(X.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new oe(X.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new oe(X.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new oe(X.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new oe(X.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new oe(X.paint_hillshade["hillshade-emissive-strength"])}),layout:O7};const B7=Rt([{name:"a_pos",components:2,type:"Int16"}],4),{members:F7}=B7;var qf={exports:{}};function A0(t,e,r){r=r||2;var n,a,l,h,f,m,g,x=e&&e.length,v=x?e[0]*r:t.length,w=G_(t,0,v,r,!0),S=[];if(!w||w.next===w.prev)return S;if(x&&(w=function(P,R,L,V){var q,G,ee,W=[];for(q=0,G=R.length;q<G;q++)(ee=G_(P,R[q]*V,q<G-1?R[q+1]*V:P.length,V,!1))===ee.next&&(ee.steiner=!0),W.push(Z7(ee));for(W.sort(G7),q=0;q<W.length;q++)L=$7(W[q],L);return L}(t,e,w,r)),t.length>80*r){n=l=t[0],a=h=t[1];for(var A=r;A<v;A+=r)(f=t[A])<n&&(n=f),(m=t[A+1])<a&&(a=m),f>l&&(l=f),m>h&&(h=m);g=(g=Math.max(l-n,h-a))!==0?32767/g:0}return Th(w,S,r,n,a,g,0),S}function G_(t,e,r,n,a){var l,h;if(a===Hf(t,e,r,n)>0)for(l=e;l<r;l+=n)h=Z_(l,t[l],t[l+1],h);else for(l=r-n;l>=e;l-=n)h=Z_(l,t[l],t[l+1],h);return h&&M0(h,h.next)&&(Eh(h),h=h.next),h}function vl(t,e){if(!t)return t;e||(e=t);var r,n=t;do if(r=!1,n.steiner||!M0(n,n.next)&&fi(n.prev,n,n.next)!==0)n=n.next;else{if(Eh(n),(n=e=n.prev)===n.next)break;r=!0}while(r||n!==e);return e}function Th(t,e,r,n,a,l,h){if(t){!h&&l&&function(x,v,w,S){var A=x;do A.z===0&&(A.z=Zf(A.x,A.y,v,w,S)),A.prevZ=A.prev,A.nextZ=A.next,A=A.next;while(A!==x);A.prevZ.nextZ=null,A.prevZ=null,function(P){var R,L,V,q,G,ee,W,re,ne=1;do{for(L=P,P=null,G=null,ee=0;L;){for(ee++,V=L,W=0,R=0;R<ne&&(W++,V=V.nextZ);R++);for(re=ne;W>0||re>0&&V;)W!==0&&(re===0||!V||L.z<=V.z)?(q=L,L=L.nextZ,W--):(q=V,V=V.nextZ,re--),G?G.nextZ=q:P=q,q.prevZ=G,G=q;L=V}G.nextZ=null,ne*=2}while(ee>1)}(A)}(t,n,a,l);for(var f,m,g=t;t.prev!==t.next;)if(f=t.prev,m=t.next,l?V7(t,n,a,l):N7(t))e.push(f.i/r|0),e.push(t.i/r|0),e.push(m.i/r|0),Eh(t),t=m.next,g=m.next;else if((t=m)===g){h?h===1?Th(t=U7(vl(t),e,r),e,r,n,a,l,2):h===2&&j7(t,e,r,n,a,l):Th(vl(t),e,r,n,a,l,1);break}}}function N7(t){var e=t.prev,r=t,n=t.next;if(fi(e,r,n)>=0)return!1;for(var a=e.x,l=r.x,h=n.x,f=e.y,m=r.y,g=n.y,x=a<l?a<h?a:h:l<h?l:h,v=f<m?f<g?f:g:m<g?m:g,w=a>l?a>h?a:h:l>h?l:h,S=f>m?f>g?f:g:m>g?m:g,A=n.next;A!==e;){if(A.x>=x&&A.x<=w&&A.y>=v&&A.y<=S&&kc(a,f,l,m,h,g,A.x,A.y)&&fi(A.prev,A,A.next)>=0)return!1;A=A.next}return!0}function V7(t,e,r,n){var a=t.prev,l=t,h=t.next;if(fi(a,l,h)>=0)return!1;for(var f=a.x,m=l.x,g=h.x,x=a.y,v=l.y,w=h.y,S=f<m?f<g?f:g:m<g?m:g,A=x<v?x<w?x:w:v<w?v:w,P=f>m?f>g?f:g:m>g?m:g,R=x>v?x>w?x:w:v>w?v:w,L=Zf(S,A,e,r,n),V=Zf(P,R,e,r,n),q=t.prevZ,G=t.nextZ;q&&q.z>=L&&G&&G.z<=V;){if(q.x>=S&&q.x<=P&&q.y>=A&&q.y<=R&&q!==a&&q!==h&&kc(f,x,m,v,g,w,q.x,q.y)&&fi(q.prev,q,q.next)>=0||(q=q.prevZ,G.x>=S&&G.x<=P&&G.y>=A&&G.y<=R&&G!==a&&G!==h&&kc(f,x,m,v,g,w,G.x,G.y)&&fi(G.prev,G,G.next)>=0))return!1;G=G.nextZ}for(;q&&q.z>=L;){if(q.x>=S&&q.x<=P&&q.y>=A&&q.y<=R&&q!==a&&q!==h&&kc(f,x,m,v,g,w,q.x,q.y)&&fi(q.prev,q,q.next)>=0)return!1;q=q.prevZ}for(;G&&G.z<=V;){if(G.x>=S&&G.x<=P&&G.y>=A&&G.y<=R&&G!==a&&G!==h&&kc(f,x,m,v,g,w,G.x,G.y)&&fi(G.prev,G,G.next)>=0)return!1;G=G.nextZ}return!0}function U7(t,e,r){var n=t;do{var a=n.prev,l=n.next.next;!M0(a,l)&&$_(a,n,n.next,l)&&Sh(a,l)&&Sh(l,a)&&(e.push(a.i/r|0),e.push(n.i/r|0),e.push(l.i/r|0),Eh(n),Eh(n.next),n=t=l),n=n.next}while(n!==t);return vl(n)}function j7(t,e,r,n,a,l){var h=t;do{for(var f=h.next.next;f!==h.prev;){if(h.i!==f.i&&W7(h,f)){var m=q_(h,f);return h=vl(h,h.next),m=vl(m,m.next),Th(h,e,r,n,a,l,0),void Th(m,e,r,n,a,l,0)}f=f.next}h=h.next}while(h!==t)}function G7(t,e){return t.x-e.x}function $7(t,e){var r=function(a,l){var h,f=l,m=a.x,g=a.y,x=-1/0;do{if(g<=f.y&&g>=f.next.y&&f.next.y!==f.y){var v=f.x+(g-f.y)*(f.next.x-f.x)/(f.next.y-f.y);if(v<=m&&v>x&&(x=v,h=f.x<f.next.x?f:f.next,v===m))return h}f=f.next}while(f!==l);if(!h)return null;var w,S=h,A=h.x,P=h.y,R=1/0;f=h;do m>=f.x&&f.x>=A&&m!==f.x&&kc(g<P?m:x,g,A,P,g<P?x:m,g,f.x,f.y)&&(w=Math.abs(g-f.y)/(m-f.x),Sh(f,a)&&(w<R||w===R&&(f.x>h.x||f.x===h.x&&q7(h,f)))&&(h=f,R=w)),f=f.next;while(f!==S);return h}(t,e);if(!r)return e;var n=q_(r,t);return vl(n,n.next),vl(r,r.next)}function q7(t,e){return fi(t.prev,t,e.prev)<0&&fi(e.next,t,t.next)<0}function Zf(t,e,r,n,a){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*a|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*a|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Z7(t){var e=t,r=t;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==t);return r}function kc(t,e,r,n,a,l,h,f){return(a-h)*(e-f)>=(t-h)*(l-f)&&(t-h)*(n-f)>=(r-h)*(e-f)&&(r-h)*(l-f)>=(a-h)*(n-f)}function W7(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(r,n){var a=r;do{if(a.i!==r.i&&a.next.i!==r.i&&a.i!==n.i&&a.next.i!==n.i&&$_(a,a.next,r,n))return!0;a=a.next}while(a!==r);return!1}(t,e)&&(Sh(t,e)&&Sh(e,t)&&function(r,n){var a=r,l=!1,h=(r.x+n.x)/2,f=(r.y+n.y)/2;do a.y>f!=a.next.y>f&&a.next.y!==a.y&&h<(a.next.x-a.x)*(f-a.y)/(a.next.y-a.y)+a.x&&(l=!l),a=a.next;while(a!==r);return l}(t,e)&&(fi(t.prev,t,e.prev)||fi(t,e.prev,e))||M0(t,e)&&fi(t.prev,t,t.next)>0&&fi(e.prev,e,e.next)>0)}function fi(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function M0(t,e){return t.x===e.x&&t.y===e.y}function $_(t,e,r,n){var a=P0(fi(t,e,r)),l=P0(fi(t,e,n)),h=P0(fi(r,n,t)),f=P0(fi(r,n,e));return a!==l&&h!==f||!(a!==0||!I0(t,r,e))||!(l!==0||!I0(t,n,e))||!(h!==0||!I0(r,t,n))||!(f!==0||!I0(r,e,n))}function I0(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function P0(t){return t>0?1:t<0?-1:0}function Sh(t,e){return fi(t.prev,t,t.next)<0?fi(t,e,t.next)>=0&&fi(t,t.prev,e)>=0:fi(t,e,t.prev)<0||fi(t,t.next,e)<0}function q_(t,e){var r=new Wf(t.i,t.x,t.y),n=new Wf(e.i,e.x,e.y),a=t.next,l=e.prev;return t.next=e,e.prev=t,r.next=a,a.prev=r,n.next=r,r.prev=n,l.next=n,n.prev=l,n}function Z_(t,e,r,n){var a=new Wf(t,e,r);return n?(a.next=n.next,a.prev=n,n.next.prev=a,n.next=a):(a.prev=a,a.next=a),a}function Eh(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Wf(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Hf(t,e,r,n){for(var a=0,l=e,h=r-n;l<r;l+=n)a+=(t[h]-t[l])*(t[l+1]+t[h+1]),h=l;return a}qf.exports=A0,qf.exports.default=A0,A0.deviation=function(t,e,r,n){var a=e&&e.length,l=Math.abs(Hf(t,0,a?e[0]*r:t.length,r));if(a)for(var h=0,f=e.length;h<f;h++)l-=Math.abs(Hf(t,e[h]*r,h<f-1?e[h+1]*r:t.length,r));var m=0;for(h=0;h<n.length;h+=3){var g=n[h]*r,x=n[h+1]*r,v=n[h+2]*r;m+=Math.abs((t[g]-t[v])*(t[x+1]-t[g+1])-(t[g]-t[x])*(t[v+1]-t[g+1]))}return l===0&&m===0?0:Math.abs((m-l)/l)},A0.flatten=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},n=0,a=0;a<t.length;a++){for(var l=0;l<t[a].length;l++)for(var h=0;h<e;h++)r.vertices.push(t[a][l][h]);a>0&&r.holes.push(n+=t[a-1].length)}return r};var C0=Br(qf.exports);function Qf(t,e){const r=t.length;if(r<=1)return[t];const n=[];let a,l;for(let h=0;h<r;h++){const f=Ma(t[h]);f!==0&&(t[h].area=Math.abs(f),l===void 0&&(l=f<0),l===f<0?(a&&n.push(a),a=[t[h]]):a.push(t[h]))}if(a&&n.push(a),e>1)for(let h=0;h<n.length;h++)n[h].length<=e||(O1(n[h],e,1,n[h].length-1,H7),n[h]=n[h].slice(0,e));return n}function H7(t,e){return e.area-t.area}function Xf(t,e,r){const n=r.patternDependencies;let a=!1;for(const l of e){const h=l.paint.get(`${t}-pattern`);h.isConstant()||(a=!0);const f=h.constantOr(null);f&&(a=!0,n[f]=!0)}return a}function Yf(t,e,r,n,a){const l=a.patternDependencies;for(const h of e){const f=h.paint.get(`${t}-pattern`).value;if(f.kind!=="constant"){let m=f.evaluate({zoom:n},r,{},a.availableImages);m=m&&m.name?m.name:m,l[m]=!0,r.patterns[h.id]=m}}return r}class Jf{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ci,this.indexArray=new gi,this.indexArray2=new xn,this.programConfigurations=new Xs(e.layers,e.zoom),this.segments=new ni,this.segments2=new ni,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.projection=e.projection}populate(e,r,n,a){this.hasPattern=Xf("fill",this.layers,r);const l=this.layers[0].layout.get("fill-sort-key"),h=[];for(const{feature:f,id:m,index:g,sourceLayerIndex:x}of e){const v=this.layers[0]._featureFilter.needGeometry,w=Ks(f,v);if(!this.layers[0]._featureFilter.filter(new N(this.zoom),w,n))continue;const S=l?l.evaluate(w,{},n,r.availableImages):void 0,A={id:m,properties:f.properties,type:f.type,sourceLayerIndex:x,index:g,geometry:v?w.geometry:hs(f,n,a),patterns:{},sortKey:S};h.push(A)}l&&h.sort((f,m)=>f.sortKey-m.sortKey);for(const f of h){const{geometry:m,index:g,sourceLayerIndex:x}=f;if(this.hasPattern){const v=Yf("fill",this.layers,f,this.zoom,r);this.patternFeatures.push(v)}else this.addFeature(f,m,g,n,{},r.availableImages,r.brightness);r.featureIndex.insert(e[g].feature,m,g,x,this.index)}}update(e,r,n,a,l){const h=Object.keys(e).length!==0;h&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,r,h?this.stateDependentLayers:this.layers,n,a,l)}addFeatures(e,r,n,a,l,h){for(const f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,r,n,a,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,F7),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,r,n,a,l,h=[],f){for(const m of Qf(r,500)){let g=0;for(const P of m)g+=P.length;const x=this.segments.prepareSegment(g,this.layoutVertexArray,this.indexArray),v=x.vertexLength,w=[],S=[];for(const P of m){if(P.length===0)continue;P!==m[0]&&S.push(w.length/2);const R=this.segments2.prepareSegment(P.length,this.layoutVertexArray,this.indexArray2),L=R.vertexLength;this.layoutVertexArray.emplaceBack(P[0].x,P[0].y),this.indexArray2.emplaceBack(L+P.length-1,L),w.push(P[0].x),w.push(P[0].y);for(let V=1;V<P.length;V++)this.layoutVertexArray.emplaceBack(P[V].x,P[V].y),this.indexArray2.emplaceBack(L+V-1,L+V),w.push(P[V].x),w.push(P[V].y);R.vertexLength+=P.length,R.primitiveLength+=P.length}const A=C0(w,S);for(let P=0;P<A.length;P+=3)this.indexArray.emplaceBack(v+A[P],v+A[P+1],v+A[P+2]);x.vertexLength+=g,x.primitiveLength+=A.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,l,h,a,f)}}nt(Jf,"FillBucket",{omit:["layers","patternFeatures"]});const Q7=new ue({"fill-sort-key":new fe(X.layout_fill["fill-sort-key"]),visibility:new oe(X.layout_fill.visibility)});var X7={paint:new ue({"fill-antialias":new oe(X.paint_fill["fill-antialias"]),"fill-opacity":new fe(X.paint_fill["fill-opacity"]),"fill-color":new fe(X.paint_fill["fill-color"]),"fill-outline-color":new fe(X.paint_fill["fill-outline-color"]),"fill-translate":new oe(X.paint_fill["fill-translate"]),"fill-translate-anchor":new oe(X.paint_fill["fill-translate-anchor"]),"fill-pattern":new fe(X.paint_fill["fill-pattern"]),"fill-emissive-strength":new oe(X.paint_fill["fill-emissive-strength"])}),layout:Q7};const Y7=Rt([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),J7=Rt([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),K7=Rt([{name:"a_centroid_pos",components:2,type:"Uint16"}]),ey=Rt([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),ty=Rt([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:ry}=Y7;var D0={},iy=kl,W_=Bc;function Bc(t,e,r,n,a){this.properties={},this.extent=r,this.type=0,this._pbf=t,this._geometry=-1,this._keys=n,this._values=a,t.readFields(ny,this,e)}function ny(t,e,r){t==1?e.id=r.readVarint():t==2?function(n,a){for(var l=n.readVarint()+n.pos;n.pos<l;){var h=a._keys[n.readVarint()],f=a._values[n.readVarint()];a.properties[h]=f}}(r,e):t==3?e.type=r.readVarint():t==4&&(e._geometry=r.pos)}function oy(t){for(var e,r,n=0,a=0,l=t.length,h=l-1;a<l;h=a++)n+=((r=t[h]).x-(e=t[a]).x)*(e.y+r.y);return n}Bc.types=["Unknown","Point","LineString","Polygon"],Bc.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,r=t.readVarint()+t.pos,n=1,a=0,l=0,h=0,f=[];t.pos<r;){if(a<=0){var m=t.readVarint();n=7&m,a=m>>3}if(a--,n===1||n===2)l+=t.readSVarint(),h+=t.readSVarint(),n===1&&(e&&f.push(e),e=[]),e.push(new iy(l,h));else{if(n!==7)throw new Error("unknown command "+n);e&&e.push(e[0].clone())}}return e&&f.push(e),f},Bc.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,r=1,n=0,a=0,l=0,h=1/0,f=-1/0,m=1/0,g=-1/0;t.pos<e;){if(n<=0){var x=t.readVarint();r=7&x,n=x>>3}if(n--,r===1||r===2)(a+=t.readSVarint())<h&&(h=a),a>f&&(f=a),(l+=t.readSVarint())<m&&(m=l),l>g&&(g=l);else if(r!==7)throw new Error("unknown command "+r)}return[h,m,f,g]},Bc.prototype.toGeoJSON=function(t,e,r){var n,a,l=this.extent*Math.pow(2,r),h=this.extent*t,f=this.extent*e,m=this.loadGeometry(),g=Bc.types[this.type];function x(S){for(var A=0;A<S.length;A++){var P=S[A];S[A]=[360*(P.x+h)/l-180,360/Math.PI*Math.atan(Math.exp((180-360*(P.y+f)/l)*Math.PI/180))-90]}}switch(this.type){case 1:var v=[];for(n=0;n<m.length;n++)v[n]=m[n][0];x(m=v);break;case 2:for(n=0;n<m.length;n++)x(m[n]);break;case 3:for(m=function(S){var A=S.length;if(A<=1)return[S];for(var P,R,L=[],V=0;V<A;V++){var q=oy(S[V]);q!==0&&(R===void 0&&(R=q<0),R===q<0?(P&&L.push(P),P=[S[V]]):P.push(S[V]))}return P&&L.push(P),L}(m),n=0;n<m.length;n++)for(a=0;a<m[n].length;a++)x(m[n][a])}m.length===1?m=m[0]:g="Multi"+g;var w={type:"Feature",geometry:{type:g,coordinates:m},properties:this.properties};return"id"in this&&(w.id=this.id),w};var sy=W_,H_=Q_;function Q_(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(ay,this,e),this.length=this._features.length}function ay(t,e,r){t===15?e.version=r.readVarint():t===1?e.name=r.readString():t===5?e.extent=r.readVarint():t===2?e._features.push(r.pos):t===3?e._keys.push(r.readString()):t===4&&e._values.push(function(n){for(var a=null,l=n.readVarint()+n.pos;n.pos<l;){var h=n.readVarint()>>3;a=h===1?n.readString():h===2?n.readFloat():h===3?n.readDouble():h===4?n.readVarint64():h===5?n.readVarint():h===6?n.readSVarint():h===7?n.readBoolean():null}return a}(r))}Q_.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new sy(this._pbf,e,this.extent,this._keys,this._values)};var ly=H_;function cy(t,e,r){if(t===3){var n=new ly(r,r.readVarint()+r.pos);n.length&&(e[n.name]=n)}}var Kf=D0.VectorTile=function(t,e){this.layers=t.readFields(cy,{},e)},z0=D0.VectorTileFeature=W_;function R0(t,e,r,n){const a=[],l=n===0?(h,f,m,g,x,v)=>{h.push(new He(v,m+(v-f)/(g-f)*(x-m)))}:(h,f,m,g,x,v)=>{h.push(new He(f+(v-m)/(x-m)*(g-f),v))};for(const h of t){const f=[];for(const m of h){if(m.length<=2)continue;const g=[];for(let w=0;w<m.length-1;w++){const S=m[w].x,A=m[w].y,P=m[w+1].x,R=m[w+1].y,L=n===0?S:A,V=n===0?P:R;L<e?V>e&&l(g,S,A,P,R,e):L>r?V<r&&l(g,S,A,P,R,r):g.push(m[w]),V<e&&L>=e&&l(g,S,A,P,R,e),V>r&&L<=r&&l(g,S,A,P,R,r)}let x=m[m.length-1];const v=n===0?x.x:x.y;v>=e&&v<=r&&g.push(x),g.length&&(x=g[g.length-1],g[0].x===x.x&&g[0].y===x.y||g.push(g[0]),f.push(g))}f.length&&a.push(f)}return a}function L0(t,e){return t.x-e.x||t.y-e.y}function X_(t,e){return L0(t.min,e.min)===0&&L0(t.max,e.max)===0}function Y_(t,e){return!(t.min.x>e.max.x||t.max.x<e.min.x||t.min.y>e.max.y||t.max.y<e.min.y)}function J_(t,e,r){const n=1/Qe,a=1/(1<<r.canonical.z),l=(e.x*n+r.canonical.x)*a+r.wrap,h=(e.y*n+r.canonical.y)*a;return{min:new He((t.x*n+r.canonical.x)*a+r.wrap,(t.y*n+r.canonical.y)*a),max:new He(l,h)}}function uy(t,e,r){const n=1<<r.canonical.z,a=((e.x-r.wrap)*n-r.canonical.x)*Qe,l=(e.y*n-r.canonical.y)*Qe;return{min:new He(((t.x-r.wrap)*n-r.canonical.x)*Qe,(t.y*n-r.canonical.y)*Qe),max:new He(a,l)}}function K_(t,e,r,n,a,l,h){const f=t.indices,m=t.vertices,g=[];for(let x=n;x<n+a;x+=3){const v=e[r[x+0]+l],w=e[r[x+1]+l],S=e[r[x+2]+l],A=Math.min(v.x,w.x,S.x),P=Math.max(v.x,w.x,S.x),R=Math.min(v.y,w.y,S.y),L=Math.max(v.y,w.y,S.y);g.length=0,t.grid.query(new He(A,R),new He(P,L),g);for(let V=0;V<g.length;V++){const q=g[V];if(Of(m[f[3*q+0]],m[f[3*q+1]],m[f[3*q+2]],v,w,S,h))return!0}}return!1}function e4(t,e,r,n){if(!t||!r)return!1;let a=t.vertices;if(!e.canonical.equals(n.canonical)||e.wrap!==n.wrap){if(r.vertices.length<t.vertices.length)return e4(r,n,t,e);const l=e.canonical,h=n.canonical,f=Math.pow(2,h.z-l.z);a=t.vertices.map(m=>new He((m.x+l.x*Qe)*f-h.x*Qe,(m.y+l.y*Qe)*f-h.y*Qe))}return K_(r,a,t.indices,0,t.indices.length,0,0)}D0.VectorTileLayer=H_;class t4{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,r){const n=this.toIdx(e,r);return{min:this.minimums[n],max:this.maximums[n]}}isLeaf(e,r){return this.leaves[this.toIdx(e,r)]}toIdx(e,r){return r*this.size+e}}function r4(t,e,r,n){let a=0,l=Number.MAX_VALUE;for(let h=0;h<3;h++)if(Math.abs(n[h])<1e-15){if(r[h]<t[h]||r[h]>e[h])return null}else{const f=1/n[h];let m=(t[h]-r[h])*f,g=(e[h]-r[h])*f;if(m>g){const x=m;m=g,g=x}if(m>a&&(a=m),g<l&&(l=g),a>l)return null}return a}function i4(t,e,r,n,a,l,h,f,m,g,x){const v=n-t,w=a-e,S=l-r,A=h-t,P=f-e,R=m-r,L=x[1]*R-x[2]*P,V=x[2]*A-x[0]*R,q=x[0]*P-x[1]*A,G=v*L+w*V+S*q;if(Math.abs(G)<1e-15)return null;const ee=1/G,W=g[0]-t,re=g[1]-e,ne=g[2]-r,de=(W*L+re*V+ne*q)*ee;if(de<0||de>1)return null;const ve=re*S-ne*w,pe=ne*v-W*S,Te=W*w-re*v,we=(x[0]*ve+x[1]*pe+x[2]*Te)*ee;return we<0||de+we>1?null:(A*ve+P*pe+R*Te)*ee}function n4(t,e,r){return(t-e)/(r-e)}function o4(t,e,r,n,a,l,h,f,m){const g=1<<r,x=l-n,v=h-a,w=(t+1)/g*x+n,S=(e+0)/g*v+a,A=(e+1)/g*v+a;f[0]=(t+0)/g*x+n,f[1]=S,m[0]=w,m[1]=A}class s4{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const r=function(l){const h=Math.ceil(Math.log2(l.dim/8)),f=[];let m=Math.ceil(Math.pow(2,h));const g=1/m,x=(S,A,P,R,L)=>{const V=R?1:0,q=(S+1)*P-V,G=A*P,ee=(A+1)*P-V;L[0]=S*P,L[1]=G,L[2]=q,L[3]=ee};let v=new t4(m);const w=[];for(let S=0;S<m*m;S++){x(S%m,Math.floor(S/m),g,!1,w);const A=ra(w[0],w[1],l),P=ra(w[2],w[1],l),R=ra(w[2],w[3],l),L=ra(w[0],w[3],l);v.minimums.push(Math.min(A,P,R,L)),v.maximums.push(Math.max(A,P,R,L)),v.leaves.push(1)}for(f.push(v),m/=2;m>=1;m/=2){const S=f[f.length-1];v=new t4(m);for(let A=0;A<m*m;A++){x(A%m,Math.floor(A/m),2,!0,w);const P=S.getElevation(w[0],w[1]),R=S.getElevation(w[2],w[1]),L=S.getElevation(w[2],w[3]),V=S.getElevation(w[0],w[3]),q=S.isLeaf(w[0],w[1]),G=S.isLeaf(w[2],w[1]),ee=S.isLeaf(w[2],w[3]),W=S.isLeaf(w[0],w[3]),re=Math.min(P.min,R.min,L.min,V.min),ne=Math.max(P.max,R.max,L.max,V.max),de=q&&G&&ee&&W;v.maximums.push(ne),v.minimums.push(re),v.leaves.push(ne-re<=5&&de?1:0)}f.push(v)}return f}(this.dem),n=r.length-1,a=r[n];this._addNode(a.minimums[0],a.maximums[0],a.leaves[0]),this._construct(r,0,0,n,0)}raycastRoot(e,r,n,a,l,h,f=1){return r4([e,r,-100],[n,a,this.maximums[0]*f],l,h)}raycast(e,r,n,a,l,h,f=1){if(!this.nodeCount)return null;const m=this.raycastRoot(e,r,n,a,l,h,f);if(m==null)return null;const g=[],x=[],v=[],w=[],S=[{idx:0,t:m,nodex:0,nodey:0,depth:0}];for(;S.length>0;){const{idx:A,t:P,nodex:R,nodey:L,depth:V}=S.pop();if(this.leaves[A]){o4(R,L,V,e,r,n,a,v,w);const G=1<<V,ee=(R+0)/G,W=(R+1)/G,re=(L+0)/G,ne=(L+1)/G,de=ra(ee,re,this.dem)*f,ve=ra(W,re,this.dem)*f,pe=ra(W,ne,this.dem)*f,Te=ra(ee,ne,this.dem)*f,we=i4(v[0],v[1],de,w[0],v[1],ve,w[0],w[1],pe,l,h),be=i4(w[0],w[1],pe,v[0],w[1],Te,v[0],v[1],de,l,h),Ce=Math.min(we!==null?we:Number.MAX_VALUE,be!==null?be:Number.MAX_VALUE);if(Ce!==Number.MAX_VALUE)return Ce;{const Ie=s.Q.scaleAndAdd([],l,h,P);if(a4(de,ve,Te,pe,n4(Ie[0],v[0],w[0]),n4(Ie[1],v[1],w[1]))>=Ie[2])return P}continue}let q=0;for(let G=0;G<this._siblingOffset.length;G++){o4((R<<1)+this._siblingOffset[G][0],(L<<1)+this._siblingOffset[G][1],V+1,e,r,n,a,v,w),v[2]=-100,w[2]=this.maximums[this.childOffsets[A]+G]*f;const ee=r4(v,w,l,h);if(ee!=null){const W=ee;g[G]=W;let re=!1;for(let ne=0;ne<q&&!re;ne++)W>=g[x[ne]]&&(x.splice(ne,0,G),re=!0);re||(x[q]=G),q++}}for(let G=0;G<q;G++){const ee=x[G];S.push({idx:this.childOffsets[A]+ee,t:g[ee],nodex:(R<<1)+this._siblingOffset[ee][0],nodey:(L<<1)+this._siblingOffset[ee][1],depth:V+1})}}return null}_addNode(e,r,n){return this.minimums.push(e),this.maximums.push(r),this.leaves.push(n),this.childOffsets.push(0),this.nodeCount++}_construct(e,r,n,a,l){if(e[a].isLeaf(r,n)===1)return;this.childOffsets[l]||(this.childOffsets[l]=this.nodeCount);const h=a-1,f=e[h];let m=0,g=0;for(let x=0;x<this._siblingOffset.length;x++){const v=2*r+this._siblingOffset[x][0],w=2*n+this._siblingOffset[x][1],S=f.getElevation(v,w),A=f.isLeaf(v,w),P=this._addNode(S.min,S.max,A);A&&(m|=1<<x),g||(g=P)}for(let x=0;x<this._siblingOffset.length;x++)m&1<<x||this._construct(e,2*r+this._siblingOffset[x][0],2*n+this._siblingOffset[x][1],h,g+x)}}function a4(t,e,r,n,a,l){return jt(jt(t,r,l),jt(e,n,l),a)}function ra(t,e,r){const n=r.dim,a=Ht(t*n-.5,0,n-1),l=Ht(e*n-.5,0,n-1),h=Math.floor(a),f=Math.floor(l),m=Math.min(h+1,n-1),g=Math.min(f+1,n-1);return a4(r.get(h,f),r.get(m,f),r.get(h,g),r.get(m,g),a-h,l-f)}const hy={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function dy(t,e,r){return(256*t*256+256*e+r)/10-1e4}function fy(t,e,r){return 256*t+e+r/256-32768}class O0{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,r,n,a=!1){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(n&&n!=="mapbox"&&n!=="terrarium")return Qr(`"${n}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=r.height;const l=this.dim=r.height-2,h=new Uint32Array(r.data.buffer);if(this.pixels=new Uint8Array(r.data.buffer),this.floatView=new Float32Array(r.data.buffer),this.borderReady=a,this._modifiedForSources={},!a){for(let m=0;m<l;m++)h[this._idx(-1,m)]=h[this._idx(0,m)],h[this._idx(l,m)]=h[this._idx(l-1,m)],h[this._idx(m,-1)]=h[this._idx(m,0)],h[this._idx(m,l)]=h[this._idx(m,l-1)];h[this._idx(-1,-1)]=h[this._idx(0,0)],h[this._idx(l,-1)]=h[this._idx(l-1,0)],h[this._idx(-1,l)]=h[this._idx(0,l-1)],h[this._idx(l,l)]=h[this._idx(l-1,l-1)]}const f=n==="terrarium"?fy:dy;for(let m=0;m<h.length;++m){const g=4*m;this.floatView[m]=f(this.pixels[g],this.pixels[g+1],this.pixels[g+2])}this._timestamp=jn.now()}_buildQuadTree(){this._tree=new s4(this)}get(e,r,n=!1){n&&(e=Ht(e,-1,this.dim),r=Ht(r,-1,this.dim));const a=this._idx(e,r);return this.floatView[a]}set(e,r,n){const a=this._idx(e,r),l=this.floatView[a];return this.floatView[a]=n,n-l}static getUnpackVector(e){return hy[e]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(e+1)}static pack(e,r){const n=[0,0,0,0],a=O0.getUnpackVector(r);let l=Math.floor((e+a[3])/a[2]);return n[2]=l%256,l=Math.floor(l/256),n[1]=l%256,l=Math.floor(l/256),n[0]=l,n}getPixels(){return new j_({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,r,n){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let a=r*this.dim,l=r*this.dim+this.dim,h=n*this.dim,f=n*this.dim+this.dim;switch(r){case-1:a=l-1;break;case 1:l=a+1}switch(n){case-1:h=f-1;break;case 1:f=h+1}const m=-r*this.dim,g=-n*this.dim;for(let x=h;x<f;x++)for(let v=a;v<l;v++){const w=4*this._idx(v,x),S=4*this._idx(v+m,x+g);this.pixels[w+0]=e.pixels[S+0],this.pixels[w+1]=e.pixels[S+1],this.pixels[w+2]=e.pixels[S+2],this.pixels[w+3]=e.pixels[S+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}nt(O0,"DEMData"),nt(s4,"DemMinMaxQuadTree",{omit:["dem"]});class Fc{constructor(e,r,n){this._demTile=e,this._dem=this._demTile.dem,this._scale=r,this._offset=n}static create(e,r,n){const a=n||e.findDEMTileFor(r);if(!a||!a.dem)return;const l=a.dem,h=a.tileID,f=1<<r.canonical.z-h.canonical.z;return new Fc(a,l.dim/Qe/f,[(r.canonical.x/f-h.canonical.x)*l.dim,(r.canonical.y/f-h.canonical.y)*l.dim])}tileCoordToPixel(e,r){const n=r*this._scale+this._offset[1],a=Math.floor(e*this._scale+this._offset[0]),l=Math.floor(n);return new He(a,l)}getElevationAt(e,r,n,a){const l=e*this._scale+this._offset[0],h=r*this._scale+this._offset[1],f=Math.floor(l),m=Math.floor(h),g=this._dem;return a=!!a,n?jt(jt(g.get(f,m,a),g.get(f,m+1,a),h-m),jt(g.get(f+1,m,a),g.get(f+1,m+1,a),h-m),l-f):g.get(f,m,a)}getElevationAtPixel(e,r,n){return this._dem.get(e,r,!!n)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*tn(1,e)*this._dem.stride}}const py=z0.types,my=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius"],_y=["fill-extrusion-flood-light-ground-radius"],gy=Math.pow(2,13),yy=Math.pow(2,15)-1,l4=new He(0,1),ia=2147483648;function Ah(t,e,r,n,a,l,h,f){t.emplaceBack((e<<1)+h,(r<<1)+l,(Math.floor(n*gy)<<1)+a,Math.round(f))}function k0(t,e,r,n,a,l){t.emplaceBack(e.x,e.y,(r.x<<1)+n,(r.y<<1)+a,l)}function Mh(t,e,r){t.emplaceBack(e.x,e.y,e.z,r[0]*16384,r[1]*16384,r[2]*16384)}class c4{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class u4{constructor(){this.centroidXY=new He(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new He(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new He(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new He(this.max.x-this.min.x,this.max.y-this.min.y)}}class h4{constructor(){this.acc=new He(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,r){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=r.x,e.min.y=e.max.y=r.y)}appendEdge(e,r,n){this.accCount++,this.acc._add(r);let a=!!this.borders;r.x<e.min.x?(e.min.x=r.x,a=!0):r.x>e.max.x&&(e.max.x=r.x,a=!0),r.y<e.min.y?(e.min.y=r.y,a=!0):r.y>e.max.y&&(e.max.y=r.y,a=!0),((r.x===0||r.x===Qe)&&r.x===n.x)!=((r.y===0||r.y===Qe)&&r.y===n.y)&&this.processBorderOverlap(r,n),a&&this.checkBorderIntersection(r,n)}checkBorderIntersection(e,r){r.x<0!=e.x<0&&this.addBorderIntersection(0,jt(r.y,e.y,(0-r.x)/(e.x-r.x))),r.x>Qe!=e.x>Qe&&this.addBorderIntersection(1,jt(r.y,e.y,(Qe-r.x)/(e.x-r.x))),r.y<0!=e.y<0&&this.addBorderIntersection(2,jt(r.x,e.x,(0-r.y)/(e.y-r.y))),r.y>Qe!=e.y>Qe&&this.addBorderIntersection(3,jt(r.x,e.x,(Qe-r.y)/(e.y-r.y)))}addBorderIntersection(e,r){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const n=this.borders[e];r<n[0]&&(n[0]=r),r>n[1]&&(n[1]=r)}processBorderOverlap(e,r){if(e.x===r.x){if(e.y===r.y)return;const n=e.x===0?0:1;this.addBorderIntersection(n,r.y),this.addBorderIntersection(n,e.y)}else{const n=e.y===0?2:3;this.addBorderIntersection(n,r.x),this.addBorderIntersection(n,e.x)}}centroid(){return this.accCount===0?new He(0,0):new He(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,r)=>e+ +(r[0]!==Number.MAX_VALUE),0):0}}function d4(t,e){const r=t.add(e)._unit(),n=Ht(t.x*r.x+t.y*r.y,-1,1);var a,l,h;return a=Math.acos(n),Math.min(4,Math.max(-4,Math.tan(a)))/4*yy*((l=t).x*(h=e).y-l.y*h.x<0?-1:1)}const xy=[t=>t.x<0,t=>t.x>Qe,t=>t.y<0,t=>t.y>Qe];function vy(t,e,r,n){const a=[4];if(n===0)return a;r._mult(n);const l=t.sub(r),h=e.sub(r),f=[t,e,l,h];for(let m=0;m<4;m++)for(const g of f)if(xy[m](g)){a.push(m);break}return a}class f4{constructor(e){this.vertexArray=new Hi,this.indexArray=new gi,this.programConfigurations=new Xs(e.layers,e.zoom,r=>_y.includes(r)),this._segments=new ni,this.hiddenByLandmarkVertexArray=new xf,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new ni}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,r,n,a=!1){const l=e.length;if(l>2){let h=Math.max(0,this._segments.get().length-1);const f=this._segments._prepareSegment(4*l,this.vertexArray.length,2*this._segmentToGroundQuads[h].length);let m;h!==this._segments.get().length-1&&(h++,this._segmentToGroundQuads[h]=[],this._segmentToRegionTriCounts[h]=[0,0,0,0,0]);{const g=e[0],x=e[1];m=d4(g.sub(e[l-1])._perp()._unit(),x.sub(g)._perp()._unit())}for(let g=0;g<l;g++){const x=g===l-1?0:g+1,v=e[g],w=e[x],S=e[x===l-1?0:x+1],A=w.sub(v)._perp()._unit(),P=d4(A,S.sub(w)._perp()._unit()),R=m,L=P;if(ep(v,w,r)||a&&_4(v,r)&&_4(w,r)){m=P;continue}const V=f.vertexLength;k0(this.vertexArray,v,w,1,1,R),k0(this.vertexArray,v,w,1,0,R),k0(this.vertexArray,v,w,0,1,L),k0(this.vertexArray,v,w,0,0,L),f.vertexLength+=4;const q=vy(v,w,A,n);for(const G of q)this._segmentToGroundQuads[h].push({id:V,region:G}),this._segmentToRegionTriCounts[h][G]+=2,f.primitiveLength+=2;m=P}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),r=e.length;for(let n=0;n<r;n++)this._segmentToGroundQuads[n].sort((a,l)=>a.region-l.region);for(let n=0;n<r;n++){const a=this._segmentToGroundQuads[n],l=e[n],h=this._segmentToRegionTriCounts[n];h.reduce((m,g)=>m+g,0);let f=0;for(let m=0;m<=4;m++){const g=h[m];if(g!==0){let x=this.regionSegments[m];x||(x=this.regionSegments[m]=new ni);const v={vertexOffset:l.vertexOffset,primitiveOffset:l.primitiveOffset+f,vertexLength:l.vertexLength,primitiveLength:g};x.get().push(v)}f+=g}for(let m=0;m<a.length;m++){const g=a[m].id;this.indexArray.emplaceBack(g,g+1,g+3),this.indexArray.emplaceBack(g,g+3,g+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,r,n,a,l,h){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,r,n,a,l,h)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,J7.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,r,n,a,l,h){this.hasData()&&this.programConfigurations.updatePaintArrays(e,r,n,a,l,h)}updateHiddenByLandmark(e){if(!this.hasData())return;const r=e.groundVertexCount+e.groundVertexArrayOffset;if(e.groundVertexCount===0)return;const n=e.flags&ia?1:0;for(let a=e.groundVertexArrayOffset;a<r;++a)this.hiddenByLandmarkVertexArray.emplace(a,n);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,ey.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const r=this.regionSegments[e];r&&r.destroy()}}}}class B0{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new gi,this.footprintVertices=new Ci,this.footprintSegments=[],this.layoutVertexArray=new Di,this.centroidVertexArray=new n_,this.indexArray=new gi,this.programConfigurations=new Xs(e.layers,e.zoom,r=>my.includes(r)),this.segments=new ni,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.groundEffect=new f4(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}populate(e,r,n,a){this.features=[],this.hasPattern=Xf("fill-extrusion",this.layers,r),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=g0(n),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:l,id:h,index:f,sourceLayerIndex:m}of e){const g=this.layers[0]._featureFilter.needGeometry,x=Ks(l,g);if(!this.layers[0]._featureFilter.filter(new N(this.zoom),x,n))continue;const v={id:h,sourceLayerIndex:m,index:f,geometry:g?x.geometry:hs(l,n,a),properties:l.properties,type:l.type,patterns:{}},w=this.layoutVertexArray.length;this.hasPattern?this.features.push(Yf("fill-extrusion",this.layers,v,this.zoom,r)):this.addFeature(v,v.geometry,f,n,{},r.availableImages,a,r.brightness),r.featureIndex.insert(l,v.geometry,f,m,this.index,w)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,r,n,a,l,h){for(const f of this.features){const{geometry:m}=f;this.addFeature(f,m,f.index,r,n,a,l,h)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,r,n,a,l){const h=Object.keys(e).length!==0;if(h&&!this.stateDependentLayers.length)return;const f=h?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(e,r,f,n,a,l),this.groundEffect.update(e,r,f,n,a,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ry),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,ty.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,K7.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,n,a,l,h,f,m){const g=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,x=[new He(0,0),new He(Qe,Qe)],v=f.projection,w=v.name==="globe",S=py[e.type]==="Polygon",A=new h4;A.centroidDataIndex=this.centroidData.length;const P=new u4,R=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},a)<=0,L=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},a);P.height=L,P.vertexArrayOffset=this.layoutVertexArray.length,P.groundVertexArrayOffset=this.groundEffect.vertexArray.length,w&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new On);const V=Qf(r,500);for(let ne=V.length-1;ne>=0;ne--){const de=V[ne];(de.length===0||(q=de[0]).every(ve=>ve.x<=0)||q.every(ve=>ve.x>=Qe)||q.every(ve=>ve.y<=0)||q.every(ve=>ve.y>=Qe))&&V.splice(ne,1)}var q;let G;if(w)G=v4(V,x,a);else{G=[];for(const ne of V)G.push({polygon:ne,bounds:x})}const ee=S?this.edgeRadius:0,W=ee>0&&this.zoom<17,re=(ne,de)=>{if(ne.length===0)return!1;const ve=ne[ne.length-1];return de.x===ve.x&&de.y===ve.y};for(const{polygon:ne,bounds:de}of G){let ve=0,pe=0;for(const Ce of ne)S&&!Ce[0].equals(Ce[Ce.length-1])&&Ce.push(Ce[0]),pe+=S?Ce.length-1:Ce.length;const Te=this.segments.prepareSegment((S?5:4)*pe,this.layoutVertexArray,this.indexArray);P.footprintSegIdx<0&&(P.footprintSegIdx=this.footprintSegments.length),P.polygonSegIdx<0&&(P.polygonSegIdx=this.polygonSegments.length);const we={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},be=new c4;if(be.vertexOffset=this.footprintVertices.length,be.indexOffset=3*this.footprintIndices.length,be.ringIndices=[],S){const Ce=[],Ie=[];ve=Te.vertexLength;for(let Le=0;Le<ne.length;Le++){const Se=ne[Le];Se.length&&Le!==0&&Ie.push(Ce.length/2);const at=[];let rt,Fe;rt=Se[1].sub(Se[0])._perp()._unit(),be.ringIndices.push(Se.length-1);for(let bt=1;bt<Se.length;bt++){const ft=Se[bt],lt=Se[bt===Se.length-1?1:bt+1],Ne=ft.clone();if(ee){Fe=lt.sub(ft)._perp()._unit();const yt=rt.add(Fe)._unit(),Lt=ee*Math.min(4,1/(rt.x*yt.x+rt.y*yt.y));Ne.x+=Lt*yt.x,Ne.y+=Lt*yt.y,Ne.x=Math.round(Ne.x),Ne.y=Math.round(Ne.y),rt=Fe}!R||ee!==0&&!W||re(at,Ne)||at.push(Ne),Ah(this.layoutVertexArray,Ne.x,Ne.y,0,0,1,1,0),Te.vertexLength++,this.footprintVertices.emplaceBack(ft.x,ft.y),Ce.push(ft.x,ft.y),w&&Mh(this.layoutVertexExtArray,v.projectTilePoint(Ne.x,Ne.y,a),v.upVector(a,Ne.x,Ne.y))}R&&(ee===0||W)&&(at.length!==0&&re(at,at[0])&&at.pop(),this.groundEffect.addData(at,de,g))}const ke=C0(Ce,Ie);for(let Le=0;Le<ke.length;Le+=3)this.footprintIndices.emplaceBack(be.vertexOffset+ke[Le+0],be.vertexOffset+ke[Le+1],be.vertexOffset+ke[Le+2]),this.indexArray.emplaceBack(ve+ke[Le],ve+ke[Le+2],ve+ke[Le+1]),Te.primitiveLength++;be.indexCount+=ke.length,be.vertexCount+=this.footprintVertices.length-be.vertexOffset}for(let Ce=0;Ce<ne.length;Ce++){const Ie=ne[Ce];A.startRing(P,Ie[0]);let ke=Ie.length>4&&g4(Ie[Ie.length-2],Ie[0],Ie[1]),Le=ee?by(Ie[Ie.length-2],Ie[0],Ie[1],ee):0;const Se=[];let at,rt,Fe;rt=Ie[1].sub(Ie[0])._perp()._unit();let bt=!0;for(let ft=1,lt=0;ft<Ie.length;ft++){let Ne=Ie[ft-1],yt=Ie[ft];const Lt=Ie[ft===Ie.length-1?1:ft+1];if(A.appendEdge(P,yt,Ne),ep(yt,Ne,de)){ee&&(rt=Lt.sub(yt)._perp()._unit(),bt=!bt);continue}const At=yt.sub(Ne)._perp(),Ft=At.x/(Math.abs(At.x)+Math.abs(At.y)),Ot=At.y>0?1:0,Zt=Ne.dist(yt);if(lt+Zt>32768&&(lt=0),ee){Fe=Lt.sub(yt)._perp()._unit();let nr=m4(Ne,yt,Lt,p4(rt,Fe),ee);isNaN(nr)&&(nr=0);const Kt=yt.sub(Ne)._unit();Ne=Ne.add(Kt.mult(Le))._round(),yt=yt.add(Kt.mult(-nr))._round(),Le=nr,rt=Fe,R&&this.zoom>=17&&(re(Se,Ne)||Se.push(Ne),re(Se,yt)||Se.push(yt))}const Tt=Te.vertexLength,wr=Ie.length>4&&g4(Ne,yt,Lt);let vr=y4(lt,ke,bt);if(Ah(this.layoutVertexArray,Ne.x,Ne.y,Ft,Ot,0,0,vr),Ah(this.layoutVertexArray,Ne.x,Ne.y,Ft,Ot,0,1,vr),lt+=Zt,vr=y4(lt,wr,!bt),ke=wr,Ah(this.layoutVertexArray,yt.x,yt.y,Ft,Ot,0,0,vr),Ah(this.layoutVertexArray,yt.x,yt.y,Ft,Ot,0,1,vr),Te.vertexLength+=4,this.indexArray.emplaceBack(Tt+0,Tt+1,Tt+2),this.indexArray.emplaceBack(Tt+1,Tt+3,Tt+2),Te.primitiveLength+=2,ee){const nr=ve+(ft===1?Ie.length-2:ft-2),Kt=ft===1?ve:nr+1;if(this.indexArray.emplaceBack(Tt+1,nr,Tt+3),this.indexArray.emplaceBack(nr,Kt,Tt+3),Te.primitiveLength+=2,at===void 0&&(at=Tt),!ep(Lt,Ie[ft],de)){const or=ft===Ie.length-1?at:Te.vertexLength;this.indexArray.emplaceBack(Tt+2,Tt+3,or),this.indexArray.emplaceBack(Tt+3,or+1,or),this.indexArray.emplaceBack(Tt+3,Kt,or+1),Te.primitiveLength+=3}bt=!bt}if(w){const nr=this.layoutVertexExtArray,Kt=v.projectTilePoint(Ne.x,Ne.y,a),or=v.projectTilePoint(yt.x,yt.y,a),kr=v.upVector(a,Ne.x,Ne.y),Pr=v.upVector(a,yt.x,yt.y);Mh(nr,Kt,kr),Mh(nr,Kt,kr),Mh(nr,or,Pr),Mh(nr,or,Pr)}}S&&(ve+=Ie.length-1),R&&ee&&this.zoom>=17&&(Se.length!==0&&re(Se,Se[0])&&Se.pop(),this.groundEffect.addData(Se,de,g,ee>0))}this.footprintSegments.push(be),we.triangleCount=this.indexArray.length-we.triangleArrayOffset,this.polygonSegments.push(we),++P.footprintSegLen,++P.polygonSegLen}if(P.vertexCount=this.layoutVertexArray.length-P.vertexArrayOffset,P.groundVertexCount=this.groundEffect.vertexArray.length-P.groundVertexArrayOffset,P.vertexCount!==0){if(P.centroidXY=A.borders?l4:this.encodeCentroid(A,P),this.centroidData.push(P),A.borders){this.featuresOnBorder.push(A);const ne=this.featuresOnBorder.length-1;for(let de=0;de<A.borders.length;de++)A.borders[de][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[de].push(ne)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,l,h,a,m),this.groundEffect.addPaintPropertiesData(e,n,l,h,a,m),this.maxHeight=Math.max(this.maxHeight,L)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((r,n)=>this.featuresOnBorder[r].borders[e][0]-this.featuresOnBorder[n].borders[e][0])}splitToSubtiles(){const e=[];for(let f=0;f<this.centroidData.length;f++){const m=this.centroidData[f],g=+(m.min.y+m.max.y>Qe),x=2*g+(+(m.min.x+m.max.x>Qe)^g);for(let v=0;v<m.polygonSegLen;v++){const w=m.polygonSegIdx+v;e.push({centroidIdx:f,subtile:x,polygonSegmentIdx:w,triangleSegmentIdx:this.polygonSegments[w].triangleSegIdx})}}const r=new gi;e.sort((f,m)=>f.triangleSegmentIdx===m.triangleSegmentIdx?f.subtile-m.subtile:f.triangleSegmentIdx-m.triangleSegmentIdx);let n=0,a=0,l=0;for(const f of e){if(f.triangleSegmentIdx!==n)break;l++}const h=e.length;for(;a!==e.length;){n=e[a].triangleSegmentIdx;let f=0,m=a,g=a;for(let x=m;x<l&&e[x].subtile===f;x++)g++;for(;m!==l;){const x=e[m];f=x.subtile;const v=this.centroidData[x.centroidIdx].min.clone(),w=this.centroidData[x.centroidIdx].max.clone(),S={vertexOffset:this.segments.segments[n].vertexOffset,primitiveOffset:r.length,vertexLength:this.segments.segments[n].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let A=m;A<g;A++){const P=e[A],R=this.polygonSegments[P.polygonSegmentIdx],L=this.centroidData[P.centroidIdx].min,V=this.centroidData[P.centroidIdx].max,q=this.indexArray.uint16;for(let G=R.triangleArrayOffset;G<R.triangleArrayOffset+R.triangleCount;G++)r.emplaceBack(q[3*G],q[3*G+1],q[3*G+2]);S.primitiveLength+=R.triangleCount,v.x=Math.min(v.x,L.x),v.y=Math.min(v.y,L.y),w.x=Math.max(w.x,V.x),w.y=Math.max(w.y,V.y)}S.primitiveLength>0&&this.triangleSubSegments.push({segment:S,min:v,max:w}),m=g;for(let A=m;A<l&&e[A].subtile===e[m].subtile;A++)g++}a=l;for(let x=a;x<h&&e[x].triangleSegmentIdx===e[a].triangleSegmentIdx;x++)l++}r._trim(),this.indexArray=r}getVisibleSegments(e,r,n){let a=0,l=0;const h=1<<e.canonical.z;if(r){const P=r.getMinMaxForTile(e);P&&(a=P.min,l=P.max)}l+=this.maxHeight;const f=e.toUnwrapped();let m;const g=[f.canonical.x/h+f.wrap,f.canonical.y/h],x=[(f.canonical.x+1)/h+f.wrap,(f.canonical.y+1)/h],v=new ni,w=(P,R,L)=>[P[0]*(1-L[0])+R[0]*L[0],P[1]*(1-L[1])+R[1]*L[1]],S=[],A=[];for(const P of this.triangleSubSegments){S[0]=P.min.x/Qe,S[1]=P.min.y/Qe,A[0]=P.max.x/Qe,A[1]=P.max.y/Qe;const R=w(g,x,S),L=w(g,x,A);if(new jr([R[0],R[1],a],[L[0],L[1],l]).intersectsPrecise(n)===0){m&&(v.segments.push(m),m=void 0);continue}const V=P.segment;m&&m.vertexOffset!==V.vertexOffset&&(v.segments.push(m),m=void 0),m?(m.vertexLength+=V.vertexLength,m.primitiveLength+=V.primitiveLength):m={vertexOffset:V.vertexOffset,primitiveLength:V.primitiveLength,vertexLength:V.vertexLength,primitiveOffset:V.primitiveOffset,sortKey:void 0,vaos:{}}}return m&&v.segments.push(m),v}encodeCentroid(e,r){const n=e.centroid(),a=r.span(),l=Math.min(7,Math.round(a.x*this.tileToMeter/10)),h=Math.min(7,Math.round(a.y*this.tileToMeter/10));return new He(Ht(n.x,1,Qe-1)<<3|l,Ht(n.y,1,Qe-1)<<3|h)}encodeBorderCentroid(e){if(!e.borders)return new He(0,0);const r=e.borders,n=Number.MAX_VALUE;if(r[0][0]!==n||r[1][0]!==n){const a=r[0][0]!==n?0:1;return new He(6|(r[0][0]!==n?0:65528),(r[a][0]+r[a][1])/2<<3|6)}{const a=r[2][0]!==n?2:3;return new He((r[a][0]+r[a][1])/2<<3|6,6|(r[2][0]!==n?0:65528))}}showCentroid(e){const r=this.centroidData[e.centroidDataIndex];r.flags&=ia,r.centroidXY.x=0,r.centroidXY.y=0,this.writeCentroidToBuffer(r)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const r=e.vertexArrayOffset,n=e.vertexCount+e.vertexArrayOffset,a=e.flags&ia?l4:e.centroidXY,l=this.centroidVertexArray.geta_centroid_pos0(r);if(this.centroidVertexArray.geta_centroid_pos1(r)!==a.y||l!==a.x){for(let h=r;h<n;++h)this.centroidVertexArray.emplace(h,a.x,a.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,r){if(r.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=r.updateTime;const n=r.getReplacementRegionsForTile(e.toUnwrapped());if(function(l,h){if(l.length!==h.length)return!1;for(let f=0;f<l.length;f++)if(l[f].sourceId!==h[f].sourceId||!X_(l[f],h[f]))return!1;return!0}(this.activeReplacements,n))return;if(this.activeReplacements=n,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const l of this.centroidData)l.flags&=2147483647;const a=[];for(const l of this.activeReplacements){const h=Math.pow(2,l.footprintTileId.canonical.z-e.canonical.z);for(const f of this.centroidData)if(!(f.flags&ia||l.min.x>f.max.x||f.min.x>l.max.x||l.min.y>f.max.y||f.min.y>l.max.y))for(let m=0;m<f.footprintSegLen;m++){const g=this.footprintSegments[f.footprintSegIdx+m];if(a.length=0,wy(this.footprintVertices,g.vertexOffset,g.vertexCount,l.footprintTileId.canonical,e.canonical,a),K_(l.footprint,a,this.footprintIndices.uint16,g.indexOffset,g.indexCount,-g.vertexOffset,-h)){f.flags|=ia;break}}}for(const l of this.centroidData)this.writeCentroidToBuffer(l);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,r,n){let a=!1;for(let l=0;l<n.footprintSegLen;l++){const h=this.footprintSegments[n.footprintSegIdx+l];let f=0;for(const m of h.ringIndices){for(let g=f,x=m+f-1;g<m+f;x=g++){const v=this.footprintVertices.int16[2*(g+h.vertexOffset)+0],w=this.footprintVertices.int16[2*(g+h.vertexOffset)+1],S=this.footprintVertices.int16[2*(x+h.vertexOffset)+1];w>r!=S>r&&e<(this.footprintVertices.int16[2*(x+h.vertexOffset)+0]-v)*(r-w)/(S-w)+v&&(a=!a)}f=m}}return a}getHeightAtTileCoord(e,r){let n=Number.NEGATIVE_INFINITY,a=!0;const l=4*(e+Qe)*Qe+(r+Qe);if(this.partLookup.hasOwnProperty(l)){const h=this.partLookup[l];return h?{height:h.height,hidden:!!(h.flags&ia)}:void 0}for(const h of this.centroidData)e>h.max.x||h.min.x>e||r>h.max.y||h.min.y>r||this.footprintContainsPoint(e,r,h)&&h&&h.height>n&&(n=h.height,this.partLookup[l]=h,a=!!(h.flags&ia));if(n!==Number.NEGATIVE_INFINITY)return{height:n,hidden:a};this.partLookup[l]=void 0}}function p4(t,e){const r=t.add(e)._unit();return t.x*r.x+t.y*r.y}function by(t,e,r,n){const a=e.sub(t)._perp()._unit(),l=r.sub(e)._perp()._unit();return m4(t,e,r,p4(a,l),n)}function m4(t,e,r,n,a){const l=Math.sqrt(1-n*n);return Math.min(t.dist(e)/3,e.dist(r)/3,a*l/n)}function ep(t,e,r){return t.x<r[0].x&&e.x<r[0].x||t.x>r[1].x&&e.x>r[1].x||t.y<r[0].y&&e.y<r[0].y||t.y>r[1].y&&e.y>r[1].y}function _4(t,e){return t.x<e[0].x||t.x>e[1].x||t.y<e[0].y||t.y>e[1].y}function g4(t,e,r){if(t.x<0||t.x>=Qe||e.x<0||e.x>=Qe||r.x<0||r.x>=Qe)return!1;const n=r.sub(e),a=n.perp(),l=t.sub(e);return(n.x*l.x+n.y*l.y)/Math.sqrt((n.x*n.x+n.y*n.y)*(l.x*l.x+l.y*l.y))>-.866&&a.x*l.x+a.y*l.y<0}function y4(t,e,r){const n=e?2|t:-3&t;return r?1|n:-2&n}function x4(){const t=Math.PI/32,e=Math.tan(t),r=Rc;return r*Math.sqrt(1+2*e*e)-r}function v4(t,e,r){const n=1<<r.z,a=vn(r.x/n),l=vn((r.x+1)/n),h=zi(r.y/n),f=zi((r.y+1)/n);return function(m,g,x,v,w=0,S){const A=[];if(!m.length||!x||!v)return A;const P=(W,re)=>{for(const ne of W)A.push({polygon:ne,bounds:re})},R=Math.ceil(Math.log2(x)),L=Math.ceil(Math.log2(v)),V=R-L,q=[];for(let W=0;W<Math.abs(V);W++)q.push(V>0?0:1);for(let W=0;W<Math.min(R,L);W++)q.push(0),q.push(1);let G=m;if(G=R0(G,g[0].y-w,g[1].y+w,1),G=R0(G,g[0].x-w,g[1].x+w,0),!G.length)return A;const ee=[];for(q.length?ee.push({polygons:G,bounds:g,depth:0}):P(G,g);ee.length;){const W=ee.pop(),re=W.depth,ne=q[re],de=W.bounds[0],ve=W.bounds[1],pe=ne===0?de.x:de.y,Te=ne===0?ve.x:ve.y,we=S?S(ne,pe,Te):.5*(pe+Te),be=R0(W.polygons,pe-w,we+w,ne),Ce=R0(W.polygons,we-w,Te+w,ne);if(be.length){const Ie=[de,new He(ne===0?we:ve.x,ne===1?we:ve.y)];q.length>re+1?ee.push({polygons:be,bounds:Ie,depth:re+1}):P(be,Ie)}if(Ce.length){const Ie=[new He(ne===0?we:de.x,ne===1?we:de.y),ve];q.length>re+1?ee.push({polygons:Ce,bounds:Ie,depth:re+1}):P(Ce,Ie)}}return A}(t,e,Math.ceil((l-a)/11.25),Math.ceil((h-f)/11.25),1,(m,g,x)=>{if(m===0)return .5*(g+x);{const v=zi((r.y+g/Qe)/n);return(us(.5*(zi((r.y+x/Qe)/n)+v))*n-r.y)*Qe}})}function wy(t,e,r,n,a,l){const h=Math.pow(2,n.z-a.z);for(let f=0;f<r;f++){let m=t.int16[2*(f+e)+0],g=t.int16[2*(f+e)+1];m=(m+a.x*Qe)*h-n.x*Qe,g=(g+a.y*Qe)*h-n.y*Qe,l.push(new He(m,g))}}nt(B0,"FillExtrusionBucket",{omit:["layers","features"]}),nt(u4,"PartData"),nt(c4,"FootprintSegment"),nt(h4,"BorderCentroidData"),nt(f4,"GroundEffect");const Ty=new ue({visibility:new oe(X["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new oe(X["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var Sy={paint:new ue({"fill-extrusion-opacity":new oe(X["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new fe(X["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new oe(X["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new oe(X["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new fe(X["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new fe(X["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new fe(X["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new oe(X["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new oe(X["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new oe(X["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new oe(X["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new oe(X["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new oe(X["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new oe(X["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new oe(X["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new fe(X["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new fe(X["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new oe(X["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new oe(X["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new oe(X["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new oe(X["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new oe(X["paint_fill-extrusion"]["fill-extrusion-emissive-strength"])}),layout:Ty};class Nc extends He{constructor(e,r,n){super(e,r),this.z=n}}function Ih(t,e){return t.x*e.x+t.y*e.y}function b4(t,e){if(t.length===1){let r=0;const n=e[r++];let a;for(;!a||n.equals(a);)if(a=e[r++],!a)return 1/0;for(;r<e.length;r++){const l=e[r],h=t[0],f=a.sub(n),m=l.sub(n),g=h.sub(n),x=Ih(f,f),v=Ih(f,m),w=Ih(m,m),S=Ih(g,f),A=Ih(g,m),P=x*w-v*v,R=(w*S-v*A)/P,L=(x*A-v*S)/P,V=n.z*(1-R-L)+a.z*R+l.z*L;if(isFinite(V))return V}return 1/0}{let r=1/0;for(const n of e)r=Math.min(r,n.z);return r}}function w4(t,e,r,n,a,l,h,f){const m=h*a.getElevationAt(t,e,!0,!0),g=l[0]!==0,x=g?l[1]===0?h*(l[0]/7-450):h*function(v,w,S){const A=Math.floor(w[0]/8),P=Math.floor(w[1]/8),R=10*(w[0]-8*A),L=10*(w[1]-8*P),V=v.getElevationAt(A,P,!0,!0),q=v.getMeterToDEM(S),G=Math.floor(.5*(R*q-1)),ee=Math.floor(.5*(L*q-1)),W=v.tileCoordToPixel(A,P),re=2*G+1,ne=2*ee+1,de=function(Ce,Ie,ke,Le,Se){return[Ce.getElevationAtPixel(Ie,ke,!0),Ce.getElevationAtPixel(Ie+Se,ke,!0),Ce.getElevationAtPixel(Ie,ke+Se,!0),Ce.getElevationAtPixel(Ie+Le,ke+Se,!0)]}(v,W.x-G,W.y-ee,re,ne),ve=Math.abs(de[0]-de[1]),pe=Math.abs(de[2]-de[3]),Te=Math.abs(de[0]-de[2])+Math.abs(de[1]-de[3]),we=Math.min(.25,.5*q*(ve+pe)/re),be=Math.min(.25,.5*q*Te/ne);return V+Math.max(we*R,be*L)}(a,l,f):m;return{base:m+(r===0)?-1:r,top:g?Math.max(x+n,m+r+2):m+n}}const Ey=Rt([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Ay}=Ey,My=Rt([{name:"a_packed",components:4,type:"Float32"}]),{members:Iy}=My,Py=Rt([{name:"a_pattern_data",components:2,type:"Float32"}]),{members:Cy}=Py;class T4{constructor(e,r){this.width=e,this.height=r,this.nextRow=0,this.image=new ta({width:e,height:r}),this.positions={},this.uploaded=!1}getDash(e,r){const n=this.getKey(e,r);return this.positions[n]}trim(){const e=this.width,r=this.height=wu(this.nextRow);this.image.resize({width:e,height:r})}getKey(e,r){return e.join(",")+r}getDashRanges(e,r,n){const a=[];let l=e.length%2==1?-e[e.length-1]*n:0,h=e[0]*n,f=!0;a.push({left:l,right:h,isDash:f,zeroLength:e[0]===0});let m=e[0];for(let g=1;g<e.length;g++){f=!f;const x=e[g];l=m*n,m+=x,h=m*n,a.push({left:l,right:h,isDash:f,zeroLength:x===0})}return a}addRoundDash(e,r,n){const a=r/2;for(let l=-n;l<=n;l++){const h=this.width*(this.nextRow+n+l);let f=0,m=e[f];for(let g=0;g<this.width;g++){g/m.right>1&&(m=e[++f]);const x=Math.abs(g-m.left),v=Math.abs(g-m.right),w=Math.min(x,v);let S;const A=l/n*(a+1);if(m.isDash){const P=a-Math.abs(A);S=Math.sqrt(w*w+P*P)}else S=a-Math.sqrt(w*w+A*A);this.image.data[h+g]=Math.max(0,Math.min(255,S+128))}}}addRegularDash(e,r){for(let m=e.length-1;m>=0;--m){const g=e[m],x=e[m+1];g.zeroLength?e.splice(m,1):x&&x.isDash===g.isDash&&(x.left=g.left,e.splice(m,1))}const n=e[0],a=e[e.length-1];n.isDash===a.isDash&&(n.left=a.left-this.width,a.right=n.right+this.width);const l=this.width*this.nextRow;let h=0,f=e[h];for(let m=0;m<this.width;m++){m/f.right>1&&(f=e[++h]);const g=Math.abs(m-f.left),x=Math.abs(m-f.right),v=Math.min(g,x);this.image.data[l+m]=Math.max(0,Math.min(255,(f.isDash?v:-v)+r+128))}}addDash(e,r){const n=this.getKey(e,r);if(this.positions[n])return this.positions[n];const a=r==="round",l=a?7:0,h=2*l+1;if(this.nextRow+h>this.height)return Qr("LineAtlas out of space"),null;e.length===0&&e.push(1);let f=0;for(let x=0;x<e.length;x++)e[x]<0&&(Qr("Negative value is found in line dasharray, replacing values with 0"),e[x]=0),f+=e[x];if(f!==0){const x=this.width/f,v=this.getDashRanges(e,this.width,x);a?this.addRoundDash(v,x,l):this.addRegularDash(v,r==="square"?.5*x:0)}const m=this.nextRow+l;this.nextRow+=h;const g={tl:[m,l],br:[f,0]};return this.positions[n]=g,g}}nt(T4,"LineAtlas");const Dy=z0.types,zy=Math.cos(Math.PI/180*37.5),Ry=Math.cos(Math.PI/180*5);class tp{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new Fi,this.layoutVertexArray2=new _i,this.patternVertexArray=new Ti,this.indexArray=new gi,this.programConfigurations=new Xs(e.layers,e.zoom),this.segments=new ni,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,n,a){this.hasPattern=Xf("line",this.layers,r);const l=this.layers[0].layout.get("line-sort-key"),h=[];for(const{feature:x,id:v,index:w,sourceLayerIndex:S}of e){const A=this.layers[0]._featureFilter.needGeometry,P=Ks(x,A);if(!this.layers[0]._featureFilter.filter(new N(this.zoom),P,n))continue;const R=l?l.evaluate(P,{},n):void 0,L={id:v,properties:x.properties,type:x.type,sourceLayerIndex:S,index:w,geometry:A?P.geometry:hs(x,n,a),patterns:{},sortKey:R};h.push(L)}l&&h.sort((x,v)=>x.sortKey-v.sortKey);const{lineAtlas:f,featureIndex:m}=r,g=this.addConstantDashes(f);for(const x of h){const{geometry:v,index:w,sourceLayerIndex:S}=x;if(g&&this.addFeatureDashes(x,f),this.hasPattern){const A=Yf("line",this.layers,x,this.zoom,r);this.patternFeatures.push(A)}else this.addFeature(x,v,w,n,f.positions,r.availableImages,r.brightness);m.insert(e[w].feature,v,w,S,this.index)}}addConstantDashes(e){let r=!1;for(const n of this.layers){const a=n.paint.get("line-dasharray").value,l=n.layout.get("line-cap").value;if(a.kind!=="constant"||l.kind!=="constant")r=!0;else{const h=l.value,f=a.value;if(!f)continue;e.addDash(f,h)}}return r}addFeatureDashes(e,r){const n=this.zoom;for(const a of this.layers){const l=a.paint.get("line-dasharray").value,h=a.layout.get("line-cap").value;if(l.kind==="constant"&&h.kind==="constant")continue;let f,m;if(l.kind==="constant"){if(f=l.value,!f)continue}else f=l.evaluate({zoom:n},e);m=h.kind==="constant"?h.value:h.evaluate({zoom:n},e),r.addDash(f,m),e.patterns[a.id]=r.getKey(f,m)}}update(e,r,n,a,l){const h=Object.keys(e).length!==0;h&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,r,h?this.stateDependentLayers:this.layers,n,a,l)}addFeatures(e,r,n,a,l,h){for(const f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,r,n,a,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Iy)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,Cy)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ay),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,n,a,l,h,f){const m=this.layers[0].layout,g=m.get("line-join").evaluate(e,{}),x=m.get("line-cap").evaluate(e,{}),v=m.get("line-miter-limit"),w=m.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const S of r)this.addLine(S,e,g,x,v,w);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,l,h,a,f)}addLine(e,r,n,a,l,h){this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0;const f=n==="none";if(this.patternJoinNone=this.hasPattern&&f,this.segmentStart=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let V=0;V<e.length-1;V++)this.totalDistance+=e[V].dist(e[V+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const m=Dy[r.type]==="Polygon";let g=e.length;for(;g>=2&&e[g-1].equals(e[g-2]);)g--;let x=0;for(;x<g-1&&e[x].equals(e[x+1]);)x++;if(g<(m?3:2))return;n==="bevel"&&(l=1.05);const v=this.overscaling<=16?15*Qe/(512*this.overscaling):0,w=this.segments.prepareSegment(10*g,this.layoutVertexArray,this.indexArray);let S,A,P,R,L;this.e1=this.e2=-1,m&&(S=e[g-2],L=e[x].sub(S)._unit()._perp());for(let V=x;V<g;V++){if(P=V===g-1?m?e[x+1]:void 0:e[V+1],P&&e[V].equals(P))continue;L&&(R=L),S&&(A=S),S=e[V],L=P?P.sub(S)._unit()._perp():R,R=R||L;const q=A&&P;let G=q?n:m||f?"butt":a;const ee=R.x*L.x+R.y*L.y;if(f){const Te=function(we){if(we.patternJoinNone){const be=we.segmentPoints.length/2,Ce=we.lineSoFar-we.segmentStart;for(let Ie=0;Ie<be;++Ie){const ke=we.segmentPoints[2*Ie+1],Le=Math.round(we.segmentPoints[2*Ie])+.5+.25*ke;we.patternVertexArray.emplaceBack(Le,Ce),we.patternVertexArray.emplaceBack(Le,Ce)}we.segmentPoints=[],we.segmentStart=we.lineSoFar}we.e1=we.e2=-1};if(q&&ee<Ry){this.updateDistance(A,S),this.addCurrentVertex(S,R,1,1,w),Te(this),this.addCurrentVertex(S,L,-1,-1,w);continue}if(A){if(!P){this.updateDistance(A,S),this.addCurrentVertex(S,R,1,1,w),Te(this);continue}G="miter"}}let W=R.add(L);W.x===0&&W.y===0||W._unit();const re=W.x*L.x+W.y*L.y,ne=re!==0?1/re:1/0,de=2*Math.sqrt(2-2*re),ve=re<zy&&A&&P,pe=R.x*L.y-R.y*L.x>0;if(ve&&V>x){const Te=S.dist(A);if(Te>2*v){const we=S.sub(S.sub(A)._mult(v/Te)._round());this.updateDistance(A,we),this.addCurrentVertex(we,R,0,0,w),A=we}}if(q&&G==="round"&&(ne<h?G="miter":ne<=2&&(G="fakeround")),G==="miter"&&ne>l&&(G="bevel"),G==="bevel"&&(ne>2&&(G="flipbevel"),ne<l&&(G="miter")),A&&this.updateDistance(A,S),G==="miter")W._mult(ne),this.addCurrentVertex(S,W,0,0,w);else if(G==="flipbevel"){if(ne>100)W=L.mult(-1);else{const Te=ne*R.add(L).mag()/R.sub(L).mag();W._perp()._mult(Te*(pe?-1:1))}this.addCurrentVertex(S,W,0,0,w),this.addCurrentVertex(S,W.mult(-1),0,0,w)}else if(G==="bevel"||G==="fakeround"){const Te=-Math.sqrt(ne*ne-1),we=pe?Te:0,be=pe?0:Te;if(A&&this.addCurrentVertex(S,R,we,be,w),G==="fakeround"){const Ce=Math.round(180*de/Math.PI/20);for(let Ie=1;Ie<Ce;Ie++){let ke=Ie/Ce;if(ke!==.5){const Se=ke-.5;ke+=ke*Se*(ke-1)*((1.0904+ee*(ee*(3.55645-1.43519*ee)-3.2452))*Se*Se+(.848013+ee*(.215638*ee-1.06021)))}const Le=L.sub(R)._mult(ke)._add(R)._unit()._mult(pe?-1:1);this.addHalfVertex(S,Le.x,Le.y,!1,pe,0,w)}}P&&this.addCurrentVertex(S,L,-we,-be,w)}else G==="butt"?this.addCurrentVertex(S,W,0,0,w):G==="square"?(A||this.addCurrentVertex(S,W,-1,-1,w),this.addCurrentVertex(S,W,0,0,w),A&&this.addCurrentVertex(S,W,1,1,w)):G==="round"&&(A&&(this.addCurrentVertex(S,R,0,0,w),this.addCurrentVertex(S,R,1,1,w,!0)),P&&(this.addCurrentVertex(S,L,-1,-1,w,!0),this.addCurrentVertex(S,L,0,0,w)));if(ve&&V<g-1){const Te=S.dist(P);if(Te>2*v){const we=S.add(P.sub(S)._mult(v/Te)._round());this.updateDistance(S,we),this.addCurrentVertex(we,L,0,0,w),S=we}}}}addCurrentVertex(e,r,n,a,l,h=!1){const f=r.y*a-r.x,m=-r.y-r.x*a;this.addHalfVertex(e,r.x+r.y*n,r.y-r.x*n,h,!1,n,l),this.addHalfVertex(e,f,m,h,!0,-a,l),this.patternJoinNone&&this.segmentPoints.push(this.lineSoFar-this.segmentStart,n)}addHalfVertex({x:e,y:r},n,a,l,h,f,m){this.layoutVertexArray.emplaceBack((e<<1)+(l?1:0),(r<<1)+(h?1:0),Math.round(63*n)+128,Math.round(63*a)+128,1+(f===0?0:f<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const g=m.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,g),m.primitiveLength++),h?this.e2=g:this.e1=g}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,r){this.distance+=e.dist(r),this.updateScaledDistance()}}nt(tp,"LineBucket",{omit:["layers","patternFeatures"]});const Ly=new ue({"line-cap":new fe(X.layout_line["line-cap"]),"line-join":new fe(X.layout_line["line-join"]),"line-miter-limit":new oe(X.layout_line["line-miter-limit"]),"line-round-limit":new oe(X.layout_line["line-round-limit"]),"line-sort-key":new fe(X.layout_line["line-sort-key"]),visibility:new oe(X.layout_line.visibility)});var S4={paint:new ue({"line-opacity":new fe(X.paint_line["line-opacity"]),"line-color":new fe(X.paint_line["line-color"]),"line-translate":new oe(X.paint_line["line-translate"]),"line-translate-anchor":new oe(X.paint_line["line-translate-anchor"]),"line-width":new fe(X.paint_line["line-width"]),"line-gap-width":new fe(X.paint_line["line-gap-width"]),"line-offset":new fe(X.paint_line["line-offset"]),"line-blur":new fe(X.paint_line["line-blur"]),"line-dasharray":new fe(X.paint_line["line-dasharray"]),"line-pattern":new fe(X.paint_line["line-pattern"]),"line-gradient":new Re(X.paint_line["line-gradient"]),"line-trim-offset":new oe(X.paint_line["line-trim-offset"]),"line-emissive-strength":new oe(X.paint_line["line-emissive-strength"]),"line-border-width":new fe(X.paint_line["line-border-width"]),"line-border-color":new fe(X.paint_line["line-border-color"])}),layout:Ly};function E4(t,e,r){return e*(Qe/(t.tileSize*Math.pow(2,r-t.tileID.overscaledZ)))}function A4(t,e){return 1/E4(t,1,e.tileZoom)}function M4(t,e,r,n){return t.translatePosMatrix(n||e.tileID.projMatrix,e,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"))}const I4=t=>{const e=[];P4(t)&&e.push("RENDER_LINE_DASH"),t.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const r=t.paint.get("line-trim-offset");r[0]===0&&r[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),t.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");const n=t.layout.get("line-join").constantOr("miter")==="none",a=!!t.paint.get("line-pattern").constantOr(1);return n&&a&&e.push("LINE_JOIN_NONE"),e};function P4(t){const e=t.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}const C4=new class extends fe{possiblyEvaluate(t,e){return e=new N(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,r,n){return e=gn({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,r,n)}}(S4.paint.properties["line-width"].specification);function D4(t,e){return e>0?e+2*t:t}C4.useIntegerZoom=!0;const Oy=Rt([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),ky=Rt([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),By=Rt([{name:"a_projected_pos",components:4,type:"Float32"}],4);Rt([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Fy=Rt([{name:"a_z_offset",components:1,type:"Float32"}],4),Ny=Rt([{name:"a_texb",components:2,type:"Uint16"}]),Vy=Rt([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),Uy=Rt([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_z_offset",components:1,type:"Float32"}]);Rt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const z4=Rt([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),jy=Rt([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Rt([{name:"triangle",components:3,type:"Uint16"}]),Rt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Rt([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),Rt([{type:"Float32",name:"offsetX"}]),Rt([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Ri=24;const co=128;function rp(t,e){const{expression:r}=e;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new N(t+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:n,interpolationType:a}=r;let l=0;for(;l<n.length&&n[l]<=t;)l++;l=Math.max(0,l-1);let h=l;for(;h<n.length&&n[h]<t+1;)h++;h=Math.min(n.length-1,h);const f=n[l],m=n[h];return r.kind==="composite"?{kind:"composite",minZoom:f,maxZoom:m,interpolationType:a}:{kind:"camera",minZoom:f,maxZoom:m,minSize:r.evaluate(new N(f)),maxSize:r.evaluate(new N(m)),interpolationType:a}}}function F0(t,{uSize:e,uSizeT:r},{lowerSize:n,upperSize:a}){return t.kind==="source"?n/co:t.kind==="composite"?jt(n/co,a/co,r):e}function Vc(t,e){let r=0,n=0;if(t.kind==="constant")n=t.layoutSize;else if(t.kind!=="source"){const{interpolationType:a,minZoom:l,maxZoom:h}=t,f=a?Ht(fn.interpolationFactor(a,e,l,h),0,1):0;t.kind==="camera"?n=jt(t.minSize,t.maxSize,f):r=f}return{uSizeT:r,uSize:n}}var Gy=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:co,evaluateSizeForFeature:F0,evaluateSizeForZoom:Vc,getSizeData:rp});function $y(t,e,r){return t.sections.forEach(n=>{n.text=function(a,l,h){const f=l.layout.get("text-transform").evaluate(h,{});return f==="uppercase"?a=a.toLocaleUpperCase():f==="lowercase"&&(a=a.toLocaleLowerCase()),Y.applyArabicShaping&&(a=Y.applyArabicShaping(a)),a}(n.text,e,r)}),t}const Ph={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function qy(t){return t==="︶"||t==="﹈"||t==="︸"||t==="﹄"||t==="﹂"||t==="︾"||t==="︼"||t==="︺"||t==="︘"||t==="﹀"||t==="︐"||t==="︓"||t==="︔"||t==="｀"||t==="￣"||t==="︑"||t==="︒"}function Zy(t){return t==="︵"||t==="﹇"||t==="︷"||t==="﹃"||t==="﹁"||t==="︽"||t==="︻"||t==="︹"||t==="︗"||t==="︿"}var Wy={read:function(t,e,r,n,a){var l,h,f=8*a-n-1,m=(1<<f)-1,g=m>>1,x=-7,v=r?a-1:0,w=r?-1:1,S=t[e+v];for(v+=w,l=S&(1<<-x)-1,S>>=-x,x+=f;x>0;l=256*l+t[e+v],v+=w,x-=8);for(h=l&(1<<-x)-1,l>>=-x,x+=n;x>0;h=256*h+t[e+v],v+=w,x-=8);if(l===0)l=1-g;else{if(l===m)return h?NaN:1/0*(S?-1:1);h+=Math.pow(2,n),l-=g}return(S?-1:1)*h*Math.pow(2,l-n)},write:function(t,e,r,n,a,l){var h,f,m,g=8*l-a-1,x=(1<<g)-1,v=x>>1,w=a===23?Math.pow(2,-24)-Math.pow(2,-77):0,S=n?0:l-1,A=n?1:-1,P=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(f=isNaN(e)?1:0,h=x):(h=Math.floor(Math.log(e)/Math.LN2),e*(m=Math.pow(2,-h))<1&&(h--,m*=2),(e+=h+v>=1?w/m:w*Math.pow(2,1-v))*m>=2&&(h++,m/=2),h+v>=x?(f=0,h=x):h+v>=1?(f=(e*m-1)*Math.pow(2,a),h+=v):(f=e*Math.pow(2,v-1)*Math.pow(2,a),h=0));a>=8;t[r+S]=255&f,S+=A,f/=256,a-=8);for(h=h<<a|f,g+=a;g>0;t[r+S]=255&h,S+=A,h/=256,g-=8);t[r+S-A]|=128*P}},R4=Gr,N0=Wy;function Gr(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}Gr.Varint=0,Gr.Fixed64=1,Gr.Bytes=2,Gr.Fixed32=5;var ip=4294967296,L4=1/ip,O4=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function fs(t){return t.type===Gr.Bytes?t.readVarint()+t.pos:t.pos+1}function Uc(t,e,r){return r?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function k4(t,e,r){var n=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(n);for(var a=r.pos-1;a>=t;a--)r.buf[a+n]=r.buf[a]}function Hy(t,e){for(var r=0;r<t.length;r++)e.writeVarint(t[r])}function Qy(t,e){for(var r=0;r<t.length;r++)e.writeSVarint(t[r])}function Xy(t,e){for(var r=0;r<t.length;r++)e.writeFloat(t[r])}function Yy(t,e){for(var r=0;r<t.length;r++)e.writeDouble(t[r])}function Jy(t,e){for(var r=0;r<t.length;r++)e.writeBoolean(t[r])}function Ky(t,e){for(var r=0;r<t.length;r++)e.writeFixed32(t[r])}function e9(t,e){for(var r=0;r<t.length;r++)e.writeSFixed32(t[r])}function t9(t,e){for(var r=0;r<t.length;r++)e.writeFixed64(t[r])}function r9(t,e){for(var r=0;r<t.length;r++)e.writeSFixed64(t[r])}function V0(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function jc(t,e,r){t[r]=e,t[r+1]=e>>>8,t[r+2]=e>>>16,t[r+3]=e>>>24}function B4(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}Gr.prototype={destroy:function(){this.buf=null},readFields:function(t,e,r){for(r=r||this.length;this.pos<r;){var n=this.readVarint(),a=n>>3,l=this.pos;this.type=7&n,t(a,e,this),this.pos===l&&this.skip(n)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=V0(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=B4(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=V0(this.buf,this.pos)+V0(this.buf,this.pos+4)*ip;return this.pos+=8,t},readSFixed64:function(){var t=V0(this.buf,this.pos)+B4(this.buf,this.pos+4)*ip;return this.pos+=8,t},readFloat:function(){var t=N0.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=N0.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,r,n=this.buf;return e=127&(r=n[this.pos++]),r<128?e:(e|=(127&(r=n[this.pos++]))<<7,r<128?e:(e|=(127&(r=n[this.pos++]))<<14,r<128?e:(e|=(127&(r=n[this.pos++]))<<21,r<128?e:function(a,l,h){var f,m,g=h.buf;if(f=(112&(m=g[h.pos++]))>>4,m<128||(f|=(127&(m=g[h.pos++]))<<3,m<128)||(f|=(127&(m=g[h.pos++]))<<10,m<128)||(f|=(127&(m=g[h.pos++]))<<17,m<128)||(f|=(127&(m=g[h.pos++]))<<24,m<128)||(f|=(1&(m=g[h.pos++]))<<31,m<128))return Uc(a,f,l);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=n[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&O4?function(r,n,a){return O4.decode(r.subarray(n,a))}(this.buf,e,t):function(r,n,a){for(var l="",h=n;h<a;){var f,m,g,x=r[h],v=null,w=x>239?4:x>223?3:x>191?2:1;if(h+w>a)break;w===1?x<128&&(v=x):w===2?(192&(f=r[h+1]))==128&&(v=(31&x)<<6|63&f)<=127&&(v=null):w===3?(m=r[h+2],(192&(f=r[h+1]))==128&&(192&m)==128&&((v=(15&x)<<12|(63&f)<<6|63&m)<=2047||v>=55296&&v<=57343)&&(v=null)):w===4&&(m=r[h+2],g=r[h+3],(192&(f=r[h+1]))==128&&(192&m)==128&&(192&g)==128&&((v=(15&x)<<18|(63&f)<<12|(63&m)<<6|63&g)<=65535||v>=1114112)&&(v=null)),v===null?(v=65533,w=1):v>65535&&(v-=65536,l+=String.fromCharCode(v>>>10&1023|55296),v=56320|1023&v),l+=String.fromCharCode(v),h+=w}return l}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==Gr.Bytes)return t.push(this.readVarint(e));var r=fs(this);for(t=t||[];this.pos<r;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==Gr.Bytes)return t.push(this.readSVarint());var e=fs(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==Gr.Bytes)return t.push(this.readBoolean());var e=fs(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==Gr.Bytes)return t.push(this.readFloat());var e=fs(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==Gr.Bytes)return t.push(this.readDouble());var e=fs(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==Gr.Bytes)return t.push(this.readFixed32());var e=fs(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==Gr.Bytes)return t.push(this.readSFixed32());var e=fs(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==Gr.Bytes)return t.push(this.readFixed64());var e=fs(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==Gr.Bytes)return t.push(this.readSFixed64());var e=fs(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===Gr.Varint)for(;this.buf[this.pos++]>127;);else if(e===Gr.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Gr.Fixed32)this.pos+=4;else{if(e!==Gr.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),jc(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),jc(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),jc(this.buf,-1&t,this.pos),jc(this.buf,Math.floor(t*L4),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),jc(this.buf,-1&t,this.pos),jc(this.buf,Math.floor(t*L4),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(e,r){var n,a;if(e>=0?(n=e%4294967296|0,a=e/4294967296|0):(a=~(-e/4294967296),4294967295^(n=~(-e%4294967296))?n=n+1|0:(n=0,a=a+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(l,h,f){f.buf[f.pos++]=127&l|128,l>>>=7,f.buf[f.pos++]=127&l|128,l>>>=7,f.buf[f.pos++]=127&l|128,l>>>=7,f.buf[f.pos++]=127&l|128,f.buf[f.pos]=127&(l>>>=7)}(n,0,r),function(l,h){var f=(7&l)<<4;h.buf[h.pos++]|=f|((l>>>=3)?128:0),l&&(h.buf[h.pos++]=127&l|((l>>>=7)?128:0),l&&(h.buf[h.pos++]=127&l|((l>>>=7)?128:0),l&&(h.buf[h.pos++]=127&l|((l>>>=7)?128:0),l&&(h.buf[h.pos++]=127&l|((l>>>=7)?128:0),l&&(h.buf[h.pos++]=127&l)))))}(a,r)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(!!t)},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(n,a,l){for(var h,f,m=0;m<a.length;m++){if((h=a.charCodeAt(m))>55295&&h<57344){if(!f){h>56319||m+1===a.length?(n[l++]=239,n[l++]=191,n[l++]=189):f=h;continue}if(h<56320){n[l++]=239,n[l++]=191,n[l++]=189,f=h;continue}h=f-55296<<10|h-56320|65536,f=null}else f&&(n[l++]=239,n[l++]=191,n[l++]=189,f=null);h<128?n[l++]=h:(h<2048?n[l++]=h>>6|192:(h<65536?n[l++]=h>>12|224:(n[l++]=h>>18|240,n[l++]=h>>12&63|128),n[l++]=h>>6&63|128),n[l++]=63&h|128)}return l}(this.buf,t,this.pos);var r=this.pos-e;r>=128&&k4(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(t){this.realloc(4),N0.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),N0.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=t[r]},writeRawMessage:function(t,e){this.pos++;var r=this.pos;t(e,this);var n=this.pos-r;n>=128&&k4(r,n,this),this.pos=r-1,this.writeVarint(n),this.pos+=n},writeMessage:function(t,e,r){this.writeTag(t,Gr.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,Hy,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,Qy,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,Jy,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,Xy,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,Yy,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,Ky,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,e9,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,t9,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,r9,e)},writeBytesField:function(t,e){this.writeTag(t,Gr.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,Gr.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,Gr.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,Gr.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,Gr.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,Gr.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,Gr.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,Gr.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,Gr.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,Gr.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,!!e)}};var Gc=Br(R4);const np=3;function i9(t,e,r){e.glyphs=[],t===1&&r.readMessage(n9,e)}function n9(t,e,r){if(t===3){const{id:n,bitmap:a,width:l,height:h,left:f,top:m,advance:g}=r.readMessage(o9,{});e.glyphs.push({id:n,bitmap:new ta({width:l+2*np,height:h+2*np},a),metrics:{width:l,height:h,left:f,top:m,advance:g}})}else t===4?e.ascender=r.readSVarint():t===5&&(e.descender=r.readSVarint())}function o9(t,e,r){t===1?e.id=r.readVarint():t===2?e.bitmap=r.readBytes():t===3?e.width=r.readVarint():t===4?e.height=r.readVarint():t===5?e.left=r.readSVarint():t===6?e.top=r.readSVarint():t===7&&(e.advance=r.readVarint())}const F4=np,Bn={horizontal:1,vertical:2,horizontalOnly:3};class Ch{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,r){const n=new Ch;return n.scale=e||1,n.fontStack=r,n}static forImage(e){const r=new Ch;return r.imageName=e,r}}class $c{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,r){const n=new $c;for(let a=0;a<e.sections.length;a++){const l=e.sections[a];l.image?n.addImageSection(l):n.addTextSection(l,r)}return n}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(r,n){let a="";for(let l=0;l<r.length;l++){const h=r.charCodeAt(l+1)||null,f=r.charCodeAt(l-1)||null;a+=!n&&(h&&_(h)&&!Ph[r[l+1]]||f&&_(f)&&!Ph[r[l-1]])||!Ph[r[l]]?r[l]:Ph[r[l]]}return a}(this.text,e)}trim(){let e=0;for(let n=0;n<this.text.length&&U0[this.text.charCodeAt(n)];n++)e++;let r=this.text.length;for(let n=this.text.length-1;n>=0&&n>=e&&U0[this.text.charCodeAt(n)];n--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)}substring(e,r){const n=new $c;return n.text=this.text.substring(e,r),n.sectionIndex=this.sectionIndex.slice(e,r),n.sections=this.sections,n}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,r)=>Math.max(e,this.sections[r].scale),0)}addTextSection(e,r){this.text+=e.text,this.sections.push(Ch.forText(e.scale,e.fontStack||r));const n=this.sections.length-1;for(let a=0;a<e.text.length;++a)this.sectionIndex.push(n)}addImageSection(e){const r=e.image?e.image.namePrimary:"";if(r.length===0)return void Qr("Can't add FormattedSection with an empty image.");const n=this.getNextImageSectionCharCode();n?(this.text+=String.fromCodePoint(n),this.sections.push(Ch.forImage(r)),this.sectionIndex.push(this.sections.length-1)):Qr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function op(t,e,r,n,a,l,h,f,m,g,x,v,w,S,A){const P=$c.fromFeature(t,a);v===Bn.vertical&&P.verticalizePunctuation(w);let R=[];const L=function(W,re,ne,de,ve,pe){if(!W)return[];const Te=[],we=function(ke,Le,Se,at,rt,Fe){let bt=0;for(let ft=0;ft<ke.length();ft++){const lt=ke.getSection(ft);bt+=N4(ke.getCodePoint(ft),lt,at,rt,Le,Fe)}return bt/Math.max(1,Math.ceil(bt/Se))}(W,re,ne,de,ve,pe),be=W.text.indexOf("​")>=0;let Ce=0;for(let ke=0;ke<W.length();ke++){const Le=W.getSection(ke),Se=W.getCodePoint(ke);if(U0[Se]||(Ce+=N4(Se,Le,de,ve,re,pe)),ke<W.length()-1){const at=!((Ie=Se)<11904||!(i["Bopomofo Extended"](Ie)||i.Bopomofo(Ie)||i["CJK Compatibility Forms"](Ie)||i["CJK Compatibility Ideographs"](Ie)||i["CJK Compatibility"](Ie)||i["CJK Radicals Supplement"](Ie)||i["CJK Strokes"](Ie)||i["CJK Symbols and Punctuation"](Ie)||i["CJK Unified Ideographs Extension A"](Ie)||i["CJK Unified Ideographs"](Ie)||i["Enclosed CJK Letters and Months"](Ie)||i["Halfwidth and Fullwidth Forms"](Ie)||i.Hiragana(Ie)||i["Ideographic Description Characters"](Ie)||i["Kangxi Radicals"](Ie)||i["Katakana Phonetic Extensions"](Ie)||i.Katakana(Ie)||i["Vertical Forms"](Ie)||i["Yi Radicals"](Ie)||i["Yi Syllables"](Ie)));(s9[Se]||at||Le.imageName)&&Te.push(U4(ke+1,Ce,we,Te,a9(Se,W.getCodePoint(ke+1),at&&be),!1))}}var Ie;return j4(U4(W.length(),Ce,we,Te,0,!0))}(P,g,l,e,n,S),{processBidirectionalText:V,processStyledBidirectionalText:q}=Y;if(V&&P.sections.length===1){const W=V(P.toString(),L);for(const re of W){const ne=new $c;ne.text=re,ne.sections=P.sections;for(let de=0;de<re.length;de++)ne.sectionIndex.push(0);R.push(ne)}}else if(q){const W=q(P.text,P.sectionIndex,L);for(const re of W){const ne=new $c;ne.text=re[0],ne.sectionIndex=re[1],ne.sections=P.sections,R.push(ne)}}else R=function(W,re){const ne=[],de=W.text;let ve=0;for(const pe of re)ne.push(W.substring(ve,pe)),ve=pe;return ve<de.length&&ne.push(W.substring(ve,de.length)),ne}(P,L);const G=[],ee={positionedLines:G,text:P.toString(),top:x[1],bottom:x[1],left:x[0],right:x[0],writingMode:v,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(W,re,ne,de,ve,pe,Te,we,be,Ce,Ie,ke){let Le=0,Se=0,at=0;const rt=we==="right"?1:we==="left"?0:.5;let Fe=!1;for(const Lt of ve){const At=Lt.getSections();for(const Ft of At){if(Ft.imageName)continue;const Ot=re[Ft.fontStack];if(Ot&&(Fe=Ot.ascender!==void 0&&Ot.descender!==void 0,!Fe))break}if(!Fe)break}let bt=0;for(const Lt of ve){Lt.trim();const At=Lt.getMaxScale(),Ft=(At-1)*Ri,Ot={positionedGlyphs:[],lineOffset:0};W.positionedLines[bt]=Ot;const Zt=Ot.positionedGlyphs;let Tt=0;if(!Lt.length()){Se+=pe,++bt;continue}let wr=0,vr=0;for(let Kt=0;Kt<Lt.length();Kt++){const or=Lt.getSection(Kt),kr=Lt.getSectionIndex(Kt),Pr=Lt.getCodePoint(Kt);let Xr=or.scale,Zr=null,Ui=null,ei=null,$r=Ri,di=0;const Ei=!(be===Bn.horizontal||!Ie&&!p(Pr)||Ie&&(U0[Pr]||(ft=Pr,i.Arabic(ft)||i["Arabic Supplement"](ft)||i["Arabic Extended-A"](ft)||i["Arabic Presentation Forms-A"](ft)||i["Arabic Presentation Forms-B"](ft))));if(or.imageName){const Ai=de[or.imageName];if(!Ai)continue;ei=or.imageName,W.iconsInText=W.iconsInText||!0,Ui=Ai.paddedRect;const Rr=Ai.displaySize;Xr=Xr*Ri/ke,Zr={width:Rr[0],height:Rr[1],left:0,top:-F4,advance:Ei?Rr[1]:Rr[0],localGlyph:!1},di=Fe?-Zr.height*Xr:At*Ri-17-Rr[1]*Xr,$r=Zr.advance;const rn=(Ei?Rr[0]:Rr[1])*Xr-Ri*At;rn>0&&rn>Tt&&(Tt=rn)}else{const Ai=ne[or.fontStack];if(!Ai)continue;Ai[Pr]&&(Ui=Ai[Pr]);const Rr=re[or.fontStack];if(!Rr)continue;const rn=Rr.glyphs[Pr];if(!rn)continue;if(Zr=rn.metrics,$r=Pr!==8203?Ri:0,Fe){const ms=Rr.ascender!==void 0?Math.abs(Rr.ascender):0,Yn=Rr.descender!==void 0?Math.abs(Rr.descender):0,_o=(ms+Yn)*Xr;wr<_o&&(wr=_o,vr=(ms-Yn)/2*Xr),di=-ms*Xr}else di=(At-Xr)*Ri-17}Ei?(W.verticalizable=!0,Zt.push({glyph:Pr,imageName:ei,x:Le,y:Se+di,vertical:Ei,scale:Xr,localGlyph:Zr.localGlyph,fontStack:or.fontStack,sectionIndex:kr,metrics:Zr,rect:Ui}),Le+=$r*Xr+Ce):(Zt.push({glyph:Pr,imageName:ei,x:Le,y:Se+di,vertical:Ei,scale:Xr,localGlyph:Zr.localGlyph,fontStack:or.fontStack,sectionIndex:kr,metrics:Zr,rect:Ui}),Le+=Zr.advance*Xr+Ce)}Zt.length!==0&&(at=Math.max(Le-Ce,at),Fe?G4(Zt,rt,Tt,vr,pe*At/2):G4(Zt,rt,Tt,0,pe/2)),Le=0;const nr=pe*At+Tt;Ot.lineOffset=Math.max(Tt,Ft),Se+=nr,++bt}var ft;const lt=Se,{horizontalAlign:Ne,verticalAlign:yt}=sp(Te);(function(Lt,At,Ft,Ot,Zt,Tt){const wr=(At-Ft)*Zt,vr=-Tt*Ot;for(const nr of Lt)for(const Kt of nr.positionedGlyphs)Kt.x+=wr,Kt.y+=vr})(W.positionedLines,rt,Ne,yt,at,lt),W.top+=-yt*lt,W.bottom=W.top+lt,W.left+=-Ne*at,W.right=W.left+at,W.hasBaseline=Fe}(ee,e,r,n,R,h,f,m,v,g,w,A),!function(W){for(const re of W)if(re.positionedGlyphs.length!==0)return!1;return!0}(G)&&ee}const U0={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},s9={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function N4(t,e,r,n,a,l){if(e.imageName){const h=n[e.imageName];return h?h.displaySize[0]*e.scale*Ri/l+a:0}{const h=r[e.fontStack],f=h&&h.glyphs[t];return f?f.metrics.advance*e.scale+a:0}}function V4(t,e,r,n){const a=Math.pow(t-e,2);return n?t<e?a/2:2*a:a+Math.abs(r)*r}function a9(t,e,r){let n=0;return t===10&&(n-=1e4),r&&(n+=150),t!==40&&t!==65288||(n+=50),e!==41&&e!==65289||(n+=50),n}function U4(t,e,r,n,a,l){let h=null,f=V4(e,r,a,l);for(const m of n){const g=V4(e-m.x,r,a,l)+m.badness;g<=f&&(h=m,f=g)}return{index:t,x:e,priorBreak:h,badness:f}}function j4(t){return t?j4(t.priorBreak).concat(t.index):[]}function sp(t){let e=.5,r=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function G4(t,e,r,n,a){if(!(e||r||n||a))return;const l=t.length-1,h=t[l],f=(h.x+h.metrics.advance*h.scale)*e;for(let m=0;m<=l;m++)t[m].x-=f,t[m].y+=r+n+a}function l9(t,e,r,n){const{horizontalAlign:a,verticalAlign:l}=sp(n),h=r[0]-t.displaySize[0]*a,f=r[1]-t.displaySize[1]*l;return{imagePrimary:t,imageSecondary:e,top:f,bottom:f+t.displaySize[1],left:h,right:h+t.displaySize[0]}}function $4(t,e,r,n,a,l){const h=t.imagePrimary;let f;if(h.content){const R=h.content,L=h.pixelRatio||1;f=[R[0]/L,R[1]/L,h.displaySize[0]-R[2]/L,h.displaySize[1]-R[3]/L]}const m=e.left*l,g=e.right*l;let x,v,w,S;r==="width"||r==="both"?(S=a[0]+m-n[3],v=a[0]+g+n[1]):(S=a[0]+(m+g-h.displaySize[0])/2,v=S+h.displaySize[0]);const A=e.top*l,P=e.bottom*l;return r==="height"||r==="both"?(x=a[1]+A-n[0],w=a[1]+P+n[2]):(x=a[1]+(A+P-h.displaySize[1])/2,w=x+h.displaySize[1]),{imagePrimary:h,imageSecondary:void 0,top:x,right:v,bottom:w,left:S,collisionPadding:f}}class ps extends He{constructor(e,r,n,a,l){super(e,r),this.angle=a,this.z=n,l!==void 0&&(this.segment=l)}clone(){return new ps(this.x,this.y,this.z,this.angle,this.segment)}}function q4(t,e,r,n,a){if(e.segment===void 0)return!0;let l=e,h=e.segment+1,f=0;for(;f>-r/2;){if(h--,h<0)return!1;f-=t[h].dist(l),l=t[h]}f+=t[h].dist(t[h+1]),h++;const m=[];let g=0;for(;f<r/2;){const x=t[h],v=t[h+1];if(!v)return!1;let w=t[h-1].angleTo(x)-x.angleTo(v);for(w=Math.abs((w+3*Math.PI)%(2*Math.PI)-Math.PI),m.push({distance:f,angleDelta:w}),g+=w;f-m[0].distance>n;)g-=m.shift().angleDelta;if(g>a)return!1;h++,f+=x.dist(v)}return!0}function Z4(t){let e=0;for(let r=0;r<t.length-1;r++)e+=t[r].dist(t[r+1]);return e}function W4(t,e,r){return t?.6*e*r:0}function H4(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function c9(t,e,r,n,a,l){const h=W4(r,a,l),f=H4(r,n)*l;let m=0;const g=Z4(t)/2;for(let x=0;x<t.length-1;x++){const v=t[x],w=t[x+1],S=v.dist(w);if(m+S>g){const A=(g-m)/S,P=jt(v.x,w.x,A),R=jt(v.y,w.y,A),L=new ps(P,R,0,w.angleTo(v),x);return!h||q4(t,L,f,h,e)?L:void 0}m+=S}}function u9(t,e,r,n,a,l,h,f,m){const g=W4(n,l,h),x=H4(n,a),v=x*h,w=t[0].x===0||t[0].x===m||t[0].y===0||t[0].y===m;return e-v<e/4&&(e=v+e/4),Q4(t,w?e/2*f%e:(x/2+2*l)*h*f%e,e,g,r,v,w,!1,m)}function Q4(t,e,r,n,a,l,h,f,m){const g=l/2,x=Z4(t);let v=0,w=e-r,S=[];for(let A=0;A<t.length-1;A++){const P=t[A],R=t[A+1],L=P.dist(R),V=R.angleTo(P);for(;w+r<v+L;){w+=r;const q=(w-v)/L,G=jt(P.x,R.x,q),ee=jt(P.y,R.y,q);if(G>=0&&G<m&&ee>=0&&ee<m&&w-g>=0&&w+g<=x){const W=new ps(G,ee,0,V,A);n&&!q4(t,W,l,n,a)||S.push(W)}}v+=L}return f||S.length||h||(S=Q4(t,v/2,r,n,a,l,h,!0,m)),S}function X4(t,e,r,n,a){const l=[];for(let h=0;h<t.length;h++){const f=t[h];let m;for(let g=0;g<f.length-1;g++){let x=f[g],v=f[g+1];x.x<e&&v.x<e||(x.x<e?x=new He(e,x.y+(e-x.x)/(v.x-x.x)*(v.y-x.y))._round():v.x<e&&(v=new He(e,x.y+(e-x.x)/(v.x-x.x)*(v.y-x.y))._round()),x.y<r&&v.y<r||(x.y<r?x=new He(x.x+(r-x.y)/(v.y-x.y)*(v.x-x.x),r)._round():v.y<r&&(v=new He(x.x+(r-x.y)/(v.y-x.y)*(v.x-x.x),r)._round()),x.x>=n&&v.x>=n||(x.x>=n?x=new He(n,x.y+(n-x.x)/(v.x-x.x)*(v.y-x.y))._round():v.x>=n&&(v=new He(n,x.y+(n-x.x)/(v.x-x.x)*(v.y-x.y))._round()),x.y>=a&&v.y>=a||(x.y>=a?x=new He(x.x+(a-x.y)/(v.y-x.y)*(v.x-x.x),a)._round():v.y>=a&&(v=new He(x.x+(a-x.y)/(v.y-x.y)*(v.x-x.x),a)._round()),m&&x.equals(m[m.length-1])||(m=[x],l.push(m)),m.push(v)))))}}return l}function Y4(t){let e=0,r=0;for(const h of t)e+=h.w*h.h,r=Math.max(r,h.w);t.sort((h,f)=>f.h-h.h);const n=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}];let a=0,l=0;for(const h of t)for(let f=n.length-1;f>=0;f--){const m=n[f];if(!(h.w>m.w||h.h>m.h)){if(h.x=m.x,h.y=m.y,l=Math.max(l,h.y+h.h),a=Math.max(a,h.x+h.w),h.w===m.w&&h.h===m.h){const g=n.pop();f<n.length&&(n[f]=g)}else h.h===m.h?(m.x+=h.w,m.w-=h.w):h.w===m.w?(m.y+=h.h,m.h-=h.h):(n.push({x:m.x+h.w,y:m.y,w:m.w-h.w,h:h.h}),m.y+=h.h,m.h-=h.h);break}}return{w:a,h:l,fill:e/(a*l)||0}}nt(ps,"Anchor");const bn=1;class ap{constructor(e,{pixelRatio:r,version:n,stretchX:a,stretchY:l,content:h}){this.paddedRect=e,this.pixelRatio=r,this.stretchX=a,this.stretchY=l,this.content=h,this.version=n}get tl(){return[this.paddedRect.x+bn,this.paddedRect.y+bn]}get br(){return[this.paddedRect.x+this.paddedRect.w-bn,this.paddedRect.y+this.paddedRect.h-bn]}get displaySize(){return[(this.paddedRect.w-2*bn)/this.pixelRatio,(this.paddedRect.h-2*bn)/this.pixelRatio]}}class J4{constructor(e,r){const n={},a={};this.haveRenderCallbacks=[];const l=[];this.addImages(e,n,l),this.addImages(r,a,l);const{w:h,h:f}=Y4(l),m=new kn({width:h||1,height:f||1});for(const g in e){const x=e[g],v=n[g].paddedRect;kn.copy(x.data,m,{x:0,y:0},{x:v.x+bn,y:v.y+bn},x.data,x.sdf)}for(const g in r){const x=r[g],v=a[g].paddedRect,w=v.x+bn,S=v.y+bn,A=x.data.width,P=x.data.height;kn.copy(x.data,m,{x:0,y:0},{x:w,y:S},x.data),kn.copy(x.data,m,{x:0,y:P-1},{x:w,y:S-1},{width:A,height:1}),kn.copy(x.data,m,{x:0,y:0},{x:w,y:S+P},{width:A,height:1}),kn.copy(x.data,m,{x:A-1,y:0},{x:w-1,y:S},{width:1,height:P}),kn.copy(x.data,m,{x:0,y:0},{x:w+A,y:S},{width:1,height:P})}this.image=m,this.iconPositions=n,this.patternPositions=a}addImages(e,r,n){for(const a in e){const l=e[a],h={x:0,y:0,w:l.data.width+2*bn,h:l.data.height+2*bn};n.push(h),r[a]=new ap(h,l),l.hasRenderCallback&&this.haveRenderCallbacks.push(a)}}patchUpdatedImages(e,r,n){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(a=>e.hasImage(a,n)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,n);for(const a in e.getUpdatedImages(n))this.patchUpdatedImage(this.iconPositions[a],e.getImage(a,n),r),this.patchUpdatedImage(this.patternPositions[a],e.getImage(a,n),r)}patchUpdatedImage(e,r,n){if(!e||!r||e.version===r.version)return;e.version=r.version;const[a,l]=e.tl,h=!!Object.keys(this.patternPositions).length;n.update(r.data,{useMipmap:h},{x:a,y:l})}}nt(ap,"ImagePosition"),nt(J4,"ImageAtlas");const Dh=1e20;function K4(t,e,r,n,a,l,h,f,m){for(let g=e;g<e+n;g++)e5(t,r*l+g,l,a,h,f,m);for(let g=r;g<r+a;g++)e5(t,g*l+e,1,n,h,f,m)}function e5(t,e,r,n,a,l,h){l[0]=0,h[0]=-Dh,h[1]=Dh,a[0]=t[e];for(let f=1,m=0,g=0;f<n;f++){a[f]=t[e+f*r];const x=f*f;do{const v=l[m];g=(a[f]-a[v]+x-v*v)/(f-v)/2}while(g<=h[m]&&--m>-1);m++,l[m]=f,h[m]=g,h[m+1]=Dh}for(let f=0,m=0;f<n;f++){for(;h[m+1]<f;)m++;const g=l[m],x=f-g;t[e+f*r]=a[g]+x*x}}const uo=2,lp={none:0,ideographs:1,all:2};class qc{constructor(e,r,n){this.requestManager=e,this.localGlyphMode=r,this.localFontFamily=n,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,r){this.urls[r]=e}getGlyphs(e,r,n){const a=[],l=this.urls[r]||Ze.GLYPHS_URL;for(const h in e)for(const f of e[h])a.push({stack:h,id:f});bu(a,({stack:h,id:f},m)=>{let g=this.entries[h];g||(g=this.entries[h]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let x=g.glyphs[f];if(x!==void 0)return void m(null,{stack:h,id:f,glyph:x});if(x=this._tinySDF(g,h,f),x)return g.glyphs[f]=x,void m(null,{stack:h,id:f,glyph:x});const v=Math.floor(f/256);if(256*v>65535)return void m(new Error("glyphs > 65535 not supported"));if(g.ranges[v])return void m(null,{stack:h,id:f,glyph:x});let w=g.requests[v];w||(w=g.requests[v]=[],qc.loadGlyphRange(h,v,l,this.requestManager,(S,A)=>{if(A){g.ascender=A.ascender,g.descender=A.descender;for(const P in A.glyphs)this._doesCharSupportLocalGlyph(+P)||(g.glyphs[+P]=A.glyphs[+P]);g.ranges[v]=!0}for(const P of w)P(S,A);delete g.requests[v]})),w.push((S,A)=>{S?m(S):A&&m(null,{stack:h,id:f,glyph:A.glyphs[f]||null})})},(h,f)=>{if(h)n(h);else if(f){const m={};for(const{stack:g,id:x,glyph:v}of f)m[g]===void 0&&(m[g]={}),m[g].glyphs===void 0&&(m[g].glyphs={}),m[g].glyphs[x]=v&&{id:v.id,bitmap:v.bitmap.clone(),metrics:v.metrics},m[g].ascender=this.entries[g].ascender,m[g].descender=this.entries[g].descender;n(null,m)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==lp.none&&(this.localGlyphMode===lp.all?!!this.localFontFamily:!!this.localFontFamily&&(i["CJK Unified Ideographs"](e)||i["Hangul Syllables"](e)||i.Hiragana(e)||i.Katakana(e)||i["CJK Symbols and Punctuation"](e)||i["CJK Unified Ideographs Extension A"](e)||i["CJK Unified Ideographs Extension B"](e)))}_tinySDF(e,r,n){const a=this.localFontFamily;if(!a||!this._doesCharSupportLocalGlyph(n))return;let l=e.tinySDF;if(!l){let P="400";/bold/i.test(r)?P="900":/medium/i.test(r)?P="500":/light/i.test(r)&&(P="200"),l=e.tinySDF=new qc.TinySDF({fontFamily:a,fontWeight:P,fontSize:24*uo,buffer:3*uo,radius:8*uo}),l.fontWeight=P}if(this.localGlyphs[l.fontWeight][n])return this.localGlyphs[l.fontWeight][n];const h=String.fromCodePoint(n),{data:f,width:m,height:g,glyphWidth:x,glyphHeight:v,glyphLeft:w,glyphTop:S,glyphAdvance:A}=l.draw(h);return this.localGlyphs[l.fontWeight][n]={id:n,bitmap:new ta({width:m,height:g},f),metrics:{width:x/uo,height:v/uo,left:w/uo,top:S/uo-27,advance:A/uo,localGlyph:!0}}}}qc.loadGlyphRange=function(t,e,r,n,a){const l=256*e,h=l+255,f=n.transformRequest(n.normalizeGlyphsURL(r).replace("{fontstack}",t).replace("{range}",`${l}-${h}`),Hl.Glyphs);za(f,(m,g)=>{if(m)a(m);else if(g){const x={},v=function(w){return new Gc(w).readFields(i9,{})}(g);for(const w of v.glyphs)x[w.id]=w;a(null,{glyphs:x,ascender:v.ascender,descender:v.descender})}})},qc.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:r=8,cutoff:n=.25,fontFamily:a="sans-serif",fontWeight:l="normal",fontStyle:h="normal"}={}){this.buffer=e,this.cutoff=n,this.radius=r;const f=this.size=t+4*e,m=this._createCanvas(f),g=this.ctx=m.getContext("2d",{willReadFrequently:!0});g.font=`${h} ${l} ${t}px ${a}`,g.textBaseline="alphabetic",g.textAlign="left",g.fillStyle="black",this.gridOuter=new Float64Array(f*f),this.gridInner=new Float64Array(f*f),this.f=new Float64Array(f),this.z=new Float64Array(f+1),this.v=new Uint16Array(f)}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:r,actualBoundingBoxDescent:n,actualBoundingBoxLeft:a,actualBoundingBoxRight:l}=this.ctx.measureText(t),h=Math.ceil(r),f=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(l-a))),m=Math.min(this.size-this.buffer,h+Math.ceil(n)),g=f+2*this.buffer,x=m+2*this.buffer,v=Math.max(g*x,0),w=new Uint8ClampedArray(v),S={data:w,width:g,height:x,glyphWidth:f,glyphHeight:m,glyphTop:h,glyphLeft:0,glyphAdvance:e};if(f===0||m===0)return S;const{ctx:A,buffer:P,gridInner:R,gridOuter:L}=this;A.clearRect(P,P,f,m),A.fillText(t,P,P+h);const V=A.getImageData(P,P,f,m);L.fill(Dh,0,v),R.fill(0,0,v);for(let q=0;q<m;q++)for(let G=0;G<f;G++){const ee=V.data[4*(q*f+G)+3]/255;if(ee===0)continue;const W=(q+P)*g+G+P;if(ee===1)L[W]=0,R[W]=Dh;else{const re=.5-ee;L[W]=re>0?re*re:0,R[W]=re<0?re*re:0}}K4(L,0,0,g,x,g,this.f,this.v,this.z),K4(R,P,P,f,m,g,this.f,this.v,this.z);for(let q=0;q<v;q++){const G=Math.sqrt(L[q])-Math.sqrt(R[q]);w[q]=Math.round(255-255*(G/this.radius+this.cutoff))}return S}};const na=bn;function t5(t,e,r,n){const a=[],l=t.imagePrimary,h=l.pixelRatio,f=l.paddedRect.w-2*na,m=l.paddedRect.h-2*na,g=t.right-t.left,x=t.bottom-t.top,v=l.stretchX||[[0,f]],w=l.stretchY||[[0,m]],S=(pe,Te)=>pe+Te[1]-Te[0],A=v.reduce(S,0),P=w.reduce(S,0),R=f-A,L=m-P;let V=0,q=A,G=0,ee=P,W=0,re=R,ne=0,de=L;if(l.content&&n){const pe=l.content;V=j0(v,0,pe[0]),G=j0(w,0,pe[1]),q=j0(v,pe[0],pe[2]),ee=j0(w,pe[1],pe[3]),W=pe[0]-V,ne=pe[1]-G,re=pe[2]-pe[0]-q,de=pe[3]-pe[1]-ee}const ve=(pe,Te,we,be)=>{const Ce=G0(pe.stretch-V,q,g,t.left),Ie=$0(pe.fixed-W,re,pe.stretch,A),ke=G0(Te.stretch-G,ee,x,t.top),Le=$0(Te.fixed-ne,de,Te.stretch,P),Se=G0(we.stretch-V,q,g,t.left),at=$0(we.fixed-W,re,we.stretch,A),rt=G0(be.stretch-G,ee,x,t.top),Fe=$0(be.fixed-ne,de,be.stretch,P),bt=new He(Ce,ke),ft=new He(Se,ke),lt=new He(Se,rt),Ne=new He(Ce,rt),yt=new He(Ie/h,Le/h),Lt=new He(at/h,Fe/h),At=e*Math.PI/180;if(At){const vr=Math.sin(At),nr=Math.cos(At),Kt=[nr,-vr,vr,nr];bt._matMult(Kt),ft._matMult(Kt),Ne._matMult(Kt),lt._matMult(Kt)}const Ft=pe.stretch+pe.fixed,Ot=we.stretch+we.fixed,Zt=Te.stretch+Te.fixed,Tt=be.stretch+be.fixed,wr=t.imageSecondary;return{tl:bt,tr:ft,bl:Ne,br:lt,texPrimary:{x:l.paddedRect.x+na+Ft,y:l.paddedRect.y+na+Zt,w:Ot-Ft,h:Tt-Zt},texSecondary:wr?{x:wr.paddedRect.x+na+Ft,y:wr.paddedRect.y+na+Zt,w:Ot-Ft,h:Tt-Zt}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:yt,pixelOffsetBR:Lt,minFontScaleX:re/h/g,minFontScaleY:de/h/x,isSDF:r}};if(n&&(l.stretchX||l.stretchY)){const pe=r5(v,R,A),Te=r5(w,L,P);for(let we=0;we<pe.length-1;we++){const be=pe[we],Ce=pe[we+1];for(let Ie=0;Ie<Te.length-1;Ie++)a.push(ve(be,Te[Ie],Ce,Te[Ie+1]))}}else a.push(ve({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:f+1},{fixed:0,stretch:m+1}));return a}function j0(t,e,r){let n=0;for(const a of t)n+=Math.max(e,Math.min(r,a[1]))-Math.max(e,Math.min(r,a[0]));return n}function r5(t,e,r){const n=[{fixed:-na,stretch:0}];for(const[a,l]of t){const h=n[n.length-1];n.push({fixed:a-h.stretch,stretch:h.stretch}),n.push({fixed:a-h.stretch,stretch:h.stretch+(l-a)})}return n.push({fixed:e+na,stretch:r}),n}function G0(t,e,r,n){return t/e*r+n}function $0(t,e,r,n){return t-e*r/n}function h9(t,e,r,n){const a=e+t.positionedLines[n].lineOffset;return n===0?r+a/2:r+(a+(e+t.positionedLines[n-1].lineOffset))/2}function d9(t,e=1,r=!1){let n=1/0,a=1/0,l=-1/0,h=-1/0;const f=t[0];for(let S=0;S<f.length;S++){const A=f[S];(!S||A.x<n)&&(n=A.x),(!S||A.y<a)&&(a=A.y),(!S||A.x>l)&&(l=A.x),(!S||A.y>h)&&(h=A.y)}const m=Math.min(l-n,h-a);let g=m/2;const x=new hc([],f9);if(m===0)return new He(n,a);for(let S=n;S<l;S+=m)for(let A=a;A<h;A+=m)x.push(new Zc(S+g,A+g,g,t));let v=function(S){let A=0,P=0,R=0;const L=S[0];for(let V=0,q=L.length,G=q-1;V<q;G=V++){const ee=L[V],W=L[G],re=ee.x*W.y-W.x*ee.y;P+=(ee.x+W.x)*re,R+=(ee.y+W.y)*re,A+=3*re}return new Zc(P/A,R/A,0,S)}(t),w=x.length;for(;x.length;){const S=x.pop();(S.d>v.d||!v.d)&&(v=S,r&&console.log("found best %d after %d probes",Math.round(1e4*S.d)/1e4,w)),S.max-v.d<=e||(g=S.h/2,x.push(new Zc(S.p.x-g,S.p.y-g,g,t)),x.push(new Zc(S.p.x+g,S.p.y-g,g,t)),x.push(new Zc(S.p.x-g,S.p.y+g,g,t)),x.push(new Zc(S.p.x+g,S.p.y+g,g,t)),w+=4)}return r&&(console.log(`num probes: ${w}`),console.log(`best distance: ${v.d}`)),v.p}function f9(t,e){return e.max-t.max}class Zc{constructor(e,r,n,a){this.p=new He(e,r),this.h=n,this.d=function(l,h){let f=!1,m=1/0;for(let g=0;g<h.length;g++){const x=h[g];for(let v=0,w=x.length,S=w-1;v<w;S=v++){const A=x[v],P=x[S];A.y>l.y!=P.y>l.y&&l.x<(P.x-A.x)*(l.y-A.y)/(P.y-A.y)+A.x&&(f=!f),m=Math.min(m,x_(l,A,P))}}return(f?1:-1)*Math.sqrt(m)}(this.p,a),this.max=this.d+this.h*Math.SQRT2}}const cp=Number.POSITIVE_INFINITY,p9=Math.sqrt(2);function i5(t,[e,r]){let n=0,a=0;if(r===cp){e<0&&(e=0);const l=e/p9;switch(t){case"top-right":case"top-left":a=l-7;break;case"bottom-right":case"bottom-left":a=7-l;break;case"bottom":a=7-e;break;case"top":a=e-7}switch(t){case"top-right":case"bottom-right":n=-l;break;case"top-left":case"bottom-left":n=l;break;case"left":n=e;break;case"right":n=-e}}else{switch(e=Math.abs(e),r=Math.abs(r),t){case"top-right":case"top-left":case"top":a=r-7;break;case"bottom-right":case"bottom-left":case"bottom":a=7-r}switch(t){case"top-right":case"bottom-right":case"right":n=-e;break;case"top-left":case"bottom-left":case"left":n=e}}return[n,a]}function up(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function m9(t,e,r,n,a,l,h,f,m,g,x,v,w,S,A){let P=l.textMaxSize.evaluate(e,{},v);P===void 0&&(P=h);const R=t.layers[0].layout,L=R.get("icon-offset").evaluate(e,{},v),V=o5(r.horizontal)||r.vertical,q=w.name==="globe",G=Ri,ee=h/G,W=t.tilePixelRatio*P/G,re=(Ce=t.overscaling,t.zoom>18&&Ce>2&&(Ce>>=1),Math.max(Qe/(512*Ce),1)*R.get("symbol-spacing")),ne=R.get("text-padding")*t.tilePixelRatio,de=R.get("icon-padding")*t.tilePixelRatio,ve=er(R.get("text-max-angle")),pe=R.get("text-rotation-alignment")==="map"&&R.get("symbol-placement")!=="point",Te=R.get("icon-rotation-alignment")==="map"&&R.get("symbol-placement")!=="point",we=R.get("symbol-placement"),be=re/2;var Ce;const Ie=R.get("icon-text-fit").evaluate(e,{},v),ke=R.get("icon-text-fit-padding").evaluate(e,{},v),Le=Ie!=="none";let Se;t.hasAnyIconTextFit===!1&&Le&&(t.hasAnyIconTextFit=!0),n&&Le&&(t.allowVerticalPlacement&&r.vertical&&(Se=$4(n,r.vertical,Ie,ke,L,ee)),V&&(n=$4(n,V,Ie,ke,L,ee)));const at=(rt,Fe,bt)=>{if(Fe.x<0||Fe.x>=Qe||Fe.y<0||Fe.y>=Qe)return;let ft=null;if(q){const{x:lt,y:Ne,z:yt}=w.projectTilePoint(Fe.x,Fe.y,bt);ft={anchor:new ps(lt,Ne,yt,0,void 0),up:w.upVector(bt,Fe.x,Fe.y)}}(function(lt,Ne,yt,Lt,At,Ft,Ot,Zt,Tt,wr,vr,nr,Kt,or,kr,Pr,Xr,Zr,Ui,ei,$r,di,Ei,Ai,Rr,rn,ms){const Yn=lt.addToLineVertexArray(Ne,Lt);let _o,ua,ha,Sl,a3,l3,c3,u3=0,h3=0,d3=0,f3=0,Rp=-1,Lp=-1;const ko={};let p3=ka("");const El=yt?yt.anchor:Ne,Op=Tt.layout.get("icon-text-fit").evaluate($r,{},Rr)!=="none";let kp=0,Bp=0;if(Tt._unevaluatedLayout.getValue("text-radial-offset")===void 0?[kp,Bp]=Tt.layout.get("text-offset").evaluate($r,{},Rr).map(wn=>wn*Ri):(kp=Tt.layout.get("text-radial-offset").evaluate($r,{},Rr)*Ri,Bp=cp),lt.allowVerticalPlacement&&At.vertical){const wn=At.vertical;if(kr)l3=hp(wn),Zt&&(c3=hp(Zt));else{const Tn=Tt.layout.get("text-rotate").evaluate($r,{},Rr)+90;ha=q0(wr,El,Ne,vr,nr,Kt,wn,or,Tn,Pr),Zt&&(Sl=q0(wr,El,Ne,vr,nr,Kt,Zt,Zr,Tn))}}if(Ft){const wn=Tt.layout.get("icon-rotate").evaluate($r,{},Rr),Tn=t5(Ft,wn,Ei,Op),Kc=Zt?t5(Zt,wn,Ei,Op):void 0;ua=q0(wr,El,Ne,vr,nr,Kt,Ft,Zr,wn),u3=4*Tn.length;const m3=lt.iconSizeData;let Al=null;m3.kind==="source"?(Al=[co*Tt.layout.get("icon-size").evaluate($r,{},Rr)],Al[0]>oa&&Qr(`${lt.layerIds[0]}: Value for "icon-size" is >= ${zh}. Reduce your "icon-size".`)):m3.kind==="composite"&&(Al=[co*di.compositeIconSizes[0].evaluate($r,{},Rr),co*di.compositeIconSizes[1].evaluate($r,{},Rr)],(Al[0]>oa||Al[1]>oa)&&Qr(`${lt.layerIds[0]}: Value for "icon-size" is >= ${zh}. Reduce your "icon-size".`)),lt.addSymbols(lt.icon,Tn,Al,ei,Ui,$r,!1,yt,Ne,Yn.lineStartIndex,Yn.lineLength,-1,Ai,Rr,rn,ms),Rp=lt.icon.placedSymbolArray.length-1,Kc&&(h3=4*Kc.length,lt.addSymbols(lt.icon,Kc,Al,ei,Ui,$r,Bn.vertical,yt,Ne,Yn.lineStartIndex,Yn.lineLength,-1,Ai,Rr,rn,ms),Lp=lt.icon.placedSymbolArray.length-1)}for(const wn in At.horizontal){const Tn=At.horizontal[wn];_o||(p3=ka(Tn.text),kr?a3=hp(Tn):_o=q0(wr,El,Ne,vr,nr,Kt,Tn,or,Tt.layout.get("text-rotate").evaluate($r,{},Rr),Pr));const Kc=Tn.positionedLines.length===1;if(d3+=n5(lt,yt,Ne,Tn,Ot,Tt,kr,$r,Pr,Yn,At.vertical?Bn.horizontal:Bn.horizontalOnly,Kc?Object.keys(At.horizontal):[wn],ko,Rp,di,Ai,Rr,rn),Kc)break}At.vertical&&(f3+=n5(lt,yt,Ne,At.vertical,Ot,Tt,kr,$r,Pr,Yn,Bn.vertical,["vertical"],ko,Lp,di,Ai,Rr,rn));let da=-1;const Fp=(wn,Tn)=>wn?Math.max(wn,Tn):Tn;da=Fp(a3,da),da=Fp(l3,da),da=Fp(c3,da);const R8=da>-1?1:0;lt.glyphOffsetArray.length>=65535&&Qr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),$r.sortKey!==void 0&&lt.addToSortKeyRanges(lt.symbolInstances.length,$r.sortKey),lt.symbolInstances.emplaceBack(Ne.x,Ne.y,El.x,El.y,El.z,ko.right>=0?ko.right:-1,ko.center>=0?ko.center:-1,ko.left>=0?ko.left:-1,ko.vertical>=0?ko.vertical:-1,Rp,Lp,p3,_o!==void 0?_o:lt.collisionBoxArray.length,_o!==void 0?_o+1:lt.collisionBoxArray.length,ha!==void 0?ha:lt.collisionBoxArray.length,ha!==void 0?ha+1:lt.collisionBoxArray.length,ua!==void 0?ua:lt.collisionBoxArray.length,ua!==void 0?ua+1:lt.collisionBoxArray.length,Sl||lt.collisionBoxArray.length,Sl?Sl+1:lt.collisionBoxArray.length,vr,d3,f3,u3,h3,R8,0,kp,Bp,da,0,Op?1:0)})(t,Fe,ft,rt,r,n,a,Se,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,ne,pe,m,0,de,Te,L,e,l,g,x,v,S,A)};if(we==="line")for(const rt of X4(e.geometry,0,0,Qe,Qe)){const Fe=u9(rt,re,ve,r.vertical||V,n,G,W,t.overscaling,Qe);for(const bt of Fe)V&&_9(t,V.text,be,bt)||at(rt,bt,v)}else if(we==="line-center"){for(const rt of e.geometry)if(rt.length>1){const Fe=c9(rt,ve,r.vertical||V,n,G,W);Fe&&at(rt,Fe,v)}}else if(e.type==="Polygon")for(const rt of Qf(e.geometry,0)){const Fe=d9(rt,16);at(rt[0],new ps(Fe.x,Fe.y,0,0,void 0),v)}else if(e.type==="LineString")for(const rt of e.geometry)at(rt,new ps(rt[0].x,rt[0].y,0,0,void 0),v);else if(e.type==="Point")for(const rt of e.geometry)for(const Fe of rt)at([Fe],new ps(Fe.x,Fe.y,0,0,void 0),v)}const zh=255,oa=zh*co;function n5(t,e,r,n,a,l,h,f,m,g,x,v,w,S,A,P,R,L){const V=function(ee,W,re,ne,de,ve,pe,Te){const we=[];if(W.positionedLines.length===0)return we;const be=ne.layout.get("text-rotate").evaluate(ve,{})*Math.PI/180,Ce=function(at){const rt=at[0],Fe=at[1],bt=rt*Fe;return bt>0?[rt,-Fe]:bt<0?[-rt,Fe]:rt===0?[Fe,rt]:[Fe,-rt]}(re);let Ie=Math.abs(W.top-W.bottom);for(const at of W.positionedLines)Ie-=at.lineOffset;const ke=W.positionedLines.length,Le=Ie/ke;let Se=W.top-re[1];for(let at=0;at<ke;++at){const rt=W.positionedLines[at];Se=h9(W,Le,Se,at);for(const Fe of rt.positionedGlyphs){if(!Fe.rect)continue;const bt=Fe.rect||{};let ft=F4+1,lt=!0,Ne=1,yt=0;if(Fe.imageName){const ei=pe[Fe.imageName];if(!ei)continue;if(ei.sdf){Qr("SDF images are not supported in formatted text and will be ignored.");continue}lt=!1,Ne=ei.pixelRatio,ft=bn/Ne}const Lt=(de||Te)&&Fe.vertical,At=Fe.metrics.advance*Fe.scale/2,Ft=Fe.metrics,Ot=Fe.rect;if(Ot===null)continue;Te&&W.verticalizable&&(yt=Fe.imageName?At-Fe.metrics.width*Fe.scale/2:0);const Zt=de?[Fe.x+At,Fe.y]:[0,0];let Tt=[0,0],wr=[0,0],vr=!1;de||(Lt?(wr=[Fe.x+At+Ce[0],Fe.y+Ce[1]-yt],vr=!0):Tt=[Fe.x+At+re[0],Fe.y+re[1]-yt]);const nr=Ot.w*Fe.scale/(Ne*(Fe.localGlyph?uo:1)),Kt=Ot.h*Fe.scale/(Ne*(Fe.localGlyph?uo:1));let or,kr,Pr,Xr;if(Lt){const ei=Fe.y-Se,$r=new He(-At,At-ei),di=-Math.PI/2,Ei=new He(...wr);or=new He(-At+Tt[0],Tt[1]),or._rotateAround(di,$r)._add(Ei),or.x+=-ei+At,or.y-=(Ft.left-ft)*Fe.scale;const Ai=Fe.imageName?Ft.advance*Fe.scale:Ri*Fe.scale,Rr=String.fromCodePoint(Fe.glyph);qy(Rr)?or.x+=(1-ft)*Fe.scale:Zy(Rr)?or.x+=Ai-Ft.height*Fe.scale+(-ft-1)*Fe.scale:or.x+=Fe.imageName||Ft.width+2*ft===Ot.w&&Ft.height+2*ft===Ot.h?(Ai-Kt)/2:(Ai-(Ft.height+2*ft)*Fe.scale)/2,kr=new He(or.x,or.y-nr),Pr=new He(or.x+Kt,or.y),Xr=new He(or.x+Kt,or.y-nr)}else{const ei=(Ft.left-ft)*Fe.scale-At+Tt[0],$r=(-Ft.top-ft)*Fe.scale+Tt[1],di=ei+nr,Ei=$r+Kt;or=new He(ei,$r),kr=new He(di,$r),Pr=new He(ei,Ei),Xr=new He(di,Ei)}if(be){let ei;ei=de?new He(0,0):vr?new He(Ce[0],Ce[1]):new He(re[0],re[1]),or._rotateAround(be,ei),kr._rotateAround(be,ei),Pr._rotateAround(be,ei),Xr._rotateAround(be,ei)}const Zr=new He(0,0),Ui=new He(0,0);we.push({tl:or,tr:kr,bl:Pr,br:Xr,texPrimary:bt,texSecondary:void 0,writingMode:W.writingMode,glyphOffset:Zt,sectionIndex:Fe.sectionIndex,isSDF:lt,pixelOffsetTL:Zr,pixelOffsetBR:Ui,minFontScaleX:0,minFontScaleY:0})}}return we}(0,n,m,l,h,f,a,t.allowVerticalPlacement),q=t.textSizeData;let G=null;q.kind==="source"?(G=[co*l.layout.get("text-size").evaluate(f,{},R)],G[0]>oa&&Qr(`${t.layerIds[0]}: Value for "text-size" is >= ${zh}. Reduce your "text-size".`)):q.kind==="composite"&&(G=[co*A.compositeTextSizes[0].evaluate(f,{},R),co*A.compositeTextSizes[1].evaluate(f,{},R)],(G[0]>oa||G[1]>oa)&&Qr(`${t.layerIds[0]}: Value for "text-size" is >= ${zh}. Reduce your "text-size".`)),t.addSymbols(t.text,V,G,m,h,f,x,e,r,g.lineStartIndex,g.lineLength,S,P,R,L,!1);for(const ee of v)w[ee]=t.text.placedSymbolArray.length-1;return 4*V.length}function o5(t){for(const e in t)return t[e];return null}function q0(t,e,r,n,a,l,h,f,m,g){let x=h.top,v=h.bottom,w=h.left,S=h.right;const A=h.collisionPadding;if(A&&(w-=A[0],x-=A[1],S+=A[2],v+=A[3]),m){const P=new He(w,x),R=new He(S,x),L=new He(w,v),V=new He(S,v),q=er(m);let G=new He(0,0);g&&(G=new He(g[0],g[1])),P._rotateAround(q,G),R._rotateAround(q,G),L._rotateAround(q,G),V._rotateAround(q,G),w=Math.min(P.x,R.x,L.x,V.x),S=Math.max(P.x,R.x,L.x,V.x),x=Math.min(P.y,R.y,L.y,V.y),v=Math.max(P.y,R.y,L.y,V.y)}return t.emplaceBack(e.x,e.y,e.z,r.x,r.y,w,x,S,v,f,n,a,l),t.length-1}function hp(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);const e=t.bottom-t.top;return e>0?Math.max(10,e):null}function _9(t,e,r,n){const a=t.compareText;if(e in a){const l=a[e];for(let h=l.length-1;h>=0;h--)if(n.dist(l[h])<r)return!0}else a[e]=[];return a[e].push(n),!1}function s5(t,e){const r=t.fovAboveCenter,n=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,a=(t._camera.position[2]*t.worldSize-n)/Math.cos(t._pitch),l=Math.sin(r)*a/Math.sin(Math.max(Math.PI/2-t._pitch-r,.01)),h=Math.sin(t._pitch)*l+a;return Math.min(1.01*h,a*(1/t._horizonShift))}function Rh(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};const r=Math.pow(2,-t.z),n=t.x*r,a=(t.x+1)*r,l=t.y*r,h=(t.y+1)*r,f=vn(n),m=vn(a),g=zi(l),x=zi(h),v=e.project(f,g),w=e.project(m,g),S=e.project(m,x),A=e.project(f,x);let P=Math.min(v.x,w.x,S.x,A.x),R=Math.min(v.y,w.y,S.y,A.y),L=Math.max(v.x,w.x,S.x,A.x),V=Math.max(v.y,w.y,S.y,A.y);const q=r/16;function G(W,re,ne,de,ve,pe){const Te=(ne+ve)/2,we=(de+pe)/2,be=e.project(vn(Te),zi(we)),Ce=Math.max(0,P-be.x,R-be.y,be.x-L,be.y-V);P=Math.min(P,be.x),L=Math.max(L,be.x),R=Math.min(R,be.y),V=Math.max(V,be.y),Ce>q&&(G(W,be,ne,de,Te,we),G(be,re,Te,we,ve,pe))}G(v,w,n,l,a,l),G(w,S,a,l,a,h),G(S,A,a,h,n,h),G(A,v,n,h,n,l),P-=q,R-=q,L+=q,V+=q;const ee=1/Math.max(L-P,V-R);return{scale:ee,x:P*ee,y:R*ee,x2:L*ee,y2:V*ee,projection:e}}function a5(t,{x:e,y:r},n=0){return new He(((e-n)*t.scale-t.x)*Qe,(r*t.scale-t.y)*Qe)}const g9=s.a9.identity(new Float32Array(16));class sa{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,r){return{x:0,y:0,z:0}}unproject(e,r){return new ir(0,0)}projectTilePoint(e,r,n){return{x:e,y:r,z:0}}locationPoint(e,r,n=!0){return e._coordinatePoint(e.locationCoordinate(r),n)}pixelsPerMeter(e,r){return tn(1,e)*r}pixelSpaceConversion(e,r,n){return 1}farthestPixelDistance(e){return s5(e,e.pixelsPerMeter)}pointCoordinate(e,r,n,a){const l=e.horizonLineFromTop(!1),h=new He(r,Math.max(l,n));return e.rayIntersectionCoordinate(e.pointRayIntersection(h,a))}pointCoordinate3D(e,r,n){const a=new He(r,n);if(e.elevation)return e.elevation.pointCoordinate(a);{const l=this.pointCoordinate(e,a.x,a.y,0);return[l.x,l.y,l.z]}}isPointAboveHorizon(e,r){if(e.elevation)return!this.pointCoordinate3D(e,r.x,r.y);const n=e.horizonLineFromTop();return r.y<n}createInversionMatrix(e,r){return g9}createTileMatrix(e,r,n){let a,l,h;const f=n.canonical,m=s.a9.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const g=Rh(f,this);a=1,l=g.x+n.wrap*g.scale,h=g.y,s.a9.scale(m,m,[a/g.scale,a/g.scale,e.pixelsPerMeter/r])}else a=r/e.zoomScale(f.z),l=(f.x+Math.pow(2,f.z)*n.wrap)*a,h=f.y*a;return s.a9.translate(m,m,[l,h,0]),s.a9.scale(m,m,[a/Qe,a/Qe,1]),m}upVector(e,r,n){return[0,0,1]}upVectorScale(e,r,n){return{metersToTile:1}}}class y9 extends sa{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[r,n]=this.parallels=e.parallels||[29.5,45.5],a=Math.sin(er(r));this.n=(a+Math.sin(er(n)))/2,this.c=1+a*(2*this.n-a),this.r0=Math.sqrt(this.c)/this.n}project(e,r){const{n,c:a,r0:l}=this,h=er(e-this.center[0]),f=er(r),m=Math.sqrt(a-2*n*Math.sin(f))/n;return{x:m*Math.sin(h*n),y:m*Math.cos(h*n)-l,z:0}}unproject(e,r){const{n,c:a,r0:l}=this,h=l+r;let f=Math.atan2(e,Math.abs(h))*Math.sign(h);h*n<0&&(f-=Math.PI*Math.sign(e)*Math.sign(h));const m=er(this.center[0])*n;f=eo(f,-Math.PI-m,Math.PI-m);const g=Ht(Zi(f/n)+this.center[0],-180,180),x=Math.asin(Ht((a-(e*e+h*h)*n*n)/(2*n),-1,1)),v=Ht(Zi(x),-oi,oi);return new ir(g,v)}}const Lh=1.340264,Oh=-.081106,kh=893e-6,Bh=.003796,Z0=Math.sqrt(3)/2;class x9 extends sa{project(e,r){r=r/180*Math.PI,e=e/180*Math.PI;const n=Math.asin(Z0*Math.sin(r)),a=n*n,l=a*a*a;return{x:.5*(e*Math.cos(n)/(Z0*(Lh+3*Oh*a+l*(7*kh+9*Bh*a)))/Math.PI+.5),y:1-.5*(n*(Lh+Oh*a+l*(kh+Bh*a))/Math.PI+1),z:0}}unproject(e,r){e=(2*e-.5)*Math.PI;let n=r=(2*(1-r)-1)*Math.PI,a=n*n,l=a*a*a;for(let x,v,w,S=0;S<12&&(v=n*(Lh+Oh*a+l*(kh+Bh*a))-r,w=Lh+3*Oh*a+l*(7*kh+9*Bh*a),x=v/w,n=Ht(n-x,-Math.PI/3,Math.PI/3),a=n*n,l=a*a*a,!(Math.abs(x)<1e-12));++S);const h=Z0*e*(Lh+3*Oh*a+l*(7*kh+9*Bh*a))/Math.cos(n),f=Math.asin(Math.sin(n)/Z0),m=Ht(180*h/Math.PI,-180,180),g=Ht(180*f/Math.PI,-oi,oi);return new ir(m,g)}}class v9 extends sa{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,r){return{x:.5+e/360,y:.5-r/360,z:0}}unproject(e,r){const n=360*(e-.5),a=Ht(360*(.5-r),-oi,oi);return new ir(n,a)}}const Wc=Math.PI/2;function W0(t){return Math.tan((Wc+t)/2)}class b9 extends sa{constructor(e){super(e),this.center=e.center||[0,30];const[r,n]=this.parallels=e.parallels||[30,30];let a=er(r),l=er(n);this.southernCenter=a+l<0,this.southernCenter&&(a=-a,l=-l);const h=Math.cos(a),f=W0(a);this.n=a===l?Math.sin(a):Math.log(h/Math.cos(l))/Math.log(W0(l)/f),this.f=h*Math.pow(W0(a),this.n)/this.n}project(e,r){r=er(r),this.southernCenter&&(r=-r),e=er(e-this.center[0]);const n=1e-6,{n:a,f:l}=this;l>0?r<-Wc+n&&(r=-Wc+n):r>Wc-n&&(r=Wc-n);const h=l/Math.pow(W0(r),a);let f=h*Math.sin(a*e),m=l-h*Math.cos(a*e);return f=.5*(f/Math.PI+.5),m=.5*(m/Math.PI+.5),{x:f,y:this.southernCenter?m:1-m,z:0}}unproject(e,r){e=(2*e-.5)*Math.PI,this.southernCenter&&(r=1-r),r=(2*(1-r)-.5)*Math.PI;const{n,f:a}=this,l=a-r,h=Math.sign(l),f=Math.sign(n)*Math.sqrt(e*e+l*l);let m=Math.atan2(e,Math.abs(l))*h;l*n<0&&(m-=Math.PI*Math.sign(e)*h);const g=Ht(Zi(m/n)+this.center[0],-180,180),x=Ht(Zi(2*Math.atan(Math.pow(a/f,1/n))-Wc),-oi,oi);return new ir(g,this.southernCenter?-x:x)}}class l5 extends sa{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,r){return{x:Js(e),y:us(r),z:0}}unproject(e,r){const n=vn(e),a=zi(r);return new ir(n,a)}}const c5=er(oi);class w9 extends sa{project(e,r){const n=(r=er(r))*r,a=n*n;return{x:.5*((e=er(e))*(.8707-.131979*n+a*(a*(.003971*n-.001529*a)-.013791))/Math.PI+.5),y:1-.5*(r*(1.007226+n*(.015085+a*(.028874*n-.044475-.005916*a)))/Math.PI+1),z:0}}unproject(e,r){e=(2*e-.5)*Math.PI;let n=r=(2*(1-r)-1)*Math.PI,a=25,l=0,h=n*n;do{h=n*n;const g=h*h;l=(n*(1.007226+h*(.015085+g*(.028874*h-.044475-.005916*g)))-r)/(1.007226+h*(.045255+g*(.259866*h-.311325-.005916*11*g))),n=Ht(n-l,-c5,c5)}while(Math.abs(l)>1e-6&&--a>0);h=n*n;const f=Ht(Zi(e/(.8707+h*(h*(h*h*h*(.003971-.001529*h)-.013791)-.131979))),-180,180),m=Zi(n);return new ir(f,m)}}const u5=er(oi);class T9 extends sa{project(e,r){r=er(r),e=er(e);const n=Math.cos(r),a=2/Math.PI,l=Math.acos(n*Math.cos(e/2)),h=Math.sin(l)/l,f=.5*(e*a+2*n*Math.sin(e/2)/h)||0,m=.5*(r+Math.sin(r)/h)||0;return{x:.5*(f/Math.PI+.5),y:1-.5*(m/Math.PI+1),z:0}}unproject(e,r){let n=e=(2*e-.5)*Math.PI,a=r=(2*(1-r)-1)*Math.PI,l=25;const h=1e-6;let f=0,m=0;do{const g=Math.cos(a),x=Math.sin(a),v=2*x*g,w=x*x,S=g*g,A=Math.cos(n/2),P=Math.sin(n/2),R=2*A*P,L=P*P,V=1-S*A*A,q=V?1/V:0,G=V?Math.acos(g*A)*Math.sqrt(1/V):0,ee=.5*(2*G*g*P+2*n/Math.PI)-e,W=.5*(G*x+a)-r,re=.5*q*(S*L+G*g*A*w)+1/Math.PI,ne=q*(R*v/4-G*x*P),de=.125*q*(v*P-G*x*S*R),ve=.5*q*(w*A+G*L*g)+.5,pe=ne*de-ve*re;f=(W*ne-ee*ve)/pe,m=(ee*de-W*re)/pe,n=Ht(n-f,-Math.PI,Math.PI),a=Ht(a-m,-u5,u5)}while((Math.abs(f)>h||Math.abs(m)>h)&&--l>0);return new ir(Zi(n),Zi(a))}}class h5 extends sa{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(er(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,r){const{scale:n,cosPhi:a}=this;return{x:er(e)*a*n+.5,y:-Math.sin(er(r))/a*n+.5,z:0}}unproject(e,r){const{scale:n,cosPhi:a}=this,l=-(r-.5)/n,h=Ht(Zi((e-.5)/n)/a,-180,180),f=Math.asin(Ht(l*a,-1,1)),m=Ht(Zi(f),-oi,oi);return new ir(h,m)}}class S9 extends l5{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,r,n){const a=bh(e,r,n),l=E0(Oo(n));return s.Q.transformMat4(a,a,l),{x:a[0],y:a[1],z:a[2]}}locationPoint(e,r){const n=_l(r.lat,r.lng),a=s.Q.normalize([],n),l=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(r),e._centerAltitude):e._centerAltitude,h=tn(1,0)*Qe*l;s.Q.scaleAndAdd(n,n,a,h);const f=s.a9.identity(new Float64Array(16));return s.a9.multiply(f,e.pixelMatrix,e.globeMatrix),s.Q.transformMat4(n,n,f),new He(n[0],n[1])}pixelsPerMeter(e,r){return tn(1,0)*r}pixelSpaceConversion(e,r,n){const a=tn(1,e)*r,l=jt(tn(1,45)*r,a,n);return this.pixelsPerMeter(e,r)/l}createTileMatrix(e,r,n){const a=Uf(Oo(n.canonical));return s.a9.multiply(new Float64Array(16),e.globeMatrix,a)}createInversionMatrix(e,r){const{center:n}=e,a=E0(Oo(r));return s.a9.rotateY(a,a,er(n.lng)),s.a9.rotateX(a,a,er(n.lat)),s.a9.scale(a,a,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(a)}pointCoordinate(e,r,n,a){return I_(e,r,n,!0)||new Vi(0,0)}pointCoordinate3D(e,r,n){const a=this.pointCoordinate(e,r,n,0);return[a.x,a.y,a.z]}isPointAboveHorizon(e,r){return!I_(e,r.x,r.y,!1)}farthestPixelDistance(e){const r=function(a,l){const h=a.cameraToCenterDistance,f=a._centerAltitude*l,m=a._camera,g=a._camera.forward(),x=s.Q.add([],s.Q.scale([],g,-h),[0,0,f]),v=a.worldSize/(2*Math.PI),w=[0,0,-v],S=a.width/a.height,A=Math.tan(a.fovAboveCenter),P=s.Q.scale([],m.up(),A),R=s.Q.scale([],m.right(),A*S),L=s.Q.normalize([],s.Q.add([],s.Q.add([],g,P),R)),V=[];let q;if(new kf(x,L).closestPointOnSphere(w,v,V)){const G=s.Q.add([],V,w),ee=s.Q.sub([],G,x);q=Math.cos(a.fovAboveCenter)*s.Q.length(ee)}else{const G=s.Q.sub([],x,w),ee=s.Q.sub([],w,x);s.Q.normalize(ee,ee);const W=s.Q.length(G)-v;q=Math.sqrt(W*(W+2*v));const re=Math.acos(q/(v+W))-Math.acos(s.Q.dot(g,ee));q*=Math.cos(re)}return 1.01*q}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),n=ea(e.zoom);if(n>0){const a=s5(e,tn(1,e.center.lat)*e.worldSize),l=e.worldSize/(2*Math.PI),h=Math.max(e.width,e.height)/e.worldSize*Math.PI;return jt(r,a+l*(1-Math.cos(h)),Math.pow(n,10))}return r}upVector(e,r,n){return bh(r,n,e,1)}upVectorScale(e){return{metersToTile:w0(S0(Oo(e)))}}}function d5(t){const e=t.parallels,r=!!e&&Math.abs(e[0]+e[1])<.01;switch(t.name){case"mercator":return new l5(t);case"equirectangular":return new v9(t);case"naturalEarth":return new w9(t);case"equalEarth":return new x9(t);case"winkelTripel":return new T9(t);case"albers":return r?new h5(t):new y9(t);case"lambertConformalConic":return r?new h5(t):new b9(t);case"globe":return new S9(t)}throw new Error(`Invalid projection name: ${t.name}`)}const E9=z0.types,A9=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function H0(t,e,r,n,a,l,h,f,m,g,x,v,w){const S=f?Math.min(oa,Math.round(f[0])):0,A=f?Math.min(oa,Math.round(f[1])):0;t.emplaceBack(e,r,Math.round(32*n),Math.round(32*a),l,h,(S<<1)+(m?1:0),A,16*g,16*x,256*v,256*w)}function Q0(t,e,r){t.emplaceBack(e,r)}function X0(t,e,r,n,a,l,h){t.emplaceBack(e,r,n,a,l,h)}function Y0(t,e,r,n,a){t.emplaceBack(e,r,n,a),t.emplaceBack(e,r,n,a),t.emplaceBack(e,r,n,a),t.emplaceBack(e,r,n,a)}function M9(t){for(const e of t.sections)if(T(e.text))return!0;return!1}class dp{constructor(e){this.layoutVertexArray=new Wn,this.indexArray=new gi,this.programConfigurations=e,this.segments=new ni,this.dynamicLayoutVertexArray=new _i,this.opacityVertexArray=new Lo,this.placedSymbolArray=new Ym,this.iconTransitioningVertexArray=new xn,this.globeExtVertexArray=new Hn,this.zOffsetVertexArray=new mh}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,r,n,a,l){this.isEmpty()||(n&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Oy.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,By.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,A9,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,Ny.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,ky.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||l)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,Fy.members,!0)),this.opacityVertexBuffer.itemSize=1),(n||a)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}nt(dp,"SymbolBuffers");class fp{constructor(e,r,n){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new n,this.segments=new ni,this.collisionVertexArray=new ao,this.collisionVertexArrayExt=new _i}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Vy.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,Uy.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}nt(fp,"CollisionBuffers");class J0{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(h=>h.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=s.a9.identity([]),this.placementViewportMatrix=s.a9.identity([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=rp(this.zoom,r["text-size"]),this.iconSizeData=rp(this.zoom,r["icon-size"]);const n=this.layers[0].layout,a=n.get("symbol-sort-key"),l=n.get("symbol-z-order");this.canOverlap=n.get("text-allow-overlap")||n.get("icon-allow-overlap")||n.get("text-ignore-placement")||n.get("icon-ignore-placement"),this.sortFeaturesByKey=l!=="viewport-y"&&a.constantOr(1)!==void 0,this.sortFeaturesByY=(l==="viewport-y"||l==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=n.get("text-writing-mode").map(h=>Bn[h]),this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=n.get("symbol-z-elevate")}createArrays(){this.text=new dp(new Xs(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new dp(new Xs(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new e_,this.lineVertexArray=new t_,this.symbolInstances=new Km}calculateGlyphDependencies(e,r,n,a,l){for(let h=0;h<e.length;h++){const f=e.codePointAt(h);if(f===void 0)break;if(r[f]=!0,a&&l&&f<=65535){const m=Ph[e.charAt(h)];m&&(r[m.charCodeAt(0)]=!0)}}}populate(e,r,n,a){const l=this.layers[0],h=l.layout,f=this.projection.name==="globe",m=h.get("text-font"),g=h.get("text-field"),x=h.get("icon-image"),v=(g.value.kind!=="constant"||g.value.value instanceof Ii&&!g.value.value.isEmpty()||g.value.value.toString().length>0)&&(m.value.kind!=="constant"||m.value.value.length>0),w=x.value.kind!=="constant"||!!x.value.value||Object.keys(x.parameters).length>0,S=h.get("symbol-sort-key");if(this.features=[],!v&&!w)return;const A=r.iconDependencies,P=r.glyphDependencies,R=r.availableImages,L=new N(this.zoom);for(const{feature:V,id:q,index:G,sourceLayerIndex:ee}of e){const W=l._featureFilter.needGeometry,re=Ks(V,W);if(!l._featureFilter.filter(L,re,n))continue;if(W||(re.geometry=hs(V,n,a)),f&&V.type!==1&&n.z<=5){const pe=re.geometry,Te=.98078528056,we=(be,Ce)=>{const Ie=bh(be.x,be.y,n,1),ke=bh(Ce.x,Ce.y,n,1);return s.Q.dot(Ie,ke)<Te};for(let be=0;be<pe.length;be++)pe[be]=m7(pe[be],we)}let ne,de;if(v){const pe=l.getValueAndResolveTokens("text-field",re,n,R),Te=Ii.factory(pe);M9(Te)&&(this.hasRTLText=!0),(!this.hasRTLText||Q()==="unavailable"||this.hasRTLText&&Y.isParsed())&&(ne=$y(Te,l,re))}if(w){const pe=l.getValueAndResolveTokens("icon-image",re,n,R);de=pe instanceof hn?pe:hn.fromString(pe)}if(!ne&&!de)continue;const ve=this.sortFeaturesByKey?S.evaluate(re,{},n):void 0;if(this.features.push({id:q,text:ne,icon:de,index:G,sourceLayerIndex:ee,geometry:re.geometry,properties:V.properties,type:E9[V.type],sortKey:ve}),de&&(A[de.namePrimary]=!0,de.nameSecondary&&(A[de.nameSecondary]=!0)),ne){const pe=m.evaluate(re,{},n).join(","),Te=h.get("text-rotation-alignment")==="map"&&h.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Bn.vertical)>=0;for(const we of ne.sections)if(we.image)A[we.image.namePrimary]=!0;else{const be=o(ne.toString()),Ce=we.fontStack||pe,Ie=P[Ce]=P[Ce]||{};this.calculateGlyphDependencies(we.text,Ie,Te,this.allowVerticalPlacement,be)}}}h.get("symbol-placement")==="line"&&(this.features=function(V){const q={},G={},ee=[];let W=0;function re(pe){ee.push(V[pe]),W++}function ne(pe,Te,we){const be=G[pe];return delete G[pe],G[Te]=be,ee[be].geometry[0].pop(),ee[be].geometry[0]=ee[be].geometry[0].concat(we[0]),be}function de(pe,Te,we){const be=q[Te];return delete q[Te],q[pe]=be,ee[be].geometry[0].shift(),ee[be].geometry[0]=we[0].concat(ee[be].geometry[0]),be}function ve(pe,Te,we){const be=we?Te[0][Te[0].length-1]:Te[0][0];return`${pe}:${be.x}:${be.y}`}for(let pe=0;pe<V.length;pe++){const Te=V[pe],we=Te.geometry,be=Te.text?Te.text.toString():null;if(!be){re(pe);continue}const Ce=ve(be,we),Ie=ve(be,we,!0);if(Ce in G&&Ie in q&&G[Ce]!==q[Ie]){const ke=de(Ce,Ie,we),Le=ne(Ce,Ie,ee[ke].geometry);delete q[Ce],delete G[Ie],G[ve(be,ee[Le].geometry,!0)]=Le,ee[ke].geometry=null}else Ce in G?ne(Ce,Ie,we):Ie in q?de(Ce,Ie,we):(re(pe),q[Ce]=W-1,G[Ie]=W-1)}return ee.filter(pe=>pe.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((V,q)=>V.sortKey-q.sortKey)}update(e,r,n,a,l){const h=Object.keys(e).length!==0;if(h&&!this.stateDependentLayers.length)return;const f=h?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(e,r,f,n,a,l),this.icon.programConfigurations.updatePaintArrays(e,r,f,n,a,l)}updateZOffset(){const e=(l,h,f)=>{n+=h,n>l.length&&l.resize(n);for(let m=-h;m<0;m++)l.emplace(m+n,f)},r=(l,h,f)=>{a+=h,a>l.length&&l.resize(a);for(let m=-h;m<0;m++)l.emplace(m+a,f)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let n=0,a=0;for(let l=0;l<this.symbolInstances.length;l++){const h=this.symbolInstances.get(l),{numHorizontalGlyphVertices:f,numVerticalGlyphVertices:m,numIconVertices:g}=h,x=h.zOffset,v=g>0;if((f>0||m>0)&&(e(this.text.zOffsetVertexArray,f,x),e(this.text.zOffsetVertexArray,m,x)),v){const{placedIconSymbolIndex:w,verticalPlacedIconSymbolIndex:S}=h;w>=0&&r(this.icon.zOffsetVertexArray,g,x),S>=0&&r(this.icon.zOffsetVertexArray,h.numVerticalIconVertices,x)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=d5(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){const n=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:a,y:l}of r)this.lineVertexArray.emplaceBack(a,l);return{lineStartIndex:n,lineLength:this.lineVertexArray.length-n}}addSymbols(e,r,n,a,l,h,f,m,g,x,v,w,S,A,P,R){const L=e.indexArray,V=e.layoutVertexArray,q=e.globeExtVertexArray,G=e.segments.prepareSegment(4*r.length,V,L,this.canOverlap?h.sortKey:void 0),ee=this.glyphOffsetArray.length,W=G.vertexLength,re=this.allowVerticalPlacement&&f===Bn.vertical?Math.PI/2:0,ne=h.text&&h.text.sections;for(let ve=0;ve<r.length;ve++){const{tl:pe,tr:Te,bl:we,br:be,texPrimary:Ce,texSecondary:Ie,pixelOffsetTL:ke,pixelOffsetBR:Le,minFontScaleX:Se,minFontScaleY:at,glyphOffset:rt,isSDF:Fe,sectionIndex:bt}=r[ve],ft=G.vertexLength,lt=rt[1];if(H0(V,g.x,g.y,pe.x,lt+pe.y,Ce.x,Ce.y,n,Fe,ke.x,ke.y,Se,at),H0(V,g.x,g.y,Te.x,lt+Te.y,Ce.x+Ce.w,Ce.y,n,Fe,Le.x,ke.y,Se,at),H0(V,g.x,g.y,we.x,lt+we.y,Ce.x,Ce.y+Ce.h,n,Fe,ke.x,Le.y,Se,at),H0(V,g.x,g.y,be.x,lt+be.y,Ce.x+Ce.w,Ce.y+Ce.h,n,Fe,Le.x,Le.y,Se,at),m){const{x:Ne,y:yt,z:Lt}=m.anchor,[At,Ft,Ot]=m.up;X0(q,Ne,yt,Lt,At,Ft,Ot),X0(q,Ne,yt,Lt,At,Ft,Ot),X0(q,Ne,yt,Lt,At,Ft,Ot),X0(q,Ne,yt,Lt,At,Ft,Ot),Y0(e.dynamicLayoutVertexArray,Ne,yt,Lt,re)}else Y0(e.dynamicLayoutVertexArray,g.x,g.y,g.z,re);if(R){const Ne=Ie||Ce;Q0(e.iconTransitioningVertexArray,Ne.x,Ne.y),Q0(e.iconTransitioningVertexArray,Ne.x+Ne.w,Ne.y),Q0(e.iconTransitioningVertexArray,Ne.x,Ne.y+Ne.h),Q0(e.iconTransitioningVertexArray,Ne.x+Ne.w,Ne.y+Ne.h)}L.emplaceBack(ft,ft+1,ft+2),L.emplaceBack(ft+1,ft+2,ft+3),G.vertexLength+=4,G.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(rt[0]),ve!==r.length-1&&bt===r[ve+1].sectionIndex||e.programConfigurations.populatePaintArrays(V.length,h,h.index,{},S,A,P,ne&&ne[bt])}const de=m?m.anchor:g;e.placedSymbolArray.emplaceBack(de.x,de.y,de.z,g.x,g.y,ee,this.glyphOffsetArray.length-ee,W,x,v,g.segment,n?n[0]:0,n?n[1]:0,a[0],a[1],f,0,!1,0,w,0)}_commitLayoutVertex(e,r,n,a,l,h,f){e.emplaceBack(r,n,a,l,h,Math.round(f.x),Math.round(f.y))}_addCollisionDebugVertices(e,r,n,a,l,h,f){const m=n.segments.prepareSegment(4,n.layoutVertexArray,n.indexArray),g=m.vertexLength,x=f.tileAnchorX,v=f.tileAnchorY;for(let S=0;S<4;S++)n.collisionVertexArray.emplaceBack(0,0,0,0);this._commitDebugCollisionVertexUpdate(n.collisionVertexArrayExt,r,e.padding,f.zOffset),this._commitLayoutVertex(n.layoutVertexArray,a,l,h,x,v,new He(e.x1,e.y1)),this._commitLayoutVertex(n.layoutVertexArray,a,l,h,x,v,new He(e.x2,e.y1)),this._commitLayoutVertex(n.layoutVertexArray,a,l,h,x,v,new He(e.x2,e.y2)),this._commitLayoutVertex(n.layoutVertexArray,a,l,h,x,v,new He(e.x1,e.y2)),m.vertexLength+=4;const w=n.indexArray;w.emplaceBack(g,g+1),w.emplaceBack(g+1,g+2),w.emplaceBack(g+2,g+3),w.emplaceBack(g+3,g),m.primitiveLength+=4}_addTextDebugCollisionBoxes(e,r,n,a,l,h){for(let f=a;f<l;f++){const m=n.get(f),g=this.getSymbolInstanceTextSize(e,h,r,f);this._addCollisionDebugVertices(m,g,this.textCollisionBox,m.projectedAnchorX,m.projectedAnchorY,m.projectedAnchorZ,h)}}_addIconDebugCollisionBoxes(e,r,n,a,l,h){for(let f=a;f<l;f++){const m=n.get(f),g=this.getSymbolInstanceIconSize(e,r,h.placedIconSymbolIndex);this._addCollisionDebugVertices(m,g,this.iconCollisionBox,m.projectedAnchorX,m.projectedAnchorY,m.projectedAnchorZ,h)}}generateCollisionDebugBuffers(e,r){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new fp(Ws,z4.members,xn),this.iconCollisionBox=new fp(Ws,z4.members,xn);const n=Vc(this.iconSizeData,e),a=Vc(this.textSizeData,e);for(let l=0;l<this.symbolInstances.length;l++){const h=this.symbolInstances.get(l);this._addTextDebugCollisionBoxes(a,e,r,h.textBoxStartIndex,h.textBoxEndIndex,h),this._addTextDebugCollisionBoxes(a,e,r,h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h),this._addIconDebugCollisionBoxes(n,e,r,h.iconBoxStartIndex,h.iconBoxEndIndex,h),this._addIconDebugCollisionBoxes(n,e,r,h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex,h)}}getSymbolInstanceTextSize(e,r,n,a){const l=this.text.placedSymbolArray.get(r.rightJustifiedTextSymbolIndex>=0?r.rightJustifiedTextSymbolIndex:r.centerJustifiedTextSymbolIndex>=0?r.centerJustifiedTextSymbolIndex:r.leftJustifiedTextSymbolIndex>=0?r.leftJustifiedTextSymbolIndex:r.verticalPlacedTextSymbolIndex>=0?r.verticalPlacedTextSymbolIndex:a),h=F0(this.textSizeData,e,l)/Ri;return this.tilePixelRatio*h}getSymbolInstanceIconSize(e,r,n){const a=this.icon.placedSymbolArray.get(n),l=F0(this.iconSizeData,e,a);return this.tilePixelRatio*l}_commitDebugCollisionVertexUpdate(e,r,n,a){e.emplaceBack(r,-n,-n,a),e.emplaceBack(r,n,-n,a),e.emplaceBack(r,n,n,a),e.emplaceBack(r,-n,n,a)}_updateTextDebugCollisionBoxes(e,r,n,a,l,h){for(let f=a;f<l;f++){const m=n.get(f),g=this.getSymbolInstanceTextSize(e,h,r,f);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,g,m.padding,h.zOffset)}}_updateIconDebugCollisionBoxes(e,r,n,a,l,h){for(let f=a;f<l;f++){const m=n.get(f),g=this.getSymbolInstanceIconSize(e,r,h.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,g,m.padding,h.zOffset)}}updateCollisionDebugBuffers(e,r){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const n=Vc(this.iconSizeData,e),a=Vc(this.textSizeData,e);for(let l=0;l<this.symbolInstances.length;l++){const h=this.symbolInstances.get(l);this._updateTextDebugCollisionBoxes(a,e,r,h.textBoxStartIndex,h.textBoxEndIndex,h),this._updateTextDebugCollisionBoxes(a,e,r,h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h),this._updateIconDebugCollisionBoxes(n,e,r,h.iconBoxStartIndex,h.iconBoxEndIndex,h),this._updateIconDebugCollisionBoxes(n,e,r,h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex,h)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,r,n,a,l,h,f,m,g){const x={};if(r<n){const{x1:v,y1:w,x2:S,y2:A,padding:P,projectedAnchorX:R,projectedAnchorY:L,projectedAnchorZ:V,tileAnchorX:q,tileAnchorY:G,featureIndex:ee}=e.get(r);x.textBox={x1:v,y1:w,x2:S,y2:A,padding:P,projectedAnchorX:R,projectedAnchorY:L,projectedAnchorZ:V,tileAnchorX:q,tileAnchorY:G},x.textFeatureIndex=ee}if(a<l){const{x1:v,y1:w,x2:S,y2:A,padding:P,projectedAnchorX:R,projectedAnchorY:L,projectedAnchorZ:V,tileAnchorX:q,tileAnchorY:G,featureIndex:ee}=e.get(a);x.verticalTextBox={x1:v,y1:w,x2:S,y2:A,padding:P,projectedAnchorX:R,projectedAnchorY:L,projectedAnchorZ:V,tileAnchorX:q,tileAnchorY:G},x.verticalTextFeatureIndex=ee}if(h<f){const{x1:v,y1:w,x2:S,y2:A,padding:P,projectedAnchorX:R,projectedAnchorY:L,projectedAnchorZ:V,tileAnchorX:q,tileAnchorY:G,featureIndex:ee}=e.get(h);x.iconBox={x1:v,y1:w,x2:S,y2:A,padding:P,projectedAnchorX:R,projectedAnchorY:L,projectedAnchorZ:V,tileAnchorX:q,tileAnchorY:G},x.iconFeatureIndex=ee}if(m<g){const{x1:v,y1:w,x2:S,y2:A,padding:P,projectedAnchorX:R,projectedAnchorY:L,projectedAnchorZ:V,tileAnchorX:q,tileAnchorY:G,featureIndex:ee}=e.get(m);x.verticalIconBox={x1:v,y1:w,x2:S,y2:A,padding:P,projectedAnchorX:R,projectedAnchorY:L,projectedAnchorZ:V,tileAnchorX:q,tileAnchorY:G},x.verticalIconFeatureIndex=ee}return x}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const n=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,n.textBoxStartIndex,n.textBoxEndIndex,n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n.iconBoxStartIndex,n.iconBoxEndIndex,n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,r){const n=e.placedSymbolArray.get(r),a=n.vertexStartIndex+4*n.numGlyphs;for(let l=n.vertexStartIndex;l<a;l+=4)e.indexArray.emplaceBack(l,l+1,l+2),e.indexArray.emplaceBack(l+1,l+2,l+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(e),n=Math.cos(e),a=[],l=[],h=[];for(let f=0;f<this.symbolInstances.length;++f){h.push(f);const m=this.symbolInstances.get(f);a.push(0|Math.round(r*m.tileAnchorX+n*m.tileAnchorY)),l.push(m.featureIndex)}return h.sort((f,m)=>a[f]-a[m]||l[m]-l[f]),h}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,r)=>this.symbolInstances.get(r).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,r){const n=this.sortKeyRanges[this.sortKeyRanges.length-1];n&&n.sortKey===r?n.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const n=this.symbolInstances.get(r);this.featureSortOrder.push(n.featureIndex);const{rightJustifiedTextSymbolIndex:a,centerJustifiedTextSymbolIndex:l,leftJustifiedTextSymbolIndex:h,verticalPlacedTextSymbolIndex:f,placedIconSymbolIndex:m,verticalPlacedIconSymbolIndex:g}=n;a>=0&&this.addIndicesForPlacedSymbol(this.text,a),l>=0&&l!==a&&this.addIndicesForPlacedSymbol(this.text,l),h>=0&&h!==l&&h!==a&&this.addIndicesForPlacedSymbol(this.text,h),f>=0&&this.addIndicesForPlacedSymbol(this.text,f),m>=0&&this.addIndicesForPlacedSymbol(this.icon,m),g>=0&&this.addIndicesForPlacedSymbol(this.icon,g)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}nt(J0,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),J0.addDynamicAttributes=Y0;const I9=new ue({"symbol-placement":new oe(X.layout_symbol["symbol-placement"]),"symbol-spacing":new oe(X.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new oe(X.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new fe(X.layout_symbol["symbol-sort-key"]),"symbol-z-order":new oe(X.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new oe(X.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new oe(X.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new oe(X.layout_symbol["icon-ignore-placement"]),"icon-optional":new oe(X.layout_symbol["icon-optional"]),"icon-rotation-alignment":new oe(X.layout_symbol["icon-rotation-alignment"]),"icon-size":new fe(X.layout_symbol["icon-size"]),"icon-text-fit":new fe(X.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new fe(X.layout_symbol["icon-text-fit-padding"]),"icon-image":new fe(X.layout_symbol["icon-image"]),"icon-rotate":new fe(X.layout_symbol["icon-rotate"]),"icon-padding":new oe(X.layout_symbol["icon-padding"]),"icon-keep-upright":new oe(X.layout_symbol["icon-keep-upright"]),"icon-offset":new fe(X.layout_symbol["icon-offset"]),"icon-anchor":new fe(X.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new oe(X.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new oe(X.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new oe(X.layout_symbol["text-rotation-alignment"]),"text-field":new fe(X.layout_symbol["text-field"]),"text-font":new fe(X.layout_symbol["text-font"]),"text-size":new fe(X.layout_symbol["text-size"]),"text-max-width":new fe(X.layout_symbol["text-max-width"]),"text-line-height":new fe(X.layout_symbol["text-line-height"]),"text-letter-spacing":new fe(X.layout_symbol["text-letter-spacing"]),"text-justify":new fe(X.layout_symbol["text-justify"]),"text-radial-offset":new fe(X.layout_symbol["text-radial-offset"]),"text-variable-anchor":new oe(X.layout_symbol["text-variable-anchor"]),"text-anchor":new fe(X.layout_symbol["text-anchor"]),"text-max-angle":new oe(X.layout_symbol["text-max-angle"]),"text-writing-mode":new oe(X.layout_symbol["text-writing-mode"]),"text-rotate":new fe(X.layout_symbol["text-rotate"]),"text-padding":new oe(X.layout_symbol["text-padding"]),"text-keep-upright":new oe(X.layout_symbol["text-keep-upright"]),"text-transform":new fe(X.layout_symbol["text-transform"]),"text-offset":new fe(X.layout_symbol["text-offset"]),"text-allow-overlap":new oe(X.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new oe(X.layout_symbol["text-ignore-placement"]),"text-optional":new oe(X.layout_symbol["text-optional"]),visibility:new oe(X.layout_symbol.visibility)});var pp={paint:new ue({"icon-opacity":new fe(X.paint_symbol["icon-opacity"]),"icon-emissive-strength":new fe(X.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new fe(X.paint_symbol["text-emissive-strength"]),"icon-color":new fe(X.paint_symbol["icon-color"]),"icon-halo-color":new fe(X.paint_symbol["icon-halo-color"]),"icon-halo-width":new fe(X.paint_symbol["icon-halo-width"]),"icon-halo-blur":new fe(X.paint_symbol["icon-halo-blur"]),"icon-translate":new oe(X.paint_symbol["icon-translate"]),"icon-translate-anchor":new oe(X.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new fe(X.paint_symbol["icon-image-cross-fade"]),"text-opacity":new fe(X.paint_symbol["text-opacity"]),"text-color":new fe(X.paint_symbol["text-color"],{runtimeType:un,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new fe(X.paint_symbol["text-halo-color"]),"text-halo-width":new fe(X.paint_symbol["text-halo-width"]),"text-halo-blur":new fe(X.paint_symbol["text-halo-blur"]),"text-translate":new oe(X.paint_symbol["text-translate"]),"text-translate-anchor":new oe(X.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new oe(X.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new oe(X.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new oe(X.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new oe(X.paint_symbol["icon-color-brightness-max"])}),layout:I9};class f5{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:$t,this.defaultValue=e}evaluate(e){if(e.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}nt(f5,"FormatSectionOverride",{omit:["defaultValue"]});class K0 extends Nt{constructor(e,r,n){super(e,pp,r,n),this._colorAdjustmentMatrix=s.a9.identity([])}recalculate(e,r){super.recalculate(e,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const n=this.layout.get("text-writing-mode");if(n){const a=[];for(const l of n)a.indexOf(l)<0&&a.push(l);this.layout._values["text-writing-mode"]=a}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,r,n,a){return this._saturation===e&&this._contrast===r&&this._brightnessMin===n&&this._brightnessMax===a||(this._colorAdjustmentMatrix=function(l,h,f,m){l=S1(l),h=Pn(h);const g=s.a9.create(),x=l/3,v=1-2*x,w=[v,x,x,0,x,v,x,0,x,x,v,0,0,0,0,1],S=.5-.5*h,A=m-f;return s.a9.multiply(g,[A,0,0,0,0,A,0,0,0,0,A,0,f,f,f,1],[h,0,0,0,0,h,0,0,0,0,h,0,S,S,S,1]),s.a9.multiply(g,g,w),g}(e,r,n,a),this._saturation=e,this._contrast=r,this._brightnessMin=n,this._brightnessMax=a),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,r,n,a){const l=this.layout.get(e).evaluate(r,{},n,a),h=this._unevaluatedLayout._values[e];return h.isDataDriven()||Mc(h.value)||!l?l:function(f,m){return m.replace(/{([^{}]+)}/g,(g,x)=>x in f?String(f[x]):"")}(r.properties,l)}createBucket(e){return new J0(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of pp.paint.overridableProperties){if(!K0.hasPaintOverride(this.layout,e))continue;const r=this.paint.get(e),n=new f5(r),a=new Ac(n,r.property.specification,this.scope,this.options);let l=null;l=r.value.kind==="constant"||r.value.kind==="source"?new sl("source",a):new al("composite",a,r.value.zoomStops,r.value._interpolationType),this.paint._values[e]=new me(r.property,l,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,n){return!(!this.layout||r.isDataDriven()||n.isDataDriven())&&K0.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){const n=e.get("text-field"),a=pp.paint.properties[r];let l=!1;const h=f=>{for(const m of f)if(a.overrides&&a.overrides.hasOverride(m))return void(l=!0)};if(n.value.kind==="constant"&&n.value.value instanceof Ii)h(n.value.value.sections);else if(n.value.kind==="source"){const f=g=>{l||(g instanceof $n&&ui(g.value)===Rs?h(g.value.sections):g instanceof $a?h(g.sections):g.eachChild(f))},m=n.value;m._styleExpression&&f(m._styleExpression.expression)}return l}getProgramIds(){const e=this.paint.get("icon-opacity").constantOr(1)!==0,r=this.paint.get("text-opacity").constantOr(1)!==0,n=[];return e&&n.push("symbolIcon"),r&&n.push("symbolSDF"),n}getDefaultProgramParams(e,r){return{config:new ml(this,r),overrideFog:!1}}}const P9=new ue({visibility:new oe(X.layout_background.visibility)});var C9={paint:new ue({"background-color":new oe(X.paint_background["background-color"]),"background-pattern":new oe(X.paint_background["background-pattern"]),"background-opacity":new oe(X.paint_background["background-opacity"]),"background-emissive-strength":new oe(X.paint_background["background-emissive-strength"])}),layout:P9};const D9=new ue({visibility:new oe(X.layout_raster.visibility)});var z9={paint:new ue({"raster-opacity":new oe(X.paint_raster["raster-opacity"]),"raster-color":new Re(X.paint_raster["raster-color"]),"raster-color-mix":new oe(X.paint_raster["raster-color-mix"]),"raster-color-range":new oe(X.paint_raster["raster-color-range"]),"raster-hue-rotate":new oe(X.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new oe(X.paint_raster["raster-brightness-min"]),"raster-brightness-max":new oe(X.paint_raster["raster-brightness-max"]),"raster-saturation":new oe(X.paint_raster["raster-saturation"]),"raster-contrast":new oe(X.paint_raster["raster-contrast"]),"raster-resampling":new oe(X.paint_raster["raster-resampling"]),"raster-fade-duration":new oe(X.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new oe(X.paint_raster["raster-emissive-strength"]),"raster-array-band":new oe(X.paint_raster["raster-array-band"]),"raster-elevation":new oe(X.paint_raster["raster-elevation"])}),layout:D9},mp=Rt([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class _p{constructor(e,r,n,a){this.context=e,this.format=n,this.texture=e.gl.createTexture(),this.update(r,a)}update(e,r,n){const{width:a,height:l}=e,{context:h}=this,{gl:f}=h;if(f.bindTexture(f.TEXTURE_2D,this.texture),h.pixelStoreUnpackFlipY.set(!1),h.pixelStoreUnpack.set(1),h.pixelStoreUnpackPremultiplyAlpha.set(this.format===f.RGBA&&(!r||r.premultiply!==!1)),n||this.size&&this.size[0]===a&&this.size[1]===l){const{x:m,y:g}=n||{x:0,y:0};if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap)f.texSubImage2D(f.TEXTURE_2D,0,m,g,f.RGBA,f.UNSIGNED_BYTE,e);else{let x=this.format,v=f.UNSIGNED_BYTE;this.format===f.R32F&&(x=f.RED,v=f.FLOAT),f.texSubImage2D(f.TEXTURE_2D,0,m,g,a,l,x,v,e.data)}}else if(this.size=[a,l],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap){let m=this.format;this.format===f.R8&&(m=f.RED),f.texImage2D(f.TEXTURE_2D,0,this.format,m,f.UNSIGNED_BYTE,e)}else{let m=this.format,g=this.format,x=f.UNSIGNED_BYTE;this.format===f.DEPTH_COMPONENT&&(m=f.DEPTH_COMPONENT16,x=f.UNSIGNED_SHORT),this.format===f.R8&&(g=f.RED),this.format===f.R32F&&(x=f.FLOAT,g=f.RED),f.texImage2D(f.TEXTURE_2D,0,m,a,l,0,g,x,e.data)}this.useMipmap=!!(r&&r.useMipmap),this.useMipmap&&f.generateMipmap(f.TEXTURE_2D)}bind(e,r,n=!1){const{context:a}=this,{gl:l}=a;l.bindTexture(l.TEXTURE_2D,this.texture),e!==this.minFilter&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,e),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,this.useMipmap&&!n?e===l.NEAREST?l.NEAREST_MIPMAP_NEAREST:l.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),r!==this.wrapS&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,r),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,r),this.wrapS=r)}bindExtraParam(e,r,n,a){const{context:l}=this,{gl:h}=l;h.bindTexture(h.TEXTURE_2D,this.texture),r!==this.magFilter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,r),this.magFilter=r),e!==this.minFilter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,this.useMipmap?e===h.NEAREST?h.NEAREST_MIPMAP_NEAREST:h.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),n!==this.wrapS&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,n),this.wrapS=n),a!==this.wrapT&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,a),this.wrapT=a)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class ed{constructor(e,r){this.context=e,this.texture=r}bind(e,r){const{context:n}=this,{gl:a}=n;a.bindTexture(a.TEXTURE_2D,this.texture),e!==this.minFilter&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,e),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,e),this.minFilter=e),r!==this.wrapS&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,r),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,r),this.wrapS=r)}}function td(t,e,r,n,a,l,h,f){const m=[t,e,1,r,n,1,a,l,1],g=[h,f,1],x=s.ct.adjoint([],m),[v,w,S]=s.Q.transformMat3(g,g,x);return s.ct.multiply(m,m,[v,0,0,0,w,0,0,0,S])}function p5(t,e,r,n,a,l,h,f){const m=function(g,x,v,w,S,A,P,R){const L=td(0,0,1,0,1,1,0,1),V=td(g,x,v,w,S,A,P,R),q=s.ct.adjoint([],L);return s.ct.multiply(V,V,q)}(t,e,r,n,a,l,h,f);return[m[2]/m[8]/Qe,m[5]/m[8]/Qe]}function rd(t){return[t[0],Math.min(Math.max(t[1],-oi),oi)]}class m5 extends Yo{constructor(e,r,n,a){super(),this.id=e,this.dispatcher=n,this.coordinates=r.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(a),this.options=r,this._dirty=!1}load(e,r){if(this._loaded=r||!1,this.fire(new Ao("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=Du(this.map._requestManager.transformRequest(this.url,Hl.Image),(n,a)=>{this._imageRequest=null,this._loaded=!0,n?this.fire(new ic(n)):a&&(this.image=a instanceof HTMLImageElement?jn.getImageData(a):a,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new ed(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Ao("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof ed||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let r=e[0][1],n=e[0][1];for(const l of e)l[1]>n&&(n=l[1]),l[1]<r&&(r=l[1]);const a=(n+r)/2;if(a>oi?this.onNorthPole=!0:a<-oi&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const l=e.map(Vi.fromLngLat);this.tileID=function(h){let f=1/0,m=1/0,g=-1/0,x=-1/0;for(const P of h)f=Math.min(f,P.x),m=Math.min(m,P.y),g=Math.max(g,P.x),x=Math.max(x,P.y);const v=Math.max(g-f,x-m),w=Math.max(0,Math.floor(-Math.log(v)/Math.LN2)),S=Math.pow(2,w);let A=Math.floor((f+g)/2*S);return A>1&&(A-=1),new gl(w,A,Math.floor((m+x)/2*S))}(l),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Ao("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const L in this.tiles){const V=this.tiles[L];V.state!=="loaded"&&(V.state="loaded",V.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const r=Rh(new gl(0,0,0),this.map.transform.projection),n=[r.projection.project(this.coordinates[0][0],this.coordinates[0][1]),r.projection.project(this.coordinates[1][0],this.coordinates[1][1]),r.projection.project(this.coordinates[2][0],this.coordinates[2][1]),r.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(L){const V=L[1].x-L[0].x,q=L[1].y-L[0].y,G=L[2].x-L[1].x,ee=L[2].y-L[1].y,W=L[3].x-L[2].x,re=L[3].y-L[2].y,ne=L[0].x-L[3].x,de=L[0].y-L[3].y,ve=V*ee-G*q,pe=G*re-W*ee,Te=W*de-ne*re,we=ne*q-V*de;return ve>0&&pe>0&&Te>0&&we>0||ve<0&&pe<0&&Te<0&&we<0}(n))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const a=Rh(this.tileID,this.map.transform.projection),[l,h,f,m]=this.coordinates.map(L=>{const V=a.projection.project(L[0],L[1]);return a5(a,V)._round()});this.perspectiveTransform=p5(l.x,l.y,h.x,h.y,f.x,f.y,m.x,m.y);const g=this._boundsArray=new Di;g.emplaceBack(l.x,l.y,0,0),g.emplaceBack(h.x,h.y,Qe,0),g.emplaceBack(m.x,m.y,0,Qe),g.emplaceBack(f.x,f.y,Qe,Qe),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(g,mp.members),this.boundsSegments=ni.simpleSegment(0,0,4,2);const x=[],v=[rd((w=this.coordinates)[0]),rd(w[1]),rd(w[2]),rd(w[3])];var w;const[S,A,P,R]=function(L){let V=L[0][0],q=V,G=L[0][1],ee=G;for(let W=1;W<L.length;W++)L[W][0]<V?V=L[W][0]:L[W][0]>q&&(q=L[W][0]),L[W][1]<G?G=L[W][1]:L[W][1]>ee&&(ee=L[W][1]);return[V,G,q-V,ee-G]}(v);{const L=new Di,[V,q,G,ee]=function(ke){let Le=ke[0].x,Se=Le,at=ke[0].y,rt=at;for(let Fe=1;Fe<ke.length;Fe++)ke[Fe].x<Le?Le=ke[Fe].x:ke[Fe].x>Se&&(Se=ke[Fe].x),ke[Fe].y<at?at=ke[Fe].y:ke[Fe].y>rt&&(rt=ke[Fe].y);return[Le,at,Se-Le,rt-at]}(n),W=ke=>[(ke.x-V)/G,(ke.y-q)/ee],[re,ne,de,ve]=n.map(W),pe=function(ke,Le,Se,at,rt,Fe,bt,ft){const lt=td(0,0,1,0,1,1,0,1),Ne=td(ke,Le,Se,at,rt,Fe,bt,ft),yt=s.ct.adjoint([],Ne);return s.ct.multiply(lt,lt,yt)}(re[0],re[1],ne[0],ne[1],de[0],de[1],ve[0],ve[1]);this.elevatedGlobePerspectiveTransform=p5(re[0],re[1],ne[0],ne[1],de[0],de[1],ve[0],ve[1]);const Te=(ke,Le)=>{x.push(ke.lng);const Se=Math.round((ke.lng-S)/P*Qe),at=Math.round((ke.lat-A)/R*Qe),rt=W(Le),Fe=s.Q.transformMat3([],[rt[0],rt[1],1],pe),bt=Math.round(Fe[0]/Fe[2]*Qe),ft=Math.round(Fe[1]/Fe[2]*Qe);L.emplaceBack(Se,at,bt,ft)},we=n[3].x-n[0].x,be=n[3].y-n[0].y,Ce=n[2].x-n[1].x,Ie=n[2].y-n[1].y;for(let ke=0;ke<65;ke++){const Le=ke/64,Se=[n[0].x+Le*we,n[0].y+Le*be],at=[n[1].x+Le*Ce,n[1].y+Le*Ie],rt=at[0]-Se[0],Fe=at[1]-Se[1];for(let bt=0;bt<65;bt++){const ft=bt/64,lt={x:Se[0]+rt*ft,y:Se[1]+Fe*ft,z:0};Te(r.projection.unproject(lt.x,lt.y),lt)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(L,mp.members)}{this.maxLongitudeTriangleSize=0;let L=[],V=new gi;const q=(G,ee,W)=>{V.emplaceBack(G,ee,W);const re=x[G],ne=x[ee],de=x[W],ve=Math.min(Math.min(re,ne),de),pe=Math.max(Math.max(re,ne),de)-ve;pe>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=pe),L.push(ve+pe/2)};for(let G=0;G<64;G++)for(let ee=0;ee<64;ee++){const W=65*G+ee,re=W+1,ne=W+65,de=ne+1;q(W,ne,re),q(re,ne,de)}[L,V]=function(G,ee){const W=Array.from({length:G.length},(de,ve)=>ve);W.sort((de,ve)=>G[de]-G[ve]);const re=[],ne=new gi;for(let de=0;de<W.length;de++){const ve=W[de];re.push(G[ve]);const pe=3*ve,Te=pe+1;ne.emplaceBack(ee.uint16[pe],ee.uint16[Te],ee.uint16[Te+1])}return[re,ne]}(L,V),this.elevatedGlobeTrianglesCenterLongitudes=L,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(V)}this.elevatedGlobeSegments=ni.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,P/Qe,0,R/Qe,0,0,A,S,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const r=this.map.painter.context,n=r.gl;!this._dirty||this.texture instanceof ed||(this.texture?this.texture.update(this.image):(this.texture=new _p(r,this.image,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(r)}loadTile(e,r){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},r(null)):(e.state="errored",r(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const r=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!r)return null;const n=this.elevatedGlobeTrianglesCenterLongitudes;let a=((x,v)=>x+360*Math.round((v-x)/360))(e+180,n[0]);const l=new ni,h=(x,v)=>{l.segments.push({vertexOffset:0,primitiveOffset:x,vertexLength:r.segments[0].vertexLength,primitiveLength:v,sortKey:void 0,vaos:{}})},f=.51*this.maxLongitudeTriangleSize;if(Math.abs(n[0]-a)<=f){const x=Au(n,0,n.length,a+f);return x===n.length||h(x,Qo(n,x+1,n.length,a+360-f)-x),l}a<n[0]&&(a+=360);const m=Qo(n,0,n.length,a-f);if(m===n.length)return h(0,n.length),l;h(0,m-0);const g=Au(n,m+1,n.length,a+f);return g!==n.length&&h(g,n.length-g),l}}const R9=(Math.pow(256,2)-1)/16907520;class _5 extends Nt{constructor(e,r,n){super(e,z9,r,n),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof m5&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;const r=this._transitionablePaint._values["raster-color"].value.expression,[n,a]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(n)&&isNaN(a)||n===this._curRampRange[0]&&a===this._curRampRange[1]||(this.colorRamp=wh({expression:r,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:n,end:a}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[n,a])}}const L9=new ue({visibility:new oe(X["layout_raster-particle"].visibility)});var O9={paint:new ue({"raster-particle-array-band":new oe(X["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new oe(X["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Re(X["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new oe(X["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new oe(X["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new oe(X["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new oe(X["paint_raster-particle"]["raster-particle-reset-rate-factor"])}),layout:L9};class g5 extends Nt{constructor(e,r,n){super(e,O9,r,n),this._updateColorRamp(),this.lastInvalidatedAt=jn.now()}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,r=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=wh({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:r}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=jn.now()}}class k9 extends Nt{constructor(e,r){super(e,{},r),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}const B9=new ue({visibility:new oe(X.layout_sky.visibility)});var F9={paint:new ue({"sky-type":new oe(X.paint_sky["sky-type"]),"sky-atmosphere-sun":new oe(X.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new oe(X.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new oe(X.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new oe(X.paint_sky["sky-gradient-radius"]),"sky-gradient":new Re(X.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new oe(X.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new oe(X.paint_sky["sky-atmosphere-color"]),"sky-opacity":new oe(X.paint_sky["sky-opacity"])}),layout:B9};function gp(t,e,r){const n=[0,0,1],a=s.bl.identity([]);return s.bl.rotateY(a,a,r?-er(t)+Math.PI:er(t)),s.bl.rotateX(a,a,-er(e)),s.Q.transformQuat(n,n,a),s.Q.normalize(n,n)}var N9={paint:new ue({})};function y5(t,e){const r=id(t.projection,t.zoom,t.width,t.height),n=function(l,h,f,m,g){const x=new ir(f.lng-180*aa,f.lat),v=new ir(f.lng+180*aa,f.lat),w=l.project(x.lng,x.lat),S=l.project(v.lng,v.lat),A=-Math.atan2(S.y-w.y,S.x-w.x),P=Vi.fromLngLat(f);P.y=Ht(P.y,-1+aa,1-aa);const R=P.toLngLat(),L=l.project(R.lng,R.lat),V=Vi.fromLngLat(R);V.x+=aa;const q=V.toLngLat(),G=l.project(q.lng,q.lat),ee=b5(G.x-L.x,G.y-L.y,A),W=Vi.fromLngLat(R);W.y+=aa;const re=W.toLngLat(),ne=l.project(re.lng,re.lat),de=b5(ne.x-L.x,ne.y-L.y,A),ve=Math.abs(ee.x)/Math.abs(de.y),pe=s.a9.identity([]);s.a9.rotateZ(pe,pe,-A*(1-(g?0:m)));const Te=s.a9.identity([]);return s.a9.scale(Te,Te,[1,1-(1-ve)*m,1]),Te[4]=-de.x/de.y*m,s.a9.rotateZ(Te,Te,A),s.a9.multiply(Te,pe,Te),Te}(t.projection,0,t.center,r,e),a=x5(t);return s.a9.scale(n,n,[a,a,1]),n}function x5(t){const e=t.projection,r=id(t.projection,t.zoom,t.width,t.height),n=v5(e,t.center),a=v5(e,ir.convert(e.center));return Math.pow(2,n*r+(1-r)*a)}function id(t,e,r,n,a=1/0){const l=t.range;if(!l)return 0;const h=Math.min(a,Math.max(r,n)),f=Math.log(h/1024)/Math.LN2;return Ea(l[0]+f,l[1]+f,e)}const aa=1/4e4;function v5(t,e){const r=Ht(e.lat,-oi,oi),n=new ir(e.lng-180*aa,r),a=new ir(e.lng+180*aa,r),l=t.project(n.lng,r),h=t.project(a.lng,r),f=Vi.fromLngLat(n),m=Vi.fromLngLat(a),g=h.x-l.x,x=h.y-l.y,v=m.x-f.x,w=m.y-f.y,S=Math.sqrt((v*v+w*w)/(g*g+x*x));return Math.log(S)/Math.LN2}function b5(t,e,r){const n=Math.cos(r),a=Math.sin(r);return{x:t*n-e*a,y:t*a+e*n}}function w5(t,e,r){s.a9.identity(t),s.a9.rotateZ(t,t,er(e[2])),s.a9.rotateX(t,t,er(e[0])),s.a9.rotateY(t,t,er(e[1])),s.a9.scale(t,t,r),s.a9.multiply(t,t,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function nd(t,e,r,n,a,l,h,f){const m=[r[0]-e[0],r[1]-e[1],0],g=[n[0]-e[0],n[1]-e[1],0];if(s.Q.length(m)<1e-12||s.Q.length(g)<1e-12)return s.bl.identity(t);const x=s.Q.cross([],m,g);s.Q.normalize(x,x),s.Q.subtract(g,n,e),m[2]=(l-a)*f,g[2]=(h-a)*f;const v=m;return s.Q.cross(v,m,g),s.Q.normalize(v,v),s.bl.rotationTo(t,x,v)}function yp(t,e,r=!1){const n=ea(e.zoom),a=function(l,h,f){const m=h.worldSize,g=[l[12],l[13],l[14]],x=zi(g[1]/m),v=vn(g[0]/m),w=s.a9.identity([]),S=tn(1,x)*m,A=tn(1,0)*m*yl(x,h.zoom),P=1/jf(m);let R=A*P;if(f){const G=id(h.projection,h.zoom,h.width,h.height,1024);R=P*h.projection.pixelSpaceConversion(h.center.lat,m,G)}const L=_l(x,v);s.Q.add(L,L,s.Q.scale([],s.Q.normalize([],L),S*R*g[2]));const V=function(G){const ee=[G[0],G[1],G[2]];let W=[0,1,0];const re=s.Q.cross([],W,ee);return s.Q.cross(W,ee,re),s.Q.squaredLength(W)===0&&(W=[0,1,0],s.Q.cross(re,ee,W)),s.Q.normalize(re,re),s.Q.normalize(W,W),s.Q.normalize(ee,ee),[re[0],re[1],re[2],0,W[0],W[1],W[2],0,ee[0],ee[1],ee[2],0,G[0],G[1],G[2],1]}(L);s.a9.scale(w,w,[R,R,R*S]),s.a9.translate(w,w,[-g[0],-g[1],-g[2]]);const q=s.a9.multiply([],h.globeMatrix,V);return s.a9.multiply(q,q,w),s.a9.multiply(q,q,l),q}(t,e,r);if(n>0){const l=function(h,f){const m=f.worldSize,g=tn(1,0)*m*yl(f.center.lat,f.zoom)/jf(m),x=tn(1,f.center.lat)*m,v=s.a9.identity([]);return s.a9.rotateY(v,v,er(f.center.lng)),s.a9.rotateX(v,v,er(f.center.lat)),s.a9.translate(v,v,[0,0,en]),s.a9.scale(v,v,[g,g,g*x]),s.a9.translate(v,v,[f.point.x-.5*m,f.point.y-.5*m,0]),s.a9.multiply(v,v,h),s.a9.multiply(v,f.globeMatrix,v)}(t,e);return function(h,f,m){const g=(A,P,R)=>{const L=s.Q.length(A),V=s.Q.length(P),q=ds(A,P,R);return s.Q.scale(q,q,1/s.Q.length(q)*jt(L,V,R))},x=g([h[0],h[1],h[2]],[f[0],f[1],f[2]],m),v=g([h[4],h[5],h[6]],[f[4],f[5],f[6]],m),w=g([h[8],h[9],h[10]],[f[8],f[9],f[10]],m),S=ds([h[12],h[13],h[14]],[f[12],f[13],f[14]],m);return[x[0],x[1],x[2],0,v[0],v[1],v[2],0,w[0],w[1],w[2],0,S[0],S[1],S[2],1]}(a,l,n)}return a}function T5(t,e,r,n){const a=jr.projectAabbCorners(n,r);let l=Number.MAX_VALUE,h=-1;for(let g=0;g<a.length;++g){const x=a[g];x[0]=(.5*x[0]+.5)*e.width,x[1]=(.5-.5*x[1])*e.height,x[2]<l&&(h=g,l=x[2])}const f=g=>new He(a[g][0],a[g][1]);let m;switch(h){case 0:case 6:m=[f(1),f(5),f(4),f(7),f(3),f(2),f(1)];break;case 1:case 7:m=[f(0),f(4),f(5),f(6),f(2),f(3),f(0)];break;case 3:case 5:m=[f(1),f(0),f(4),f(7),f(6),f(2),f(1)];break;default:m=[f(1),f(5),f(6),f(7),f(3),f(0),f(1)]}if(zf(t,m))return l}const V9=Rt([{name:"a_pos_3f",components:3,type:"Float32"}]),U9=Rt([{name:"a_color_3f",components:3,type:"Float32"}]),j9=Rt([{name:"a_color_4f",components:4,type:"Float32"}]),G9=Rt([{name:"a_uv_2f",components:2,type:"Float32"}]),$9=Rt([{name:"a_normal_3f",components:3,type:"Float32"}]),q9=Rt([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),Z9=Rt([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);class od{constructor(e,r,n,a){this.message=(e?`${e}: `:"")+n,a&&(this.identifier=a),r!=null&&r.__line__&&(this.line=r.__line__)}}function S5(t,e){const r=t.indexOf("://")===-1;try{return new URL(t,r&&e?"http://example.com":void 0),!0}catch{return!1}}class E5{constructor(e,r){this.feature=e,this.instancedDataOffset=r,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class A5{constructor(){this.instancedDataArray=new gf,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class xp{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1}populate(e,r,n,a){this.tileToMeter=g0(n);const l=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:h,id:f,index:m,sourceLayerIndex:g}of e){const x=f??(h.properties&&h.properties.hasOwnProperty("id")?h.properties.id:void 0),v=Ks(h,l);if(!this.layers[0]._featureFilter.filter(new N(this.zoom),v,n))continue;const w={id:x,sourceLayerIndex:g,index:m,geometry:l?v.geometry:hs(h,n,a),properties:h.properties,type:h.type,patterns:{}},S=this.addFeature(w,w.geometry,v);S&&r.featureIndex.insert(h,w.geometry,m,g,this.index,this.instancesPerModel[S].instancedDataArray.length,Qe/32)}this.lookup=null}update(e,r,n,a){for(const l in this.instancesPerModel){const h=this.instancesPerModel[l];for(const f in e)h.idToFeaturesIndex.hasOwnProperty(f)&&(this.evaluate(h.features[h.idToFeaturesIndex[f]],e[f],h,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const r in this.instancesPerModel){const n=this.instancesPerModel[r];for(const a of n.features){const l=this.layers[0],h=a.feature,f=this.canonical,m=l.paint.get("model-rotation").evaluate(h,{},f),g=l.paint.get("model-scale").evaluate(h,{},f),x=l.paint.get("model-translation").evaluate(h,{},f);s.Q.exactEquals(a.rotation,m)&&s.Q.exactEquals(a.scale,g)&&s.Q.exactEquals(a.translation,x)||(this.evaluate(a,a.featureStates,n,!0),e=!0)}}return e}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const r in this.instancesPerModel){const n=this.instancesPerModel[r];n.instancedDataArray.length<0||n.instancedDataArray.length===0||(n.instancedDataBuffer?n.instancedDataBuffer.updateData(n.instancedDataArray):n.instancedDataBuffer=e.createVertexBuffer(n.instancedDataArray,q9.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const r in this.instancesPerModel){const n=this.instancesPerModel[r];n.instancedDataArray.length!==0&&n.instancedDataBuffer&&n.instancedDataBuffer.destroy()}const e=this.layers[0].modelManager;if(e&&this.modelUris)for(const r of this.modelUris)e.removeModel(r,"")}addFeature(e,r,n){const a=this.layers[0],l=a.layout.get("model-id").evaluate(n,{},this.canonical);if(!l)return Qr(`modelId is not evaluated for layer ${a.id} and it is not going to get rendered.`),l;S5(l,!1)&&(this.modelUris.includes(l)||this.modelUris.push(l)),this.instancesPerModel[l]||(this.instancesPerModel[l]=new A5);const h=this.instancesPerModel[l],f=h.instancedDataArray,m=new E5(n,f.length);for(const g of r)for(const x of g){if(x.x<0||x.x>=Qe||x.y<0||x.y>=Qe)continue;const v=(this.lookupDim-1)/Qe,w=this.lookupDim*(x.y*v|0)+x.x*v|0;if(this.lookup){if(this.lookup[w]!==0)continue;this.lookup[w]=1}this.instanceCount++;const S=f.length;f.resize(S+1),h.instancesEvaluatedElevation.push(0),f.float32[16*S]=x.x,f.float32[16*S+1]=x.y}return m.instancedDataCount=h.instancedDataArray.length-m.instancedDataOffset,m.instancedDataCount>0&&(e.id&&(h.idToFeaturesIndex[e.id]=h.features.length),h.features.push(m),this.evaluate(m,{},h,!1)),l}getModelUris(){return this.modelUris}evaluate(e,r,n,a){const l=this.layers[0],h=e.feature,f=this.canonical,m=e.rotation=l.paint.get("model-rotation").evaluate(h,r,f),g=e.scale=l.paint.get("model-scale").evaluate(h,r,f),x=e.translation=l.paint.get("model-translation").evaluate(h,r,f),v=l.paint.get("model-color").evaluate(h,r,f);v.a=l.paint.get("model-color-mix-intensity").evaluate(h,r,f);const w=[];this.maxVerticalOffset<x[2]&&(this.maxVerticalOffset=x[2]),this.maxScale=Math.max(Math.max(this.maxScale,g[0]),Math.max(g[1],g[2])),w5(w,m,g);const S=Math.round(100*v.a)+v.b/1.05;for(let A=0;A<e.instancedDataCount;++A){const P=e.instancedDataOffset+A,R=16*P,L=n.instancedDataArray.float32;let V=0;a&&(V=L[R+6]-n.instancesEvaluatedElevation[P]);const q=0|L[R+1];L[R]=(0|L[R])+v.r/1.05,L[R+1]=q+v.g/1.05,L[R+2]=S,L[R+3]=1/(f.z>10?this.tileToMeter:g0(f,q)),L[R+4]=x[0],L[R+5]=x[1],L[R+6]=x[2]+V,L[R+7]=w[0],L[R+8]=w[1],L[R+9]=w[2],L[R+10]=w[4],L[R+11]=w[5],L[R+12]=w[6],L[R+13]=w[8],L[R+14]=w[9],L[R+15]=w[10],n.instancesEvaluatedElevation[P]=x[2]}}}nt(xp,"ModelBucket",{omit:["layers"]}),nt(A5,"PerModelAttributes"),nt(E5,"ModelFeature");const W9=new ue({visibility:new oe(X.layout_model.visibility),"model-id":new fe(X.layout_model["model-id"])});var H9={paint:new ue({"model-opacity":new oe(X.paint_model["model-opacity"]),"model-rotation":new fe(X.paint_model["model-rotation"]),"model-scale":new fe(X.paint_model["model-scale"]),"model-translation":new fe(X.paint_model["model-translation"]),"model-color":new fe(X.paint_model["model-color"]),"model-color-mix-intensity":new fe(X.paint_model["model-color-mix-intensity"]),"model-type":new oe(X.paint_model["model-type"]),"model-cast-shadows":new oe(X.paint_model["model-cast-shadows"]),"model-receive-shadows":new oe(X.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new oe(X.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new fe(X.paint_model["model-emissive-strength"]),"model-roughness":new fe(X.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new fe(X.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new oe(X.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new oe(X.paint_model["model-front-cutoff"])}),layout:W9};const bl=64,Hc={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function M5(t,e,r,n,a,l,h,f,m,g=!1){const x=r.zoom,v=r.project(n),w=yl(n.lat,x),S=1/w;s.a9.identity(t),s.a9.translate(t,t,[v.x+h[0]*S,v.y+h[1]*S,h[2]]);let A=1,P=1;const R=r.worldSize;if(g){if(r.projection.name==="mercator"){let G=0;r.elevation&&(G=r.elevation.getAtPointOrZero(new Vi(v.x/R,v.y/R),0));const ee=s.aa.transformMat4([],[v.x,v.y,G,1],r.projMatrix)[3]/r.cameraToCenterDistance;A=ee,P=ee*yl(r.center.lat,x)}else if(r.projection.name==="globe"){const G=yp(t,r),ee=s.a9.multiply([],r.projMatrix,G),W=[0,0,0,1];s.aa.transformMat4(W,W,ee);const re=W[3]/r.cameraToCenterDistance,ne=ea(x),de=r.projection.pixelsPerMeter(n.lat,R)*yl(n.lat,x),ve=r.projection.pixelsPerMeter(r.center.lat,R)*yl(r.center.lat,x);A=re/jt(de,p_(r.center.lat),ne),P=re*w/de,A*=ve,P*=ve}}else A=S;s.a9.scale(t,t,[A,A,P]);const L=[...t],V=e.orientation,q=[];if(w5(q,[V[0]+a[0],V[1]+a[1],V[2]+a[2]],l),s.a9.multiply(t,L,q),f&&r.elevation){let G=0;const ee=[];if(m&&r.elevation){G=function(ne,de,ve,pe,Te){const we=de.elevation;if(!we)return 0;const be=jr.projectAabbCorners(ve,pe),Ce=tn(1,Te.lat)*de.worldSize,Ie=function(yt,Lt){const At=[0,0,1],Ft=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const Ot of Ft){const Zt=yt[Ot.corners[0]],Tt=yt[Ot.corners[1]],wr=yt[Ot.corners[2]],vr=[Tt[0]-Zt[0],Tt[1]-Zt[1],Lt*(Tt[2]-Zt[2])],nr=s.Q.cross(vr,vr,[wr[0]-Zt[0],wr[1]-Zt[1],Lt*(wr[2]-Zt[2])]);s.Q.normalize(nr,nr),Ot.dotProductWithUp=s.Q.dot(nr,At)}return Ft.sort((Ot,Zt)=>Ot.dotProductWithUp-Zt.dotProductWithUp),Ft[0].corners}(be,Ce),ke=be[Ie[0]],Le=be[Ie[1]],Se=be[Ie[2]],at=be[Ie[3]],rt=we.getAtPointOrZero(new Vi(ke[0]/de.worldSize,ke[1]/de.worldSize),0),Fe=we.getAtPointOrZero(new Vi(Le[0]/de.worldSize,Le[1]/de.worldSize),0),bt=we.getAtPointOrZero(new Vi(Se[0]/de.worldSize,Se[1]/de.worldSize),0),ft=we.getAtPointOrZero(new Vi(at[0]/de.worldSize,at[1]/de.worldSize),0),lt=(rt+ft)/2,Ne=(Fe+bt)/2;return lt>Ne?Fe<bt?nd(ne,Le,at,ke,Fe,ft,rt,Ce):nd(ne,Se,ke,at,bt,rt,ft,Ce):rt<ft?nd(ne,ke,Le,Se,rt,Fe,bt,Ce):nd(ne,at,Se,Le,ft,bt,Fe,Ce),Math.max(lt,Ne)}(ee,r,e.aabb,t,n);const W=s.a9.fromQuat([],ee),re=s.a9.multiply([],W,q);s.a9.multiply(t,L,re)}else G=r.elevation.getAtPointOrZero(new Vi(v.x/R,v.y/R),0);G!==0&&(t[14]+=G)}}function Fh(t,e,r=!1){t.uploaded||(t.gfxTexture=new _p(e,t.image,r?e.gl.R8:e.gl.RGBA,{useMipmap:t.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),t.uploaded=!0,t.image=null)}function Q9(t,e,r){t.indexBuffer=e.createIndexBuffer(t.indexArray,!1,!0),t.vertexBuffer=e.createVertexBuffer(t.vertexArray,V9.members,!1,!0),t.normalArray&&(t.normalBuffer=e.createVertexBuffer(t.normalArray,$9.members,!1,!0)),t.texcoordArray&&(t.texcoordBuffer=e.createVertexBuffer(t.texcoordArray,G9.members,!1,!0)),t.colorArray&&(t.colorBuffer=e.createVertexBuffer(t.colorArray,(t.colorArray.bytesPerElement===12?U9:j9).members,!1,!0)),t.featureArray&&(t.pbrBuffer=e.createVertexBuffer(t.featureArray,Z9.members,!0)),t.segments=ni.simpleSegment(0,0,t.vertexArray.length,t.indexArray.length);const n=t.material;n.pbrMetallicRoughness.baseColorTexture&&Fh(n.pbrMetallicRoughness.baseColorTexture,e),n.pbrMetallicRoughness.metallicRoughnessTexture&&Fh(n.pbrMetallicRoughness.metallicRoughnessTexture,e),n.normalTexture&&Fh(n.normalTexture,e),n.occlusionTexture&&Fh(n.occlusionTexture,e,r),n.emissionTexture&&Fh(n.emissionTexture,e)}function vp(t,e,r){if(t.meshes)for(const n of t.meshes)Q9(n,e,r);if(t.children)for(const n of t.children)vp(n,e,r)}function sd(t){if(t.meshes)for(const e of t.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(t.children)for(const e of t.children)sd(e)}function bp(t){if(t.meshes)for(const r of t.meshes)r.vertexBuffer&&(r.vertexBuffer.destroy(),r.indexBuffer.destroy(),r.normalBuffer&&r.normalBuffer.destroy(),r.texcoordBuffer&&r.texcoordBuffer.destroy(),r.colorBuffer&&r.colorBuffer.destroy(),r.pbrBuffer&&r.pbrBuffer.destroy(),r.segments.destroy(),r.material&&((e=r.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(t.children)for(const r of t.children)bp(r)}class X9{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class Y9{constructor(){this.tasks={},this.taskQueue=[],Tu(["process"],this),this.invoker=new X9(this.process),this.nextId=0}add(e,r){const n=this.nextId++,a=function({type:l,isSymbolTile:h,zoom:f}){return f=f||0,l==="message"?0:l!=="maybePrepare"||h?l!=="parseTile"||h?l==="parseTile"&&h?300-f:l==="maybePrepare"&&h?400-f:500:200-f:100-f}(r);if(a===0){ro();try{e()}finally{}return null}return this.tasks[n]={fn:e,metadata:r,priority:a,id:n},this.taskQueue.push(n),this.invoker.trigger(),{cancel:()=>{delete this.tasks[n]}}}process(){ro();try{if(this.taskQueue=this.taskQueue.filter(n=>!!this.tasks[n]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const r=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!r)return;r.fn()}finally{}}pick(){let e=null,r=1/0;for(let a=0;a<this.taskQueue.length;a++){const l=this.tasks[this.taskQueue[a]];l.priority<r&&(r=l.priority,e=a)}if(e===null)return null;const n=this.taskQueue[e];return this.taskQueue.splice(e,1),n}remove(){this.invoker.remove()}}class I5{constructor(e,r,n){this.target=e,this.parent=r,this.mapId=n,this.callbacks={},this.cancelCallbacks={},Tu(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new Y9}send(e,r,n,a,l=!1,h){const f=Math.round(1e18*Math.random()).toString(36).substring(0,10);n&&(n.metadata=h,this.callbacks[f]=n);const m=new Set;return this.target.postMessage({id:f,type:e,hasCallback:!!n,targetMapId:a,mustQueue:l,sourceMapId:this.mapId,data:cl(r,m)},m),{cancel:()=>{n&&delete this.callbacks[f],this.target.postMessage({id:f,type:"<cancel>",targetMapId:a,sourceMapId:this.mapId})}}}receive(e){const r=e.data,n=r.id;if(n&&(!r.targetMapId||this.mapId===r.targetMapId))if(r.type==="<cancel>"){const a=this.cancelCallbacks[n];delete this.cancelCallbacks[n],a&&a.cancel()}else if(r.mustQueue||ro()){const a=this.callbacks[n],l=this.scheduler.add(()=>this.processTask(n,r),a&&a.metadata||{type:"message"});l&&(this.cancelCallbacks[n]=l)}else this.processTask(n,r)}processTask(e,r){if(delete this.cancelCallbacks[e],r.type==="<response>"){const n=this.callbacks[e];delete this.callbacks[e],n&&(r.error?n(c(r.error)):n(null,c(r.data)))}else{const n=new Set,a=r.hasCallback?(h,f)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:h?cl(h):null,data:cl(f,n)},n)}:h=>{},l=c(r.data);if(this.parent[r.type])this.parent[r.type](r.sourceMapId,l,a);else if(this.parent.getWorkerSource){const h=r.type.split(".");this.parent.getWorkerSource(r.sourceMapId,h[0],l.source,l.scope)[h[1]](l,a)}else a(new Error(`Could not find function ${r.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}class Qc{constructor(e,r){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=ar();const n=this.workerPool.acquire(this.id);for(let a=0;a<n.length;a++){const l=new Qc.Actor(n[a],r,this.id);l.name=`Worker ${a}`,this.actors.push(l)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,r,n){bu(this.actors,(a,l)=>{a.send(e,r,l)},n=n||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}Qc.Actor=I5;var Nh={workerUrl:"",workerClass:null,workerParams:void 0};function J9(){return Nh.workerClass!=null?new Nh.workerClass:new self.Worker(Nh.workerUrl,Nh.workerParams)}const wp="mapboxgl_preloaded_worker_pool";class Vh{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<Vh.workerCount;)this.workers.push(new J9);return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(r=>{r.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[wp]}numActive(){return Object.keys(this.active).length}}let Uh;function ad(){return Uh||(Uh=new Vh),Uh}Vh.workerCount=2;let ld,Tp,ho,Xc,Sp,Yc=null;function P5(){return ro()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:Tp||Ze.DRACO_URL}function C5(){if(ro()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Xc)return Xc;const t=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Xc=WebAssembly.validate(t)?Ze.MESHOPT_SIMD_URL:Ze.MESHOPT_URL,Xc}const cd={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},K9={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},jh={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function D5(t,e,r){const n=r.json.bufferViews.length,a=r.buffers.length;e.bufferView=n,r.json.bufferViews[n]={buffer:a,byteLength:t.byteLength},r.buffers[a]=t}const Ep="KHR_draco_mesh_compression";function e8(t,e){const r=t.extensions&&t.extensions[Ep];if(!r)return;const n=new ho.Decoder,a=O5(e,r.bufferView),l=new ho.Mesh;if(!n.DecodeArrayToMesh(a,a.byteLength,l))throw new Error("Failed to decode Draco mesh");const h=e.json.accessors[t.indices],f=cd[h.componentType],m=h.count*f.BYTES_PER_ELEMENT,g=ho._malloc(m);f===Uint16Array?n.GetTrianglesUInt16Array(l,m,g):n.GetTrianglesUInt32Array(l,m,g),D5(ho.memory.buffer.slice(g,g+m),h,e),ho._free(g);for(const x of Object.keys(r.attributes)){const v=n.GetAttributeByUniqueId(l,r.attributes[x]),w=e.json.accessors[t.attributes[x]],S=K9[w.componentType],A=w.count*jh[w.type]*cd[w.componentType].BYTES_PER_ELEMENT,P=ho._malloc(A);n.GetAttributeDataArrayForAllPoints(l,v,ho[S],A,P),D5(ho.memory.buffer.slice(P,P+A),w,e),ho._free(P)}n.destroy(),l.destroy(),delete t.extensions[Ep]}const ud="EXT_meshopt_compression";function t8(t,e){if(!t.extensions||!t.extensions[ud])return;const r=t.extensions[ud],n=new Uint8Array(e.buffers[r.buffer],r.byteOffset||0,r.byteLength||0),a=new Uint8Array(r.count*r.byteStride);Sp.decodeGltfBuffer(a,r.count,r.byteStride,n,r.mode,r.filter),t.buffer=e.buffers.length,t.byteOffset=0,e.buffers[t.buffer]=a.buffer,delete t.extensions[ud]}const z5=1179937895,R5=new TextDecoder("utf8");function L5(t,e){return new URL(t,e).href}function r8(t,e,r,n){return fetch(L5(t.uri,n)).then(a=>a.arrayBuffer()).then(a=>{e.buffers[r]=a})}function O5(t,e){const r=t.json.bufferViews[e];return new Uint8Array(t.buffers[r.buffer],r.byteOffset||0,r.byteLength)}function i8(t,e,r,n){if(t.uri){const a=L5(t.uri,n);return fetch(a).then(l=>l.blob()).then(l=>createImageBitmap(l)).then(l=>{e.images[r]=l})}if(t.bufferView!==void 0){const a=O5(e,t.bufferView),l=new Blob([a],{type:t.mimeType});return createImageBitmap(l).then(h=>{e.images[r]=h})}}function k5(t,e=0,r){const n={json:null,images:[],buffers:[]};if(new Uint32Array(t,e,1)[0]===z5){const x=new Uint32Array(t,e);let v=2;const w=(x[v++]>>2)-3,S=x[v++]>>2;if(v++,n.json=JSON.parse(R5.decode(x.subarray(v,v+S))),v+=S,v<w){const A=x[v++];v++;const P=e+(v<<2);n.buffers[0]=t.slice(P,P+A)}}else n.json=JSON.parse(R5.decode(new Uint8Array(t,e)));const{buffers:a,images:l,meshes:h,extensionsUsed:f,bufferViews:m}=n.json;let g=Promise.resolve();if(a){const x=[];for(let v=0;v<a.length;v++){const w=a[v];w.uri?x.push(r8(w,n,v,r)):n.buffers[v]||(n.buffers[v]=null)}g=Promise.all(x)}return g.then(()=>{const x=[],v=f&&f.includes(Ep),w=f&&f.includes(ud);if(v&&x.push(function(){if(!ho)return ld||(ld=function(S){let A,P=null;function R(){A=new Uint8Array(P.buffer)}function L(){throw new Error("Unexpected Draco error.")}const V={a:{a:L,d:function(q,G,ee){return A.copyWithin(q,G,G+ee)},c:function(q){const G=A.length,ee=Math.max(q>>>0,Math.ceil(1.2*G)),W=Math.ceil((ee-G)/65536);try{return P.grow(W),R(),!0}catch{return!1}},b:L}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(S,V):S.then(q=>q.arrayBuffer()).then(q=>WebAssembly.instantiate(q,V))).then(q=>{const{Rb:G,Qb:ee,P:W,T:re,X:ne,Ja:de,La:ve,Qa:pe,Va:Te,Wa:we,eb:be,jb:Ce,f:Ie,e:ke,yb:Le,zb:Se,Ab:at,Bb:rt,Db:Fe,Gb:bt}=q.instance.exports;P=ke;const ft=(()=>{let lt=0,Ne=0,yt=0,Lt=0;return At=>{yt&&(G(Lt),G(lt),Ne+=yt,yt=lt=0),lt||(Ne+=128,lt=ee(Ne));const Ft=At.length+7&-8;let Ot=lt;Ft>=Ne&&(yt=Ft,Ot=Lt=ee(Ft));for(let Zt=0;Zt<At.length;Zt++)A[Ot+Zt]=At[Zt];return Ot}})();return R(),Ie(),{memory:ke,_free:G,_malloc:ee,Mesh:class{constructor(){this.ptr=W()}destroy(){re(this.ptr)}},Decoder:class{constructor(){this.ptr=de()}destroy(){Ce(this.ptr)}DecodeArrayToMesh(lt,Ne,yt){const Lt=ft(lt),At=ve(this.ptr,Lt,Ne,yt.ptr);return!!ne(At)}GetAttributeByUniqueId(lt,Ne){return{ptr:pe(this.ptr,lt.ptr,Ne)}}GetTrianglesUInt16Array(lt,Ne,yt){Te(this.ptr,lt.ptr,Ne,yt)}GetTrianglesUInt32Array(lt,Ne,yt){we(this.ptr,lt.ptr,Ne,yt)}GetAttributeDataArrayForAllPoints(lt,Ne,yt,Lt,At){be(this.ptr,lt.ptr,Ne.ptr,yt,Lt,At)}},DT_INT8:Le(),DT_UINT8:Se(),DT_INT16:at(),DT_UINT16:rt(),DT_UINT32:Fe(),DT_FLOAT32:bt()}})}(fetch(P5())),ld.then(S=>{ho=S,ld=void 0}))}()),w&&x.push(function(){if(Sp)return;const S=function(A){let P;const R=WebAssembly.instantiateStreaming(A,{}).then(q=>{P=q.instance,P.exports.__wasm_call_ctors()}),L={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},V={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:R,supported:!0,decodeGltfBuffer(q,G,ee,W,re,ne){(function(de,ve,pe,Te,we,be,Ce){const Ie=de.exports.sbrk,ke=Te+3&-4,Le=Ie(ke*we),Se=Ie(be.length),at=new Uint8Array(de.exports.memory.buffer);at.set(be,Se);const rt=ve(Le,Te,we,Se,be.length);if(rt===0&&Ce&&Ce(Le,ke,we),pe.set(at.subarray(Le,Le+Te*we)),Ie(Le-Ie(0)),rt!==0)throw new Error(`Malformed buffer data: ${rt}`)})(P,P.exports[V[re]],q,G,ee,W,P.exports[L[ne]])}}}(fetch(C5()));return S.ready.then(()=>{Sp=S})}()),l)for(let S=0;S<l.length;S++)x.push(i8(l[S],n,S,r));return(x.length?Promise.all(x):Promise.resolve()).then(()=>{if(v&&h)for(const{primitives:S}of h)for(const A of S)e8(A,n);if(w&&h&&m)for(const S of m)t8(S,n);return n})})}class B5{constructor(e,r,n,a){if(this.triangleCount=r.length/3,this.min=new He(0,0),this.max=new He(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;const[l,h]=[e[0].clone(),e[0].clone()];for(let v=1;v<e.length;++v){const w=e[v];l.x=Math.min(l.x,w.x),l.y=Math.min(l.y,w.y),h.x=Math.max(h.x,w.x),h.y=Math.max(h.y,w.y)}if(a){const v=Math.ceil(Math.max(h.x-l.x,h.y-l.y)/a);n=Math.max(n,v)}if(n===0)return;this.min=l,this.max=h;const f=this.max.sub(this.min);f.x=Math.max(f.x,1),f.y=Math.max(f.y,1);const m=Math.max(f.x,f.y)/n;this.cellsX=Math.max(1,Math.ceil(f.x/m)),this.cellsY=Math.max(1,Math.ceil(f.y/m)),this.xScale=1/m,this.yScale=1/m;const g=[];for(let v=0;v<this.triangleCount;v++){const w=e[r[3*v+0]].sub(this.min),S=e[r[3*v+1]].sub(this.min),A=e[r[3*v+2]].sub(this.min),P=la(Math.floor(Math.min(w.x,S.x,A.x)),this.xScale,this.cellsX),R=la(Math.floor(Math.max(w.x,S.x,A.x)),this.xScale,this.cellsX),L=la(Math.floor(Math.min(w.y,S.y,A.y)),this.yScale,this.cellsY),V=la(Math.floor(Math.max(w.y,S.y,A.y)),this.yScale,this.cellsY),q=new He(0,0),G=new He(0,0),ee=new He(0,0),W=new He(0,0);for(let re=L;re<=V;++re){q.y=G.y=re*m,ee.y=W.y=(re+1)*m;for(let ne=P;ne<=R;++ne)q.x=ee.x=ne*m,G.x=W.x=(ne+1)*m,(Of(w,S,A,q,G,W)||Of(w,S,A,q,W,ee))&&g.push({cellIdx:re*this.cellsX+ne,triIdx:v})}}if(g.length===0)return;g.sort((v,w)=>v.cellIdx-w.cellIdx||v.triIdx-w.triIdx);let x=0;for(;x<g.length;){const v=g[x].cellIdx,w={start:this.payload.length,len:0};for(;x<g.length&&g[x].cellIdx===v;)++w.len,this.payload.push(g[x++].triIdx);this.cells[v]=w}}query(e,r,n){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>r.x||e.y>this.max.y||this.min.y>r.y)return;this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8)));for(let m=0;m<this.lookup.length;m++)this.lookup[m]=0;const a=la(e.x-this.min.x,this.xScale,this.cellsX),l=la(r.x-this.min.x,this.xScale,this.cellsX),h=la(e.y-this.min.y,this.yScale,this.cellsY),f=la(r.y-this.min.y,this.yScale,this.cellsY);for(let m=h;m<=f;m++)for(let g=a;g<=l;g++){const x=this.cells[m*this.cellsX+g];if(x)for(let v=0;v<x.len;v++){const w=this.payload[x.start+v],S=Math.floor(w/8),A=1<<w%8;if(!(this.lookup[S]&A)&&(this.lookup[S]|=A,n.push(w),n.length===this.triangleCount))return}}}}function la(t,e,r){return Math.max(0,Math.min(r-1,Math.floor(t*e)))}function wl(t,e){const r=t.json.bufferViews[e.bufferView],n=cd[e.componentType];return new n(t.buffers[r.buffer],(e.byteOffset||0)+(r.byteOffset||0),e.count*(r.byteStride&&r.byteStride!==jh[e.type]*n.BYTES_PER_ELEMENT?r.byteStride/n.BYTES_PER_ELEMENT:jh[e.type]))}function Ap(t,e,r,n){const a=cd[e.componentType],l=function(x){switch(x){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(a),h=t.json.bufferViews[e.bufferView],f=h.byteStride?h.byteStride/a.BYTES_PER_ELEMENT:jh[e.type],m=r.float32,g=m.length/r.capacity;for(let x=0,v=0;x<e.count*f;x+=f,v+=g)for(let w=0;w<g;w++)m[v+w]=n[x+w]*l;r._trim()}function n8(t,e,r){const n=t.indices,a=t.attributes,l={};l.indexArray=new gi;const h=e.json.accessors[n],f=h.count/3;l.indexArray.reserve(f);const m=wl(e,h);for(let w=0;w<f;w++)l.indexArray.emplaceBack(m[3*w],m[3*w+1],m[3*w+2]);l.indexArray._trim(),l.vertexArray=new pl;const g=e.json.accessors[a.POSITION];l.vertexArray.reserve(g.count);const x=wl(e,g);for(let w=0;w<g.count;w++)l.vertexArray.emplaceBack(x[3*w],x[3*w+1],x[3*w+2]);if(l.vertexArray._trim(),l.aabb=new jr(g.min,g.max),l.centroid=function(w,S){const A=[0,0,0],P=w.length;if(P>0){for(let R=0;R<P;R++){const L=3*w[R];A[0]+=S[L],A[1]+=S[L+1],A[2]+=S[L+2]}A[0]/=P,A[1]/=P,A[2]/=P}return A}(m,x),a.COLOR_0!==void 0){const w=e.json.accessors[a.COLOR_0],S=jh[w.type],A=wl(e,w);l.colorArray=S===3?new pl:new _i,l.colorArray.resize(w.count),Ap(e,w,l.colorArray,A)}if(a.NORMAL!==void 0){l.normalArray=new pl;const w=e.json.accessors[a.NORMAL];l.normalArray.resize(w.count);const S=wl(e,w);Ap(e,w,l.normalArray,S)}if(a.TEXCOORD_0!==void 0&&r.length>0){l.texcoordArray=new Ti;const w=e.json.accessors[a.TEXCOORD_0];l.texcoordArray.resize(w.count);const S=wl(e,w);Ap(e,w,l.texcoordArray,S)}if(a._FEATURE_ID_RGBA4444!==void 0){const w=e.json.accessors[a._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(l.featureData=wl(e,w))}a._FEATURE_RGBA4444!==void 0&&(l.featureData=new Uint32Array(wl(e,e.json.accessors[a._FEATURE_RGBA4444]).buffer));const v=t.material;return l.material=function(w,S){const{emissiveFactor:A=[0,0,0],alphaMode:P="OPAQUE",alphaCutoff:R=.5,normalTexture:L,occlusionTexture:V,emissiveTexture:q,doubleSided:G}=w,{baseColorFactor:ee=[1,1,1,1],metallicFactor:W=1,roughnessFactor:re=1,baseColorTexture:ne,metallicRoughnessTexture:de}=w.pbrMetallicRoughness||{},ve=V?S[V.index]:void 0;if(V&&V.extensions&&V.extensions.KHR_texture_transform&&ve){const pe=V.extensions.KHR_texture_transform;ve.offsetScale=[pe.offset[0],pe.offset[1],pe.scale[0],pe.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new gr(...ee),metallicFactor:W,roughnessFactor:re,baseColorTexture:ne?S[ne.index]:void 0,metallicRoughnessTexture:de?S[de.index]:void 0},doubleSided:G,emissiveFactor:A,alphaMode:P,alphaCutoff:R,normalTexture:L?S[L.index]:void 0,occlusionTexture:ve,emissionTexture:q?S[q.index]:void 0,defined:w.defined===void 0}}(v!==void 0?e.json.materials[v]:{defined:!1},r),l}function F5(t,e,r){const{matrix:n,rotation:a,translation:l,scale:h,mesh:f,extras:m,children:g}=t,x={};if(x.matrix=n||s.a9.fromRotationTranslationScale([],a||[0,0,0,1],l||[0,0,0],h||[1,1,1]),f!==void 0){x.meshes=r[f];const v=x.anchor=[0,0];for(const w of x.meshes){const{min:S,max:A}=w.aabb;v[0]+=S[0]+A[0],v[1]+=S[1]+A[1]}v[0]=Math.floor(v[0]/x.meshes.length/2),v[1]=Math.floor(v[1]/x.meshes.length/2)}if(m&&(m.id&&(x.id=m.id),m.lights&&(x.lights=function(v){if(!v.length)return[];const w=function(L){const V=atob(L),q=new Uint8Array(V.length);for(let G=0;G<V.length;G++)q[G]=V.codePointAt(G);return q}(v),S=[],A=w.length/24,P=new Uint16Array(w.buffer),R=new Float32Array(w.buffer);for(let L=0;L<A;L++){const V=P[2*L*6]/30,q=P[2*L*6+1]/30,G=P[2*L*6+10]/100,ee=R[6*L+1],W=R[6*L+2],re=R[6*L+3],ne=R[6*L+4],de=re-ee,ve=ne-W,pe=Math.hypot(de,ve);S.push({pos:[ee+.5*de,W+.5*ve,q],normal:[ve/pe,-de/pe,0],width:pe,height:V,depth:G,points:[ee,W,re,ne]})}return S}(m.lights))),g){const v=[];for(const w of g)v.push(F5(e.json.nodes[w],e,r));x.children=v}return x}function o8(t){if(t.vertices.length===0||t.indices.length===0)return null;const e=new B5(t.vertices,t.indices,8,256),[r,n]=[e.min.clone(),e.max.clone()];return{vertices:t.vertices,indices:t.indices,grid:e,min:r,max:n}}function s8(t){if(!t.extras||!t.extras.ground)return null;const e=t.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const r=e[0];if(!r||!Array.isArray(r)||r.length===0)return null;const n=[];for(const h of r){if(!Array.isArray(h)||h.length!==2)continue;const f=h[0],m=h[1];typeof f=="number"&&typeof m=="number"&&n.push(new He(f,m))}if(n.length<3)return null;n.length>1&&n[n.length-1].equals(n[0])&&n.pop();let a=0;for(let h=0;h<n.length;h++){const f=n[h],m=n[(h+1)%n.length],g=n[(h+2)%n.length];a+=(f.x-m.x)*(g.y-m.y)-(g.x-m.x)*(f.y-m.y)}a>0&&n.reverse();const l=C0(n.flatMap(h=>[h.x,h.y]),[]);return l.length===0?null:{vertices:n,indices:l}}function a8(t,e){const r=[],n=[];let a=0;const l=[];for(const h of t){a=r.length;const f=h.vertexArray.float32,m=h.indexArray.uint16;for(let g=0;g<h.vertexArray.length;g++)l[0]=f[3*g+0],l[1]=f[3*g+1],l[2]=f[3*g+2],s.Q.transformMat4(l,l,e),r.push(new He(l[0],l[1]));for(let g=0;g<3*h.indexArray.length;g++)n.push(m[g]+a)}if(n.length%3!=0)return null;for(let h=0;h<n.length;h+=3){const f=r[n[h+0]],m=r[n[h+1]],g=r[n[h+2]];(f.x-m.x)*(g.y-m.y)-(g.x-m.x)*(f.y-m.y)>0&&([n[h+1],n[h+2]]=[n[h+2],n[h+1]])}return{vertices:r,indices:n}}function N5(t){const e=function(m,g){const x=[],v=WebGL2RenderingContext;if(m.json.textures)for(const w of m.json.textures){const S={magFilter:v.LINEAR,minFilter:v.NEAREST,wrapS:v.REPEAT,wrapT:v.REPEAT};w.sampler!==void 0&&Object.assign(S,m.json.samplers[w.sampler]),x.push({image:g[w.source],sampler:S,uploaded:!1})}return x}(t,t.images),r=function(m,g){const x=[];for(const v of m.json.meshes){const w=[];for(const S of v.primitives)w.push(n8(S,m,g));x.push(w)}return x}(t,e),{scenes:n,scene:a,nodes:l}=t.json,h=n?n[a||0].nodes:l,f=[];for(const m of h)f.push(F5(l[m],t,r));return function(m,g,x){const v={},w=new Set;for(let S=0;S<m.length;S++){const A=x[g[S]];if(!A.extras)continue;const P=A.extras["mapbox:footprint:version"],R=A.extras["mapbox:footprint:id"];(P||R)&&w.add(S),P==="1.0.0"&&R&&(v[R]=S)}for(let S=0;S<m.length;S++){if(w.has(S))continue;const A=m[S],P=x[g[S]];if(!P.extras)continue;let R=null;A.id in v&&(R=a8(m[v[A.id]].meshes,A.matrix)),R||(R=s8(P)),R&&(A.footprint=o8(R))}if(w.size>0){const S=Array.from(w.values()).sort((A,P)=>A-P);for(let A=S.length-1;A>=0;A--)m.splice(S[A],1)}}(f,h,t.json.nodes),f}function l8(t){t.heightmap=new Float32Array(4096),t.heightmap.fill(-1);const e=t.vertexArray.float32,r=t.aabb.min[0]-1,n=t.aabb.min[1]-1,a=bl/(t.aabb.max[0]-r+2),l=bl/(t.aabb.max[1]-n+2);for(let h=0;h<e.length;h+=3){const f=e[h+2],m=(e[h+0]-r)*a|0,g=(e[h+1]-n)*l|0;f>t.heightmap[g*bl+m]&&(t.heightmap[g*bl+m]=f)}}function c8(t,e){const r={};r.indexArray=new gi,r.indexArray.reserve(4*t.length),r.vertexArray=new pl,r.vertexArray.reserve(10*t.length),r.colorArray=new _i,r.vertexArray.reserve(10*t.length);let n=0;for(const h of t){const f=Math.min(10,Math.max(4,1.3*h.height))*e,m=[-h.normal[1],h.normal[0],0],g=Math.min(.29,.1*h.width/h.depth),x=h.width-2*h.depth*e*(g+.01),v=s.Q.scaleAndAdd([],h.pos,m,x/2),w=s.Q.scaleAndAdd([],h.pos,m,-x/2),S=[v[0],v[1],v[2]+h.height],A=[w[0],w[1],w[2]+h.height],P=s.Q.scaleAndAdd([],h.normal,m,g);s.Q.scale(P,P,f);const R=s.Q.scaleAndAdd([],h.normal,m,-g);s.Q.scale(R,R,f),s.Q.add(P,v,P),s.Q.add(R,w,R),v[2]+=.1,w[2]+=.1,r.vertexArray.emplaceBack(P[0],P[1],P[2]),r.vertexArray.emplaceBack(R[0],R[1],R[2]),r.vertexArray.emplaceBack(v[0],v[1],v[2]),r.vertexArray.emplaceBack(w[0],w[1],w[2]),r.vertexArray.emplaceBack(S[0],S[1],S[2]),r.vertexArray.emplaceBack(A[0],A[1],A[2]),r.vertexArray.emplaceBack(v[0],v[1],v[2]),r.vertexArray.emplaceBack(w[0],w[1],w[2]),r.vertexArray.emplaceBack(P[0],P[1],P[2]),r.vertexArray.emplaceBack(R[0],R[1],R[2]);const L=x/f/2;r.colorArray.emplaceBack(-L-g,-1,L,.8),r.colorArray.emplaceBack(L+g,-1,L,.8),r.colorArray.emplaceBack(-L,0,L,1.3),r.colorArray.emplaceBack(L,0,L,1.3),r.colorArray.emplaceBack(L+g,-.8,L,.7),r.colorArray.emplaceBack(L+g,-.8,L,.7),r.colorArray.emplaceBack(0,0,L,1.3),r.colorArray.emplaceBack(0,0,L,1.3),r.colorArray.emplaceBack(L+g,-1.2,L,.8),r.colorArray.emplaceBack(L+g,-1.2,L,.8),r.indexArray.emplaceBack(6+n,4+n,8+n),r.indexArray.emplaceBack(7+n,9+n,5+n),r.indexArray.emplaceBack(0+n,1+n,2+n),r.indexArray.emplaceBack(1+n,3+n,2+n),n+=10}const a={defined:!0,emissiveFactor:[0,0,0]},l={};return l.baseColorFactor=gr.white,a.pbrMetallicRoughness=l,r.material=a,r.aabb=new jr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),r}nt(B5,"TriangleGridIndex");class V5{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){const n=e[r];this._stringToNumber[n]=r,this._numberToString[r]=n}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const u8=["tile","layer","source","sourceLayer","state"];class U5{constructor(e,r,n,a,l){this.type="Feature",this._vectorTileFeature=e,this._z=r,this._x=n,this._y=a,this.properties=e.properties,this.id=l}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};this.id!==void 0&&(e.id=this.id);for(const r of u8)this[r]!==void 0&&(e[r]=this[r]);return e}}class j5{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Zs(Qe,16,0),this.featureIndexArray=new i_,this.promoteId=r,this.is3DTile=!1}insert(e,r,n,a,l,h=0,f=0){const m=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(n,a,l,h);const g=this.grid;for(let x=0;x<r.length;x++){const v=r[x],w=[1/0,1/0,-1/0,-1/0];for(let S=0;S<v.length;S++){const A=v[S];w[0]=Math.min(w[0],A.x),w[1]=Math.min(w[1],A.y),w[2]=Math.max(w[2],A.x),w[3]=Math.max(w[3],A.y)}f!==0&&(w[0]-=f,w[1]-=f,w[2]+=f,w[3]+=f),w[0]<Qe&&w[1]<Qe&&w[2]>=0&&w[3]>=0&&g.insert(m,w[0],w[1],w[2],w[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Kf(new Gc(this.rawTileData)).layers,this.sourceLayerCoder=new V5(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,r,n,a){this.loadVTLayers();const l=e.params||{},h=Je(l.filter),f=e.tileResult,m=e.transform,g=f.bufferedTilespaceBounds,x=this.grid.query(g.min.x,g.min.y,g.max.x,g.max.y,(A,P,R,L)=>b_(f.bufferedTilespaceGeometry,A,P,R,L));x.sort(h8);let v=null;m.elevation&&x.length>0&&(v=Fc.create(m.elevation,this.tileID));const w={};let S;for(let A=0;A<x.length;A++){const P=x[A];if(P===S)continue;S=P;const R=this.featureIndexArray.get(P);let L=null;if(this.is3DTile){const V=this.bucketLayerIDs[0][0],q=r[V];if(q.type!=="model")continue;const{queryFeature:G,intersectionZ:ee}=q.queryIntersectsMatchingFeature(f,R.featureIndex,h,m);G&&this.appendToResult(w,V,R.featureIndex,G,ee)}else this.loadMatchingFeature(w,R,h,l.layers,l.availableImages,r,n,a,(V,q,G,ee=0)=>(L||(L=hs(V,this.tileID.canonical,e.tileTransform)),q.queryIntersectsFeature(f,V,G,L,this.z,e.transform,e.pixelPosMatrix,v,ee)))}return w}loadMatchingFeature(e,r,n,a,l,h,f,m,g){const{featureIndex:x,bucketIndex:v,sourceLayerIndex:w,layoutVertexArrayOffset:S}=r,A=this.bucketLayerIDs[v];if(a&&!function(V,q){for(let G=0;G<V.length;G++)if(q.indexOf(V[G])>=0)return!0;return!1}(a,A))return;const P=this.sourceLayerCoder.decode(w),R=this.vtLayers[P].feature(x);if(n.needGeometry){const V=Ks(R,!0);if(!n.filter(new N(this.tileID.overscaledZ),V,this.tileID.canonical))return}else if(!n.filter(new N(this.tileID.overscaledZ),R))return;const L=this.getId(R,P);for(let V=0;V<A.length;V++){const q=A[V];if(a&&a.indexOf(q)<0)continue;const G=h[q];if(!G)continue;let ee={};L!==void 0&&m&&(ee=m.getState(G.sourceLayer||"_geojsonTileLayer",L));const W=!g||g(R,G,ee,S);if(!W)continue;const re=new U5(R,this.z,this.x,this.y,L),ne=gn({},f[q]);ne.paint=G5(ne.paint,G.paint,R,ee,l),ne.layout=G5(ne.layout,G.layout,R,ee,l),re.layer=ne,this.appendToResult(e,q,x,re,W)}}appendToResult(e,r,n,a,l){let h=e[r];h===void 0&&(h=e[r]=[]),h.push({featureIndex:n,feature:a,intersectionZ:l})}lookupSymbolFeatures(e,r,n,a,l,h,f,m){const g={};this.loadVTLayers();const x=Je(l);for(const v of e)this.loadMatchingFeature(g,{bucketIndex:n,sourceLayerIndex:a,featureIndex:v,layoutVertexArrayOffset:0},x,h,f,m,r);return g}loadFeature(e){const{featureIndex:r,sourceLayerIndex:n}=e;this.loadVTLayers();const a=this.sourceLayerCoder.decode(n),l=this.vtFeatures[a];if(l[r])return l[r];const h=this.vtLayers[a].feature(r);return l[r]=h,h}hasLayer(e){for(const r of this.bucketLayerIDs)for(const n of r)if(e===n)return!0;return!1}getId(e,r){let n=e.id;if(this.promoteId){const a=typeof this.promoteId=="string"?this.promoteId:this.promoteId[r];a!=null&&(n=e.properties[a]),typeof n=="boolean"&&(n=Number(n))}return n}}function G5(t,e,r,n,a){return Ss(t,(l,h)=>{const f=e instanceof xe?e.get(h):null;return f&&f.evaluate?f.evaluate(r,n,a):f})}function h8(t,e){return e-t}nt(j5,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const Mp=new Float32Array(262144),Tl=new Uint8Array(262144);function $5(t){let e=0;if(t.meshes)for(const r of t.meshes)e=Math.max(e,r.aabb.max[2]);if(t.children)for(const r of t.children)e=Math.max(e,$5(r));return e}function q5(t,e,r){if(t.meshes)for(const n of t.meshes)n.aabb.min[0]!==1/0&&r.insert(e,n.aabb.min[0],n.aabb.min[1],n.aabb.max[0],n.aabb.max[1]);if(t.children)for(const n of t.children)q5(n,e,r)}const Z5=["","wall","door","roof","window","lamp","logo"];class W5{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:e.id,geometry:[],properties:{height:$5(e)}}}getLocalBounds(){if(!this.node.meshes)return new jr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const r=new jr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const n of this.node.meshes)this.node.lightMeshIndex!==e&&r.encapsulate(n.aabb),e++;this.aabb=jr.applyTransform(r,this.node.matrix)}return this.aabb}}class hd{constructor(e,r,n,a,l,h){this.id=r,this.modelTraits|=Hc.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,n&&(this.modelTraits|=Hc.HasMapboxMeshFeatures),a&&(this.modelTraits|=Hc.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=l,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(const f of e)this.nodesInfo.push(new W5(f)),q5(f,h.featureIndexArray.length,h.grid),h.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,h.bucketLayerIDs.length-1,0)}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const r=this.getNodesInfo();for(const n of r){const a=n.node;this.uploaded?this.updatePbrBuffer(a):vp(a,e,!0)}for(const n of r)sd(n.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let r=!1;if(!e.meshes)return r;for(const n of e.meshes)n.pbrBuffer&&(n.pbrBuffer.updateData(n.featureArray),r=!0);return r}needsReEvaluation(e,r,n){const a=e.transform.projectionOptions,l=e.style.getBrightness(),h=this.brightness!==l;return!!(!this.uploaded||this.dirty||a.name!==this.projection.name||Gh(n.paint.get("model-color").value,h)||Gh(n.paint.get("model-color-mix-intensity").value,h)||Gh(n.paint.get("model-roughness").value,h)||Gh(n.paint.get("model-emissive-strength").value,h)||Gh(n.paint.get("model-height-based-emissive-strength-multiplier").value,h))&&(this.projection=a,this.brightness=l,!0)}evaluateScale(e,r){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const n=this.getNodesInfo(),a=this.id.canonical;for(const l of n){const h=l.feature;l.evaluatedScale=r.paint.get("model-scale").evaluate(h,{},a)}}evaluate(e){const r=this.getNodesInfo();for(const n of r){if(!n.node.meshes)continue;const a=n.feature,l=n.node.meshes&&n.node.meshes[0].featureData,h=n.evaluatedColor[2],f=n.evaluatedRMEA[2],m=this.id.canonical;if(n.hasTranslucentParts=!1,l){for(let g=0;g<Z5.length;g++){const x=Z5[g];x.length&&(a.properties.part=x);const v=e.paint.get("model-color").evaluate(a,{},m),w=e.paint.get("model-color-mix-intensity").evaluate(a,{},m);n.evaluatedColor[g]=[v.r,v.g,v.b,w],n.evaluatedRMEA[g][0]=e.paint.get("model-roughness").evaluate(a,{},m),n.evaluatedRMEA[g][2]=e.paint.get("model-emissive-strength").evaluate(a,{},m),n.evaluatedRMEA[g][3]=v.a,n.emissionHeightBasedParams[g]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(a,{},m),!n.hasTranslucentParts&&v.a<1&&(n.hasTranslucentParts=!0)}delete a.properties.part,f8(n,h!==n.evaluatedColor[2]||f!==n.evaluatedRMEA[2],this.modelTraits)}else n.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(a,{},m);n.evaluatedScale=e.paint.get("model-scale").evaluate(a,{},m),this.updatePbrBuffer(n.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,r,n,a){const l=e.findDEMTileFor(n);if(l&&(l.tileID.canonical!==this.terrainTile||r!==this.terrainExaggeration)){if(l.dem&&l.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=l.tileID.overscaledZ;const h=Fc.create(e,n,l);if(!h)return;this.modelTraits&Hc.HasMapboxMeshFeatures&&this.updateDEM(e,h,n,a);for(const f of this.getNodesInfo()){const m=f.node;if(!m.footprint||!m.footprint.vertices||!m.footprint.vertices.length)continue;const g=m.footprint.vertices;let x=h.getElevationAt(g[0].x,g[0].y,!0,!0);for(let v=1;v<g.length;v++)x=Math.min(x,h.getElevationAt(g[v].x,g[v].y,!0,!0));m.elevation=x}}this.terrainTile=l.tileID.canonical,this.terrainExaggeration=r}}updateDEM(e,r,n,a){let l=r._dem._modifiedForSources[a];if(l===void 0&&(r._dem._modifiedForSources[a]=[],l=r._dem._modifiedForSources[a]),l.includes(n.canonical))return;const h=r._dem.dim;l.push(n.canonical);let f=!1;for(const m of this.getNodesInfo()){const g=m.node;if(!g.footprint||!g.footprint.grid)continue;const x=g.footprint.grid,v=r.tileCoordToPixel(x.min.x,x.min.y),w=r.tileCoordToPixel(x.max.x,x.max.y),S=Math.min(Math.min(h-w.y,v.x),Math.min(v.y,h-w.x));if(S<0)continue;const A=Ht(S,2,5);let P=Math.max(0,v.x-A),R=Math.max(0,v.y-A),L=Math.min(w.x+A,h-1),V=Math.min(w.y+A,h-1);for(let W=R;W<=V;++W)for(let re=P;re<=L;++re)Tl[W*h+re]=255;let q=0,G=0;for(let W=0;W<x.cellsY;++W)for(let re=0;re<x.cellsX;++re){if(!x.cells[W*x.cellsX+re])continue;const ne=r.tileCoordToPixel(x.min.x+re/x.xScale,x.min.y+W/x.yScale),de=r.tileCoordToPixel(x.min.x+(re+1)/x.xScale,x.min.y+(W+1)/x.yScale);for(let ve=ne.y;ve<=Math.min(de.y+1,h-1);++ve)for(let pe=ne.x;pe<=Math.min(de.x+1,h-1);++pe)Tl[ve*h+pe]===255&&(Tl[ve*h+pe]=0,q+=r.getElevationAtPixel(pe,ve),G++)}const ee=q/G;P=Math.max(1,v.x-A),R=Math.max(1,v.y-A),L=Math.min(w.x+A,h-2),V=Math.min(w.y+A,h-2),f=!0;for(let W=R;W<=V;++W)for(let re=P;re<=L;++re)Tl[W*h+re]===0&&(Mp[W*h+re]=r._dem.set(re,W,ee));for(let W=1;W<A;++W){P=Math.max(1,v.x-W),R=Math.max(1,v.y-W),L=Math.min(w.x+W,h-2),V=Math.min(w.y+W,h-2);for(let re=R;re<=V;++re)for(let ne=P;ne<=L;++ne){const de=re*h+ne;if(Tl[de]===255){let ve=0,pe=0,Te=-1,we=-1;for(let be=-1;be<=1;++be)for(let Ce=-1;Ce<=1;++Ce){const Ie=(re+be)*h+ne+Ce;if(Tl[Ie]>=W)continue;const ke=Mp[Ie],Le=Math.abs(ke);Le>pe&&(ve=ke,pe=Le,Te=Ce,we=be)}if(pe>.1){const be=1-(W+.5*Math.abs(Te*we))/A;let Ce=r._dem.get(ne,re)+ve*be;const Ie=r._dem.get(ne+Te,re+we),ke=r._dem.get(ne-Te,re-we,!0);(Ce-Ie)*(Ce-ke)>0&&(Ce=(Ie+ke)/2),Mp[de]=r._dem.set(ne,re,Ce),Tl[de]=W}}}}}f&&(r._demTile.needsDEMTextureUpload=!0,r._dem._timestamp=jn.now())}getNodesInfo(){return this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const r of e)sd(r.node),bp(r.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,r){if(r.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=r.updateTime;const n=r.getReplacementRegionsForTile(e.toUnwrapped()),a=this.getNodesInfo();for(let l=0;l<this.nodesInfo.length;l++){const h=a[l].node;a[l].hiddenByReplacement=!!h.footprint&&!n.find(f=>f.footprint===h.footprint)}}getHeightAtTileCoord(e,r){const n=this.getNodesInfo(),a=[],l=[0,0,0];for(let h=0;h<this.nodesInfo.length;h++){const f=n[h],m=f.node.meshes[0],g=jr.applyTransform(m.aabb,f.node.matrix);if(e<g.min[0]||r<g.min[1]||e>g.max[0]||r>g.max[1])continue;const x=(e-m.aabb.min[0])/(m.aabb.max[0]-m.aabb.min[0])*bl|0,v=Math.min(63,(r-m.aabb.min[1])/(m.aabb.max[1]-m.aabb.min[1])*bl|0)*bl+Math.min(63,x);if(l[2]=m.heightmap[v],s.Q.transformMat4(l,l,f.node.matrix),!(m.heightmap[v]<0&&f.node.footprint))return f.hiddenByReplacement?void 0:{height:l[2],maxHeight:f.feature.properties.height,hidden:!1,verticalScale:f.evaluatedScale[2]};if(f.node.footprint.grid.query(new He(e,r),new He(e,r),a),a.length>0)return{height:void 0,maxHeight:f.feature.properties.height,hidden:f.hiddenByReplacement,verticalScale:f.evaluatedScale[2]}}}}function Gh(t,e){return!t.isLightConstant&&e}function d8(t,e,r,n,a,l,h,f){let m=(61440&e|(61440&e)>>4)>>8,g=(3840&e|(3840&e)>>4)>>4,x=240&e|(240&e)>>4;r[3]>0&&(m=jt(m,255*r[0],r[3]),g=jt(g,255*r[1],r[3]),x=jt(x,255*r[2],r[3]));const v=m<<8|g,w=x<<8|Math.floor(255*n[3]),S=function(W){const re=Ht(W,0,2);return Math.min(Math.round(.5*re*255),255)}(n[2])<<8|15*n[0]<<4|15*n[1],A=Ht(a[0],0,1),P=Ht(a[1],0,1),R=Ht(a[2],0,1),L=Ht(a[3],0,1);let V,q,G,ee;if(A!==P&&h!==l&&P!==A){const W=h-l;q=1/(W*(P-A)),G=-(l+W*A)/(W*(P-A));const re=Ht(a[4],-1,1);ee=Math.pow(10,re),V=255*R<<8|255*L}else V=65535,q=0,G=1,ee=1;if(t.emplaceBack(v,w,S,V,q,G,ee),f){const W=f.length;f.clear();for(let re=0;re<W;re++)f.emplaceBack(v,w,S,V,q,G,ee)}}function f8(t,e,r){const n=t.node;let a=0;const l=r&Hc.HasMeshoptCompression;for(const h of n.meshes){if(n.lights&&n.lightMeshIndex===a||!h.featureData)continue;h.featureArray=new p0,h.featureArray.reserve(h.featureData.length);let f=e;for(const m of h.featureData){const g=l?65535&m:m>>16&65535,x=l?m>>16&65535:65535&m,v=(15&x)<8?15&x:0,w=t.evaluatedRMEA[v],S=t.evaluatedColor[v],A=t.emissionHeightBasedParams[v];let P;if(f&&v===2&&n.lights&&(P=new p0,P.resize(10*n.lights.length)),d8(h.featureArray,g,S,w,A,h.aabb.min[2],h.aabb.max[2],P),P&&f){f=!1;const R=n.meshes[n.lightMeshIndex];R.featureArray=P,R.featureArray._trim()}}h.featureArray._trim(),a++}}function H5(t,e,r,n){const a=1<<t.z;e.lat=zi((n/Qe+t.y)/a),e.lng=vn((r/Qe+t.x)/a)}nt(hd,"Tiled3dModelBucket",{omit:["layers"]}),nt(W5,"Tiled3dModelFeature");const p8={circle:class extends Nt{constructor(t,e,r){super(t,w7,e,r)}createBucket(t){return new Df(t)}queryRadius(t){const e=t;return Oc("circle-radius",this,e)+Oc("circle-stroke-width",this,e)+v0(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,r,n,a,l,h,f){const m=T_(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),l.angle,t.pixelToTileUnitsFactor),g=this.paint.get("circle-radius").evaluate(e,r)+this.paint.get("circle-stroke-width").evaluate(e,r);return B_(t,n,l,h,f,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",m,g)}getProgramIds(){return["circle"]}getDefaultProgramParams(t,e){const r=k_(this);return{config:new ml(this,e),defines:r,overrideFog:!1}}},heatmap:class extends Nt{createBucket(t){return new N_(t)}constructor(t,e,r){super(t,L7,e,r),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=wh({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return Oc("heatmap-radius",this,t)}queryIntersectsFeature(t,e,r,n,a,l,h,f){const m=this.paint.get("heatmap-radius").evaluate(e,r);return B_(t,n,l,h,f,!0,!0,new He(0,0),m)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(t,e){return t==="heatmap"?{config:new ml(this,e),overrideFog:!1}:{}}},hillshade:class extends Nt{constructor(t,e,r){super(t,k7,e,r)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(t,e){return{overrideFog:!1}}},fill:class extends Nt{constructor(t,e,r){super(t,X7,e,r)}getProgramIds(){const t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),r=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&r.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),r}getDefaultProgramParams(t,e){return{config:new ml(this,e),overrideFog:!1}}recalculate(t,e){super.recalculate(t,e);const r=this.paint._values["fill-outline-color"];r.value.kind==="constant"&&r.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Jf(t)}queryRadius(){return v0(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,r,n,a,l){return!t.queryGeometry.isAboveHorizon&&y_(w_(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),l.angle,t.pixelToTileUnitsFactor),n)}isTileClipped(){return!0}},"fill-extrusion":class extends Nt{constructor(t,e,r){super(t,Sy,e,r),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(t){return new B0(t)}queryRadius(){return v0(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(t,e,r,n,a,l,h,f,m){const g=T_(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),l.angle,t.pixelToTileUnitsFactor),x=this.paint.get("fill-extrusion-height").evaluate(e,r),v=this.paint.get("fill-extrusion-base").evaluate(e,r),w=[0,0],S=f&&l.elevation,A=l.elevation?l.elevation.exaggeration():1,P=t.tile.getBucket(this);if(S&&P instanceof B0){const G=P.centroidVertexArray,ee=m+1;ee<G.length&&(w[0]=G.geta_centroid_pos0(ee),w[1]=G.geta_centroid_pos1(ee))}if(w[0]===0&&w[1]===1)return!1;l.projection.name==="globe"&&(n=v4([n],[new He(0,0),new He(Qe,Qe)],t.tileID.canonical).map(G=>G.polygon).flat());const R=S?f:null,[L,V]=function(G,ee,W,re,ne,de,ve,pe,Te,we,be){return G.projection.name==="globe"?function(Ce,Ie,ke,Le,Se,at,rt,Fe,bt,ft,lt){const Ne=[],yt=[],Lt=Ce.projection.upVectorScale(lt,Ce.center.lat,Ce.worldSize).metersToTile,At=[0,0,0,1],Ft=[0,0,0,1],Ot=(Tt,wr,vr,nr)=>{Tt[0]=wr,Tt[1]=vr,Tt[2]=nr,Tt[3]=1},Zt=x4();ke>0&&(ke+=Zt),Le+=Zt;for(const Tt of Ie){const wr=[],vr=[];for(const nr of Tt){const Kt=nr.x+Se.x,or=nr.y+Se.y,kr=Ce.projection.projectTilePoint(Kt,or,lt),Pr=Ce.projection.upVector(lt,nr.x,nr.y);let Xr=ke,Zr=Le;if(rt){const Ui=w4(Kt,or,ke,Le,rt,Fe,bt,ft);Xr+=Ui.base,Zr+=Ui.top}ke!==0?Ot(At,kr.x+Pr[0]*Lt*Xr,kr.y+Pr[1]*Lt*Xr,kr.z+Pr[2]*Lt*Xr):Ot(At,kr.x,kr.y,kr.z),Ot(Ft,kr.x+Pr[0]*Lt*Zr,kr.y+Pr[1]*Lt*Zr,kr.z+Pr[2]*Lt*Zr),s.Q.transformMat4(At,At,at),s.Q.transformMat4(Ft,Ft,at),wr.push(new Nc(At[0],At[1],At[2])),vr.push(new Nc(Ft[0],Ft[1],Ft[2]))}Ne.push(wr),yt.push(vr)}return[Ne,yt]}(G,ee,W,re,ne,de,ve,pe,Te,we,be):ve?function(Ce,Ie,ke,Le,Se,at,rt,Fe,bt){const ft=[],lt=[],Ne=[0,0,0,1];for(const yt of Ce){const Lt=[],At=[];for(const Ft of yt){const Ot=Ft.x+Le.x,Zt=Ft.y+Le.y,Tt=w4(Ot,Zt,Ie,ke,at,rt,Fe,bt);Ne[0]=Ot,Ne[1]=Zt,Ne[2]=Tt.base,Ne[3]=1,s.aa.transformMat4(Ne,Ne,Se),Ne[3]=Math.max(Ne[3],1e-5);const wr=new Nc(Ne[0]/Ne[3],Ne[1]/Ne[3],Ne[2]/Ne[3]);Ne[0]=Ot,Ne[1]=Zt,Ne[2]=Tt.top,Ne[3]=1,s.aa.transformMat4(Ne,Ne,Se),Ne[3]=Math.max(Ne[3],1e-5);const vr=new Nc(Ne[0]/Ne[3],Ne[1]/Ne[3],Ne[2]/Ne[3]);Lt.push(wr),At.push(vr)}ft.push(Lt),lt.push(At)}return[ft,lt]}(ee,W,re,ne,de,ve,pe,Te,we):function(Ce,Ie,ke,Le,Se){const at=[],rt=[],Fe=Se[8]*Ie,bt=Se[9]*Ie,ft=Se[10]*Ie,lt=Se[11]*Ie,Ne=Se[8]*ke,yt=Se[9]*ke,Lt=Se[10]*ke,At=Se[11]*ke;for(const Ft of Ce){const Ot=[],Zt=[];for(const Tt of Ft){const wr=Tt.x+Le.x,vr=Tt.y+Le.y,nr=Se[0]*wr+Se[4]*vr+Se[12],Kt=Se[1]*wr+Se[5]*vr+Se[13],or=Se[2]*wr+Se[6]*vr+Se[14],kr=Se[3]*wr+Se[7]*vr+Se[15],Pr=nr+Fe,Xr=Kt+bt,Zr=or+ft,Ui=Math.max(kr+lt,1e-5),ei=nr+Ne,$r=Kt+yt,di=or+Lt,Ei=Math.max(kr+At,1e-5);Ot.push(new Nc(Pr/Ui,Xr/Ui,Zr/Ui)),Zt.push(new Nc(ei/Ei,$r/Ei,di/Ei))}at.push(Ot),rt.push(Zt)}return[at,rt]}(ee,W,re,ne,de)}(l,n,v,x,g,h,R,w,A,l.center.lat,t.tileID.canonical),q=t.queryGeometry;return function(G,ee,W){let re=1/0;y_(W,ee)&&(re=b4(W,ee[0]));for(let ne=0;ne<ee.length;ne++){const de=ee[ne],ve=G[ne];for(let pe=0;pe<de.length-1;pe++){const Te=de[pe],we=[Te,de[pe+1],ve[pe+1],ve[pe],Te];zf(W,we)&&(re=Math.min(re,b4(W,we)))}}return re!==1/0&&re}(L,V,q.isPointQuery()?q.screenBounds:q.screenGeometry)}},line:class extends Nt{constructor(t,e,r){super(t,S4,e,r),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof el,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=C4.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new tp(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(t,e){const r=I4(this);return{config:new ml(this,e),defines:r,overrideFog:!1}}queryRadius(t){const e=t,r=D4(Oc("line-width",this,e),Oc("line-gap-width",this,e)),n=Oc("line-offset",this,e);return r/2+Math.abs(n)+v0(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,r,n,a,l){if(t.queryGeometry.isAboveHorizon)return!1;const h=w_(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),l.angle,t.pixelToTileUnitsFactor),f=t.pixelToTileUnitsFactor/2*D4(this.paint.get("line-width").evaluate(e,r),this.paint.get("line-gap-width").evaluate(e,r)),m=this.paint.get("line-offset").evaluate(e,r);return m&&(n=function(g,x){const v=[],w=new He(0,0);for(let S=0;S<g.length;S++){const A=g[S],P=[];for(let R=0;R<A.length;R++){const L=A[R],V=A[R+1],q=R===0?w:L.sub(A[R-1])._unit()._perp(),G=R===A.length-1?w:V.sub(L)._unit()._perp(),ee=q._add(G)._unit();ee._mult(1/(ee.x*G.x+ee.y*G.y)),P.push(ee._mult(x)._add(L))}v.push(P)}return v}(n,m*t.pixelToTileUnitsFactor)),function(g,x,v){for(let w=0;w<x.length;w++){const S=x[w];if(g.length>=3){for(let A=0;A<S.length;A++)if(xl(g,S[A]))return!0}if(y7(g,S,v))return!0}return!1}(h,n,f)}isTileClipped(){return!0}},symbol:K0,background:class extends Nt{constructor(t,e,r){super(t,C9,e,r)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(t,e){return{overrideFog:!1}}},raster:_5,"raster-particle":g5,sky:class extends Nt{constructor(t,e,r){super(t,F9,e,r),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="sky-gradient"?this._updateColorRamp():t!=="sky-atmosphere-sun"&&t!=="sky-atmosphere-halo-color"&&t!=="sky-atmosphere-color"&&t!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=wh({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(t,e){if(this.paint.get("sky-type")==="atmosphere"){const n=this.paint.get("sky-atmosphere-sun"),a=!n,l=t.style.light,h=l.properties.get("position");return a&&l.properties.get("anchor")==="viewport"&&Qr("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),a?gp(h.azimuthal,90-h.polar,e):gp(n[0],90-n[1],e)}const r=this.paint.get("sky-gradient-center");return gp(r[0],90-r[1],e)}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const t=this.paint.get("sky-type");return t==="atmosphere"?["skyboxCapture","skybox"]:t==="gradient"?["skyboxGradient"]:null}},slot:class extends Nt{constructor(t,e,r){super(t,N9,e)}},model:class extends Nt{constructor(t,e,r){super(t,H9,e,r),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(t){return new xp(t)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(t){return t instanceof hd?Qe-1:0}queryIntersectsFeature(t,e,r,n,a,l){if(!this.modelManager)return!1;const h=this.modelManager,f=t.tile.getBucket(this);if(!(f&&f instanceof xp))return!1;const m=f;for(const g in m.instancesPerModel){const x=m.instancesPerModel[g],v=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(x.idToFeaturesIndex.hasOwnProperty(v)){const w=x.features[x.idToFeaturesIndex[v]],S=h.getModel(g,this.scope);if(!S)return!1;let A=s.a9.create();const P=new ir(0,0),R=m.canonical;let L=Number.MAX_VALUE;for(let V=0;V<w.instancedDataCount;++V){const q=16*(w.instancedDataOffset+V),G=x.instancedDataArray.float32,ee=[G[q+4],G[q+5],G[q+6]];H5(R,P,G[q],0|G[q+1]),M5(A,S,l,P,w.rotation,w.scale,ee,!1,!1,!1),l.projection.name==="globe"&&(A=yp(A,l));const W=s.a9.multiply([],l.projMatrix,A),re=t.queryGeometry,ne=T5(re.isPointQuery()?re.screenBounds:re.screenGeometry,l,W,S.aabb);ne!=null&&(L=Math.min(ne,L))}return L!==Number.MAX_VALUE&&L}}return!1}_handleOverridablePaintPropertyUpdate(t,e,r){return!(!this.layout||e.isDataDriven()||r.isDataDriven()||t!=="model-color"&&t!=="model-color-mix-intensity"&&t!=="model-rotation"&&t!=="model-scale"&&t!=="model-translation"&&t!=="model-emissive-strength")}_isPropertyZoomDependent(t){const e=this._transitionablePaint._values[t];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof al}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}queryIntersectsMatchingFeature(t,e,r,n){const a=t.tile,l=a.getBucket(this);let h=null,f=Number.MAX_VALUE;if(!(l&&l instanceof hd))return{queryFeature:h,intersectionZ:f};const m=l.getNodesInfo()[e];if(m.hiddenByReplacement||!m.node.meshes||!r.filter(new N(a.tileID.overscaledZ),m.feature,a.tileID.canonical))return{queryFeature:h,intersectionZ:f};const g=m.node,x=n.calculatePosMatrix(a.tileID.toUnwrapped(),n.worldSize),v=m.evaluatedScale;let w=0;n.elevation&&g.elevation&&(w=g.elevation*n.elevation.exaggeration()),s.a9.translate(x,x,[(g.anchor?g.anchor[0]:0)*(v[0]-1),(g.anchor?g.anchor[1]:0)*(v[1]-1),w]),s.a9.scale(x,x,v),s.a9.multiply(x,x,g.matrix);const S=t.queryGeometry,A=S.isPointQuery()?S.screenBounds:S.screenGeometry,P=function(L){const V=s.a9.multiply([],x,L.matrix),q=s.a9.multiply(V,n.expandedFarZProjMatrix,V);for(let G=0;G<L.meshes.length;++G){const ee=L.meshes[G];if(G===L.lightMeshIndex)continue;const W=T5(A,n,q,ee.aabb);W!=null&&(f=Math.min(W,f))}if(L.children)for(const G of L.children)P(G)};if(P(g),f===Number.MAX_VALUE)return{queryFeature:h,intersectionZ:f};const R=new ir(0,0);return H5(a.tileID.canonical,R,m.node.anchor[0],m.node.anchor[1]),h={type:"Feature",geometry:{type:"Point",coordinates:[R.lng,R.lat]},properties:m.feature.properties,id:m.feature.id,state:{},layer:this.serialize()},{queryFeature:h,intersectionZ:f}}}},zt={read:function(t,e){return t.readFields(zt._readField,{header_length:0,x:0,y:0,z:0,layers:[]},e)},_readField:function(t,e,r){t===1?e.header_length=r.readFixed32():t===2?e.x=r.readVarint():t===3?e.y=r.readVarint():t===4?e.z=r.readVarint():t===5&&e.layers.push(zt.Layer.read(r,r.readVarint()+r.pos))},PixelFormat:{PIXEL_FORMAT_UNKNOWN:{value:0,options:{}},PIXEL_FORMAT_UINT32:{value:1,options:{}},PIXEL_FORMAT_UINT16:{value:2,options:{}},PIXEL_FORMAT_UINT8:{value:3,options:{}}},Filter:{}};zt.Filter.read=function(t,e){return t.readFields(zt.Filter._readField,{delta_filter:null,filter:null,zigzag_filter:null,bitshuffle_filter:null,byteshuffle_filter:null},e)},zt.Filter._readField=function(t,e,r){t===1?(e.delta_filter=zt.Filter.Delta.read(r,r.readVarint()+r.pos),e.filter="delta_filter"):t===2?(e.zigzag_filter=zt.Filter.Zigzag.read(r,r.readVarint()+r.pos),e.filter="zigzag_filter"):t===3?(e.bitshuffle_filter=zt.Filter.BitShuffle.read(r,r.readVarint()+r.pos),e.filter="bitshuffle_filter"):t===4&&(e.byteshuffle_filter=zt.Filter.ByteShuffle.read(r,r.readVarint()+r.pos),e.filter="byteshuffle_filter")},zt.Filter.Delta={},zt.Filter.Delta.read=function(t,e){return t.readFields(zt.Filter.Delta._readField,{block_size:0},e)},zt.Filter.Delta._readField=function(t,e,r){t===1&&(e.block_size=r.readVarint())},zt.Filter.Zigzag={},zt.Filter.Zigzag.read=function(t,e){return t.readFields(zt.Filter.Zigzag._readField,{},e)},zt.Filter.Zigzag._readField=function(t,e,r){},zt.Filter.BitShuffle={},zt.Filter.BitShuffle.read=function(t,e){return t.readFields(zt.Filter.BitShuffle._readField,{},e)},zt.Filter.BitShuffle._readField=function(t,e,r){},zt.Filter.ByteShuffle={},zt.Filter.ByteShuffle.read=function(t,e){return t.readFields(zt.Filter.ByteShuffle._readField,{},e)},zt.Filter.ByteShuffle._readField=function(t,e,r){},zt.Codec={},zt.Codec.read=function(t,e){return t.readFields(zt.Codec._readField,{gzip_data:null,codec:null,jpeg_image:null,webp_image:null,png_image:null},e)},zt.Codec._readField=function(t,e,r){t===1?(e.gzip_data=zt.Codec.GzipData.read(r,r.readVarint()+r.pos),e.codec="gzip_data"):t===2?(e.jpeg_image=zt.Codec.JpegImage.read(r,r.readVarint()+r.pos),e.codec="jpeg_image"):t===3?(e.webp_image=zt.Codec.WebpImage.read(r,r.readVarint()+r.pos),e.codec="webp_image"):t===4&&(e.png_image=zt.Codec.PngImage.read(r,r.readVarint()+r.pos),e.codec="png_image")},zt.Codec.GzipData={},zt.Codec.GzipData.read=function(t,e){return t.readFields(zt.Codec.GzipData._readField,{},e)},zt.Codec.GzipData._readField=function(t,e,r){},zt.Codec.JpegImage={},zt.Codec.JpegImage.read=function(t,e){return t.readFields(zt.Codec.JpegImage._readField,{},e)},zt.Codec.JpegImage._readField=function(t,e,r){},zt.Codec.WebpImage={},zt.Codec.WebpImage.read=function(t,e){return t.readFields(zt.Codec.WebpImage._readField,{},e)},zt.Codec.WebpImage._readField=function(t,e,r){},zt.Codec.PngImage={},zt.Codec.PngImage.read=function(t,e){return t.readFields(zt.Codec.PngImage._readField,{},e)},zt.Codec.PngImage._readField=function(t,e,r){},zt.DataIndexEntry={},zt.DataIndexEntry.read=function(t,e){return t.readFields(zt.DataIndexEntry._readField,{first_byte:0,last_byte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},e)},zt.DataIndexEntry._readField=function(t,e,r){t===1?e.first_byte=r.readFixed64():t===2?e.last_byte=r.readFixed64():t===3?e.filters.push(zt.Filter.read(r,r.readVarint()+r.pos)):t===4?e.codec=zt.Codec.read(r,r.readVarint()+r.pos):t===5?e.offset=r.readFloat():t===6?e.scale=r.readFloat():t===7&&e.bands.push(r.readString())},zt.Layer={},zt.Layer.read=function(t,e){return t.readFields(zt.Layer._readField,{version:0,name:"",units:"",tilesize:0,buffer:0,pixel_format:0,data_index:[]},e)},zt.Layer._readField=function(t,e,r){t===1?e.version=r.readVarint():t===2?e.name=r.readString():t===3?e.units=r.readString():t===4?e.tilesize=r.readVarint():t===5?e.buffer=r.readVarint():t===6?e.pixel_format=r.readVarint():t===7&&e.data_index.push(zt.DataIndexEntry.read(r,r.readVarint()+r.pos))};const fo={read:function(t,e){return t.readFields(fo._readField,{uint32_values:null,values:null,fixed32_values:null},e)},_readField:function(t,e,r){t===2?(e.uint32_values=fo.Uint32Values.read(r,r.readVarint()+r.pos),e.values="uint32_values"):t===3&&(e.fixed32_values=fo.Fixed32Values.read(r,r.readVarint()+r.pos),e.values="fixed32_values")},Uint32Values:{}};fo.Uint32Values.read=function(t,e){return t.readFields(fo.Uint32Values._readField,{values:[]},e)},fo.Uint32Values._readField=function(t,e,r){t===1&&(e.readValuesInto=function(n){if(n.type!==2)throw new Error(`Unsupported pbf type "${n.type}"`);const a=function(h){return h.type===2?h.readVarint()+h.pos:h.pos+1}(n),l=n.pos;return n.pos=a,function(h){n.pos=l;let f=0;for(;n.pos<a;){const m=n.readVarint();h[f++]=m}return h}}(r))},fo.Fixed32Values={},fo.Fixed32Values.read=function(t,e){return t.readFields(fo.Fixed32Values._readField,{values:[]},e)},fo.Fixed32Values._readField=function(t,e,r){throw new Error("Not implemented")};/**
 * tiny-lru
 *
 * @copyright 2024 Jason Mulligan <jason.mulligan@avoidwork.com>
 * @license BSD-3-Clause
 * @version 11.2.6
 */class m8{constructor(e=0,r=0,n=!1){this.first=null,this.items=Object.create(null),this.last=null,this.max=e,this.resetTtl=n,this.size=0,this.ttl=r}clear(){return this.first=null,this.items=Object.create(null),this.last=null,this.size=0,this}delete(e){if(this.has(e)){const r=this.items[e];delete this.items[e],this.size--,r.prev!==null&&(r.prev.next=r.next),r.next!==null&&(r.next.prev=r.prev),this.first===r&&(this.first=r.next),this.last===r&&(this.last=r.prev)}return this}entries(e=this.keys()){return e.map(r=>[r,this.get(r)])}evict(e=!1){if(e||this.size>0){const r=this.first;delete this.items[r.key],--this.size==0?(this.first=null,this.last=null):(this.first=r.next,this.first.prev=null)}return this}expiresAt(e){let r;return this.has(e)&&(r=this.items[e].expiry),r}get(e){let r;if(this.has(e)){const n=this.items[e];this.ttl>0&&n.expiry<=Date.now()?this.delete(e):(r=n.value,this.set(e,r,!0))}return r}has(e){return e in this.items}keys(){const e=[];let r=this.first;for(;r!==null;)e.push(r.key),r=r.next;return e}set(e,r,n=!1,a=this.resetTtl){let l;if(n||this.has(e)){if(l=this.items[e],l.value=r,n===!1&&a&&(l.expiry=this.ttl>0?Date.now()+this.ttl:this.ttl),this.last!==l){const h=this.last,f=l.next,m=l.prev;this.first===l&&(this.first=l.next),l.next=null,l.prev=this.last,h.next=l,m!==null&&(m.next=f),f!==null&&(f.prev=m)}}else this.max>0&&this.size===this.max&&this.evict(!0),l=this.items[e]={expiry:this.ttl>0?Date.now()+this.ttl:this.ttl,key:e,prev:this.last,next:null,value:r},++this.size==1?this.first=l:this.last.next=l;return this.last=l,this}values(e=this.keys()){return e.map(r=>this.get(r))}}function _8(t,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let r=e[3];for(let n=2;n>=1;n--){const a=n===1?1:0,l=n===2?1:0;for(let h=0;h<e[0];h++){const f=e[1]*h;for(let m=a;m<e[1];m++){const g=e[2]*(m+f);for(let x=l;x<e[2];x++){const v=e[3]*(x+g);for(let w=0;w<e[3];w++){const S=v+w;t[S]+=t[S-r]}}}}r*=e[n]}return t}function g8(t){for(let e=0,r=t.length;e<r;e++)t[e]=t[e]>>>1^-(1&t[e]);return t}function y8(t,e){switch(e){case"uint32":return t;case"uint16":for(let r=0;r<t.length;r+=2){const n=t[r],a=t[r+1];t[r]=(240&n)>>4|(61440&n)>>8|(240&a)<<4|61440&a,t[r+1]=15&n|(3840&n)>>4|(15&a)<<8|(3840&a)<<4}return t;case"uint8":for(let r=0;r<t.length;r+=4){const n=t[r],a=t[r+1],l=t[r+2],h=t[r+3];t[r+0]=(192&n)>>6|(192&a)>>4|(192&l)>>2|192&h,t[r+1]=(48&n)>>4|(48&a)>>2|48&l|(48&h)<<2,t[r+2]=(12&n)>>2|12&a|(12&l)<<2|(12&h)<<4,t[r+3]=3&n|(3&a)<<2|(3&l)<<4|(3&h)<<6}return t;default:throw new Error(`Invalid pixel format, "${e}"`)}}class ca extends Error{constructor(e){super(e),this.name="MRTError"}}var Fn=Uint8Array,$h=Uint16Array,x8=Int32Array,Q5=new Fn([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),X5=new Fn([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),v8=new Fn([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Y5=function(t,e){for(var r=new $h(31),n=0;n<31;++n)r[n]=e+=1<<t[n-1];var a=new x8(r[30]);for(n=1;n<30;++n)for(var l=r[n];l<r[n+1];++l)a[l]=l-r[n]<<5|n;return{b:r,r:a}},J5=Y5(Q5,2),K5=J5.b,b8=J5.r;K5[28]=258,b8[258]=28;for(var w8=Y5(X5,0).b,e3=new $h(32768),si=0;si<32768;++si){var Jc=(43690&si)>>1|(21845&si)<<1;e3[si]=((65280&(Jc=(61680&(Jc=(52428&Jc)>>2|(13107&Jc)<<2))>>4|(3855&Jc)<<4))>>8|(255&Jc)<<8)>>1}var qh=function(t,e,r){for(var n=t.length,a=0,l=new $h(e);a<n;++a)t[a]&&++l[t[a]-1];var h,f=new $h(e);for(a=1;a<e;++a)f[a]=f[a-1]+l[a-1]<<1;{h=new $h(1<<e);var m=15-e;for(a=0;a<n;++a)if(t[a])for(var g=a<<4|t[a],x=e-t[a],v=f[t[a]-1]++<<x,w=v|(1<<x)-1;v<=w;++v)h[e3[v]>>m]=g}return h},Zh=new Fn(288);for(si=0;si<144;++si)Zh[si]=8;for(si=144;si<256;++si)Zh[si]=9;for(si=256;si<280;++si)Zh[si]=7;for(si=280;si<288;++si)Zh[si]=8;var t3=new Fn(32);for(si=0;si<32;++si)t3[si]=5;var T8=qh(Zh,9),S8=qh(t3,5),Ip=function(t){for(var e=t[0],r=1;r<t.length;++r)t[r]>e&&(e=t[r]);return e},po=function(t,e,r){var n=e/8|0;return(t[n]|t[n+1]<<8)>>(7&e)&r},Pp=function(t,e){var r=e/8|0;return(t[r]|t[r+1]<<8|t[r+2]<<16)>>(7&e)},E8=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],mo=function(t,e,r){var n=new Error(e||E8[t]);if(n.code=t,Error.captureStackTrace&&Error.captureStackTrace(n,mo),!r)throw n;return n},A8=new Fn(0),M8=typeof TextDecoder<"u"&&new TextDecoder;try{M8.decode(A8,{stream:!0})}catch{}const I8={gzip_data:"gzip"},P8={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},C8={uint32:1,uint16:2,uint8:4},D8={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};class r3{constructor(e=1){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){return this.layers[e]}getHeaderLength(e){const r=new Uint8Array(e),n=new DataView(e);if(r[0]!==13)throw new ca("File is not a valid MRT.");return n.getUint32(1,!0)}parseHeader(e){const r=new Uint8Array(e),n=this.getHeaderLength(e);if(r.length<n)throw new ca(`Expected header with length >= ${n} but got buffer of length ${r.length}`);const a=new Gc(r.subarray(0,n)),l=zt.read(a);if(!isNaN(this.x)&&(this.x!==l.x||this.y!==l.y||this.z!==l.z))throw new ca(`Invalid attempt to parse header ${l.z}/${l.x}/${l.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=l.x,this.y=l.y,this.z=l.z;for(const h of l.layers)this.layers[h.name]=new z8(h,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const r=[],n=this.getLayer(e.layerName);for(let a=0;a<n.dataIndex.length;a++){const l=n.dataIndex[a],h=l.first_byte-e.firstByte,f=l.last_byte+1-e.firstByte;if(a<e.firstBlock||a>e.lastBlock||n._blocksInProgress.has(a))continue;const m={layerName:n.name,firstByte:h,lastByte:f,pixelFormat:n.pixelFormat,blockIndex:a,blockShape:[l.bands.length].concat(n.bandShape),buffer:n.buffer,codec:l.codec.codec,filters:l.filters.map(g=>g.filter)};n._blocksInProgress.add(a),r.push(m)}return new i3(r,()=>{r.forEach(a=>n._blocksInProgress.delete(a.blockIndex))},(a,l)=>{if(r.forEach(h=>n._blocksInProgress.delete(h.blockIndex)),a)throw a;l.forEach(h=>{this.getLayer(h.layerName).processDecodedData(h)})})}}class z8{constructor({version:e,name:r,units:n,tilesize:a,pixel_format:l,buffer:h,data_index:f},m){if(this.version=e,this.version!==1)throw new ca(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=r,this.units=n,this.tileSize=a,this.buffer=h,this.pixelFormat=P8[l],this.dataIndex=f,this.bandShape=[a+2*h,a+2*h,C8[this.pixelFormat]],this._decodedBlocks=function(g=1e3,x=0,v=!1){if(isNaN(g)||g<0)throw new TypeError("Invalid max value");if(isNaN(x)||x<0)throw new TypeError("Invalid ttl value");if(typeof v!="boolean")throw new TypeError("Invalid resetTtl value");return new m8(g,x,v)}(m?m.cacheSize:5),this._blocksInProgress=new Set}processDecodedData(e){const r=e.blockIndex.toString();this._decodedBlocks.get(r)||this._decodedBlocks.set(r,e.data)}getBlockForBand(e){let r=0;switch(typeof e){case"string":for(const[n,a]of this.dataIndex.entries()){for(const[l,h]of a.bands.entries())if(h===e)return{bandIndex:r+l,blockIndex:n,blockBandIndex:l};r+=a.bands.length}break;case"number":for(const[n,a]of this.dataIndex.entries()){if(e>=r&&e<r+a.bands.length)return{bandIndex:e,blockIndex:n,blockBandIndex:e-r};r+=a.bands.length}break;default:throw new ca(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}throw new ca(`Band not found: ${JSON.stringify(e)}`)}getDataRange(e){let r=1/0,n=-1/0,a=1/0,l=-1/0;for(const h of e){const{blockIndex:f}=this.getBlockForBand(h);if(f<0)throw new ca(`Invalid band: ${JSON.stringify(h)}`);const m=this.dataIndex[f];a=Math.min(a,f),l=Math.max(l,f),r=Math.min(r,m.first_byte),n=Math.max(n,m.last_byte)}return{layerName:this.name,firstByte:r,lastByte:n,firstBlock:a,lastBlock:l}}hasBand(e){const{blockIndex:r}=this.getBlockForBand(e);return r>=0}hasDataForBand(e){const{blockIndex:r}=this.getBlockForBand(e);return r>=0&&!!this._decodedBlocks.get(r.toString())}getBandView(e){const{blockIndex:r,blockBandIndex:n}=this.getBlockForBand(e),a=this._decodedBlocks.get(r.toString());if(!a)throw new ca(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const l=this.dataIndex[r],h=this.bandShape.reduce((g,x)=>g*x,1),f=n*h,m=a.subarray(f,f+h);return{data:m,bytes:new Uint8Array(m.buffer).subarray(m.byteOffset,m.byteOffset+m.byteLength),tileSize:this.tileSize,buffer:this.buffer,offset:l.offset,scale:l.scale}}}class i3{constructor(e,r,n){this.tasks=e,this._onCancel=r,this._onComplete=n,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,r){this._finalized||(this._onComplete(e,r),this._finalized=!0)}}r3.performDecoding=function(t,e){return Promise.all(e.tasks.map(r=>{const{layerName:n,firstByte:a,lastByte:l,pixelFormat:h,blockShape:f,blockIndex:m,filters:g,codec:x}=r,v=new Uint8Array(t).subarray(a,l+1),w=new Uint32Array(f[0]*f[1]*f[2]);let S;if(x!=="gzip_data")throw new Error(`Unhandled codec: ${x}`);return S=function(A,P){if(!globalThis.DecompressionStream&&P==="gzip_data")return Promise.resolve(((q=function(W){W[0]==31&&W[1]==139&&W[2]==8||mo(6,"invalid gzip data");var re=W[3],ne=10;4&re&&(ne+=2+(W[10]|W[11]<<8));for(var de=(re>>3&1)+(re>>4&1);de>0;de-=!W[ne++]);return ne+(2&re)}(V=A))+8>V.length&&mo(6,"invalid gzip data"),function(W,re,ne,de){var ve=W.length;if(!ve||re.f&&!re.l)return ne||new Fn(0);var pe=!ne,Te=pe||re.i!=2,we=re.i;pe&&(ne=new Fn(3*ve));var be,Ce,Ie=function(ua){var ha=ne.length;if(ua>ha){var Sl=new Fn(Math.max(2*ha,ua));Sl.set(ne),ne=Sl}},ke=re.f||0,Le=re.p||0,Se=re.b||0,at=re.l,rt=re.d,Fe=re.m,bt=re.n,ft=8*ve;do{if(!at){ke=po(W,Le,1);var lt=po(W,Le+1,3);if(Le+=3,!lt){var Ne=W[(Kt=4+((Le+7)/8|0))-4]|W[Kt-3]<<8,yt=Kt+Ne;if(yt>ve){we&&mo(0);break}Te&&Ie(Se+Ne),ne.set(W.subarray(Kt,yt),Se),re.b=Se+=Ne,re.p=Le=8*yt,re.f=ke;continue}if(lt==1)at=T8,rt=S8,Fe=9,bt=5;else if(lt==2){var Lt=po(W,Le,31)+257,At=po(W,Le+10,15)+4,Ft=Lt+po(W,Le+5,31)+1;Le+=14;for(var Ot=new Fn(Ft),Zt=new Fn(19),Tt=0;Tt<At;++Tt)Zt[v8[Tt]]=po(W,Le+3*Tt,7);Le+=3*At;var wr=Ip(Zt),vr=(1<<wr)-1,nr=qh(Zt,wr);for(Tt=0;Tt<Ft;){var Kt,or=nr[po(W,Le,vr)];if(Le+=15&or,(Kt=or>>4)<16)Ot[Tt++]=Kt;else{var kr=0,Pr=0;for(Kt==16?(Pr=3+po(W,Le,3),Le+=2,kr=Ot[Tt-1]):Kt==17?(Pr=3+po(W,Le,7),Le+=3):Kt==18&&(Pr=11+po(W,Le,127),Le+=7);Pr--;)Ot[Tt++]=kr}}var Xr=Ot.subarray(0,Lt),Zr=Ot.subarray(Lt);Fe=Ip(Xr),bt=Ip(Zr),at=qh(Xr,Fe),rt=qh(Zr,bt)}else mo(1);if(Le>ft){we&&mo(0);break}}Te&&Ie(Se+131072);for(var Ui=(1<<Fe)-1,ei=(1<<bt)-1,$r=Le;;$r=Le){var di=(kr=at[Pp(W,Le)&Ui])>>4;if((Le+=15&kr)>ft){we&&mo(0);break}if(kr||mo(2),di<256)ne[Se++]=di;else{if(di==256){$r=Le,at=null;break}var Ei=di-254;di>264&&(Ei=po(W,Le,(1<<(rn=Q5[Tt=di-257]))-1)+K5[Tt],Le+=rn);var Ai=rt[Pp(W,Le)&ei],Rr=Ai>>4;if(Ai||mo(3),Le+=15&Ai,Zr=w8[Rr],Rr>3){var rn=X5[Rr];Zr+=Pp(W,Le)&(1<<rn)-1,Le+=rn}if(Le>ft){we&&mo(0);break}Te&&Ie(Se+131072);var ms=Se+Ei;if(Se<Zr){var Yn=0-Zr,_o=Math.min(Zr,ms);for(Yn+Se<0&&mo(3);Se<_o;++Se)ne[Se]=(void 0)[Yn+Se]}for(;Se<ms;++Se)ne[Se]=ne[Se-Zr]}}re.l=at,re.p=$r,re.b=Se,re.f=ke,at&&(ke=1,re.m=Fe,re.d=rt,re.n=bt)}while(!ke);return Se!=ne.length&&pe?(be=ne,((Ce=Se)==null||Ce>be.length)&&(Ce=be.length),new Fn(be.subarray(0,Ce))):ne.subarray(0,Se)}(V.subarray(q,-8),{i:2},new Fn(((R=V)[(L=R.length)-4]|R[L-3]<<8|R[L-2]<<16|R[L-1]<<24)>>>0))));var R,L,V,q;const G=I8[P];if(!G)throw new Error(`Unhandled codec: ${P}`);const ee=new globalThis.DecompressionStream(G);return new Response(new Blob([A]).stream().pipeThrough(ee)).arrayBuffer().then(W=>new Uint8Array(W))}(v,x).then(A=>{const P=fo.read(new Gc(A));if(P.values==="uint32_values")return P.uint32_values.readValuesInto(w),new D8[h](w.buffer);throw new Error(`Unhandled numeric data "${P.values}"`)}),S.then(A=>{for(let P=g.length-1;P>=0;P--)switch(g[P]){case"delta_filter":_8(A,f);break;case"zigzag_filter":g8(A);break;case"bitshuffle_filter":y8(A,h);break;default:throw new Error(`Unhandled filter "${g[P]}"`)}return{layerName:n,blockIndex:m,data:A}}).catch(A=>{throw A})}))},nt(i3,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});const n3=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Cp{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,n]=new Uint8Array(e,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const a=n>>4;if(a!==1)throw new Error(`Got v${a} data when expected v1.`);const l=n3[15&n];if(!l)throw new Error("Unrecognized array type.");const[h]=new Uint16Array(e,2,1),[f]=new Uint32Array(e,4,1);return new Cp(f,h,l,e)}constructor(e,r=64,n=Float64Array,a){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=n,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const l=n3.indexOf(this.ArrayType),h=2*e*this.ArrayType.BYTES_PER_ELEMENT,f=e*this.IndexArrayType.BYTES_PER_ELEMENT,m=(8-f%8)%8;if(l<0)throw new Error(`Unexpected typed array class: ${n}.`);a&&a instanceof ArrayBuffer?(this.data=a,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+f+m,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+h+f+m),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+f+m,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+l]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=e)}add(e,r){const n=this._pos>>1;return this.ids[n]=n,this.coords[this._pos++]=e,this.coords[this._pos++]=r,n}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Dp(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,r,n,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:l,coords:h,nodeSize:f}=this,m=[0,l.length-1,0],g=[];for(;m.length;){const x=m.pop()||0,v=m.pop()||0,w=m.pop()||0;if(v-w<=f){for(let R=w;R<=v;R++){const L=h[2*R],V=h[2*R+1];L>=e&&L<=n&&V>=r&&V<=a&&g.push(l[R])}continue}const S=w+v>>1,A=h[2*S],P=h[2*S+1];A>=e&&A<=n&&P>=r&&P<=a&&g.push(l[S]),(x===0?e<=A:r<=P)&&(m.push(w),m.push(S-1),m.push(1-x)),(x===0?n>=A:a>=P)&&(m.push(S+1),m.push(v),m.push(1-x))}return g}within(e,r,n){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:a,coords:l,nodeSize:h}=this,f=[0,a.length-1,0],m=[],g=n*n;for(;f.length;){const x=f.pop()||0,v=f.pop()||0,w=f.pop()||0;if(v-w<=h){for(let R=w;R<=v;R++)s3(l[2*R],l[2*R+1],e,r)<=g&&m.push(a[R]);continue}const S=w+v>>1,A=l[2*S],P=l[2*S+1];s3(A,P,e,r)<=g&&m.push(a[S]),(x===0?e-n<=A:r-n<=P)&&(f.push(w),f.push(S-1),f.push(1-x)),(x===0?e+n>=A:r+n>=P)&&(f.push(S+1),f.push(v),f.push(1-x))}return m}}function Dp(t,e,r,n,a,l){if(a-n<=r)return;const h=n+a>>1;o3(t,e,h,n,a,l),Dp(t,e,r,n,h-1,1-l),Dp(t,e,r,h+1,a,1-l)}function o3(t,e,r,n,a,l){for(;a>n;){if(a-n>600){const g=a-n+1,x=r-n+1,v=Math.log(g),w=.5*Math.exp(2*v/3),S=.5*Math.sqrt(v*w*(g-w)/g)*(x-g/2<0?-1:1);o3(t,e,r,Math.max(n,Math.floor(r-x*w/g+S)),Math.min(a,Math.floor(r+(g-x)*w/g+S)),l)}const h=e[2*r+l];let f=n,m=a;for(Wh(t,e,n,r),e[2*a+l]>h&&Wh(t,e,n,a);f<m;){for(Wh(t,e,f,m),f++,m--;e[2*f+l]<h;)f++;for(;e[2*m+l]>h;)m--}e[2*n+l]===h?Wh(t,e,n,m):(m++,Wh(t,e,m,a)),m<=r&&(n=m+1),r<=m&&(a=m-1)}}function Wh(t,e,r,n){zp(t,r,n),zp(e,2*r,2*n),zp(e,2*r+1,2*n+1)}function zp(t,e,r){const n=t[e];t[e]=t[r],t[r]=n}function s3(t,e,r,n){const a=t-r,l=e-n;return a*a+l*l}s.$=class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return function([r,n]){const a=Ia([1,r,n]);return{x:a.x,y:a.y,z:a.z}}(t.expression.evaluate(e))}interpolate(t,e,r){return{x:jt(t.x,e.x,r),y:jt(t.y,e.y,r),z:jt(t.z,e.z,r)}}},s.A=Ee,s.B=fh,s.C=Ji,s.D=s0,s.E=Yo,s.F=function(t){const e=t.value;let r=[];if(!e)return r;const n=Io(e);return n!=="string"?(r=r.concat([new od(t.key,e,`string expected, "${n}" found`)]),r):(S5(e,!0)||(r=r.concat([new od(t.key,e,`invalid url "${e}"`)])),r)},s.G=X,s.H=ue,s.I=ap,s.J=oe,s.K=class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return Ia(t.expression.evaluate(e))}interpolate(t,e,r){return{x:jt(t.x,e.x,r),y:jt(t.y,e.y,r),z:jt(t.z,e.z,r),azimuthal:jt(t.azimuthal,e.azimuthal,r),polar:jt(t.polar,e.polar,r)}}},s.L=te,s.M=class{constructor(t,e,r,n){this.id=t,this.position=e!=null?new ir(e[0],e[1]):new ir(0,0),this.orientation=r??[0,0,0],this.nodes=n,this.uploaded=!1,this.aabb=new jr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(t,e){if(s.a9.multiply(t.matrix,e,t.matrix),t.meshes)for(const r of t.meshes){const n=jr.applyTransform(r.aabb,t.matrix);this.aabb.encapsulate(n)}if(t.children)for(const r of t.children)this._applyTransformations(r,t.matrix)}computeBoundsAndApplyParent(){const t=s.a9.identity([]);for(const e of this.nodes)this._applyTransformations(e,t)}computeModelMatrix(t,e,r,n,a,l,h=!1){M5(this.matrix,this,t.transform,this.position,e,r,n,a,l,h)}upload(t){if(!this.uploaded){for(const e of this.nodes)vp(e,t);for(const e of this.nodes)sd(e);this.uploaded=!0}}destroy(){for(const t of this.nodes)bp(t)}},s.N=N,s.O=Vi,s.P=He,s.R=Hl,s.S=Ea,s.T=_p,s.U=xe,s.V=od,s.W=ea,s.X=jt,s.Y=Qe,s.Z=al,s._=Na,s.a=ic,s.a$=Tu,s.a0=function(t,e,r=0,n=!0){const a=new He(r,r),l=t.sub(a),h=e.add(a),f=[l,new He(h.x,l.y),h,new He(l.x,h.y)];return n&&f.push(l.clone()),f},s.a1=function(t,e){const r=[];for(let n=0;n<t.length;n++){const a=eo(n-1,-1,t.length-1),l=eo(n+1,-1,t.length-1),h=t[n],f=t[l],m=t[a].sub(h).unit(),g=f.sub(h).unit(),x=g.angleWithSep(m.x,m.y),v=m.add(g).unit().mult(-1*e/Math.sin(x/2));r.push(h.add(v))}return r},s.a2=a5,s.a3=b_,s.a4=function(t,e,r=0){return s.Q.fromValues(((e.x-r)*t.scale-t.x)*Qe,(e.y*t.scale-t.y)*Qe,f_(e.z,e.y))},s.a5=kf,s.a6=E4,s.a7=function(t){let e=1/0,r=1/0,n=-1/0,a=-1/0;for(const l of t)e=Math.min(e,l.x),r=Math.min(r,l.y),n=Math.max(n,l.x),a=Math.max(a,l.y);return{min:new He(e,r),max:new He(n,a)}},s.a8=Js,s.aA=gr,s.aB=Rt,s.aC=t0,s.aD=yf,s.aE=ni,s.aF=ar,s.aG=Qm,s.aH=J0,s.aI=function(){Y.isLoading()||Y.isLoaded()||Q()!=="deferred"||H()},s.aJ=Je,s.aK=Ks,s.aL=U5,s.aM=cn,s.aN=tp,s.aO=Jf,s.aP=hs,s.aQ=Ci,s.aR=_f,s.aS=M_,s.aT=C0,s.aU=mp,s.aV=function(t,e){const r=ea(e.zoom);if(r===0)return Oo(t);const n=T0(t),a=Vf(n),l=Js(n.getWest())*e.worldSize,h=Js(n.getEast())*e.worldSize,f=us(n.getNorth())*e.worldSize,m=us(n.getSouth())*e.worldSize,g=[l,f,0],x=[h,f,0],v=[l,m,0],w=[h,m,0],S=s.a9.invert([],e.globeMatrix);return s.Q.transformMat4(g,g,S),s.Q.transformMat4(x,x,S),s.Q.transformMat4(v,v,S),s.Q.transformMat4(w,w,S),a[0]=ds(a[0],v,r),a[1]=ds(a[1],w,r),a[2]=ds(a[2],x,r),a[3]=ds(a[3],g,r),jr.fromPoints(a)},s.aW=E0,s.aX=bh,s.aY=ds,s.aZ=mi,s.a_=S7,s.ab=xl,s.ac=__,s.ad=Ht,s.ae=en,s.af=function(t,e){const r={};for(let n=0;n<e.length;n++){const a=e[n];a in t&&(r[a]=t[a])}return r},s.ag=Ys,s.ah=us,s.ai=class{constructor(t){this.entries={},this.scheduler=t}request(t,e,r,n){const a=this.entries[t]=this.entries[t]||{callbacks:[]};if(a.result){const[l,h]=a.result;return this.scheduler?this.scheduler.add(()=>{n(l,h)},e):n(l,h),()=>{}}return a.callbacks.push(n),a.cancel||(a.cancel=r((l,h)=>{a.result=[l,h];for(const f of a.callbacks)this.scheduler?this.scheduler.add(()=>{f(l,h)},e):f(l,h);setTimeout(()=>delete this.entries[t],3e3)})),()=>{a.result||(a.callbacks=a.callbacks.filter(l=>l!==n),a.callbacks.length||(a.cancel(),delete this.entries[t]))}}},s.aj=Mr,s.ak=function(t,e,r){const n=JSON.stringify(t.request);return t.data&&(this.deduped.entries[n]={result:[null,t.data]}),this.deduped.request(n,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},a=>{const l=za(t.request,(h,f,m,g)=>{h?a(h):f&&a(null,{vectorTile:r?void 0:new Kf(new Gc(f)),rawData:f,cacheControl:m,expires:g})});return()=>{l.cancel(),a()}},e)},s.al=function(t){Iu++,Iu>E1&&(t.getActor().send("enforceCacheSizeLimit",Zl),Iu=0)},s.am=Xi,s.an=Gl,s.ao=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},s.ap=Ni,s.aq=_5,s.ar=g5,s.as=m5,s.at=function(t,e){const r=document.createElement("video");r.muted=!0,r.onloadstart=function(){e(null,r)};for(let n=0;n<t.length;n++){const a=document.createElement("source");Cu(t[n])||(r.crossOrigin="Anonymous"),a.src=t[n],r.appendChild(a)}return{cancel:()=>{}}},s.au=ed,s.av=Rh,s.aw=vn,s.ax=zi,s.ay=Di,s.az=gi,s.b=Ao,s.b$=qc,s.b0=r3,s.b1=za,s.b2=function(t){const e=[];for(const r in t)e.push(t[r]);return e},s.b3=function(t,e){const r=[];for(const n in t)n in e||r.push(n);return r},s.b4=bu,s.b5=["type","source","source-layer","minzoom","maxzoom","filter","layout"],s.b6=function(t,e){const{x:r,y:n}=t.point,a=R_(r,n,t.worldSize/t._pixelsPerMercatorPixel,0,0);return s.a9.multiply(a,a,Uf(Oo(e)))},s.b8=Vc,s.b9=Bn,s.bA=u_,s.bB=function(t){const e=s.a9.identity(new Float64Array(16));s.a9.multiply(e,t.pixelMatrix,t.globeMatrix);const r=[0,Qn,0],n=[0,Xn,0];return s.Q.transformMat4(r,r,e),s.Q.transformMat4(n,n,e),[r[0]>0&&r[0]<=t.width&&r[1]>0&&r[1]<=t.height&&!Gf(t,new ir(t.center.lat,90)),n[0]>0&&n[0]<=t.width&&n[1]>0&&n[1]<=t.height&&!Gf(t,new ir(t.center.lat,-90))]},s.bC=function(t,e){const{scale:r}=t.tileTransform,n=r*Qe/(t.tileSize*Math.pow(2,e.zoom-t.tileID.overscaledZ+t.tileID.canonical.z));return s.b7.scale(new Float32Array(4),e.inverseAdjustmentMatrix,[n,n])},s.bD=id,s.bE=y5,s.bF=function(t){const e=y5(t,!0);return s.b7.invert([],[e[0],e[1],e[4],e[5]])},s.bG=Bf,s.bH=function(t){const{x:e,y:r}=t.point,{lng:n,lat:a}=t._center;return R_(e,r,t.worldSize,n,a)},s.bI=Zi,s.bJ=Sf,s.bK=function(t){const e=Math.round((t+45+360)%360/90)%4;return v1[e]},s.bL=45,s.bM=Mf,s.bN=gh,s.bO=Hs,s.bP=bf,s.bQ=Ki,s.bR=_0,s.bS=a_,s.bT=function(t,e,r){const n=Math.sqrt(t*t+e*e+r*r),a=n>0?Math.acos(r/n)*vu:0;let l=t!==0||e!==0?Math.atan2(-e,-t)*vu+90:0;return l<0&&(l+=360),[n,l,a]},s.bU=g0,s.bV=jr,s.bW=Ia,s.bX=function(t){return[Math.pow(t[0],1/2.2),Math.pow(t[1],1/2.2),Math.pow(t[2],1/2.2)]},s.bY=function(t){return t({pluginStatus:k,pluginURL:O}),j.on("pluginStateChange",t),t},s.bZ=Qc,s.b_=ad,s.ba=F0,s.bb=function(t,e,r,n,a){const l=5*e+2;t.float32[l+0]=r,t.float32[l+1]=n,t.float32[l+2]=a},s.bc=Y0,s.bd=X4,s.be=zf,s.bf=Ri,s.bg=up,s.bh=i5,s.bi=sp,s.bj=Cp,s.bk=eo,s.bm=er,s.bn=Ho,s.bo=tn,s.bp=function(t,e,r){t[4*e+0]=r[0],t[4*e+1]=r[1],t[4*e+2]=r[2],t[4*e+3]=r[3]},s.bq=ir,s.br=d5,s.bs=d_,s.bt=Ff,s.bu=x5,s.bv=gl,s.bw=C_,s.bx=function(t,e,r,n,a,l,h,f,m){if(m.name==="globe")return C_(t,e,new gl(r,n,a),!1);const g=Rh({z:r,x:n,y:a},m);return new jr([(l+g.x/g.scale)*e,e*(g.y/g.scale),h],[(l+g.x2/g.scale)*e,e*(g.y2/g.scale),f])},s.by=function(t,e,r){let n=0;for(let a=0;a<2;++a)t[a]>0&&(n+=(t[a]-0)*(t[a]-0)),e[a]<0&&(n+=(0-e[a])*(0-e[a]));return n},s.bz=oi,s.c=N5,s.c$=[1,1,1],s.c0=lp,s.c1=Ps,s.c2=B,s.c3=ct,s.c4=ql,s.c5=ka,s.c6=to,s.c7=function(t,e,r){return t.type==="custom"?new k9(t,e):new p8[t.type](t,e,r)},s.c8=function(t){const e=t.indexOf(ii);return e>=0?t.slice(0,e):t},s.c9=function(t){return t.indexOf(ii)>=0},s.cA=t=>({u_matrix:new gh(t),u_pixels_to_tile_units:new wf(t),u_device_pixel_ratio:new Ki(t),u_units_to_pixels:new Hs(t),u_dash_image:new _0(t),u_gradient_image:new _0(t),u_image_height:new Ki(t),u_texsize:new Hs(t),u_tile_units_to_pixels:new Ki(t),u_alpha_discard_threshold:new Ki(t),u_trim_offset:new Hs(t),u_emissive_strength:new Ki(t)}),s.cB=t=>({u_matrix:new gh(t),u_texsize:new Hs(t),u_pixels_to_tile_units:new wf(t),u_device_pixel_ratio:new Ki(t),u_image:new _0(t),u_units_to_pixels:new Hs(t),u_tile_units_to_pixels:new Ki(t),u_alpha_discard_threshold:new Ki(t),u_trim_offset:new Hs(t)}),s.cC=hl,s.cD=jy,s.cE=Gy,s.cF=k_,s.cG=(t,e,r,n,a,l)=>{const h=t.transform,f=h.projection.name==="globe";let m;if(l.paint.get("circle-pitch-alignment")==="map")if(f){const x=z_(h.zoom,e.canonical)*h._pixelsPerMercatorPixel;m=Float32Array.from([x,0,0,x])}else m=h.calculatePixelsToTileUnitsMatrix(r);else m=new Float32Array([h.pixelsToGLUnits[0],0,0,h.pixelsToGLUnits[1]]);const g={u_camera_to_center_distance:t.transform.getCameraToCenterDistance(h.projection),u_matrix:t.translatePosMatrix(e.projMatrix,r,l.paint.get("circle-translate"),l.paint.get("circle-translate-anchor")),u_device_pixel_ratio:jn.devicePixelRatio,u_extrude_scale:m,u_inv_rot_matrix:P7,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:l.paint.get("circle-emissive-strength")};if(f){g.u_inv_rot_matrix=n,g.u_merc_center=a,g.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],g.u_zoom_transition=ea(h.zoom);const x=a[0]*Qe,v=a[1]*Qe;g.u_up_dir=h.projection.upVector(new gl(0,0,0),x,v)}return g},s.cH=I4,s.cI=(t,e,r,n,a,l)=>{const h=t.transform;return{u_matrix:M4(t,e,r,n),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:h.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:a,u_image:0,u_tile_units_to_pixels:A4(e,h),u_units_to_pixels:[1/h.pixelsToGLUnits[0],1/h.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:l}},s.cJ=(t,e,r,n,a,l,h)=>{const f=t.transform,m=f.calculatePixelsToTileUnitsMatrix(e);return{u_matrix:M4(t,e,r,n),u_pixels_to_tile_units:m,u_device_pixel_ratio:l,u_units_to_pixels:[1/f.pixelsToGLUnits[0],1/f.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:a,u_texsize:P4(r)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:A4(e,t.transform),u_alpha_discard_threshold:0,u_trim_offset:h,u_emissive_strength:r.paint.get("line-emissive-strength")}},s.cK=wu,s.cL=wh,s.cM=x4,s.cN=d7,s.cO=B0,s.cP=ia,s.cQ=450,s.cR=7,s.cS=R9,s.cT=256,s.cU=Uf,s.cV=pl,s.cW=fl,s.cX=pf,s.cY=function(t,e,r,n,a){return Ht((t-e)/(r-e)*(a-n)+n,n,a)},s.cZ=yl,s.c_=yp,s.ca=function(t){const e=t.indexOf(ii);return e>=0?t.slice(e+1):""},s.cb=function(t){const e=[],r=t.id;return r===void 0&&e.push({message:`layers.${r}: missing required property "id"`}),t.render===void 0&&e.push({message:`layers.${r}: missing required method "render"`}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},s.cc=Aa,s.cd=j,s.ce=Da,s.cf=l_,s.cg=class extends ls{constructor(t){super(t),this.current=n7}set(t,e,r){if(this.fetchUniformLocation(t,e)){for(let n=0;n<9;n++)if(r[n]!==this.current[n]){this.current=r,this.gl.uniformMatrix3fv(this.location,!1,r);break}}}},s.ch=Bl,s.ci=function(t,e,r){const n=ea(r.zoom),a=t.style.map._antialias,l=e.options.extStandardDerivativesForceOff||t.terrain&&t.terrain.exaggeration()>0;return n===0&&!a&&!l},s.cj=function(t){const e=t.pixelsPerMeter,r=e/tn(1,t.center.lat),n=s.a9.identity(new Float64Array(16));return s.a9.translate(n,n,[t.point.x,t.point.y,0]),s.a9.scale(n,n,[r,r,e]),Float32Array.from(n)},s.ck=T0,s.cl=function(t){const e=oi-5;t=Ht(t,-e,e)/e*90;const r=Math.pow(Math.abs(Math.sin(er(t))),3);return Math.round(r*(Ef.length-1))},s.cm=function(t,e,r,n){const a=e.getNorth(),l=e.getSouth(),h=e.getWest(),f=e.getEast(),m=1<<t.z,g=f-h,x=a-l,v=g/Dc,w=-x/Ef[r],S=[0,v,0,w,0,0,a,h,0];if(t.z>0){const A=180/n;s.ct.multiply(S,S,[A/g+1,0,0,0,A/x+1,0,-.5*A/v,.5*A/w,1])}return S[2]=m,S[5]=t.x,S[8]=t.y,S},s.cn=Oo,s.co=function(t,e,r){const n=s.a9.identity(new Float64Array(16)),a=(e/(1<<t)-.5)*Math.PI*2;return s.a9.rotateY(n,r.globeMatrix,a),Float32Array.from(n)},s.cp=class{isDataAvailableAtPoint(t){const e=this._source();if(this.isUsingMockSource()||!e||t.y<0||t.y>1)return!1;const r=e.getSource().maxzoom,n=1<<r,a=Math.floor(t.x),l=Math.floor((t.x-a)*n),h=Math.floor(t.y*n),f=this.findDEMTileFor(new Ni(r,a,r,l,h));return!(!f||!f.dem)}getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,r=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const n=this._source();if(!n||t.y<0||t.y>1)return e;const a=n.getSource().maxzoom,l=1<<a,h=Math.floor(t.x),f=t.x-h,m=new Ni(a,h,a,Math.floor(f*l),Math.floor(t.y*l)),g=this.findDEMTileFor(m);if(!g||!g.dem)return e;const x=g.dem,v=1<<g.tileID.canonical.z,w=(f*v-g.tileID.canonical.x)*x.dim,S=(t.y*v-g.tileID.canonical.y)*x.dim,A=Math.floor(w),P=Math.floor(S);return(r?this.exaggeration():1)*jt(jt(x.get(A,P),x.get(A,P+1),S-P),jt(x.get(A+1,P),x.get(A+1,P+1),S-P),w-A)}getAtTileOffset(t,e,r){const n=1<<t.canonical.z;return this.getAtPointOrZero(new Vi(t.wrap+(t.canonical.x+e/Qe)/n,(t.canonical.y+r/Qe)/n))}getAtTileOffsetFunc(t,e,r,n){return a=>{const l=this.getAtTileOffset(t,a.x,a.y),h=n.upVector(t.canonical,a.x,a.y),f=n.upVectorScale(t.canonical,e,r).metersToTile;return s.Q.scale(h,h,l*f),h}}getForTilePoints(t,e,r,n){if(this.isUsingMockSource())return!1;const a=Fc.create(this,t,n);return!!a&&(e.forEach(l=>{l[2]=this.exaggeration()*a.getElevationAt(l[0],l[1],r)}),!0)}getMinMaxForTile(t){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(t);if(!e||!e.dem)return null;const r=e.dem.tree,n=e.tileID,a=1<<t.canonical.z-n.canonical.z;let l=t.canonical.x/a-n.canonical.x,h=t.canonical.y/a-n.canonical.y,f=0;for(let m=0;m<t.canonical.z-n.canonical.z&&!r.leaves[f];m++){l*=2,h*=2;const g=2*Math.floor(h)+Math.floor(l);f=r.childOffsets[f]+g,l%=1,h%=1}return{min:this.exaggeration()*r.minimums[f],max:this.exaggeration()*r.maximums[f]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,r){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const t=this.visibleDemTiles;if(t.length===0)return null;let e=!1,r=Number.MAX_VALUE,n=Number.MIN_VALUE;for(const a of t){const l=this.getMinMaxForTile(a.tileID);l&&(r=Math.min(r,l.min),n=Math.max(n,l.max),e=!0)}return e?{min:r,max:n}:null}},s.cq=w0,s.cr=j_,s.cs=function(t,e){return[Math.pow(t[0],2.2)*e,Math.pow(t[1],2.2)*e,Math.pow(t[2],2.2)*e]},s.cu=z_,s.cv=S1,s.cw=Pn,s.cx=256,s.cy=function(t,e){const r=[0,0,0],n=E0(Oo(e.canonical));return s.Q.transformMat4(r,r,n),s.Q.transformMat4(r,r,t),r},s.cz=t=>({u_camera_to_center_distance:new Ki(t),u_extrude_scale:new wf(t),u_device_pixel_ratio:new Ki(t),u_matrix:new gh(t),u_inv_rot_matrix:new gh(t),u_merc_center:new Hs(t),u_tile_id:new bf(t),u_zoom_transition:new Ki(t),u_up_dir:new bf(t),u_emissive_strength:new Ki(t)}),s.d=Du,s.d$=I5,s.d0=Fc,s.d1=Hc,s.d2=xn,s.d3=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[]}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(t){const e=J_(new He(0,0),new He(Qe,Qe),t),r=[];for(const n of this._activeRegions){if(n.hiddenByOverlap||!Y_(e,n))continue;const a=uy(n.min,n.max,t);r.push({min:a.min,max:a.max,sourceId:this._sourceIds[n.priority],footprint:n.footprint,footprintTileId:n.tileId})}return r}setSources(t){this._setSources(t.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const r=[];for(const n of e.cache.getVisibleCoordinates()){const a=e.cache.getTile(n).buckets[e.layer];if(a)for(const l of a.getNodesInfo()){const h=l.node;h.footprint&&r.push({footprint:h.footprint,id:n.toUnwrapped()})}}return r}})))}_addSource(t){const e=t.getFootprints();if(e.length!==0){for(const r of e){if(!r.footprint)continue;const n=J_(r.footprint.min,r.footprint.max,r.id);this._activeRegions.push({min:n.min,max:n.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:r.id,footprint:r.footprint})}this._sourceIds.push(t.getSourceId())}}_computeReplacement(){this._activeRegions.sort((e,r)=>e.priority-r.priority||L0(e.min,r.min)||L0(e.max,r.max));let t=this._activeRegions.length!==this._prevRegions.length;if(!t){let e=0,r=0;for(;!t&&e!==this._activeRegions.length;){const n=this._activeRegions[e],a=this._prevRegions[r];t=n.priority!==a.priority||!X_(n,a),++e,++r}}if(t){++this._updateTime;const e=r=>{const n=this._activeRegions;if(r>=n.length)return r;const a=n[r].priority;for(;r<n.length&&n[r].priority===a;)++r;return r};if(this._sourceIds.length>1){let r=0,n=e(r);for(;r!==n;){let a=r;const l=r;for(;a!==n;){const h=this._activeRegions[a];h.hiddenByOverlap=!1;for(let f=0;f<l;f++){const m=this._activeRegions[f];if(!m.hiddenByOverlap&&Y_(h,m)&&(h.hiddenByOverlap=e4(h.footprint,h.tileId,m.footprint,m.tileId),h.hiddenByOverlap))break}++a}r=n,n=e(r)}}}}_setSources(t){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=t.length-1;e>=0;e--)this._addSource(t[e]);this._computeReplacement()}},s.d4=class{constructor(t){this._createGrid(t),this._createPoles(t)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const t of this._poleSegments)t.destroy();for(const t of this._gridSegments)t.withSkirts.destroy(),t.withoutSkirts.destroy()}_fillGridMeshWithLods(t,e){const r=new Ci,n=new gi,a=[],l=t+1+2,h=e[0]+1,f=e[0]+1+(1+e.length),m=(g,x,v)=>{let w=g===l-1?g-2:g===0?g:g-1;return w+=v?24575:0,[w,x]};for(let g=0;g<l;++g)r.emplaceBack(...m(g,0,!0));for(let g=0;g<h;++g)for(let x=0;x<l;++x)r.emplaceBack(...m(x,g,(x===0||x===l-1)&&!0));for(let g=0;g<e.length;++g){const x=e[g];for(let v=0;v<l;++v)r.emplaceBack(...m(v,x,!0))}for(let g=0;g<e.length;++g){const x=n.length,v=e[g]+1+2,w=new gi;for(let P=0;P<v-1;P++){const R=P===v-2,L=R?l*(f-e.length+g-P):l;for(let V=0;V<l-1;V++){const q=P*l+V;P===0||R||V===0||V===l-2?(w.emplaceBack(q+1,q,q+L),w.emplaceBack(q+L,q+L+1,q+1)):(n.emplaceBack(q+1,q,q+L),n.emplaceBack(q+L,q+L+1,q+1))}}const S=ni.simpleSegment(0,x,r.length,n.length-x);for(let P=0;P<w.uint16.length;P+=3)n.emplaceBack(w.uint16[P],w.uint16[P+1],w.uint16[P+2]);const A=ni.simpleSegment(0,x,r.length,n.length-x);a.push({withoutSkirts:S,withSkirts:A})}return{vertices:r,indices:n,segments:a}}_createGrid(t){const e=this._fillGridMeshWithLods(Dc,Ef);this._gridSegments=e.segments,this._gridBuffer=t.createVertexBuffer(e.vertices,M_.members),this._gridIndexBuffer=t.createIndexBuffer(e.indices,!0)}_createPoles(t){const e=new gi;for(let h=0;h<=Dc;h++)e.emplaceBack(0,h+1,h+2);this._poleIndexBuffer=t.createIndexBuffer(e,!0);const r=new fl,n=new fl,a=new fl,l=new fl;this._poleSegments=[];for(let h=0,f=0;h<Sf;h++){const m=360/(1<<h);r.emplaceBack(0,-en,0,.5,0),n.emplaceBack(0,-en,0,.5,1),a.emplaceBack(0,-en,0,.5,.5),l.emplaceBack(0,-en,0,.5,.5);for(let g=0;g<=Dc;g++){let x=g/Dc,v=0;const w=jt(0,m,x),[S,A,P]=zc(M7,I7,w,en);r.emplaceBack(S,A,P,x,v),n.emplaceBack(S,A,P,x,1-v);const R=er(w);x=.5+.5*Math.sin(R),v=.5+.5*Math.cos(R),a.emplaceBack(S,A,P,x,v),l.emplaceBack(S,A,P,x,1-v)}this._poleSegments.push(ni.simpleSegment(f,0,66,64)),f+=66}this._poleNorthVertexBuffer=t.createVertexBuffer(r,b0,!1),this._poleSouthVertexBuffer=t.createVertexBuffer(n,b0,!1),this._texturedPoleNorthVertexBuffer=t.createVertexBuffer(a,b0,!1),this._texturedPoleSouthVertexBuffer=t.createVertexBuffer(l,b0,!1)}getGridBuffers(t,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[t].withSkirts:this._gridSegments[t].withoutSkirts]}getPoleBuffers(t,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[t]]}},s.d5=function(t){return tc.has(t)},s.d6=b1,s.d7=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},s.d8=In,s.d9=m_,s.dA=Vh,s.dB=function(t){const e=Mu();if(!e)return;const r=e.delete(As);t&&r.catch(t).then(()=>t())},s.dC=Nh,s.dD=P5,s.dE=function(t){Tp=jn.resolveURL(t),Yc||(Yc=new Qc(ad(),new Yo)),Yc.broadcast("setDracoUrl",Tp)},s.dF=C5,s.dG=function(t){Xc=jn.resolveURL(t),Yc||(Yc=new Qc(ad(),new Yo)),Yc.broadcast("setMeshoptUrl",Xc)},s.dH=nt,s.dI=ta,s.dJ=uo,s.dK=V5,s.dL=j5,s.dM=T4,s.dN=Ss,s.dO=J4,s.dP=function(t,e,r,n,a,l,h,f,m,g,x){t.createArrays(),t.tilePixelRatio=Qe/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;const v=t.layers[0].layout,w=t.layers[0]._unevaluatedLayout._values,S={};if(t.textSizeData.kind==="composite"){const{minZoom:L,maxZoom:V}=t.textSizeData;S.compositeTextSizes=[w["text-size"].possiblyEvaluate(new N(L),f),w["text-size"].possiblyEvaluate(new N(V),f)]}if(t.iconSizeData.kind==="composite"){const{minZoom:L,maxZoom:V}=t.iconSizeData;S.compositeIconSizes=[w["icon-size"].possiblyEvaluate(new N(L),f),w["icon-size"].possiblyEvaluate(new N(V),f)]}S.layoutTextSize=w["text-size"].possiblyEvaluate(new N(m+1),f),S.layoutIconSize=w["icon-size"].possiblyEvaluate(new N(m+1),f),S.textMaxSize=w["text-size"].possiblyEvaluate(new N(18),f);const A=v.get("text-rotation-alignment")==="map"&&v.get("symbol-placement")!=="point",P=v.get("text-size");let R=!1;for(const L of t.features)if(L.icon&&L.icon.nameSecondary){R=!0;break}for(const L of t.features){const V=v.get("text-font").evaluate(L,{},f).join(","),q=P.evaluate(L,{},f),G=S.layoutTextSize.evaluate(L,{},f),ee=(S.layoutIconSize.evaluate(L,{},f),{horizontal:{},vertical:void 0}),W=L.text;let re,ne=[0,0];if(W){const pe=W.toString(),Te=v.get("text-letter-spacing").evaluate(L,{},f)*Ri,we=v.get("text-line-height").evaluate(L,{},f)*Ri,be=u(pe)?Te:0,Ce=v.get("text-anchor").evaluate(L,{},f),Ie=v.get("text-variable-anchor");if(!Ie){const rt=v.get("text-radial-offset").evaluate(L,{},f);ne=rt?i5(Ce,[rt*Ri,cp]):v.get("text-offset").evaluate(L,{},f).map(Fe=>Fe*Ri)}let ke=A?"center":v.get("text-justify").evaluate(L,{},f);const Le=v.get("symbol-placement")==="point",Se=Le?v.get("text-max-width").evaluate(L,{},f)*Ri:1/0,at=rt=>{t.allowVerticalPlacement&&o(pe)&&(ee.vertical=op(W,e,r,a,V,Se,we,Ce,rt,be,ne,Bn.vertical,!0,G,q))};if(!A&&Ie){const rt=ke==="auto"?Ie.map(bt=>up(bt)):[ke];let Fe=!1;for(let bt=0;bt<rt.length;bt++){const ft=rt[bt];if(!ee.horizontal[ft])if(Fe)ee.horizontal[ft]=ee.horizontal[0];else{const lt=op(W,e,r,a,V,Se,we,"center",ft,be,ne,Bn.horizontal,!1,G,q);lt&&(ee.horizontal[ft]=lt,Fe=lt.positionedLines.length===1)}}at("left")}else{if(ke==="auto"&&(ke=up(Ce)),Le||v.get("text-writing-mode").indexOf("horizontal")>=0||!o(pe)){const rt=op(W,e,r,a,V,Se,we,Ce,ke,be,ne,Bn.horizontal,!1,G,q);rt&&(ee.horizontal[ke]=rt)}at(Le?"left":ke)}}let de=!1;if(L.icon&&L.icon.namePrimary){const pe=n[L.icon.namePrimary];pe&&(re=l9(a[L.icon.namePrimary],L.icon.nameSecondary?a[L.icon.nameSecondary]:void 0,v.get("icon-offset").evaluate(L,{},f),v.get("icon-anchor").evaluate(L,{},f)),de=pe.sdf,t.sdfIcons===void 0?t.sdfIcons=pe.sdf:t.sdfIcons!==pe.sdf&&Qr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(pe.pixelRatio!==t.pixelRatio||v.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}const ve=o5(ee.horizontal)||ee.vertical;t.iconsInText||(t.iconsInText=!!ve&&ve.iconsInText),(ve||re)&&m9(t,L,ee,re,n,S,G,0,ne,de,h,f,g,x,R)}l&&t.generateCollisionDebugBuffers(m,t.collisionBoxArray)},s.dQ=Kf,s.dR=Gc,s.dS=O0,s.dT=z0,s.dU=D0,s.dV=kl,s.dW=R4,s.dX=Br,s.dY=function(t){let e=0;if(new Uint32Array(t,0,1)[0]!==z5){const r=new Uint32Array(t,0,7),[,,n,a,l,h]=r;e=r.byteLength+a+l+h+l,(n!==t.byteLength||e>=t.byteLength)&&Qr("Invalid b3dm header information.")}return k5(t,e)},s.dZ=function(t,e){const r=N5(t);for(const n of r){for(const a of n.meshes)l8(a);n.lights&&(n.lightMeshIndex=n.meshes.length,n.meshes.push(c8(n.lights,e)))}return r},s.d_=hd,s.da=_l,s.db=function([t,e,r]){const n=Math.hypot(t,e,r),a=Math.atan2(t,r),l=.5*Math.PI-Math.acos(-e/n);return new ir(Zi(a),Zi(l))},s.dc=Rc,s.dd=Ze,s.de=Gf,s.df=L_,s.dg=function(t){const e=[0,0,0],r=s.a9.identity(new Float64Array(16));return s.a9.multiply(r,t.pixelMatrix,t.globeMatrix),s.Q.transformMat4(e,e,r),new He(e[0],e[1])},s.dh=function(t){const e=t.navigator?t.navigator.userAgent:null;return!!function(r){if(jl==null){const n=r.navigator?r.navigator.userAgent:null;jl=!!r.safari||!(!n||!(/\b(iPad|iPhone|iPod)\b/.test(n)||n.match("Safari")&&!n.match("Chrome")))}return jl}(t)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},s.di=class{constructor(t,e,r){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!r,this._createSkuToken()}_createSkuToken(){const t=function(){let e="";for(let r=0;r<10;r++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",La,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,e){if(!ct(t))return t;const r=Cn(t);return r.params.push(`sdk=js-${ze}`),r.path=`/styles/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||e)}normalizeGlyphsURL(t,e){if(!ct(t))return t;const r=Cn(t);return r.path=`/fonts/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||e)}normalizeModelURL(t,e){if(!ct(t))return t;const r=Cn(t);return r.path=`/models/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||e)}normalizeSourceURL(t,e,r,n){if(!ct(t))return t;const a=Cn(t);return a.path=`/v4/${a.authority}.json`,a.params.push("secure"),r&&a.params.push(`language=${r}`),n&&a.params.push(`worldview=${n}`),this._makeAPIURL(a,this._customAccessToken||e)}normalizeSpriteURL(t,e,r,n){const a=Cn(t);return ct(t)?(a.path=`/styles/v1${a.path}/sprite${e}${r}`,this._makeAPIURL(a,this._customAccessToken||n)):(a.path+=`${e}${r}`,Cs(a))}normalizeTileURL(t,e,r){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!ct(t))return t;const n=Cn(t);n.path=n.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||r&&n.authority!=="raster"&&r===512?"@2x":""}${Xo.supported?".webp":"$1"}`),n.authority==="raster"?n.path=`/${Ze.RASTER_URL_PREFIX}${n.path}`:n.authority==="rasterarrays"?n.path=`/${Ze.RASTERARRAYS_URL_PREFIX}${n.path}`:(n.path=n.path.replace(/^.+\/v4\//,"/"),n.path=`/${Ze.TILE_URL_VERSION}${n.path}`);const a=this._customAccessToken||function(l){for(const h of l){const f=h.match(/^access_token=(.*)$/);if(f)return f[1]}return null}(n.params)||Ze.ACCESS_TOKEN;return Ze.REQUIRE_ACCESS_TOKEN&&a&&this._skuToken&&n.params.push(`sku=${this._skuToken}`),this._makeAPIURL(n,a)}canonicalizeTileURL(t,e){const r=Cn(t);if(!r.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!r.path.match(/\.[\w]+$/))return t;let n="mapbox://";r.path.match(/^\/raster\/v1\//)?n+=`raster/${r.path.replace(`/${Ze.RASTER_URL_PREFIX}/`,"")}`:r.path.match(/^\/rasterarrays\/v1\//)?n+=`rasterarrays/${r.path.replace(`/${Ze.RASTERARRAYS_URL_PREFIX}/`,"")}`:n+=`tiles/${r.path.replace(`/${Ze.TILE_URL_VERSION}/`,"")}`;let a=r.params;return e&&(a=a.filter(l=>!l.match(/^access_token=/))),a.length&&(n+=`?${a.join("&")}`),n}canonicalizeTileset(t,e){const r=!!e&&ct(e),n=[];for(const a of t.tiles||[])St(a)?n.push(this.canonicalizeTileURL(a,r)):n.push(a);return n}_makeAPIURL(t,e){const r="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",n=Cn(Ze.API_URL);if(t.protocol=n.protocol,t.authority=n.authority,t.protocol==="http"){const a=t.params.indexOf("secure");a>=0&&t.params.splice(a,1)}if(n.path!=="/"&&(t.path=`${n.path}${t.path}`),!Ze.REQUIRE_ACCESS_TOKEN)return Cs(t);if(e=e||Ze.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${r}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${r}`)}return t.params=t.params.filter(a=>a.indexOf("access_token")===-1),t.params.push(`access_token=${e||""}`),Cs(t)}},s.dj=function(t,e){e?tc.add(t):tc.delete(t)},s.dk=Xo,s.dl=Kl,s.dm=Lu,s.dn=Yl,s.dp=Yi,s.dq=Hd,s.dr=function(t){tc.delete(t)},s.ds=ec,s.dt=Eo,s.du=ze,s.dv=function(t,e){Zl=t,E1=e},s.dw=function(t,e,r=!1){if(k===E||k===I||k===C)throw new Error("setRTLTextPlugin cannot be called multiple times.");O=jn.resolveURL(t),k=E,D=e,F(),r||H()},s.dx=Q,s.dy=function(){ad().acquire(wp)},s.dz=function(){const t=Uh;t&&(t.isPreloaded()&&t.numActive()===1?(t.release(wp),Uh=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},s.e=gn,s.e0=Y,s.e1=function(t){Ms(),io&&io.then(e=>{e.keys().then(r=>{for(let n=0;n<r.length-t;n++)e.delete(r[n])})})},s.f=jn,s.g=function(t,e){return Da(gn(t,{type:"json"}),e)},s.h=kn,s.i=class extends od{},s.j=Io,s.k=sc,s.l=function(t){return fetch(t).then(e=>e.arrayBuffer()).then(e=>k5(e,0,t))},s.m=Ec,s.n=a0,s.o=Mc,s.p=Y4,s.q=ye,s.r=u0,s.s=$s,s.t=qs,s.u=_e,s.v=Ya,s.w=Qr,s.x=Ka,s.y=Do}),qe(["./shared"],function(s){function ze(Ve){const Z=Ve?Ve.url.toString():void 0;return Z?performance.getEntriesByName(Z):[]}function pt(Ve){if(typeof Ve=="number"||typeof Ve=="boolean"||typeof Ve=="string"||Ve==null)return JSON.stringify(Ve);if(Array.isArray(Ve)){let K="[";for(const ce of Ve)K+=`${pt(ce)},`;return`${K}]`}let Z="{";for(const K of Object.keys(Ve).sort())Z+=`${K}:${pt(Ve[K])},`;return`${Z}}`}function Ze(Ve){let Z="";for(const K of s.b5)Z+=`/${pt(Ve[K])}`;return Z}class St{constructor(Z){this.keyCache={},this._layers={},this._layerConfigs={},Z&&this.replace(Z)}replace(Z,K){this._layerConfigs={},this._layers={},this.update(Z,[],K)}update(Z,K,ce){this._options=ce;for(const Oe of Z)this._layerConfigs[Oe.id]=Oe,(this._layers[Oe.id]=s.c7(Oe,this.scope,this._options)).compileFilter(),this.keyCache[Oe.id]&&delete this.keyCache[Oe.id];for(const Oe of K)delete this.keyCache[Oe],delete this._layerConfigs[Oe],delete this._layers[Oe];this.familiesBySource={};const De=function(Oe,Ue){const dt={};for(let ot=0;ot<Oe.length;ot++){const ut=Ue&&Ue[Oe[ot].id]||Ze(Oe[ot]);Ue&&(Ue[Oe[ot].id]=ut);let gt=dt[ut];gt||(gt=dt[ut]=[]),gt.push(Oe[ot])}const Pe=[];for(const ot in dt)Pe.push(dt[ot]);return Pe}(s.b2(this._layerConfigs),this.keyCache);for(const Oe of De){const Ue=Oe.map(Ke=>this._layers[Ke.id]),dt=Ue[0];if(dt.visibility==="none")continue;const Pe=dt.source||"";let ot=this.familiesBySource[Pe];ot||(ot=this.familiesBySource[Pe]={});const ut=dt.sourceLayer||"_geojsonTileLayer";let gt=ot[ut];gt||(gt=ot[ut]=[]),gt.push(Ue)}}}const ct=1*s.dJ;class dr{constructor(Z){const K={},ce=[];for(const dt in Z){const Pe=Z[dt],ot=K[dt]={};for(const ut in Pe.glyphs){const gt=Pe.glyphs[+ut];if(!gt||gt.bitmap.width===0||gt.bitmap.height===0)continue;const Ke=gt.metrics.localGlyph?ct:1,Sr={x:0,y:0,w:gt.bitmap.width+2*Ke,h:gt.bitmap.height+2*Ke};ce.push(Sr),ot[ut]=Sr}}const{w:De,h:Oe}=s.p(ce),Ue=new s.dI({width:De||1,height:Oe||1});for(const dt in Z){const Pe=Z[dt];for(const ot in Pe.glyphs){const ut=Pe.glyphs[+ot];if(!ut||ut.bitmap.width===0||ut.bitmap.height===0)continue;const gt=K[dt][ot],Ke=ut.metrics.localGlyph?ct:1;s.dI.copy(ut.bitmap,Ue,{x:0,y:0},{x:gt.x+Ke,y:gt.y+Ke},ut.bitmap)}}this.image=Ue,this.positions=K}}s.dH(dr,"GlyphAtlas");class _r{constructor(Z){this.tileID=new s.ap(Z.tileID.overscaledZ,Z.tileID.wrap,Z.tileID.canonical.z,Z.tileID.canonical.x,Z.tileID.canonical.y),this.tileZoom=Z.tileZoom,this.uid=Z.uid,this.zoom=Z.zoom,this.canonical=Z.tileID.canonical,this.pixelRatio=Z.pixelRatio,this.tileSize=Z.tileSize,this.source=Z.source,this.scope=Z.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Z.showCollisionBoxes,this.collectResourceTiming=!!Z.collectResourceTiming,this.promoteId=Z.promoteId,this.isSymbolTile=Z.isSymbolTile,this.tileTransform=s.av(Z.tileID.canonical,Z.projection),this.projection=Z.projection,this.brightness=Z.brightness,this.extraShadowCaster=!!Z.extraShadowCaster}parse(Z,K,ce,De,Oe){this.status="parsing",this.data=Z,this.collisionBoxArray=new s.aG;const Ue=new s.dK(Object.keys(Z.layers).sort()),dt=new s.dL(this.tileID,this.promoteId);dt.bucketLayerIDs=[];const Pe={},ot=new s.dM(256,256),ut={featureIndex:dt,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:ot,availableImages:ce,brightness:this.brightness},gt=K.familiesBySource[this.source];for(const Er in gt){const qr=Z.layers[Er];if(!qr)continue;let xi=!1,Nr=!1,Gi=!1;for(const ci of gt[Er])ci[0].type==="symbol"?xi=!0:Nr=!0,ci[0].is3D()&&ci[0].type!=="model"&&(Gi=!0);if(this.extraShadowCaster&&!Gi||this.isSymbolTile===!0&&!xi||this.isSymbolTile===!1&&!Nr)continue;qr.version===1&&s.w(`Vector tile source "${this.source}" layer "${Er}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Bi=Ue.encode(Er),En=[];for(let ci=0;ci<qr.length;ci++){const Wr=qr.feature(ci),Ae=dt.getId(Wr,Er);En.push({feature:Wr,id:Ae,index:ci,sourceLayerIndex:Bi})}for(const ci of gt[Er]){const Wr=ci[0];(!this.extraShadowCaster||Wr.is3D()&&Wr.type!=="model")&&(this.isSymbolTile!==void 0&&Wr.type==="symbol"!==this.isSymbolTile||Wr.minzoom&&this.zoom<Math.floor(Wr.minzoom)||Wr.maxzoom&&this.zoom>=Wr.maxzoom||Wr.visibility!=="none"&&(ur(ci,this.zoom,ut.brightness,ce),(Pe[Wr.id]=Wr.createBucket({index:dt.bucketLayerIDs.length,layers:ci,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Bi,sourceID:this.source,projection:this.projection.spec})).populate(En,ut,this.tileID.canonical,this.tileTransform),dt.bucketLayerIDs.push(ci.map(Ae=>Ae.id))))}}let Ke,Sr,fr,br;ot.trim();const pr={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},mr=()=>{if(Ke)return this.status="done",Oe(Ke);if(this.extraShadowCaster)this.status="done",Oe(null,{buckets:s.b2(Pe).filter(Er=>!Er.isEmpty()),featureIndex:dt,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:ut.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Sr&&fr&&br){const Er=new dr(Sr),qr=new s.dO(fr,br);for(const xi in Pe){const Nr=Pe[xi];Nr instanceof s.aH?(ur(Nr.layers,this.zoom,ut.brightness,ce),s.dP(Nr,Sr,Er.positions,fr,qr.iconPositions,this.showCollisionBoxes,ce,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):Nr.hasPattern&&(Nr instanceof s.aN||Nr instanceof s.aO||Nr instanceof s.cO)&&(ur(Nr.layers,this.zoom,ut.brightness,ce),Nr.addFeatures(ut,this.tileID.canonical,qr.patternPositions,ce,this.tileTransform,this.brightness))}this.status="done",Oe(null,{buckets:s.b2(Pe).filter(xi=>!xi.isEmpty()),featureIndex:dt,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Er.image,lineAtlas:ot,imageAtlas:qr,brightness:ut.brightness})}};if(!this.extraShadowCaster){const Er=s.dN(ut.glyphDependencies,Nr=>Object.keys(Nr).map(Number));Object.keys(Er).length?De.send("getGlyphs",{uid:this.uid,stacks:Er,scope:this.scope},(Nr,Gi)=>{Ke||(Ke=Nr,Sr=Gi,mr())},void 0,!1,pr):Sr={};const qr=Object.keys(ut.iconDependencies);qr.length?De.send("getImages",{icons:qr,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(Nr,Gi)=>{Ke||(Ke=Nr,fr=Gi,mr())},void 0,!1,pr):fr={};const xi=Object.keys(ut.patternDependencies);xi.length?De.send("getImages",{icons:xi,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(Nr,Gi)=>{Ke||(Ke=Nr,br=Gi,mr())},void 0,!1,pr):br={}}mr()}}function ur(Ve,Z,K,ce){const De=new s.N(Z,{brightness:K});for(const Oe of Ve)Oe.recalculate(De,ce)}class Lr extends s.E{constructor(Z,K,ce,De,Oe,Ue){super(),this.actor=Z,this.layerIndex=K,this.availableImages=ce,this.loadVectorData=Oe||s.ak,this.loading={},this.loaded={},this.deduped=new s.ai(Z.scheduler),this.isSpriteLoaded=De,this.scheduler=Z.scheduler,this.brightness=Ue}loadTile(Z,K){const ce=Z.uid,De=Z&&Z.request,Oe=De&&De.collectResourceTiming,Ue=this.loading[ce]=new _r(Z);Ue.abort=this.loadVectorData(Z,(dt,Pe)=>{const ot=!this.loading[ce];if(delete this.loading[ce],ot||dt||!Pe)return Ue.status="done",ot||(this.loaded[ce]=Ue),K(dt);const ut=Pe.rawData,gt={};Pe.expires&&(gt.expires=Pe.expires),Pe.cacheControl&&(gt.cacheControl=Pe.cacheControl),Ue.vectorTile=Pe.vectorTile||new s.dQ(new s.dR(ut));const Ke=()=>{Ue.parse(Ue.vectorTile,this.layerIndex,this.availableImages,this.actor,(Sr,fr)=>{if(Sr||!fr)return K(Sr);const br={};if(Oe){const pr=ze(De);pr.length>0&&(br.resourceTiming=JSON.parse(JSON.stringify(pr)))}K(null,s.e({rawTileData:ut.slice(0)},fr,gt,br))})};this.isSpriteLoaded?Ke():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Ke,{type:"parseTile",isSymbolTile:Z.isSymbolTile,zoom:Z.tileZoom}):Ke()}),this.loaded=this.loaded||{},this.loaded[ce]=Ue})}reloadTile(Z,K){const ce=this.loaded,De=Z.uid,Oe=this;if(ce&&ce[De]){const Ue=ce[De];Ue.showCollisionBoxes=Z.showCollisionBoxes,Ue.projection=Z.projection,Ue.brightness=Z.brightness,Ue.tileTransform=s.av(Z.tileID.canonical,Z.projection),Ue.extraShadowCaster=Z.extraShadowCaster;const dt=(Pe,ot)=>{const ut=Ue.reloadCallback;ut&&(delete Ue.reloadCallback,Ue.parse(Ue.vectorTile,Oe.layerIndex,this.availableImages,Oe.actor,ut)),K(Pe,ot)};Ue.status==="parsing"?Ue.reloadCallback=dt:Ue.status==="done"&&(Ue.vectorTile?Ue.parse(Ue.vectorTile,this.layerIndex,this.availableImages,this.actor,dt):dt())}else K(null,void 0)}abortTile(Z,K){const ce=Z.uid,De=this.loading[ce];De&&(De.abort&&De.abort(),delete this.loading[ce]),K()}removeTile(Z,K){const ce=this.loaded,De=Z.uid;ce&&ce[De]&&delete ce[De],K()}}class Dr{loadTile(Z,K){const{uid:ce,encoding:De,rawImageData:Oe,padding:Ue}=Z,dt=ImageBitmap&&Oe instanceof ImageBitmap?this.getImageData(Oe,Ue):Oe;K(null,new s.dS(ce,dt,De,Ue<1))}getImageData(Z,K){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(Z.width,Z.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=Z.width,this.offscreenCanvas.height=Z.height,this.offscreenCanvasContext.drawImage(Z,0,0,Z.width,Z.height);const ce=this.offscreenCanvasContext.getImageData(-K,-K,Z.width+2*K,Z.height+2*K);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ce}}class Br{decodeRasterArray({task:Z,buffer:K},ce){s.b0.performDecoding(K,Z).then(De=>{ce(null,De)},De=>{ce(De)})}}const Vt=s.dT.prototype.toGeoJSON;let Ut=class{constructor(Ve){this._feature=Ve,this.extent=s.Y,this.type=Ve.type,this.properties=Ve.tags,"id"in Ve&&!isNaN(Ve.id)&&(this.id=parseInt(Ve.id,10))}loadGeometry(){if(this._feature.type===1){const Ve=[];for(const Z of this._feature.geometry)Ve.push([new s.P(Z[0],Z[1])]);return Ve}{const Ve=[];for(const Z of this._feature.geometry){const K=[];for(const ce of Z)K.push(new s.P(ce[0],ce[1]));Ve.push(K)}return Ve}}toGeoJSON(Ve,Z,K){return Vt.call(this,Ve,Z,K)}},Fr=class{constructor(Ve){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=s.Y,this.length=Ve.length,this._features=Ve}feature(Ve){return new Ut(this._features[Ve])}};var ti={exports:{}},ai=s.dV,Oi=s.dU.VectorTileFeature,sr=vo;function vo(Ve,Z){this.options=Z||{},this.features=Ve,this.length=Ve.length}function Mi(Ve,Z){this.id=typeof Ve.id=="number"?Ve.id:void 0,this.type=Ve.type,this.rawGeometry=Ve.type===1?[Ve.geometry]:Ve.geometry,this.properties=Ve.tags,this.extent=Z||4096}vo.prototype.feature=function(Ve){return new Mi(this.features[Ve],this.options.extent)},Mi.prototype.loadGeometry=function(){var Ve=this.rawGeometry;this.geometry=[];for(var Z=0;Z<Ve.length;Z++){for(var K=Ve[Z],ce=[],De=0;De<K.length;De++)ce.push(new ai(K[De][0],K[De][1]));this.geometry.push(ce)}return this.geometry},Mi.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Ve=this.geometry,Z=1/0,K=-1/0,ce=1/0,De=-1/0,Oe=0;Oe<Ve.length;Oe++)for(var Ue=Ve[Oe],dt=0;dt<Ue.length;dt++){var Pe=Ue[dt];Z=Math.min(Z,Pe.x),K=Math.max(K,Pe.x),ce=Math.min(ce,Pe.y),De=Math.max(De,Pe.y)}return[Z,ce,K,De]},Mi.prototype.toGeoJSON=Oi.prototype.toGeoJSON;var Sn=s.dW,Vn=sr;function yi(Ve){var Z=new Sn;return function(K,ce){for(var De in K.layers)ce.writeMessage(3,Tr,K.layers[De])}(Ve,Z),Z.finish()}function Tr(Ve,Z){var K;Z.writeVarintField(15,Ve.version||1),Z.writeStringField(1,Ve.name||""),Z.writeVarintField(5,Ve.extent||4096);var ce={keys:[],values:[],keycache:{},valuecache:{}};for(K=0;K<Ve.length;K++)ce.feature=Ve.feature(K),Z.writeMessage(2,ys,ce);var De=ce.keys;for(K=0;K<De.length;K++)Z.writeStringField(3,De[K]);var Oe=ce.values;for(K=0;K<Oe.length;K++)Z.writeMessage(4,hr,Oe[K])}function ys(Ve,Z){var K=Ve.feature;K.id!==void 0&&Z.writeVarintField(1,K.id),Z.writeMessage(2,an,Ve),Z.writeVarintField(3,K.type),Z.writeMessage(4,Uo,K)}function an(Ve,Z){var K=Ve.feature,ce=Ve.keys,De=Ve.values,Oe=Ve.keycache,Ue=Ve.valuecache;for(var dt in K.properties){var Pe=K.properties[dt],ot=Oe[dt];if(Pe!==null){ot===void 0&&(ce.push(dt),Oe[dt]=ot=ce.length-1),Z.writeVarint(ot);var ut=typeof Pe;ut!=="string"&&ut!=="boolean"&&ut!=="number"&&(Pe=JSON.stringify(Pe));var gt=ut+":"+Pe,Ke=Ue[gt];Ke===void 0&&(De.push(Pe),Ue[gt]=Ke=De.length-1),Z.writeVarint(Ke)}}}function pn(Ve,Z){return(Z<<3)+(7&Ve)}function xs(Ve){return Ve<<1^Ve>>31}function Uo(Ve,Z){for(var K=Ve.loadGeometry(),ce=Ve.type,De=0,Oe=0,Ue=K.length,dt=0;dt<Ue;dt++){var Pe=K[dt],ot=1;ce===1&&(ot=Pe.length),Z.writeVarint(pn(1,ot));for(var ut=ce===3?Pe.length-1:Pe.length,gt=0;gt<ut;gt++){gt===1&&ce!==1&&Z.writeVarint(pn(2,ut-1));var Ke=Pe[gt].x-De,Sr=Pe[gt].y-Oe;Z.writeVarint(xs(Ke)),Z.writeVarint(xs(Sr)),De+=Ke,Oe+=Sr}ce===3&&Z.writeVarint(pn(7,1))}}function hr(Ve,Z){var K=typeof Ve;K==="string"?Z.writeStringField(1,Ve):K==="boolean"?Z.writeBooleanField(7,Ve):K==="number"&&(Ve%1!=0?Z.writeDoubleField(3,Ve):Ve<0?Z.writeSVarintField(6,Ve):Z.writeVarintField(5,Ve))}ti.exports=yi,ti.exports.fromVectorTileJs=yi,ti.exports.fromGeojsonVt=function(Ve,Z){Z=Z||{};var K={};for(var ce in Ve)K[ce]=new Vn(Ve[ce].features,Z),K[ce].name=ce,K[ce].version=Z.version,K[ce].extent=Z.extent;return yi({layers:K})},ti.exports.GeoJSONWrapper=Vn;var vs=s.dX(ti.exports);const ki={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ve=>Ve},bs=Math.fround||(jo=new Float32Array(1),Ve=>(jo[0]=+Ve,jo[0]));var jo;const mn=3,wt=5,Go=6;class Vr{constructor(Z){this.options=Object.assign(Object.create(ki),Z),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Z){const{log:K,minZoom:ce,maxZoom:De}=this.options;K&&console.time("total time");const Oe=`prepare ${Z.length} points`;K&&console.time(Oe),this.points=Z;const Ue=[];for(let Pe=0;Pe<Z.length;Pe++){const ot=Z[Pe];if(!ot.geometry)continue;const[ut,gt]=ot.geometry.coordinates,Ke=bs(bo(ut)),Sr=bs(wo(gt));Ue.push(Ke,Sr,1/0,Pe,-1,1),this.options.reduce&&Ue.push(0)}let dt=this.trees[De+1]=this._createTree(Ue);K&&console.timeEnd(Oe);for(let Pe=De;Pe>=ce;Pe--){const ot=+Date.now();dt=this.trees[Pe]=this._createTree(this._cluster(dt,Pe)),K&&console.log("z%d: %d clusters in %dms",Pe,dt.numItems,+Date.now()-ot)}return K&&console.timeEnd("total time"),this}getClusters(Z,K){let ce=((Z[0]+180)%360+360)%360-180;const De=Math.max(-90,Math.min(90,Z[1]));let Oe=Z[2]===180?180:((Z[2]+180)%360+360)%360-180;const Ue=Math.max(-90,Math.min(90,Z[3]));if(Z[2]-Z[0]>=360)ce=-180,Oe=180;else if(ce>Oe){const gt=this.getClusters([ce,De,180,Ue],K),Ke=this.getClusters([-180,De,Oe,Ue],K);return gt.concat(Ke)}const dt=this.trees[this._limitZoom(K)],Pe=dt.range(bo(ce),wo(Ue),bo(Oe),wo(De)),ot=dt.data,ut=[];for(const gt of Pe){const Ke=this.stride*gt;ut.push(ot[Ke+wt]>1?ba(ot,Ke,this.clusterProps):this.points[ot[Ke+mn]])}return ut}getChildren(Z){const K=this._getOriginId(Z),ce=this._getOriginZoom(Z),De="No cluster with the specified id.",Oe=this.trees[ce];if(!Oe)throw new Error(De);const Ue=Oe.data;if(K*this.stride>=Ue.length)throw new Error(De);const dt=this.options.radius/(this.options.extent*Math.pow(2,ce-1)),Pe=Oe.within(Ue[K*this.stride],Ue[K*this.stride+1],dt),ot=[];for(const ut of Pe){const gt=ut*this.stride;Ue[gt+4]===Z&&ot.push(Ue[gt+wt]>1?ba(Ue,gt,this.clusterProps):this.points[Ue[gt+mn]])}if(ot.length===0)throw new Error(De);return ot}getLeaves(Z,K,ce){const De=[];return this._appendLeaves(De,Z,K=K||10,ce=ce||0,0),De}getTile(Z,K,ce){const De=this.trees[this._limitZoom(Z)],Oe=Math.pow(2,Z),{extent:Ue,radius:dt}=this.options,Pe=dt/Ue,ot=(ce-Pe)/Oe,ut=(ce+1+Pe)/Oe,gt={features:[]};return this._addTileFeatures(De.range((K-Pe)/Oe,ot,(K+1+Pe)/Oe,ut),De.data,K,ce,Oe,gt),K===0&&this._addTileFeatures(De.range(1-Pe/Oe,ot,1,ut),De.data,Oe,ce,Oe,gt),K===Oe-1&&this._addTileFeatures(De.range(0,ot,Pe/Oe,ut),De.data,-1,ce,Oe,gt),gt.features.length?gt:null}getClusterExpansionZoom(Z){let K=this._getOriginZoom(Z)-1;for(;K<=this.options.maxZoom;){const ce=this.getChildren(Z);if(K++,ce.length!==1)break;Z=ce[0].properties.cluster_id}return K}_appendLeaves(Z,K,ce,De,Oe){const Ue=this.getChildren(K);for(const dt of Ue){const Pe=dt.properties;if(Pe&&Pe.cluster?Oe+Pe.point_count<=De?Oe+=Pe.point_count:Oe=this._appendLeaves(Z,Pe.cluster_id,ce,De,Oe):Oe<De?Oe++:Z.push(dt),Z.length===ce)break}return Oe}_createTree(Z){const K=new s.bj(Z.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ce=0;ce<Z.length;ce+=this.stride)K.add(Z[ce],Z[ce+1]);return K.finish(),K.data=Z,K}_addTileFeatures(Z,K,ce,De,Oe,Ue){for(const dt of Z){const Pe=dt*this.stride,ot=K[Pe+wt]>1;let ut,gt,Ke;if(ot)ut=ws(K,Pe,this.clusterProps),gt=K[Pe],Ke=K[Pe+1];else{const br=this.points[K[Pe+mn]];ut=br.properties;const[pr,mr]=br.geometry.coordinates;gt=bo(pr),Ke=wo(mr)}const Sr={type:1,geometry:[[Math.round(this.options.extent*(gt*Oe-ce)),Math.round(this.options.extent*(Ke*Oe-De))]],tags:ut};let fr;fr=ot||this.options.generateId?K[Pe+mn]:this.points[K[Pe+mn]].id,fr!==void 0&&(Sr.id=fr),Ue.features.push(Sr)}}_limitZoom(Z){return Math.max(this.options.minZoom,Math.min(Math.floor(+Z),this.options.maxZoom+1))}_cluster(Z,K){const{radius:ce,extent:De,reduce:Oe,minPoints:Ue}=this.options,dt=ce/(De*Math.pow(2,K)),Pe=Z.data,ot=[],ut=this.stride;for(let gt=0;gt<Pe.length;gt+=ut){if(Pe[gt+2]<=K)continue;Pe[gt+2]=K;const Ke=Pe[gt],Sr=Pe[gt+1],fr=Z.within(Pe[gt],Pe[gt+1],dt),br=Pe[gt+wt];let pr=br;for(const mr of fr){const Er=mr*ut;Pe[Er+2]>K&&(pr+=Pe[Er+wt])}if(pr>br&&pr>=Ue){let mr,Er=Ke*br,qr=Sr*br,xi=-1;const Nr=(gt/ut<<5)+(K+1)+this.points.length;for(const Gi of fr){const Bi=Gi*ut;if(Pe[Bi+2]<=K)continue;Pe[Bi+2]=K;const En=Pe[Bi+wt];Er+=Pe[Bi]*En,qr+=Pe[Bi+1]*En,Pe[Bi+4]=Nr,Oe&&(mr||(mr=this._map(Pe,gt,!0),xi=this.clusterProps.length,this.clusterProps.push(mr)),Oe(mr,this._map(Pe,Bi)))}Pe[gt+4]=Nr,ot.push(Er/pr,qr/pr,1/0,Nr,-1,pr),Oe&&ot.push(xi)}else{for(let mr=0;mr<ut;mr++)ot.push(Pe[gt+mr]);if(pr>1)for(const mr of fr){const Er=mr*ut;if(!(Pe[Er+2]<=K)){Pe[Er+2]=K;for(let qr=0;qr<ut;qr++)ot.push(Pe[Er+qr])}}}}return ot}_getOriginId(Z){return Z-this.points.length>>5}_getOriginZoom(Z){return(Z-this.points.length)%32}_map(Z,K,ce){if(Z[K+wt]>1){const Ue=this.clusterProps[Z[K+Go]];return ce?Object.assign({},Ue):Ue}const De=this.points[Z[K+mn]].properties,Oe=this.options.map(De);return ce&&Oe===De?Object.assign({},Oe):Oe}}function ba(Ve,Z,K){return{type:"Feature",id:Ve[Z+mn],properties:ws(Ve,Z,K),geometry:{type:"Point",coordinates:[(ce=Ve[Z],360*(ce-.5)),wa(Ve[Z+1])]}};var ce}function ws(Ve,Z,K){const ce=Ve[Z+wt],De=ce>=1e4?`${Math.round(ce/1e3)}k`:ce>=1e3?Math.round(ce/100)/10+"k":ce,Oe=Ve[Z+Go],Ue=Oe===-1?{}:Object.assign({},K[Oe]);return Object.assign(Ue,{cluster:!0,cluster_id:Ve[Z+mn],point_count:ce,point_count_abbreviated:De})}function bo(Ve){return Ve/360+.5}function wo(Ve){const Z=Math.sin(Ve*Math.PI/180),K=.5-.25*Math.log((1+Z)/(1-Z))/Math.PI;return K<0?0:K>1?1:K}function wa(Ve){const Z=(180-360*Ve)*Math.PI/180;return 360*Math.atan(Math.exp(Z))/Math.PI-90}var Ts={exports:{}};Ts.exports=function(){function Ve(Ae,Me,Be,Ge){for(var je,Xe=Ge,Ye=Be-Me>>1,$e=Be-Me,tt=Ae[Me],We=Ae[Me+1],Pt=Ae[Be],Yt=Ae[Be+1],mt=Me+3;mt<Be;mt+=3){var Ar=Z(Ae[mt],Ae[mt+1],tt,We,Pt,Yt);if(Ar>Xe)je=mt,Xe=Ar;else if(Ar===Xe){var Hr=Math.abs(mt-Ye);Hr<$e&&(je=mt,$e=Hr)}}Xe>Ge&&(je-Me>3&&Ve(Ae,Me,je,Ge),Ae[je+2]=Xe,Be-je>3&&Ve(Ae,je,Be,Ge))}function Z(Ae,Me,Be,Ge,je,Xe){var Ye=je-Be,$e=Xe-Ge;if(Ye!==0||$e!==0){var tt=((Ae-Be)*Ye+(Me-Ge)*$e)/(Ye*Ye+$e*$e);tt>1?(Be=je,Ge=Xe):tt>0&&(Be+=Ye*tt,Ge+=$e*tt)}return(Ye=Ae-Be)*Ye+($e=Me-Ge)*$e}function K(Ae,Me,Be,Ge){var je={id:Ae===void 0?null:Ae,type:Me,geometry:Be,tags:Ge,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Xe){var Ye=Xe.geometry,$e=Xe.type;if($e==="Point"||$e==="MultiPoint"||$e==="LineString")ce(Xe,Ye);else if($e==="Polygon"||$e==="MultiLineString")for(var tt=0;tt<Ye.length;tt++)ce(Xe,Ye[tt]);else if($e==="MultiPolygon")for(tt=0;tt<Ye.length;tt++)for(var We=0;We<Ye[tt].length;We++)ce(Xe,Ye[tt][We])}(je),je}function ce(Ae,Me){for(var Be=0;Be<Me.length;Be+=3)Ae.minX=Math.min(Ae.minX,Me[Be]),Ae.minY=Math.min(Ae.minY,Me[Be+1]),Ae.maxX=Math.max(Ae.maxX,Me[Be]),Ae.maxY=Math.max(Ae.maxY,Me[Be+1])}function De(Ae,Me,Be,Ge){if(Me.geometry){var je=Me.geometry.coordinates,Xe=Me.geometry.type,Ye=Math.pow(Be.tolerance/((1<<Be.maxZoom)*Be.extent),2),$e=[],tt=Me.id;if(Be.promoteId?tt=Me.properties[Be.promoteId]:Be.generateId&&(tt=Ge||0),Xe==="Point")Oe(je,$e);else if(Xe==="MultiPoint")for(var We=0;We<je.length;We++)Oe(je[We],$e);else if(Xe==="LineString")Ue(je,$e,Ye,!1);else if(Xe==="MultiLineString"){if(Be.lineMetrics){for(We=0;We<je.length;We++)Ue(je[We],$e=[],Ye,!1),Ae.push(K(tt,"LineString",$e,Me.properties));return}dt(je,$e,Ye,!1)}else if(Xe==="Polygon")dt(je,$e,Ye,!0);else{if(Xe!=="MultiPolygon"){if(Xe==="GeometryCollection"){for(We=0;We<Me.geometry.geometries.length;We++)De(Ae,{id:tt,geometry:Me.geometry.geometries[We],properties:Me.properties},Be,Ge);return}throw new Error("Input data is not a valid GeoJSON object.")}for(We=0;We<je.length;We++){var Pt=[];dt(je[We],Pt,Ye,!0),$e.push(Pt)}}Ae.push(K(tt,Xe,$e,Me.properties))}}function Oe(Ae,Me){Me.push(Pe(Ae[0])),Me.push(ot(Ae[1])),Me.push(0)}function Ue(Ae,Me,Be,Ge){for(var je,Xe,Ye=0,$e=0;$e<Ae.length;$e++){var tt=Pe(Ae[$e][0]),We=ot(Ae[$e][1]);Me.push(tt),Me.push(We),Me.push(0),$e>0&&(Ye+=Ge?(je*We-tt*Xe)/2:Math.sqrt(Math.pow(tt-je,2)+Math.pow(We-Xe,2))),je=tt,Xe=We}var Pt=Me.length-3;Me[2]=1,Ve(Me,0,Pt,Be),Me[Pt+2]=1,Me.size=Math.abs(Ye),Me.start=0,Me.end=Me.size}function dt(Ae,Me,Be,Ge){for(var je=0;je<Ae.length;je++){var Xe=[];Ue(Ae[je],Xe,Be,Ge),Me.push(Xe)}}function Pe(Ae){return Ae/360+.5}function ot(Ae){var Me=Math.sin(Ae*Math.PI/180),Be=.5-.25*Math.log((1+Me)/(1-Me))/Math.PI;return Be<0?0:Be>1?1:Be}function ut(Ae,Me,Be,Ge,je,Xe,Ye,$e){if(Ge/=Me,Xe>=(Be/=Me)&&Ye<Ge)return Ae;if(Ye<Be||Xe>=Ge)return null;for(var tt=[],We=0;We<Ae.length;We++){var Pt=Ae[We],Yt=Pt.geometry,mt=Pt.type,Ar=je===0?Pt.minX:Pt.minY,Hr=je===0?Pt.maxX:Pt.maxY;if(Ar>=Be&&Hr<Ge)tt.push(Pt);else if(!(Hr<Be||Ar>=Ge)){var zr=[];if(mt==="Point"||mt==="MultiPoint")gt(Yt,zr,Be,Ge,je);else if(mt==="LineString")Ke(Yt,zr,Be,Ge,je,!1,$e.lineMetrics);else if(mt==="MultiLineString")fr(Yt,zr,Be,Ge,je,!1);else if(mt==="Polygon")fr(Yt,zr,Be,Ge,je,!0);else if(mt==="MultiPolygon")for(var ri=0;ri<Yt.length;ri++){var Jr=[];fr(Yt[ri],Jr,Be,Ge,je,!0),Jr.length&&zr.push(Jr)}if(zr.length){if($e.lineMetrics&&mt==="LineString"){for(ri=0;ri<zr.length;ri++)tt.push(K(Pt.id,mt,zr[ri],Pt.tags));continue}mt!=="LineString"&&mt!=="MultiLineString"||(zr.length===1?(mt="LineString",zr=zr[0]):mt="MultiLineString"),mt!=="Point"&&mt!=="MultiPoint"||(mt=zr.length===3?"Point":"MultiPoint"),tt.push(K(Pt.id,mt,zr,Pt.tags))}}}return tt.length?tt:null}function gt(Ae,Me,Be,Ge,je){for(var Xe=0;Xe<Ae.length;Xe+=3){var Ye=Ae[Xe+je];Ye>=Be&&Ye<=Ge&&(Me.push(Ae[Xe]),Me.push(Ae[Xe+1]),Me.push(Ae[Xe+2]))}}function Ke(Ae,Me,Be,Ge,je,Xe,Ye){for(var $e,tt,We=Sr(Ae),Pt=je===0?pr:mr,Yt=Ae.start,mt=0;mt<Ae.length-3;mt+=3){var Ar=Ae[mt],Hr=Ae[mt+1],zr=Ae[mt+2],ri=Ae[mt+3],Jr=Ae[mt+4],rr=je===0?Ar:Hr,ln=je===0?ri:Jr,An=!1;Ye&&($e=Math.sqrt(Math.pow(Ar-ri,2)+Math.pow(Hr-Jr,2))),rr<Be?ln>Be&&(tt=Pt(We,Ar,Hr,ri,Jr,Be),Ye&&(We.start=Yt+$e*tt)):rr>Ge?ln<Ge&&(tt=Pt(We,Ar,Hr,ri,Jr,Ge),Ye&&(We.start=Yt+$e*tt)):br(We,Ar,Hr,zr),ln<Be&&rr>=Be&&(tt=Pt(We,Ar,Hr,ri,Jr,Be),An=!0),ln>Ge&&rr<=Ge&&(tt=Pt(We,Ar,Hr,ri,Jr,Ge),An=!0),!Xe&&An&&(Ye&&(We.end=Yt+$e*tt),Me.push(We),We=Sr(Ae)),Ye&&(Yt+=$e)}var wi=Ae.length-3;Ar=Ae[wi],Hr=Ae[wi+1],zr=Ae[wi+2],(rr=je===0?Ar:Hr)>=Be&&rr<=Ge&&br(We,Ar,Hr,zr),wi=We.length-3,Xe&&wi>=3&&(We[wi]!==We[0]||We[wi+1]!==We[1])&&br(We,We[0],We[1],We[2]),We.length&&Me.push(We)}function Sr(Ae){var Me=[];return Me.size=Ae.size,Me.start=Ae.start,Me.end=Ae.end,Me}function fr(Ae,Me,Be,Ge,je,Xe){for(var Ye=0;Ye<Ae.length;Ye++)Ke(Ae[Ye],Me,Be,Ge,je,Xe,!1)}function br(Ae,Me,Be,Ge){Ae.push(Me),Ae.push(Be),Ae.push(Ge)}function pr(Ae,Me,Be,Ge,je,Xe){var Ye=(Xe-Me)/(Ge-Me);return Ae.push(Xe),Ae.push(Be+(je-Be)*Ye),Ae.push(1),Ye}function mr(Ae,Me,Be,Ge,je,Xe){var Ye=(Xe-Be)/(je-Be);return Ae.push(Me+(Ge-Me)*Ye),Ae.push(Xe),Ae.push(1),Ye}function Er(Ae,Me){for(var Be=[],Ge=0;Ge<Ae.length;Ge++){var je,Xe=Ae[Ge],Ye=Xe.type;if(Ye==="Point"||Ye==="MultiPoint"||Ye==="LineString")je=qr(Xe.geometry,Me);else if(Ye==="MultiLineString"||Ye==="Polygon"){je=[];for(var $e=0;$e<Xe.geometry.length;$e++)je.push(qr(Xe.geometry[$e],Me))}else if(Ye==="MultiPolygon")for(je=[],$e=0;$e<Xe.geometry.length;$e++){for(var tt=[],We=0;We<Xe.geometry[$e].length;We++)tt.push(qr(Xe.geometry[$e][We],Me));je.push(tt)}Be.push(K(Xe.id,Ye,je,Xe.tags))}return Be}function qr(Ae,Me){var Be=[];Be.size=Ae.size,Ae.start!==void 0&&(Be.start=Ae.start,Be.end=Ae.end);for(var Ge=0;Ge<Ae.length;Ge+=3)Be.push(Ae[Ge]+Me,Ae[Ge+1],Ae[Ge+2]);return Be}function xi(Ae,Me){if(Ae.transformed)return Ae;var Be,Ge,je,Xe=1<<Ae.z,Ye=Ae.x,$e=Ae.y;for(Be=0;Be<Ae.features.length;Be++){var tt=Ae.features[Be],We=tt.geometry,Pt=tt.type;if(tt.geometry=[],Pt===1)for(Ge=0;Ge<We.length;Ge+=2)tt.geometry.push(Nr(We[Ge],We[Ge+1],Me,Xe,Ye,$e));else for(Ge=0;Ge<We.length;Ge++){var Yt=[];for(je=0;je<We[Ge].length;je+=2)Yt.push(Nr(We[Ge][je],We[Ge][je+1],Me,Xe,Ye,$e));tt.geometry.push(Yt)}}return Ae.transformed=!0,Ae}function Nr(Ae,Me,Be,Ge,je,Xe){return[Math.round(Be*(Ae*Ge-je)),Math.round(Be*(Me*Ge-Xe))]}function Gi(Ae,Me,Be,Ge,je){for(var Xe=Me===je.maxZoom?0:je.tolerance/((1<<Me)*je.extent),Ye={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:Be,y:Ge,z:Me,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},$e=0;$e<Ae.length;$e++){Ye.numFeatures++,Bi(Ye,Ae[$e],Xe,je);var tt=Ae[$e].minX,We=Ae[$e].minY,Pt=Ae[$e].maxX,Yt=Ae[$e].maxY;tt<Ye.minX&&(Ye.minX=tt),We<Ye.minY&&(Ye.minY=We),Pt>Ye.maxX&&(Ye.maxX=Pt),Yt>Ye.maxY&&(Ye.maxY=Yt)}return Ye}function Bi(Ae,Me,Be,Ge){var je=Me.geometry,Xe=Me.type,Ye=[];if(Xe==="Point"||Xe==="MultiPoint")for(var $e=0;$e<je.length;$e+=3)Ye.push(je[$e]),Ye.push(je[$e+1]),Ae.numPoints++,Ae.numSimplified++;else if(Xe==="LineString")En(Ye,je,Ae,Be,!1,!1);else if(Xe==="MultiLineString"||Xe==="Polygon")for($e=0;$e<je.length;$e++)En(Ye,je[$e],Ae,Be,Xe==="Polygon",$e===0);else if(Xe==="MultiPolygon")for(var tt=0;tt<je.length;tt++){var We=je[tt];for($e=0;$e<We.length;$e++)En(Ye,We[$e],Ae,Be,!0,$e===0)}if(Ye.length){var Pt=Me.tags||null;if(Xe==="LineString"&&Ge.lineMetrics){for(var Yt in Pt={},Me.tags)Pt[Yt]=Me.tags[Yt];Pt.mapbox_clip_start=je.start/je.size,Pt.mapbox_clip_end=je.end/je.size}var mt={geometry:Ye,type:Xe==="Polygon"||Xe==="MultiPolygon"?3:Xe==="LineString"||Xe==="MultiLineString"?2:1,tags:Pt};Me.id!==null&&(mt.id=Me.id),Ae.features.push(mt)}}function En(Ae,Me,Be,Ge,je,Xe){var Ye=Ge*Ge;if(Ge>0&&Me.size<(je?Ye:Ge))Be.numPoints+=Me.length/3;else{for(var $e=[],tt=0;tt<Me.length;tt+=3)(Ge===0||Me[tt+2]>Ye)&&(Be.numSimplified++,$e.push(Me[tt]),$e.push(Me[tt+1])),Be.numPoints++;je&&function(We,Pt){for(var Yt=0,mt=0,Ar=We.length,Hr=Ar-2;mt<Ar;Hr=mt,mt+=2)Yt+=(We[mt]-We[Hr])*(We[mt+1]+We[Hr+1]);if(Yt>0===Pt)for(mt=0,Ar=We.length;mt<Ar/2;mt+=2){var zr=We[mt],ri=We[mt+1];We[mt]=We[Ar-2-mt],We[mt+1]=We[Ar-1-mt],We[Ar-2-mt]=zr,We[Ar-1-mt]=ri}}($e,Xe),Ae.push($e)}}function ci(Ae,Me){var Be=(Me=this.options=function(je,Xe){for(var Ye in Xe)je[Ye]=Xe[Ye];return je}(Object.create(this.options),Me)).debug;if(Be&&console.time("preprocess data"),Me.maxZoom<0||Me.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Me.promoteId&&Me.generateId)throw new Error("promoteId and generateId cannot be used together.");var Ge=function(je,Xe){var Ye=[];if(je.type==="FeatureCollection")for(var $e=0;$e<je.features.length;$e++)De(Ye,je.features[$e],Xe,$e);else De(Ye,je.type==="Feature"?je:{geometry:je},Xe);return Ye}(Ae,Me);this.tiles={},this.tileCoords=[],Be&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Me.indexMaxZoom,Me.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(Ge=function(je,Xe){var Ye=Xe.buffer/Xe.extent,$e=je,tt=ut(je,1,-1-Ye,Ye,0,-1,2,Xe),We=ut(je,1,1-Ye,2+Ye,0,-1,2,Xe);return(tt||We)&&($e=ut(je,1,-Ye,1+Ye,0,-1,2,Xe)||[],tt&&($e=Er(tt,1).concat($e)),We&&($e=$e.concat(Er(We,-1)))),$e}(Ge,Me)).length&&this.splitTile(Ge,0,0,0),Be&&(Ge.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Wr(Ae,Me,Be){return 32*((1<<Ae)*Be+Me)+Ae}return ci.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},ci.prototype.splitTile=function(Ae,Me,Be,Ge,je,Xe,Ye){for(var $e=[Ae,Me,Be,Ge],tt=this.options,We=tt.debug;$e.length;){Ge=$e.pop(),Be=$e.pop(),Me=$e.pop(),Ae=$e.pop();var Pt=1<<Me,Yt=Wr(Me,Be,Ge),mt=this.tiles[Yt];if(!mt&&(We>1&&console.time("creation"),mt=this.tiles[Yt]=Gi(Ae,Me,Be,Ge,tt),this.tileCoords.push({z:Me,x:Be,y:Ge}),We)){We>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Me,Be,Ge,mt.numFeatures,mt.numPoints,mt.numSimplified),console.timeEnd("creation"));var Ar="z"+Me;this.stats[Ar]=(this.stats[Ar]||0)+1,this.total++}if(mt.source=Ae,je){if(Me===tt.maxZoom||Me===je)continue;var Hr=1<<je-Me;if(Be!==Math.floor(Xe/Hr)||Ge!==Math.floor(Ye/Hr))continue}else if(Me===tt.indexMaxZoom||mt.numPoints<=tt.indexMaxPoints)continue;if(mt.source=null,Ae.length!==0){We>1&&console.time("clipping");var zr,ri,Jr,rr,ln,An,wi=.5*tt.buffer/tt.extent,$o=.5-wi,Sa=.5+wi,$i=1+wi;zr=ri=Jr=rr=null,ln=ut(Ae,Pt,Be-wi,Be+Sa,0,mt.minX,mt.maxX,tt),An=ut(Ae,Pt,Be+$o,Be+$i,0,mt.minX,mt.maxX,tt),Ae=null,ln&&(zr=ut(ln,Pt,Ge-wi,Ge+Sa,1,mt.minY,mt.maxY,tt),ri=ut(ln,Pt,Ge+$o,Ge+$i,1,mt.minY,mt.maxY,tt),ln=null),An&&(Jr=ut(An,Pt,Ge-wi,Ge+Sa,1,mt.minY,mt.maxY,tt),rr=ut(An,Pt,Ge+$o,Ge+$i,1,mt.minY,mt.maxY,tt),An=null),We>1&&console.timeEnd("clipping"),$e.push(zr||[],Me+1,2*Be,2*Ge),$e.push(ri||[],Me+1,2*Be,2*Ge+1),$e.push(Jr||[],Me+1,2*Be+1,2*Ge),$e.push(rr||[],Me+1,2*Be+1,2*Ge+1)}}},ci.prototype.getTile=function(Ae,Me,Be){var Ge=this.options,je=Ge.extent,Xe=Ge.debug;if(Ae<0||Ae>24)return null;var Ye=1<<Ae,$e=Wr(Ae,Me=(Me%Ye+Ye)%Ye,Be);if(this.tiles[$e])return xi(this.tiles[$e],je);Xe>1&&console.log("drilling down to z%d-%d-%d",Ae,Me,Be);for(var tt,We=Ae,Pt=Me,Yt=Be;!tt&&We>0;)We--,Pt=Math.floor(Pt/2),Yt=Math.floor(Yt/2),tt=this.tiles[Wr(We,Pt,Yt)];return tt&&tt.source?(Xe>1&&console.log("found parent tile z%d-%d-%d",We,Pt,Yt),Xe>1&&console.time("drilling down"),this.splitTile(tt.source,We,Pt,Yt,Ae,Me,Be),Xe>1&&console.timeEnd("drilling down"),this.tiles[$e]?xi(this.tiles[$e],je):null):null},function(Ae,Me){return new ci(Ae,Me)}}();var li=s.dX(Ts.exports);function Dl(Ve,Z){const K=Ve.tileID.canonical;if(!this._geoJSONIndex)return Z(null,null);const ce=this._geoJSONIndex.getTile(K.z,K.x,K.y);if(!ce)return Z(null,null);const De=new Fr(ce.features);let Oe=vs(De);Oe.byteOffset===0&&Oe.byteLength===Oe.buffer.byteLength||(Oe=new Uint8Array(Oe)),Z(null,{vectorTile:De,rawData:Oe.buffer})}class It extends Lr{constructor(Z,K,ce,De,Oe,Ue){super(Z,K,ce,De,Dl,Ue),Oe&&(this.loadGeoJSON=Oe),this._featureMap=new Map}loadData(Z,K){const ce=Z&&Z.request,De=ce&&ce.collectResourceTiming;this.loadGeoJSON(Z,(Oe,Ue)=>{if(Oe||!Ue)return K(Oe);if(typeof Ue!="object")return K(new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`));{try{if(Z.filter){const Pe=s.t(Z.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Pe.result==="error")throw new Error(Pe.value.map(ot=>`${ot.key}: ${ot.message}`).join(", "));Ue.features=Ue.features.filter(ot=>Pe.value.evaluate({zoom:0},ot))}if(Z.dynamic){Ue.type==="Feature"&&(Ue={type:"FeatureCollection",features:[Ue]}),Z.append||this._featureMap.clear();for(const Pe of Ue.features||[]){const ot=Pe.id;ot!==void 0&&(Pe.geometry?this._featureMap.set(ot,Pe):this._featureMap.delete(ot))}Ue.features=[...this._featureMap.values()]}this._geoJSONIndex=Z.cluster?new Vr(function({superclusterOptions:Pe,clusterProperties:ot}){if(!ot||!Pe)return Pe;const ut={},gt={},Ke={accumulated:null,zoom:0},Sr={properties:null},fr=Object.keys(ot);for(const br of fr){const[pr,mr]=ot[br],Er=s.t(mr),qr=s.t(typeof pr=="string"?[pr,["accumulated"],["get",br]]:pr);ut[br]=Er.value,gt[br]=qr.value}return Pe.map=br=>{Sr.properties=br;const pr={};for(const mr of fr)pr[mr]=ut[mr].evaluate(Ke,Sr);return pr},Pe.reduce=(br,pr)=>{Sr.properties=pr;for(const mr of fr)Ke.accumulated=br[mr],br[mr]=gt[mr].evaluate(Ke,Sr)},Pe}(Z)).load(Ue.features):li(Ue,Z.geojsonVtOptions)}catch(Pe){return K(Pe)}this.loaded={};const dt={};if(De){const Pe=ze(ce);Pe&&(dt.resourceTiming={},dt.resourceTiming[Z.source]=JSON.parse(JSON.stringify(Pe)))}K(null,dt)}})}reloadTile(Z,K){const ce=this.loaded;return ce&&ce[Z.uid]?super.reloadTile(Z,K):this.loadTile(Z,K)}loadGeoJSON(Z,K){if(Z.request)s.g(Z.request,K);else{if(typeof Z.data!="string")return K(new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`));try{return K(null,JSON.parse(Z.data))}catch{return K(new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(Z,K){try{K(null,this._geoJSONIndex.getClusterExpansionZoom(Z.clusterId))}catch(ce){K(ce)}}getClusterChildren(Z,K){try{K(null,this._geoJSONIndex.getChildren(Z.clusterId))}catch(ce){K(ce)}}getClusterLeaves(Z,K){try{K(null,this._geoJSONIndex.getLeaves(Z.clusterId,Z.limit,Z.offset))}catch(ce){K(ce)}}}class Et{constructor(Z,K){this.tileID=new s.ap(Z.tileID.overscaledZ,Z.tileID.wrap,Z.tileID.canonical.z,Z.tileID.canonical.x,Z.tileID.canonical.y),this.tileZoom=Z.tileZoom,this.uid=Z.uid,this.zoom=Z.zoom,this.canonical=Z.tileID.canonical,this.pixelRatio=Z.pixelRatio,this.tileSize=Z.tileSize,this.source=Z.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=Z.projection,this.brightness=K}parse(Z,K,ce,De){this.status="parsing";const Oe=new s.ap(ce.tileID.overscaledZ,ce.tileID.wrap,ce.tileID.canonical.z,ce.tileID.canonical.x,ce.tileID.canonical.y),Ue={},dt=K.familiesBySource[ce.source],Pe=new s.dL(Oe,ce.promoteId);return Pe.bucketLayerIDs=[],Pe.is3DTile=!0,s.dY(Z).then(ot=>{if(!ot)return De(new Error("Could not parse tile"));const ut=s.dZ(ot,1/s.bU(ce.tileID.canonical)),gt=ot.json.extensionsUsed&&ot.json.extensionsUsed.includes("MAPBOX_mesh_features")||ot.json.asset.extras&&ot.json.asset.extras.MAPBOX_mesh_features,Ke=ot.json.extensionsUsed&&ot.json.extensionsUsed.includes("EXT_meshopt_compression"),Sr=new s.N(this.zoom,{brightness:this.brightness});for(const fr in dt)for(const br of dt[fr]){const pr=br[0];Pe.bucketLayerIDs.push(br.map(Er=>Er.id)),pr.recalculate(Sr,[]);const mr=new s.d_(ut,Oe,gt,Ke,this.brightness,Pe);gt||(mr.needsUpload=!0),Ue[pr.fqid]=mr,mr.evaluate(pr)}this.status="done",De(null,{buckets:Ue,featureIndex:Pe})}).catch(ot=>De(new Error(ot.message)))}}class Ta{constructor(Z,K,ce,De,Oe,Ue){this.actor=Z,this.layerIndex=K,this.brightness=Ue,this.loading={},this.loaded={}}loadTile(Z,K){const ce=Z.uid,De=this.loading[ce]=new Et(Z,this.brightness);s.b1(Z.request,(Oe,Ue)=>{const dt=!this.loading[ce];return delete this.loading[ce],dt||Oe?(De.status="done",dt||(this.loaded[ce]=De),K(Oe)):Ue&&Ue.byteLength!==0?void De.parse(Ue,this.layerIndex,Z,(Pe,ot)=>{De.status="done",this.loaded=this.loaded||{},this.loaded[ce]=De,Pe||!ot?K(Pe):K(null,ot)}):(De.status="done",this.loaded[ce]=De,K())})}reloadTile(Z,K){const ce=this.loaded,De=Z.uid;if(ce&&ce[De]){const Oe=ce[De];Oe.projection=Z.projection,Oe.brightness=Z.brightness;const Ue=(dt,Pe)=>{Oe.reloadCallback&&(delete Oe.reloadCallback,this.loadTile(Z,K)),K(dt,Pe)};Oe.status==="parsing"?Oe.reloadCallback=Ue:Oe.status==="done"&&this.loadTile(Z,K)}}abortTile(Z,K){const ce=Z.uid;this.loading[ce]&&delete this.loading[ce],K()}removeTile(Z,K){const ce=this.loaded,De=Z.uid;ce&&ce[De]&&delete ce[De],K()}}class _n{constructor(Z){this.self=Z,this.actor=new s.d$(Z,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=s.br({name:"mercator"}),this.workerSourceTypes={vector:Lr,geojson:It,"batched-model":Ta},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(K,ce)=>{if(this.workerSourceTypes[K])throw new Error(`Worker source with name "${K}" already registered.`);this.workerSourceTypes[K]=ce},this.self.registerRTLTextPlugin=K=>{if(s.e0.isParsed())throw new Error("RTL text plugin already registered.");s.e0.applyArabicShaping=K.applyArabicShaping,s.e0.processBidirectionalText=K.processBidirectionalText,s.e0.processStyledBidirectionalText=K.processStyledBidirectionalText}}clearCaches(Z,K,ce){delete this.layerIndexes[Z],delete this.availableImages[Z],delete this.workerSources[Z],delete this.demWorkerSources[Z],delete this.rasterArrayWorkerSource,ce()}checkIfReady(Z,K,ce){ce()}setReferrer(Z,K){this.referrer=K}spriteLoaded(Z,{scope:K,isLoaded:ce}){if(this.isSpriteLoaded[Z]||(this.isSpriteLoaded[Z]={}),this.isSpriteLoaded[Z][K]=ce,this.workerSources[Z]&&this.workerSources[Z][K])for(const De in this.workerSources[Z][K]){const Oe=this.workerSources[Z][K][De];for(const Ue in Oe)Oe[Ue]instanceof Lr&&(Oe[Ue].isSpriteLoaded=ce,Oe[Ue].fire(new s.b("isSpriteLoaded")))}}setImages(Z,{scope:K,images:ce},De){if(this.availableImages[Z]||(this.availableImages[Z]={}),this.availableImages[Z][K]=ce,this.workerSources[Z]&&this.workerSources[Z][K]){for(const Oe in this.workerSources[Z][K]){const Ue=this.workerSources[Z][K][Oe];for(const dt in Ue)Ue[dt].availableImages=ce}De()}else De()}setProjection(Z,K){this.projections[Z]=s.br(K)}setBrightness(Z,K,ce){this.brightness=K,ce()}setLayers(Z,K,ce){this.getLayerIndex(Z,K.scope).replace(K.layers,K.options),ce()}updateLayers(Z,K,ce){this.getLayerIndex(Z,K.scope).update(K.layers,K.removedIds,K.options),ce()}loadTile(Z,K,ce){K.projection=this.projections[Z]||this.defaultProjection,this.getWorkerSource(Z,K.type,K.source,K.scope).loadTile(K,ce)}loadDEMTile(Z,K,ce){this.getDEMWorkerSource(Z,K.source,K.scope).loadTile(K,ce)}decodeRasterArray(Z,K,ce){this.getRasterArrayWorkerSource().decodeRasterArray(K,ce)}reloadTile(Z,K,ce){K.projection=this.projections[Z]||this.defaultProjection,this.getWorkerSource(Z,K.type,K.source,K.scope).reloadTile(K,ce)}abortTile(Z,K,ce){this.getWorkerSource(Z,K.type,K.source,K.scope).abortTile(K,ce)}removeTile(Z,K,ce){this.getWorkerSource(Z,K.type,K.source,K.scope).removeTile(K,ce)}removeSource(Z,K,ce){if(!(this.workerSources[Z]&&this.workerSources[Z][K.scope]&&this.workerSources[Z][K.scope][K.type]&&this.workerSources[Z][K.scope][K.type][K.source]))return;const De=this.workerSources[Z][K.scope][K.type][K.source];delete this.workerSources[Z][K.scope][K.type][K.source],De.removeSource!==void 0?De.removeSource(K,ce):ce()}loadWorkerSource(Z,K,ce){try{this.self.importScripts(K.url),ce()}catch(De){ce(De.toString())}}syncRTLPluginState(Z,K,ce){try{s.e0.setState(K);const De=s.e0.getPluginURL();if(s.e0.isLoaded()&&!s.e0.isParsed()&&De!=null){this.self.importScripts(De);const Oe=s.e0.isParsed();ce(Oe?void 0:new Error(`RTL Text Plugin failed to import scripts from ${De}`),Oe)}}catch(De){ce(De.toString())}}setDracoUrl(Z,K){this.dracoUrl=K}getAvailableImages(Z,K){this.availableImages[Z]||(this.availableImages[Z]={});let ce=this.availableImages[Z][K];return ce||(ce=[]),ce}getLayerIndex(Z,K){this.layerIndexes[Z]||(this.layerIndexes[Z]={});let ce=this.layerIndexes[Z][K];return ce||(ce=this.layerIndexes[Z][K]=new St,ce.scope=K),ce}getWorkerSource(Z,K,ce,De){if(this.workerSources[Z]||(this.workerSources[Z]={}),this.workerSources[Z][De]||(this.workerSources[Z][De]={}),this.workerSources[Z][De][K]||(this.workerSources[Z][De][K]={}),this.isSpriteLoaded[Z]||(this.isSpriteLoaded[Z]={}),!this.workerSources[Z][De][K][ce]){const Oe={send:(Ue,dt,Pe,ot,ut,gt)=>{this.actor.send(Ue,dt,Pe,Z,ut,gt)},scheduler:this.actor.scheduler};this.workerSources[Z][De][K][ce]=new this.workerSourceTypes[K](Oe,this.getLayerIndex(Z,De),this.getAvailableImages(Z,De),this.isSpriteLoaded[Z][De],void 0,this.brightness)}return this.workerSources[Z][De][K][ce]}getDEMWorkerSource(Z,K,ce){return this.demWorkerSources[Z]||(this.demWorkerSources[Z]={}),this.demWorkerSources[Z][ce]||(this.demWorkerSources[Z][ce]={}),this.demWorkerSources[Z][ce][K]||(this.demWorkerSources[Z][ce][K]=new Dr),this.demWorkerSources[Z][ce][K]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new Br),this.rasterArrayWorkerSource}enforceCacheSizeLimit(Z,K){s.e1(K)}getWorkerPerformanceMetrics(Z,K,ce){ce(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new _n(self)),_n}),qe(["./shared"],function(s){function ze(c,i){if(Array.isArray(c)){if(!Array.isArray(i)||c.length!==i.length)return!1;for(let o=0;o<c.length;o++)if(!ze(c[o],i[o]))return!1;return!0}if(typeof c=="object"&&c!==null&&i!==null){if(typeof i!="object"||Object.keys(c).length!==Object.keys(i).length)return!1;for(const o in c)if(!ze(c[o],i[o]))return!1;return!0}return c===i}var pt=Ze;function Ze(c){return!function(i){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var u,d,p=new Blob([""],{type:"text/javascript"}),_=URL.createObjectURL(p);try{d=new Worker(_),u=!0}catch{u=!1}return d&&d.terminate(),URL.revokeObjectURL(_),u}()?function(){var u=document.createElement("canvas");u.width=u.height=1;var d=u.getContext("2d");if(!d)return!1;var p=d.getImageData(0,0,1,1);return p&&p.width===u.width}()?(St[o=i&&i.failIfMajorPerformanceCaveat]===void 0&&(St[o]=function(u){var d,p=function(_){var y=document.createElement("canvas"),b=Object.create(Ze.webGLContextAttributes);return b.failIfMajorPerformanceCaveat=_,y.getContext("webgl2",b)}(u);if(!p)return!1;try{d=p.createShader(p.VERTEX_SHADER)}catch{return!1}return!(!d||p.isContextLost())&&(p.shaderSource(d,"void main() {}"),p.compileShader(d),p.getShaderParameter(d,p.COMPILE_STATUS)===!0)}(o)),St[o]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var o}(c)}var St={};function ct(c,i,o){const u=document.createElement(c);return i!=null&&(u.className=i),o&&o.appendChild(u),u}function dr(c,i,o){const u=document.createElementNS("http://www.w3.org/2000/svg",c);for(const d of Object.keys(i))u.setAttributeNS(null,d,String(i[d]));return o&&o.appendChild(u),u}Ze.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const _r=typeof document<"u"?document.documentElement&&document.documentElement.style:null,ur=_r&&_r.userSelect!==void 0?"userSelect":"WebkitUserSelect";let Lr;function Dr(){_r&&ur&&(Lr=_r[ur],_r[ur]="none")}function Br(){_r&&ur&&(_r[ur]=Lr)}function Vt(c){c.preventDefault(),c.stopPropagation(),window.removeEventListener("click",Vt,!0)}function Ut(){window.addEventListener("click",Vt,!0),window.setTimeout(()=>{window.removeEventListener("click",Vt,!0)},0)}function Fr(c,i){const o=c.getBoundingClientRect();return Oi(c,o,i)}function ti(c,i){const o=c.getBoundingClientRect(),u=[];for(let d=0;d<i.length;d++)u.push(Oi(c,o,i[d]));return u}function ai(c){return window.InstallTrigger!==void 0&&c.button===2&&c.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:c.button}function Oi(c,i,o){const u=c.offsetWidth===i.width?1:c.offsetWidth/i.width;return new s.P((o.clientX-i.left)*u,(o.clientY-i.top)*u)}class sr{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(i,o){this._updatedSourceCaches[i]=o,this.setDirty()}discardSourceCacheUpdate(i){delete this._updatedSourceCaches[i]}updateLayer(i){const o=i.scope;this._updatedLayers[o]=this._updatedLayers[o]||new Set,this._updatedLayers[o].add(i.id),this.setDirty()}removeLayer(i){const o=i.scope;this._removedLayers[o]=this._removedLayers[o]||{},this._updatedLayers[o]=this._updatedLayers[o]||new Set,this._removedLayers[o][i.id]=i,this._updatedLayers[o].delete(i.id),this._updatedPaintProps.delete(i.fqid),this.setDirty()}getRemovedLayer(i){return this._removedLayers[i.scope]?this._removedLayers[i.scope][i.id]:null}discardLayerRemoval(i){this._removedLayers[i.scope]&&delete this._removedLayers[i.scope][i.id]}getLayerUpdatesByScope(){const i={};for(const o in this._updatedLayers)i[o]=i[o]||{},i[o].updatedIds=Array.from(this._updatedLayers[o].values());for(const o in this._removedLayers)i[o]=i[o]||{},i[o].removedIds=Object.keys(this._removedLayers[o]);return i}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(i){this._updatedPaintProps.add(i.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(i){this._updatedImages.add(i),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}class vo extends s.E{constructor(i){super(),this.requestManager=i,this.models={"":{}},this.numModelsLoading={}}loadModel(i,o){return s.l(this.requestManager.transformRequest(o,s.R.Model).url).then(u=>{if(!u)return;const d=s.c(u),p=new s.M(i,void 0,void 0,d);return p.computeBoundsAndApplyParent(),p}).catch(u=>{if(u&&u.status===404)return null;this.fire(new s.a(new Error(`Could not load model ${i} from ${o}: ${u.message}`)))})}load(i,o){this.models[o]||(this.models[o]={});const u=Object.keys(i);this.numModelsLoading[o]=(this.numModelsLoading[o]||0)+u.length;const d=[];for(const p of u)d.push(this.loadModel(p,i[p]));Promise.allSettled(d).then(p=>{for(let _=0;_<p.length;_++){const{status:y,value:b}=p[_];y==="fulfilled"&&b&&(this.models[o][u[_]]={model:b,numReferences:1})}this.numModelsLoading[o]-=u.length,this.fire(new s.b("data",{dataType:"style"}))}).catch(p=>{this.fire(new s.a(new Error(`Could not load models: ${p.message}`)))})}isLoaded(){for(const i in this.numModelsLoading)if(this.numModelsLoading[i]>0)return!1;return!0}hasModel(i,o){return!!this.getModel(i,o)}getModel(i,o){return this.models[o]||(this.models[o]={}),this.models[o][i]?this.models[o][i].model:void 0}addModel(i,o,u){this.models[u]||(this.models[u]={}),this.hasModel(i,u)&&this.models[u][i].numReferences++,this.load({[i]:this.requestManager.normalizeModelURL(o)},u)}addModels(i,o){this.models[o]||(this.models[o]={});const u={};for(const d in i)this.models[o][d]={},u[d]=this.requestManager.normalizeModelURL(i[d]);this.load(u,o)}addModelsFromBucket(i,o){this.models[o]||(this.models[o]={});const u={};for(const d of i)this.hasModel(d,o)?this.models[o][d].numReferences++:u[d]=this.requestManager.normalizeModelURL(d);this.load(u,o)}removeModel(i,o){if(this.models[o]&&this.models[o][i]&&(this.models[o][i].numReferences--,this.models[o][i].numReferences===0)){const u=this.models[o][i].model;delete this.models[o][i],u.destroy()}}listModels(i){return this.models[i]||(this.models[i]={}),Object.keys(this.models[i])}upload(i,o){this.models[o]||(this.models[o]={});for(const u in this.models[o])this.models[o][u].model&&this.models[o][u].model.upload(i.context)}}class Mi{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(i,o,u){const d=String(o);if(this.stateChanges[i]=this.stateChanges[i]||{},this.stateChanges[i][d]=this.stateChanges[i][d]||{},s.e(this.stateChanges[i][d],u),this.deletedStates[i]===null){this.deletedStates[i]={};for(const p in this.state[i])p!==d&&(this.deletedStates[i][p]=null)}else if(this.deletedStates[i]&&this.deletedStates[i][d]===null){this.deletedStates[i][d]={};for(const p in this.state[i][d])u[p]||(this.deletedStates[i][d][p]=null)}else for(const p in u)this.deletedStates[i]&&this.deletedStates[i][d]&&this.deletedStates[i][d][p]===null&&delete this.deletedStates[i][d][p]}removeFeatureState(i,o,u){if(this.deletedStates[i]===null)return;const d=String(o);if(this.deletedStates[i]=this.deletedStates[i]||{},u&&o!==void 0)this.deletedStates[i][d]!==null&&(this.deletedStates[i][d]=this.deletedStates[i][d]||{},this.deletedStates[i][d][u]=null);else if(o!==void 0)if(this.stateChanges[i]&&this.stateChanges[i][d])for(u in this.deletedStates[i][d]={},this.stateChanges[i][d])this.deletedStates[i][d][u]=null;else this.deletedStates[i][d]=null;else this.deletedStates[i]=null}getState(i,o){const u=String(o),d=s.e({},(this.state[i]||{})[u],(this.stateChanges[i]||{})[u]);if(this.deletedStates[i]===null)return{};if(this.deletedStates[i]){const p=this.deletedStates[i][o];if(p===null)return{};for(const _ in p)delete d[_]}return d}initializeTileState(i,o){i.setFeatureState(this.state,o)}coalesceChanges(i,o){const u={};for(const d in this.stateChanges){this.state[d]=this.state[d]||{};const p={};for(const _ in this.stateChanges[d])this.state[d][_]||(this.state[d][_]={}),s.e(this.state[d][_],this.stateChanges[d][_]),p[_]=this.state[d][_];u[d]=p}for(const d in this.deletedStates){this.state[d]=this.state[d]||{};const p={};if(this.deletedStates[d]===null)for(const _ in this.state[d])p[_]={},this.state[d][_]={};else for(const _ in this.deletedStates[d]){if(this.deletedStates[d][_]===null)this.state[d][_]={};else if(this.state[d][_])for(const y of Object.keys(this.deletedStates[d][_]))delete this.state[d][_][y];p[_]=this.state[d][_]}u[d]=u[d]||{},s.e(u[d],p)}if(this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0)for(const d in i)i[d].setFeatureState(u,o)}}function Sn(c){const{userImage:i}=c;return!!(i&&i.render&&i.render())&&(c.data.replace(new Uint8Array(i.data.buffer)),!0)}class Vn extends s.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(i){this.images[i]={},this.loaded[i]=!1,this.updatedImages[i]={},this.patterns[i]={},this.callbackDispatchedThisFrame[i]={},this.atlasImage[i]=new s.h({width:1,height:1})}isLoaded(){for(const i in this.loaded)if(!this.loaded[i])return!1;return!0}setLoaded(i,o){if(this.loaded[o]!==i&&(this.loaded[o]=i,i)){for(const{ids:u,callback:d}of this.requestors)this._notify(u,o,d);this.requestors=[]}}hasImage(i,o){return!!this.getImage(i,o)}getImage(i,o){return this.images[o][i]}addImage(i,o,u){this._validate(i,u)&&(this.images[o][i]=u)}_validate(i,o){let u=!0;return this._validateStretch(o.stretchX,o.data&&o.data.width)||(this.fire(new s.a(new Error(`Image "${i}" has invalid "stretchX" value`))),u=!1),this._validateStretch(o.stretchY,o.data&&o.data.height)||(this.fire(new s.a(new Error(`Image "${i}" has invalid "stretchY" value`))),u=!1),this._validateContent(o.content,o)||(this.fire(new s.a(new Error(`Image "${i}" has invalid "content" value`))),u=!1),u}_validateStretch(i,o){if(!i)return!0;let u=0;for(const d of i){if(d[0]<u||d[1]<d[0]||o<d[1])return!1;u=d[1]}return!0}_validateContent(i,o){return!(i&&(i.length!==4||i[0]<0||o.data.width<i[0]||i[1]<0||o.data.height<i[1]||i[2]<0||o.data.width<i[2]||i[3]<0||o.data.height<i[3]||i[2]<i[0]||i[3]<i[1]))}updateImage(i,o,u){u.version=this.images[o][i].version+1,this.images[o][i]=u,this.updatedImages[o][i]=!0}removeImage(i,o){const u=this.images[o][i];delete this.images[o][i],delete this.patterns[o][i],u.userImage&&u.userImage.onRemove&&u.userImage.onRemove()}listImages(i){return Object.keys(this.images[i])}getImages(i,o,u){let d=!0;const p=!!this.loaded[o];if(!p)for(const _ of i)this.images[o][_]||(d=!1);p||d?this._notify(i,o,u):this.requestors.push({ids:i,scope:o,callback:u})}getUpdatedImages(i){return this.updatedImages[i]}_notify(i,o,u){const d={};for(const p of i){this.images[o][p]||this.fire(new s.b("styleimagemissing",{id:p}));const _=this.images[o][p];_?d[p]={data:_.data.clone(),pixelRatio:_.pixelRatio,sdf:_.sdf,version:_.version,stretchX:_.stretchX,stretchY:_.stretchY,content:_.content,hasRenderCallback:!!(_.userImage&&_.userImage.render)}:s.w(`Image "${p}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}u(null,d)}getPixelSize(i){const{width:o,height:u}=this.atlasImage[i];return{width:o,height:u}}getPattern(i,o){const u=this.patterns[o][i],d=this.getImage(i,o);if(!d)return null;if(u&&u.position.version===d.version)return u.position;if(u)u.position.version=d.version;else{const p={w:d.data.width+2,h:d.data.height+2,x:0,y:0},_=new s.I(p,d);this.patterns[o][i]={bin:p,position:_}}return this._updatePatternAtlas(o),this.patterns[o][i].position}bind(i,o){const u=i.gl;let d=this.atlasTexture[o];d?this.dirty&&(d.update(this.atlasImage[o]),this.dirty=!1):(d=new s.T(i,this.atlasImage[o],u.RGBA),this.atlasTexture[o]=d),d.bind(u.LINEAR,u.CLAMP_TO_EDGE)}_updatePatternAtlas(i){const o=[];for(const _ in this.patterns[i])o.push(this.patterns[i][_].bin);const{w:u,h:d}=s.p(o),p=this.atlasImage[i];p.resize({width:u||1,height:d||1});for(const _ in this.patterns[i]){const{bin:y}=this.patterns[i][_],b=y.x+1,T=y.y+1,E=this.images[i][_].data,I=E.width,C=E.height;s.h.copy(E,p,{x:0,y:0},{x:b,y:T},{width:I,height:C}),s.h.copy(E,p,{x:0,y:C-1},{x:b,y:T-1},{width:I,height:1}),s.h.copy(E,p,{x:0,y:0},{x:b,y:T+C},{width:I,height:1}),s.h.copy(E,p,{x:I-1,y:0},{x:b-1,y:T},{width:1,height:C}),s.h.copy(E,p,{x:0,y:0},{x:b+I,y:T},{width:1,height:C})}this.dirty=!0}beginFrame(){for(const i in this.images)this.callbackDispatchedThisFrame[i]={}}dispatchRenderCallbacks(i,o){for(const u of i){if(this.callbackDispatchedThisFrame[o][u])continue;this.callbackDispatchedThisFrame[o][u]=!0;const d=this.images[o][u];Sn(d)&&this.updateImage(u,o,d)}}}function yi(c){const i=c.key,o=c.value,u=c.valueSpec||{},d=c.objectElementValidators||{},p=c.style,_=c.styleSpec;let y=[];const b=s.j(o);if(b!=="object")return[new s.V(i,o,`object expected, ${b} found`)];for(const T in o){const E=T.split(".")[0];let I;d[E]?I=d[E]:u[E]?I=li:d["*"]?I=d["*"]:u["*"]&&(I=li),I?y=y.concat(I({key:(i&&`${i}.`)+T,value:o[T],valueSpec:u[E]||u["*"],style:p,styleSpec:_,object:o,objectKey:T},o)):y.push(new s.i(i,o[T],`unknown property "${T}"`))}for(const T in u)d[T]||u[T].required&&u[T].default===void 0&&o[T]===void 0&&y.push(new s.V(i,o,`missing required property "${T}"`));return y}function Tr(c){const i=c.value,o=c.valueSpec,u=c.style,d=c.styleSpec,p=c.key,_=c.arrayElementValidator||li;if(s.j(i)!=="array")return[new s.V(p,i,`array expected, ${s.j(i)} found`)];if(o.length&&i.length!==o.length)return[new s.V(p,i,`array length ${o.length} expected, length ${i.length} found`)];if(o["min-length"]&&i.length<o["min-length"])return[new s.V(p,i,`array length at least ${o["min-length"]} expected, length ${i.length} found`)];let y={type:o.value,values:o.values,minimum:o.minimum,maximum:o.maximum,function:void 0};d.$version<7&&(y.function=o.function),s.j(o.value)==="object"&&(y=o.value);let b=[];for(let T=0;T<i.length;T++)b=b.concat(_({array:i,arrayIndex:T,value:i[T],valueSpec:y,style:u,styleSpec:d,key:`${p}[${T}]`},!0));return b}function ys(c){const i=c.key,o=c.value,u=c.valueSpec;let d=s.j(o);if(d==="number"&&o!=o&&(d="NaN"),d!=="number")return[new s.V(i,o,`number expected, ${d} found`)];if("minimum"in u){let p=u.minimum;if(s.j(u.minimum)==="array"&&(p=u.minimum[c.arrayIndex]),o<p)return[new s.V(i,o,`${o} is less than the minimum value ${p}`)]}if("maximum"in u){let p=u.maximum;if(s.j(u.maximum)==="array"&&(p=u.maximum[c.arrayIndex]),o>p)return[new s.V(i,o,`${o} is greater than the maximum value ${p}`)]}return[]}function an(c){const i=c.valueSpec,o=s.u(c.value.type);let u,d,p,_={};const y=o!=="categorical"&&c.value.property===void 0,b=!y,T=s.j(c.value.stops)==="array"&&s.j(c.value.stops[0])==="array"&&s.j(c.value.stops[0][0])==="object",E=yi({key:c.key,value:c.value,valueSpec:c.styleSpec.function,style:c.style,styleSpec:c.styleSpec,objectElementValidators:{stops:function(D){if(o==="identity")return[new s.V(D.key,D.value,'identity function may not have a "stops" property')];let k=[];const O=D.value;return k=k.concat(Tr({key:D.key,value:O,valueSpec:D.valueSpec,style:D.style,styleSpec:D.styleSpec,arrayElementValidator:I})),s.j(O)==="array"&&O.length===0&&k.push(new s.V(D.key,O,"array must have at least one stop")),k},default:function(D){return li({key:D.key,value:D.value,valueSpec:i,style:D.style,styleSpec:D.styleSpec})}}});return o==="identity"&&y&&E.push(new s.V(c.key,c.value,'missing required property "property"')),o==="identity"||c.value.stops||E.push(new s.V(c.key,c.value,'missing required property "stops"')),o==="exponential"&&c.valueSpec.expression&&!s.s(c.valueSpec)&&E.push(new s.V(c.key,c.value,"exponential functions not supported")),c.styleSpec.$version>=8&&(b&&!s.m(c.valueSpec)?E.push(new s.V(c.key,c.value,"property functions not supported")):y&&!s.n(c.valueSpec)&&E.push(new s.V(c.key,c.value,"zoom functions not supported"))),o!=="categorical"&&!T||c.value.property!==void 0||E.push(new s.V(c.key,c.value,'"property" property is required')),E;function I(D){let k=[];const O=D.value,B=D.key;if(s.j(O)!=="array")return[new s.V(B,O,`array expected, ${s.j(O)} found`)];if(O.length!==2)return[new s.V(B,O,`array length 2 expected, length ${O.length} found`)];if(T){if(s.j(O[0])!=="object")return[new s.V(B,O,`object expected, ${s.j(O[0])} found`)];if(O[0].zoom===void 0)return[new s.V(B,O,"object stop key must have zoom")];if(O[0].value===void 0)return[new s.V(B,O,"object stop key must have value")];const F=s.u(O[0].zoom);if(typeof F!="number")return[new s.V(B,O[0].zoom,"stop zoom values must be numbers")];if(p&&p>F)return[new s.V(B,O[0].zoom,"stop zoom values must appear in ascending order")];F!==p&&(p=F,d=void 0,_={}),k=k.concat(yi({key:`${B}[0]`,value:O[0],valueSpec:{zoom:{}},style:D.style,styleSpec:D.styleSpec,objectElementValidators:{zoom:ys,value:C}}))}else k=k.concat(C({key:`${B}[0]`,value:O[0],valueSpec:{},style:D.style,styleSpec:D.styleSpec},O));return s.o(s.q(O[1]))?k.concat([new s.V(`${B}[1]`,O[1],"expressions are not allowed in function stops.")]):k.concat(li({key:`${B}[1]`,value:O[1],valueSpec:i,style:D.style,styleSpec:D.styleSpec}))}function C(D,k){const O=s.j(D.value),B=s.u(D.value),F=D.value!==null?D.value:k;if(u){if(O!==u)return[new s.V(D.key,F,`${O} stop domain type must match previous stop domain type ${u}`)]}else u=O;if(O!=="number"&&O!=="string"&&O!=="boolean"&&typeof B!="number"&&typeof B!="string"&&typeof B!="boolean")return[new s.V(D.key,F,"stop domain value must be a number, string, or boolean")];if(O!=="number"&&o!=="categorical"){let j=`number expected, ${O} found`;return s.m(i)&&o===void 0&&(j+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new s.V(D.key,F,j)]}return o!=="categorical"||O!=="number"||typeof B=="number"&&isFinite(B)&&Math.floor(B)===B?o!=="categorical"&&O==="number"&&typeof B=="number"&&typeof d=="number"&&d!==void 0&&B<d?[new s.V(D.key,F,"stop domain values must appear in ascending order")]:(d=B,o==="categorical"&&B in _?[new s.V(D.key,F,"stop domain values must be unique")]:(_[B]=!0,[])):[new s.V(D.key,F,`integer expected, found ${String(B)}`)]}}function pn(c){const i=(c.expressionContext==="property"?s.r:s.t)(s.q(c.value),c.valueSpec);if(i.result==="error")return i.value.map(u=>new s.V(`${c.key}${u.key}`,c.value,u.message));const o=i.value.expression||i.value._styleExpression.expression;if(c.expressionContext==="property"&&c.propertyKey==="text-font"&&!o.outputDefined())return[new s.V(c.key,c.value,`Invalid data expression for "${c.propertyKey}". Output values must be contained as literals within the expression.`)];if(c.expressionContext==="property"&&c.propertyType==="layout"&&!s.v(o))return[new s.V(c.key,c.value,'"feature-state" data expressions are not supported with layout properties.')];if(c.expressionContext==="filter")return xs(o,c);if(c.expressionContext&&c.expressionContext.indexOf("cluster")===0){if(!s.x(o,["zoom","feature-state"]))return[new s.V(c.key,c.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(c.expressionContext==="cluster-initial"&&!s.y(o))return[new s.V(c.key,c.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function xs(c,i){const o=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(i.valueSpec&&i.valueSpec.expression)for(const d of i.valueSpec.expression.parameters)o.delete(d);if(o.size===0)return[];const u=[];return c instanceof s.C&&o.has(c.name)?[new s.V(i.key,i.value,`["${c.name}"] expression is not supported in a filter for a ${i.object.type} layer with id: ${i.object.id}`)]:(c.eachChild(d=>{u.push(...xs(d,i))}),u)}function Uo(c){const i=c.key,o=c.value,u=c.valueSpec,d=[];return Array.isArray(u.values)?u.values.indexOf(s.u(o))===-1&&d.push(new s.V(i,o,`expected one of [${u.values.join(", ")}], ${JSON.stringify(o)} found`)):Object.keys(u.values).indexOf(s.u(o))===-1&&d.push(new s.V(i,o,`expected one of [${Object.keys(u.values).join(", ")}], ${JSON.stringify(o)} found`)),d}function hr(c){return s.A(s.q(c.value))?pn(s.k({},c,{expressionContext:"filter",valueSpec:c.styleSpec[`filter_${c.layerType||"fill"}`]})):vs(c)}function vs(c){const i=c.value,o=c.key;if(s.j(i)!=="array")return[new s.V(o,i,`array expected, ${s.j(i)} found`)];const u=c.styleSpec;let d,p=[];if(i.length<1)return[new s.V(o,i,"filter array must have at least 1 element")];switch(p=p.concat(Uo({key:`${o}[0]`,value:i[0],valueSpec:u.filter_operator,style:c.style,styleSpec:c.styleSpec})),s.u(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&s.u(i[1])==="$type"&&p.push(new s.V(o,i,`"$type" cannot be use with operator "${i[0]}"`));case"==":case"!=":i.length!==3&&p.push(new s.V(o,i,`filter array for operator "${i[0]}" must have 3 elements`));case"in":case"!in":i.length>=2&&(d=s.j(i[1]),d!=="string"&&p.push(new s.V(`${o}[1]`,i[1],`string expected, ${d} found`)));for(let _=2;_<i.length;_++)d=s.j(i[_]),s.u(i[1])==="$type"?p=p.concat(Uo({key:`${o}[${_}]`,value:i[_],valueSpec:u.geometry_type,style:c.style,styleSpec:c.styleSpec})):d!=="string"&&d!=="number"&&d!=="boolean"&&p.push(new s.V(`${o}[${_}]`,i[_],`string, number, or boolean expected, ${d} found`));break;case"any":case"all":case"none":for(let _=1;_<i.length;_++)p=p.concat(vs({key:`${o}[${_}]`,value:i[_],style:c.style,styleSpec:c.styleSpec}));break;case"has":case"!has":d=s.j(i[1]),i.length!==2?p.push(new s.V(o,i,`filter array for "${i[0]}" operator must have 2 elements`)):d!=="string"&&p.push(new s.V(`${o}[1]`,i[1],`string expected, ${d} found`))}return p}function ki(c,i){const o=c.key,u=c.style,d=c.layer,p=c.styleSpec,_=c.value,y=c.objectKey,b=p[`${i}_${c.layerType}`];if(!b)return[];const T=y.match(/^(.*)-transition$/);if(i==="paint"&&T&&b[T[1]]&&b[T[1]].transition)return li({key:o,value:_,valueSpec:p.transition,style:u,styleSpec:p});const E=c.valueSpec||b[y];if(!E)return[new s.i(o,_,`unknown property "${y}"`)];let I;if(s.j(_)==="string"&&s.m(E)&&!E.tokens&&(I=/^{([^}]+)}$/.exec(_))){const D=`\`{ "type": "identity", "property": ${I?JSON.stringify(I[1]):'"_"'} }\``;return[new s.V(o,_,`"${y}" does not support interpolation syntax
Use an identity property function instead: ${D}.`)]}const C=[];if(c.layerType==="symbol")y!=="text-field"||!u||u.glyphs||u.imports||C.push(new s.V(o,_,'use of "text-field" requires a style "glyphs" property')),y==="text-font"&&s.B(s.q(_))&&s.u(_.type)==="identity"&&C.push(new s.V(o,_,'"text-font" does not support identity functions'));else if(c.layerType==="model"&&i==="paint"&&d&&d.layout&&d.layout.hasOwnProperty("model-id")&&s.m(E)&&(s.D(E)||s.n(E))){const D=s.r(s.q(_),E),k=D.value.expression||D.value._styleExpression.expression;k&&!s.x(k,["measure-light"])&&(y==="model-emissive-strength"&&s.y(k)&&s.v(k)||C.push(new s.V(o,_,`${y} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return C.concat(li({key:c.key,value:_,valueSpec:E,style:u,styleSpec:p,expressionContext:"property",propertyType:i,propertyKey:y}))}function bs(c){return ki(c,"paint")}function jo(c){return ki(c,"layout")}function mn(c){let i=[];const o=c.value,u=c.key,d=c.style,p=c.styleSpec;o.type||o.ref||i.push(new s.V(u,o,'either "type" or "ref" is required'));let _=s.u(o.type);const y=s.u(o.ref);if(o.id){const b=s.u(o.id);for(let T=0;T<c.arrayIndex;T++){const E=d.layers[T];s.u(E.id)===b&&i.push(new s.V(u,o.id,`duplicate layer id "${o.id}", previously used at line ${E.id.__line__}`))}}if("ref"in o){let b;["type","source","source-layer","filter","layout"].forEach(T=>{T in o&&i.push(new s.V(u,o[T],`"${T}" is prohibited for ref layers`))}),d.layers.forEach(T=>{s.u(T.id)===y&&(b=T)}),b?b.ref?i.push(new s.V(u,o.ref,"ref cannot reference another ref layer")):_=s.u(b.type):typeof y=="string"&&i.push(new s.V(u,o.ref,`ref layer "${y}" not found`))}else if(_!=="background"&&_!=="sky"&&_!=="slot")if(o.source){const b=d.sources&&d.sources[o.source],T=b&&s.u(b.type);b?T==="vector"&&_==="raster"?i.push(new s.V(u,o.source,`layer "${o.id}" requires a raster source`)):T==="raster"&&_!=="raster"?i.push(new s.V(u,o.source,`layer "${o.id}" requires a vector source`)):T!=="vector"||o["source-layer"]?T==="raster-dem"&&_!=="hillshade"?i.push(new s.V(u,o.source,"raster-dem source can only be used with layer type 'hillshade'.")):T!=="raster-array"||["raster","raster-particle"].includes(_)?_!=="line"||!o.paint||!o.paint["line-gradient"]&&!o.paint["line-trim-offset"]||T==="geojson"&&b.lineMetrics?_==="raster-particle"&&T!=="raster-array"&&i.push(new s.V(u,o.source,`layer "${o.id}" requires a 'raster-array' source.`)):i.push(new s.V(u,o,`layer "${o.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):i.push(new s.V(u,o.source,"raster-array source can only be used with layer type 'raster'.")):i.push(new s.V(u,o,`layer "${o.id}" must specify a "source-layer"`)):i.push(new s.V(u,o.source,`source "${o.source}" not found`))}else i.push(new s.V(u,o,'missing required property "source"'));return i=i.concat(yi({key:u,value:o,valueSpec:p.layer,style:c.style,styleSpec:c.styleSpec,objectElementValidators:{"*":()=>[],type:()=>li({key:`${u}.type`,value:o.type,valueSpec:p.layer.type,style:c.style,styleSpec:c.styleSpec,object:o,objectKey:"type"}),filter:b=>hr(s.k({layerType:_},b)),layout:b=>yi({layer:o,key:b.key,value:b.value,valueSpec:{},style:b.style,styleSpec:b.styleSpec,objectElementValidators:{"*":T=>jo(s.k({layerType:_},T))}}),paint:b=>yi({layer:o,key:b.key,value:b.value,valueSpec:{},style:b.style,styleSpec:b.styleSpec,objectElementValidators:{"*":T=>bs(s.k({layerType:_,layer:o},T))}})}})),i}function wt(c){const i=c.value,o=c.key,u=s.j(i);return u!=="string"?[new s.V(o,i,`string expected, ${u} found`)]:[]}const Go={promoteId:function({key:c,value:i}){if(s.j(i)==="string")return wt({key:c,value:i});{const o=[];for(const u in i)o.push(...wt({key:`${c}.${u}`,value:i[u]}));return o}}};function Vr(c){const i=c.value,o=c.key,u=c.styleSpec,d=c.style;if(!i.type)return[new s.V(o,i,'"type" is required')];const p=s.u(i.type);let _=[];switch(["vector","raster","raster-dem","raster-array"].includes(p)&&(i.url||i.tiles||_.push(new s.i(o,i,'Either "url" or "tiles" is required.'))),p){case"vector":case"raster":case"raster-dem":case"raster-array":return _=_.concat(yi({key:o,value:i,valueSpec:u[`source_${p.replace("-","_")}`],style:c.style,styleSpec:u,objectElementValidators:Go})),_;case"geojson":if(_=yi({key:o,value:i,valueSpec:u.source_geojson,style:d,styleSpec:u,objectElementValidators:Go}),i.cluster)for(const y in i.clusterProperties){const[b,T]=i.clusterProperties[y],E=typeof b=="string"?[b,["accumulated"],["get",y]]:b;_.push(...pn({key:`${o}.${y}.map`,value:T,expressionContext:"cluster-map"})),_.push(...pn({key:`${o}.${y}.reduce`,value:E,expressionContext:"cluster-reduce"}))}return _;case"video":return yi({key:o,value:i,valueSpec:u.source_video,style:d,styleSpec:u});case"image":return yi({key:o,value:i,valueSpec:u.source_image,style:d,styleSpec:u});case"canvas":return[new s.V(o,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Uo({key:`${o}.type`,value:i.type,valueSpec:{values:ba(u)},style:d,styleSpec:u})}}function ba(c){return c.source.reduce((i,o)=>{const u=c[o];return u.type.type==="enum"&&(i=i.concat(Object.keys(u.type.values))),i},[])}function ws(c){const i=c.value,o=c.styleSpec,u=o.light,d=c.style;let p=[];const _=s.j(i);if(i===void 0)return p;if(_!=="object")return p=p.concat([new s.V("light",i,`object expected, ${_} found`)]),p;for(const y in i){const b=y.match(/^(.*)-transition$/);p=p.concat(b&&u[b[1]]&&u[b[1]].transition?li({key:y,value:i[y],valueSpec:o.transition,style:d,styleSpec:o}):u[y]?li({key:y,value:i[y],valueSpec:u[y],style:d,styleSpec:o}):[new s.V(y,i[y],`unknown property "${y}"`)])}return p}function bo(c){const i=c.value;let o=[];if(!i)return o;const u=s.j(i);if(u!=="object")return o=o.concat([new s.V("light-3d",i,`object expected, ${u} found`)]),o;const d=c.styleSpec,p=d["light-3d"],_=c.key,y=c.style,b=c.style.lights;for(const I of["type","id"])if(!(I in i))return o=o.concat([new s.V("light-3d",i,`missing property ${I} on light`)]),o;if(i.type&&b)for(let I=0;I<c.arrayIndex;I++){const C=s.u(i.type),D=b[I];s.u(D.type)===C&&o.push(new s.V(_,i.id,`duplicate light type "${i.type}", previously defined at line ${D.id.__line__}`))}const T=`properties_light_${i.type}`;if(!(T in d))return o=o.concat([new s.V("light-3d",i,`Invalid light type ${i.type}`)]),o;const E=d[T];for(const I in i)if(I==="properties"){const C=i[I],D=s.j(C);if(D!=="object")return o=o.concat([new s.V("properties",C,`object expected, ${D} found`)]),o;for(const k in C)o=o.concat(E[k]?li({key:k,value:C[k],valueSpec:E[k],style:y,styleSpec:d}):[new s.i(c.key,C[k],`unknown property "${k}"`)])}else{const C=I.match(/^(.*)-transition$/);o=o.concat(C&&p[C[1]]&&p[C[1]].transition?li({key:I,value:i[I],valueSpec:d.transition,style:y,styleSpec:d}):p[I]?li({key:I,value:i[I],valueSpec:p[I],style:y,styleSpec:d}):[new s.i(I,i[I],`unknown property "${I}"`)])}return o}function wo(c){const i=c.value,o=c.key,u=c.style,d=c.styleSpec,p=d.terrain;let _=[];const y=s.j(i);if(i===void 0||y==="null")return _;if(y!=="object")return _=_.concat([new s.V("terrain",i,`object expected, ${y} found`)]),_;for(const b in i){const T=b.match(/^(.*)-transition$/);_=_.concat(T&&p[T[1]]&&p[T[1]].transition?li({key:b,value:i[b],valueSpec:d.transition,style:u,styleSpec:d}):p[b]?li({key:b,value:i[b],valueSpec:p[b],style:u,styleSpec:d}):[new s.i(b,i[b],`unknown property "${b}"`)])}if(i.source){const b=u.sources&&u.sources[i.source],T=b&&s.u(b.type);b?T!=="raster-dem"&&_.push(new s.V(o,i.source,`terrain cannot be used with a source of type ${String(T)}, it only be used with a "raster-dem" source type`)):_.push(new s.V(o,i.source,`source "${i.source}" not found`))}else _.push(new s.V(o,i,'terrain is missing required property "source"'));return _}function wa(c){const i=c.value,o=c.style,u=c.styleSpec,d=u.fog;let p=[];const _=s.j(i);if(i===void 0)return p;if(_!=="object")return p=p.concat([new s.V("fog",i,`object expected, ${_} found`)]),p;for(const y in i){const b=y.match(/^(.*)-transition$/);p=p.concat(b&&d[b[1]]&&d[b[1]].transition?li({key:y,value:i[y],valueSpec:u.transition,style:o,styleSpec:u}):d[y]?li({key:y,value:i[y],valueSpec:d[y],style:o,styleSpec:u}):[new s.i(y,i[y],`unknown property "${y}"`)])}return p}const Ts={"*":()=>[],array:Tr,boolean:function(c){const i=c.value,o=c.key,u=s.j(i);return u!=="boolean"?[new s.V(o,i,`boolean expected, ${u} found`)]:[]},number:ys,color:function(c){const i=c.key,o=c.value,u=s.j(o);return u!=="string"?[new s.V(i,o,`color expected, ${u} found`)]:s.z(o)===null?[new s.V(i,o,`color expected, "${o}" found`)]:[]},enum:Uo,filter:hr,function:an,layer:mn,object:yi,source:Vr,model:s.F,light:ws,"light-3d":bo,terrain:wo,fog:wa,string:wt,formatted:function(c){return wt(c).length===0?[]:pn(c)},resolvedImage:function(c){return wt(c).length===0?[]:pn(c)},projection:function(c){const i=c.value,o=c.styleSpec,u=o.projection,d=c.style;let p=[];const _=s.j(i);if(_==="object")for(const y in i)p=p.concat(li({key:y,value:i[y],valueSpec:u[y],style:d,styleSpec:o}));else _!=="string"&&(p=p.concat([new s.V("projection",i,`object or string expected, ${_} found`)]));return p},import:function(c){const{value:i,styleSpec:o}=c,{data:u,...d}=i;Object.defineProperty(d,"__line__",{value:i.__line__,enumerable:!1});let p=yi(s.k({},c,{value:d,valueSpec:o.import}));return s.u(d.id)===""&&p.push(new s.V(`${c.key}.id`,d,"import id can't be an empty string")),u&&(p=p.concat(It(u,o,{key:`${c.key}.data`}))),p}};function li(c,i=!1){const o=c.value,u=c.valueSpec,d=c.styleSpec;if(u.expression&&s.B(s.u(o)))return an(c);if(u.expression&&s.o(s.q(o)))return pn(c);if(u.type&&Ts[u.type]){const p=Ts[u.type](c);return i===!0&&p.length>0&&s.j(c.value)==="array"?pn(c):p}return yi(s.k({},c,{valueSpec:u.type?d[u.type]:u}))}function Dl(c){const i=c.value,o=c.key,u=wt(c);return u.length||(i.indexOf("{fontstack}")===-1&&u.push(new s.V(o,i,'"glyphs" url must include a "{fontstack}" token')),i.indexOf("{range}")===-1&&u.push(new s.V(o,i,'"glyphs" url must include a "{range}" token'))),u}function It(c,i=s.G,o={}){return li({key:o.key||"",value:c,valueSpec:i.$root,styleSpec:i,style:c,objectElementValidators:{glyphs:Dl,"*":()=>[]}})}function Et(c,i=s.G){return Pe(It(c,i))}const Ta=c=>Pe(Vr(c)),_n=c=>Pe(ws(c)),Ve=c=>Pe(bo(c)),Z=c=>Pe(wo(c)),K=c=>Pe(wa(c)),ce=c=>Pe(mn(c)),De=c=>Pe(hr(c)),Oe=c=>Pe(bs(c)),Ue=c=>Pe(jo(c)),dt=c=>Pe(s.F(c));function Pe(c){return c.slice().sort((i,o)=>i.line&&o.line?i.line-o.line:0)}function ot(c,i){let o=!1;if(i&&i.length)for(const u of i)u instanceof s.i?s.w(u.message):(c.fire(new s.a(new Error(u.message))),o=!0);return o}const ut=new s.H({anchor:new s.J(s.G.light.anchor),position:new s.K(s.G.light.position),color:new s.J(s.G.light.color),intensity:new s.J(s.G.light.intensity)});class gt extends s.E{constructor(i,o="flat"){super(),this._transitionable=new s.L(ut),this.setLight(i,o),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(i,o,u={}){this._validate(_n,i,u)||(this._transitionable.setTransitionOrValue(i),this.id=o)}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,o,u){return(!u||u.validate!==!1)&&ot(this,i.call(Et,s.e({value:o,style:{glyphs:!0,sprite:!0},styleSpec:s.G})))}}const Ke=new s.H({source:new s.J(s.G.terrain.source),exaggeration:new s.J(s.G.terrain.exaggeration)});let Sr=class extends s.E{constructor(c,i,o,u){super(),this.scope=o,this._transitionable=new s.L(Ke,o,u),this._transitionable.setTransitionOrValue(c,u),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=i}get(){return this._transitionable.serialize()}set(c,i){this._transitionable.setTransitionOrValue(c,i)}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}getExaggeration(c){return this._transitioning.possiblyEvaluate(new s.N(c)).get("exaggeration")}isZoomDependent(){const c=this._transitionable._values.exaggeration;return c!=null&&c.value!=null&&c.value.expression!=null&&c.value.expression instanceof s.Z}};const fr=45,br=65,pr=.05;function mr(c,i,o,u){const d=s.S(fr,br,o),[p,_]=Er(c,u);let y=1-Math.min(1,Math.exp((i-p)/(_-p)*-6));return y*=y*y,y=Math.min(1,1.00747*y),y*d*c.alpha}function Er(c,i){const o=.5/Math.tan(.5*i);return[c.range[0]+o,c.range[1]+o]}function qr(c,i,o,u,d){const p=s.Q.transformMat4([],[i,o,u],d.mercatorFogMatrix);return mr(c,s.Q.length(p),d.pitch,d._fov)}function xi(c,i,o,u,d,p,_){const y=[[o,u,0],[d,u,0],[d,p,0],[o,p,0]];let b=Number.MAX_VALUE,T=-Number.MAX_VALUE;for(const E of y){const I=s.Q.transformMat4([],E,i),C=s.Q.length(I);b=Math.min(b,C),T=Math.max(T,C)}return[mr(c,b,_.pitch,_._fov),mr(c,T,_.pitch,_._fov)]}const Nr=new s.H({range:new s.J(s.G.fog.range),color:new s.J(s.G.fog.color),"high-color":new s.J(s.G.fog["high-color"]),"space-color":new s.J(s.G.fog["space-color"]),"horizon-blend":new s.J(s.G.fog["horizon-blend"]),"star-intensity":new s.J(s.G.fog["star-intensity"]),"vertical-range":new s.J(s.G.fog["vertical-range"])});class Gi extends s.E{constructor(i,o,u,d){super(),this._transitionable=new s.L(Nr,u,new Map(d)),this.set(i,d),this._transitioning=this._transitionable.untransitioned(),this._transform=o,this.properties=new s.U(Nr)}get state(){const i=this._transform,o=i.projection.name==="globe",u=s.W(i.zoom),d=this.properties.get("range"),p=[.5,3];return{range:o?[s.X(p[0],d[0],u),s.X(p[1],d[1],u)]:d,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(i,o,u={}){if(this._validate(K,i,u))return;const d=s.e({},i);for(const p of Object.keys(s.G.fog))d[p]===void 0&&(d[p]=s.G.fog[p].default);this._options=d,this._transitionable.setTransitionOrValue(this._options,o)}getOpacity(i){if(!this._transform.projection.supportsFog)return 0;const o=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:s.S(fr,br,i))*o.a}getOpacityAtLatLng(i,o){return this._transform.projection.supportsFog?function(u,d,p){const _=s.O.fromLngLat(d),y=p.elevation?p.elevation.getAtPointOrZero(_):0;return qr(u,_.x,_.y,y,p)}(this.state,i,o):0}getOpacityForTile(i){if(!this._transform.projection.supportsFog)return[1,1];const o=this._transform.calculateFogTileMatrix(i.toUnwrapped());return xi(this.state,o,0,0,s.Y,s.Y,this._transform)}getOpacityForBounds(i,o,u,d,p){return this._transform.projection.supportsFog?xi(this.state,i,o,u,d,p,this._transform):[1,1]}getFovAdjustedRange(i){return this._transform.projection.supportsFog?Er(this.state,i):[0,1]}isVisibleOnFrustum(i){if(!this._transform.projection.supportsFog)return!1;const o=[4,5,6,7];for(const u of o){const d=i.points[u];let p;if(d[2]>=0)p=d;else{const _=i.points[u-4];p=s._(_,d,_[2]/(_[2]-d[2]))}if(qr(this.state,p[0],p[1],0,this._transform)>=pr)return!0}return!1}updateConfig(i){this._transitionable.setTransitionOrValue(this._options,new Map(i))}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,o,u){return(!u||u.validate!==!1)&&ot(this,i.call(Et,s.e({value:o,style:{glyphs:!0,sprite:!0},styleSpec:s.G})))}}class Bi extends s.E{constructor(i,o,u,d){super(),this.scope=u,this._options=i,this.properties=new s.U(o),this._transitionable=new s.L(o,u,new Map(d)),this._transitionable.setTransitionOrValue(i.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(i){this._transitionable.setTransitionOrValue(this._options.properties,new Map(i))}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(i,o){this._options=i,this._transitionable.setTransitionOrValue(i.properties,o)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}const En=new s.H({color:new s.J(s.G.properties_light_ambient.color),intensity:new s.J(s.G.properties_light_ambient.intensity)}),ci=new s.H({direction:new s.$(s.G.properties_light_directional.direction),color:new s.J(s.G.properties_light_directional.color),intensity:new s.J(s.G.properties_light_directional.intensity),"cast-shadows":new s.J(s.G.properties_light_directional["cast-shadows"]),"shadow-intensity":new s.J(s.G.properties_light_directional["shadow-intensity"])});class Wr{constructor(i,o,u,d){this.screenBounds=i,this.cameraPoint=o,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=u,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,d)}static createFromScreenPoints(i,o){let u,d;if(i instanceof s.P||typeof i[0]=="number"){const p=s.P.convert(i);u=[p],d=o.isPointAboveHorizon(p)}else{const p=s.P.convert(i[0]),_=s.P.convert(i[1]);u=[p,_],d=s.a0(p,_).every(y=>o.isPointAboveHorizon(y))}return new Wr(u,o.getCameraPoint(),d,o)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(i){return s.a0(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],i)}bufferedCameraGeometry(i){const o=this.screenBounds[0],u=this.screenBounds.length===1?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],d=s.a0(o,u,0,!1);return this.cameraPoint.y>u.y&&(this.cameraPoint.x>o.x&&this.cameraPoint.x<u.x?d.splice(3,0,this.cameraPoint):this.cameraPoint.x>=u.x?d[2]=this.cameraPoint:this.cameraPoint.x<=o.x&&(d[3]=this.cameraPoint)),s.a1(d,i)}bufferedCameraGeometryGlobe(i){const o=this.screenBounds[0],u=this.screenBounds.length===1?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],d=s.a0(o,u,i),p=this.cameraPoint.clone();switch(3*((p.y>o.y)+(p.y>u.y))+((p.x>o.x)+(p.x>u.x))){case 0:d[0]=p,d[4]=p.clone();break;case 1:d.splice(1,0,p);break;case 2:d[1]=p;break;case 3:d.splice(4,0,p);break;case 5:d.splice(2,0,p);break;case 6:d[3]=p;break;case 7:d.splice(3,0,p);break;case 8:d[2]=p}return d}containsTile(i,o,u,d=0){const p=i.queryPadding/o._pixelsPerMercatorPixel+1,_=u?this._bufferedCameraMercator(p,o):this._bufferedScreenMercator(p,o);let y=i.tileID.wrap+(_.unwrapped?d:0);const b=_.polygon.map(B=>s.a2(i.tileTransform,B,y));if(!s.a3(b,0,0,s.Y,s.Y))return;y=i.tileID.wrap+(this.screenGeometryMercator.unwrapped?d:0);const T=this.screenGeometryMercator.polygon.map(B=>s.a4(i.tileTransform,B,y)),E=T.map(B=>new s.P(B[0],B[1])),I=o.getFreeCameraOptions().position||new s.O(0,0,0),C=s.a4(i.tileTransform,I,y),D=T.map(B=>{const F=s.Q.sub(B,B,C);return s.Q.normalize(F,F),new s.a5(C,F)}),k=s.a6(i,1,o.zoom)*o._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:E,tilespaceRays:D,bufferedTilespaceGeometry:b,bufferedTilespaceBounds:(O=s.a7(b),O.min.x=s.ad(O.min.x,0,s.Y),O.min.y=s.ad(O.min.y,0,s.Y),O.max.x=s.ad(O.max.x,0,s.Y),O.max.y=s.ad(O.max.y,0,s.Y),O),tile:i,tileID:i.tileID,pixelToTileUnitsFactor:k};var O}_bufferedScreenMercator(i,o){const u=Be(i);if(this._screenRaycastCache[u])return this._screenRaycastCache[u];{let d;return d=o.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(i),o):{polygon:this.bufferedScreenGeometry(i).map(p=>o.pointCoordinate3D(p)),unwrapped:!0},this._screenRaycastCache[u]=d,d}}_bufferedCameraMercator(i,o){const u=Be(i);if(this._cameraRaycastCache[u])return this._cameraRaycastCache[u];{let d;return d=o.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(i),o):{polygon:this.bufferedCameraGeometry(i).map(p=>o.pointCoordinate3D(p)),unwrapped:!0},this._cameraRaycastCache[u]=d,d}}_projectAndResample(i,o){const u=function(p,_){const y=s.a9.multiply([],_.pixelMatrix,_.globeMatrix),b=[0,-s.ae,0,1],T=[0,s.ae,0,1],E=[0,0,0,1];s.aa.transformMat4(b,b,y),s.aa.transformMat4(T,T,y),s.aa.transformMat4(E,E,y);const I=new s.P(b[0]/b[3],b[1]/b[3]),C=new s.P(T[0]/T[3],T[1]/T[3]),D=s.ab(p,I)&&b[3]<E[3],k=s.ab(p,C)&&T[3]<E[3];if(!D&&!k)return null;const O=function($,ie,te){for(let ae=1;ae<$.length;ae++){const ge=Me(ie.pointCoordinate3D($[ae-1]).x),se=Me(ie.pointCoordinate3D($[ae]).x);if(te<0){if(ge<se)return{idx:ae,t:-ge/(se-1-ge)}}else if(se<ge)return{idx:ae,t:(1-ge)/(se+1-ge)}}return null}(p,_,D?-1:1);if(!O)return null;const{idx:B,t:F}=O;let j=B>1?Ae(p.slice(0,B),_):[],Q=B<p.length?Ae(p.slice(B),_):[];j=j.map($=>new s.P(Me($.x),$.y)),Q=Q.map($=>new s.P(Me($.x),$.y));const H=[...j];H.length===0&&H.push(Q[Q.length-1]);const Y=s.X(H[H.length-1].y,(Q.length===0?j[0]:Q[0]).y,F);let N;return N=D?[new s.P(0,Y),new s.P(0,0),new s.P(1,0),new s.P(1,Y)]:[new s.P(1,Y),new s.P(1,1),new s.P(0,1),new s.P(0,Y)],H.push(...N),Q.length===0?H.push(j[0]):H.push(...Q),{polygon:H.map($=>new s.O($.x,$.y)),unwrapped:!1}}(i,o);if(u)return u;const d=function(p,_){let y=!1,b=-1/0,T=0;for(let I=0;I<p.length-1;I++)p[I].x>b&&(b=p[I].x,T=I);for(let I=0;I<p.length-1;I++){const C=(T+I)%(p.length-1),D=p[C],k=p[C+1];Math.abs(D.x-k.x)>.5&&(D.x<k.x?(D.x+=1,C===0&&(p[p.length-1].x+=1)):(k.x+=1,C+1===p.length-1&&(p[0].x+=1)),y=!0)}const E=s.a8(_.center.lng);return y&&E<Math.abs(E-1)&&p.forEach(I=>{I.x-=1}),{polygon:p,unwrapped:y}}(Ae(i,o).map(p=>new s.P(Me(p.x),p.y)),o);return{polygon:d.polygon.map(p=>new s.O(p.x,p.y)),unwrapped:d.unwrapped}}}function Ae(c,i){return s.ac(c,o=>{const u=i.pointCoordinate3D(o);o.x=u.x,o.y=u.y},1/256)}function Me(c){return c<0?1+c%1:c%1}function Be(c){return 100*c|0}function Ge(c,i,o,u,d){const p=function(_,y){if(_)return d(_);if(y){c.url&&y.tiles&&c.tiles&&delete c.tiles;const b=s.af(s.e(y,c),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);y.vector_layers&&(b.vectorLayers=y.vector_layers,b.vectorLayerIds=b.vectorLayers.map(T=>T.id)),y.raster_layers&&(b.rasterLayers=y.raster_layers,b.rasterLayerIds=b.rasterLayers.map(T=>T.id)),b.tiles=i.canonicalizeTileset(b,c.url),d(null,b)}};return c.url?s.g(i.transformRequest(i.normalizeSourceURL(c.url,null,o,u),s.R.Source),p):s.f.frame(()=>p(null,c))}class je{constructor(i,o,u){this.bounds=s.ag.convert(this.validateBounds(i)),this.minzoom=o||0,this.maxzoom=u||24}validateBounds(i){return Array.isArray(i)&&i.length===4?[Math.max(-180,i[0]),Math.max(-90,i[1]),Math.min(180,i[2]),Math.min(90,i[3])]:[-180,-90,180,90]}contains(i){const o=Math.pow(2,i.z),u=Math.floor(s.a8(this.bounds.getWest())*o),d=Math.floor(s.ah(this.bounds.getNorth())*o),p=Math.ceil(s.a8(this.bounds.getEast())*o),_=Math.ceil(s.ah(this.bounds.getSouth())*o);return i.x>=u&&i.x<p&&i.y>=d&&i.y<_}}class Xe extends s.E{constructor(i,o,u,d){if(super(),this.id=i,this.dispatcher=u,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.e(this,s.af(o,["url","scheme","tileSize","promoteId"])),this._options=s.e({type:"vector"},o),this._collectResourceTiming=!!o.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(d),this._tileWorkers={},this._deduped=new s.ai}load(i){this._loaded=!1,this.fire(new s.b("dataloading",{dataType:"source"}));const o=Array.isArray(this.map._language)?this.map._language.join():this.map._language,u=this.map._worldview;this._tileJSONRequest=Ge(this._options,this.map._requestManager,o,u,(d,p)=>{this._tileJSONRequest=null,this._loaded=!0,d?(o&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${o}`),u&&u.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${u}`),this.fire(new s.a(d))):p&&(s.e(this,p),p.bounds&&(this.tileBounds=new je(p.bounds,this.minzoom,this.maxzoom)),s.am(p.tiles,this.map._requestManager._customAccessToken),this.fire(new s.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.b("data",{dataType:"source",sourceDataType:"content"}))),i&&i(d)})}loaded(){return this._loaded}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}onAdd(i){this.map=i,this.load()}reload(){this.cancelTileJSONRequest();const i=s.aj(this.id,this.scope);this.load(()=>this.map.style.clearSource(i))}setTiles(i){return this._options.tiles=i,this.reload(),this}setUrl(i){return this.url=i,this._options.url=i,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return s.e({},this._options)}loadTile(i,o){const u=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme)),d={request:this.map._requestManager.transformRequest(u,s.R.Tile),data:void 0,uid:i.uid,tileID:i.tileID,tileZoom:i.tileZoom,zoom:i.tileID.overscaledZ,tileSize:this.tileSize*i.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:s.f.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:i.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:i.isExtraShadowCaster};if(d.request.collectResourceTiming=this._collectResourceTiming,i.actor&&i.state!=="expired")i.state==="loading"?i.reloadCallback=o:i.request=i.actor.send("reloadTile",d,p.bind(this));else if(i.actor=this._tileWorkers[u]=this._tileWorkers[u]||this.dispatcher.getActor(),this.dispatcher.ready)i.request=i.actor.send("loadTile",d,p.bind(this),void 0,!0);else{const _=s.ak.call({deduped:this._deduped},d,(y,b)=>{y||!b?p.call(this,y):(d.data={cacheControl:b.cacheControl,expires:b.expires,rawData:b.rawData.slice(0)},i.actor&&i.actor.send("loadTile",d,p.bind(this),void 0,!0))},!0);i.request={cancel:_}}function p(_,y){return delete i.request,i.aborted?o(null):_&&_.status!==404?o(_):(y&&y.resourceTiming&&(i.resourceTiming=y.resourceTiming),this.map._refreshExpiredTiles&&y&&i.setExpiryData(y),i.loadVectorData(y,this.map.painter),s.al(this.dispatcher),o(null),void(i.reloadCallback&&(this.loadTile(i,i.reloadCallback),i.reloadCallback=null)))}}abortTile(i){i.request&&(i.request.cancel(),delete i.request),i.actor&&i.actor.send("abortTile",{uid:i.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(i){i.actor&&i.actor.send("removeTile",{uid:i.uid,type:this.type,source:this.id,scope:this.scope}),i.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Ye extends s.E{constructor(i,o,u,d){super(),this.id=i,this.dispatcher=u,this.setEventedParent(d),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.e({type:"raster"},o),s.e(this,s.af(o,["url","scheme","tileSize"]))}load(i){this._loaded=!1,this.fire(new s.b("dataloading",{dataType:"source"})),this._tileJSONRequest=Ge(this._options,this.map._requestManager,null,null,(o,u)=>{this._tileJSONRequest=null,this._loaded=!0,o?this.fire(new s.a(o)):u&&(s.e(this,u),u.bounds&&(this.tileBounds=new je(u.bounds,this.minzoom,this.maxzoom)),s.am(u.tiles),this.fire(new s.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.b("data",{dataType:"source",sourceDataType:"content"}))),i&&i(o)})}loaded(){return this._loaded}onAdd(i){this.map=i,this.load()}reload(){this.cancelTileJSONRequest();const i=s.aj(this.id,this.scope);this.load(()=>this.map.style.clearSource(i))}setTiles(i){return this._options.tiles=i,this.reload(),this}setUrl(i){return this.url=i,this._options.url=i,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return s.e({},this._options)}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}loadTile(i,o){const u=s.f.devicePixelRatio>=2,d=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),u,this.tileSize);i.request=s.d(this.map._requestManager.transformRequest(d,s.R.Tile),(p,_,y,b)=>(delete i.request,i.aborted?(i.state="unloaded",o(null)):p?(i.state="errored",o(p)):_?(this.map._refreshExpiredTiles&&i.setExpiryData({cacheControl:y,expires:b}),i.setTexture(_,this.map.painter),i.state="loaded",s.al(this.dispatcher),void o(null)):o(null)))}abortTile(i,o){i.request&&(i.request.cancel(),delete i.request),o()}unloadTile(i,o){i.texture&&i.texture instanceof s.T?(i.destroy(!0),i.texture&&i.texture instanceof s.T&&this.map.painter.saveTileTexture(i.texture)):i.destroy(),o()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class $e extends Ye{constructor(i,o,u,d){super(i,o,u,d),this.type="raster-array",this.maxzoom=22,this._options=s.e({type:"raster-array"},o)}triggerRepaint(i){const o=this.map.painter._terrain,u=this.map.style.getSourceCache(this.id);o&&o.enabled&&u&&o._clearRenderCacheForTile(u.id,i.tileID),this.map.triggerRepaint()}loadTile(i,o){const u=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),d=this.map._requestManager.transformRequest(u,s.R.Tile);i.requestParams=d,i.actor||(i.actor=this.dispatcher.getActor()),i.request=i.fetchHeader(void 0,(p,_,y,b)=>{if(delete i.request,i.aborted)return i.state="unloaded",o(null);if(p)return p.code===20?void 0:(i.state="errored",o(p));this.map._refreshExpiredTiles&&i.setExpiryData({cacheControl:y,expires:b}),i.state="empty",o(null)})}unloadTile(i){const o=i.texture;o&&o instanceof s.T?(i.destroy(!0),this.map.painter.saveTileTexture(o)):(i.destroy(),i.flushQueues(),i._isHeaderLoaded=!1,delete i._mrt,delete i.textureDescriptor),i.fbo&&(i.fbo.destroy(),delete i.fbo),delete i.request,delete i.requestParams,delete i.neighboringTiles,i.state="unloaded"}prepareTile(i,o,u){i._isHeaderLoaded&&(i.state!=="empty"&&(i.state="reloading"),i.fetchBand(o,u,(d,p)=>{if(d)return i.state="errored",this.fire(new s.a(d)),void this.triggerRepaint(i);p&&(i.setTexture(p,this.map.painter),i.state="loaded",this.triggerRepaint(i))}))}getInitialBand(i){if(!this.rasterLayers)return 0;const o=this.rasterLayers.find(({id:p})=>p===i),u=o&&o.fields,d=u&&u.bands&&u.bands;return d?d[0]:0}getTextureDescriptor(i,o,u){if(!i)return;const d=o.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!d)return;let p=null;o instanceof s.aq?p=o.paint.get("raster-array-band"):o instanceof s.ar&&(p=o.paint.get("raster-particle-array-band"));const _=p||this.getInitialBand(d);if(_!=null)if(i.textureDescriptor){if(!i.updateNeeded(d,_)||u)return Object.assign({},i.textureDescriptor,{texture:i.texture})}else this.prepareTile(i,d,_)}}const tt=32,We=33,Pt=new Uint16Array(8184);for(let c=0;c<2046;c++){let i=c+2,o=0,u=0,d=0,p=0,_=0,y=0;for(1&i?d=p=_=tt:o=u=y=tt;(i>>=1)>1;){const T=o+d>>1,E=u+p>>1;1&i?(d=o,p=u,o=_,u=y):(o=d,u=p,d=_,p=y),_=T,y=E}const b=4*c;Pt[b+0]=o,Pt[b+1]=u,Pt[b+2]=d,Pt[b+3]=p}const Yt=new Uint16Array(2178),mt=new Uint8Array(1089),Ar=new Uint16Array(1089);function Hr(c){return c===0?-.03125:c===32?.03125:0}class zr{constructor(i,o,u,d){this.id=zr.uniqueIdxCounter,zr.uniqueIdxCounter++,this.context=i;const p=i.gl;this.buffer=p.createBuffer(),this.dynamicDraw=!!u,this.context.unbindVAO(),i.bindElementBuffer.set(this.buffer),p.bufferData(p.ELEMENT_ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||d||o.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(i){this.id=zr.uniqueIdxCounter,zr.uniqueIdxCounter++;const o=this.context.gl;this.context.unbindVAO(),this.bind(),o.bufferSubData(o.ELEMENT_ARRAY_BUFFER,0,i.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}zr.uniqueIdxCounter=0;const ri={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Jr{constructor(i,o,u,d,p,_){this.length=o.length,this.attributes=u,this.itemSize=o.bytesPerElement,this.dynamicDraw=d,this.instanceCount=_,this.context=i;const y=i.gl;this.buffer=y.createBuffer(),i.bindVertexBuffer.set(this.buffer),y.bufferData(y.ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||p||o.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(i){const o=this.context.gl;this.bind(),o.bufferSubData(o.ARRAY_BUFFER,0,i.arrayBuffer)}enableAttributes(i,o){for(let u=0;u<this.attributes.length;u++){const d=o.attributes[this.attributes[u].name];d!==void 0&&i.enableVertexAttribArray(d)}}setVertexAttribPointers(i,o,u){for(let d=0;d<this.attributes.length;d++){const p=this.attributes[d],_=o.attributes[p.name];_!==void 0&&i.vertexAttribPointer(_,p.components,i[ri[p.type]],!1,this.itemSize,p.offset+this.itemSize*(u||0))}}setVertexAttribDivisor(i,o,u){for(let d=0;d<this.attributes.length;d++){const p=o.attributes[this.attributes[d].name];p!==void 0&&this.instanceCount&&this.instanceCount>0&&i.vertexAttribDivisor(p,u)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class rr{constructor(i){this.gl=i.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(i){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ln extends rr{getDefault(){return s.aA.transparent}set(i){const o=this.current;(i.r!==o.r||i.g!==o.g||i.b!==o.b||i.a!==o.a||this.dirty)&&(this.gl.clearColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class An extends rr{getDefault(){return 1}set(i){(i!==this.current||this.dirty)&&(this.gl.clearDepth(i),this.current=i,this.dirty=!1)}}class wi extends rr{getDefault(){return 0}set(i){(i!==this.current||this.dirty)&&(this.gl.clearStencil(i),this.current=i,this.dirty=!1)}}class $o extends rr{getDefault(){return[!0,!0,!0,!0]}set(i){const o=this.current;(i[0]!==o[0]||i[1]!==o[1]||i[2]!==o[2]||i[3]!==o[3]||this.dirty)&&(this.gl.colorMask(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class Sa extends rr{getDefault(){return!0}set(i){(i!==this.current||this.dirty)&&(this.gl.depthMask(i),this.current=i,this.dirty=!1)}}class $i extends rr{getDefault(){return 255}set(i){(i!==this.current||this.dirty)&&(this.gl.stencilMask(i),this.current=i,this.dirty=!1)}}class jd extends rr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(i){const o=this.current;(i.func!==o.func||i.ref!==o.ref||i.mask!==o.mask||this.dirty)&&(this.gl.stencilFunc(i.func,i.ref,i.mask),this.current=i,this.dirty=!1)}}class Wt extends rr{getDefault(){const i=this.gl;return[i.KEEP,i.KEEP,i.KEEP]}set(i){const o=this.current;(i[0]!==o[0]||i[1]!==o[1]||i[2]!==o[2]||this.dirty)&&(this.gl.stencilOp(i[0],i[1],i[2]),this.current=i,this.dirty=!1)}}class fu extends rr{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;i?o.enable(o.STENCIL_TEST):o.disable(o.STENCIL_TEST),this.current=i,this.dirty=!1}}class qi extends rr{getDefault(){return[0,1]}set(i){const o=this.current;(i[0]!==o[0]||i[1]!==o[1]||this.dirty)&&(this.gl.depthRange(i[0],i[1]),this.current=i,this.dirty=!1)}}class Kn extends rr{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;i?o.enable(o.DEPTH_TEST):o.disable(o.DEPTH_TEST),this.current=i,this.dirty=!1}}class n1 extends rr{getDefault(){return this.gl.LESS}set(i){(i!==this.current||this.dirty)&&(this.gl.depthFunc(i),this.current=i,this.dirty=!1)}}class o1 extends rr{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;i?o.enable(o.BLEND):o.disable(o.BLEND),this.current=i,this.dirty=!1}}class pu extends rr{getDefault(){const i=this.gl;return[i.ONE,i.ZERO,i.ONE,i.ZERO]}set(i){const o=this.current;(i[0]!==o[0]||i[1]!==o[1]||i[2]!==o[2]||i[3]!==o[3]||this.dirty)&&(this.gl.blendFuncSeparate(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class s1 extends rr{getDefault(){return s.aA.transparent}set(i){const o=this.current;(i.r!==o.r||i.g!==o.g||i.b!==o.b||i.a!==o.a||this.dirty)&&(this.gl.blendColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class a1 extends rr{getDefault(){return this.gl.FUNC_ADD}set(i){(i!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(i,i),this.current=i,this.dirty=!1)}}class l1 extends rr{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;i?o.enable(o.CULL_FACE):o.disable(o.CULL_FACE),this.current=i,this.dirty=!1}}class c1 extends rr{getDefault(){return this.gl.BACK}set(i){(i!==this.current||this.dirty)&&(this.gl.cullFace(i),this.current=i,this.dirty=!1)}}class u1 extends rr{getDefault(){return this.gl.CCW}set(i){(i!==this.current||this.dirty)&&(this.gl.frontFace(i),this.current=i,this.dirty=!1)}}let zl=class extends rr{getDefault(){return null}set(c){(c!==this.current||this.dirty)&&(this.gl.useProgram(c),this.current=c,this.dirty=!1)}};class kt extends rr{getDefault(){return this.gl.TEXTURE0}set(i){(i!==this.current||this.dirty)&&(this.gl.activeTexture(i),this.current=i,this.dirty=!1)}}class mu extends rr{getDefault(){const i=this.gl;return[0,0,i.drawingBufferWidth,i.drawingBufferHeight]}set(i){const o=this.current;(i[0]!==o[0]||i[1]!==o[1]||i[2]!==o[2]||i[3]!==o[3]||this.dirty)&&(this.gl.viewport(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class qo extends rr{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.bindFramebuffer(o.FRAMEBUFFER,i),this.current=i,this.dirty=!1}}class h1 extends rr{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.bindRenderbuffer(o.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class d1 extends rr{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.bindTexture(o.TEXTURE_2D,i),this.current=i,this.dirty=!1}}class f1 extends rr{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.bindBuffer(o.ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class p1 extends rr{getDefault(){return null}set(i){const o=this.gl;o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class m1 extends rr{getDefault(){return null}set(i){this.gl&&(i!==this.current||this.dirty)&&(this.gl.bindVertexArray(i),this.current=i,this.dirty=!1)}}class _1 extends rr{getDefault(){return 4}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_ALIGNMENT,i),this.current=i,this.dirty=!1}}class g1 extends rr{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i),this.current=i,this.dirty=!1}}class y1 extends rr{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,i),this.current=i,this.dirty=!1}}class Rl extends rr{constructor(i,o){super(i),this.context=i,this.parent=o}getDefault(){return null}}class Gd extends Rl{setDirty(){this.dirty=!0}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class Ll extends Rl{attachment(){return this.gl.DEPTH_ATTACHMENT}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,this.attachment(),o.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class $d extends Rl{attachment(){return this.gl.DEPTH_ATTACHMENT}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferTexture2D(o.FRAMEBUFFER,this.attachment(),o.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class qd extends Ll{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Zd{constructor(i,o,u,d,p){this.context=i,this.width=o,this.height=u;const _=this.framebuffer=i.gl.createFramebuffer();d&&(this.colorAttachment=new Gd(i,_)),p&&(this.depthAttachmentType=p,this.depthAttachment=p==="renderbuffer"?new Ll(i,_):new $d(i,_))}destroy(){const i=this.context.gl;if(this.colorAttachment){const o=this.colorAttachment.get();o&&i.deleteTexture(o)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const o=this.depthAttachment.get();o&&i.deleteRenderbuffer(o)}else{const o=this.depthAttachment.get();o&&i.deleteTexture(o)}i.deleteFramebuffer(this.framebuffer)}}class vt{constructor(i,o,u){this.func=i,this.mask=o,this.range=u}}vt.ReadOnly=!1,vt.ReadWrite=!0,vt.disabled=new vt(519,vt.ReadOnly,[0,1]);const _u=7680;class Dt{constructor(i,o,u,d,p,_){this.test=i,this.ref=o,this.mask=u,this.fail=d,this.depthFail=p,this.pass=_}}Dt.disabled=new Dt({func:519,mask:0},0,0,_u,_u,_u);const Ol=771;class Gt{constructor(i,o,u,d){this.blendFunction=i,this.blendColor=o,this.mask=u,this.blendEquation=d}}Gt.Replace=[1,0,1,0],Gt.disabled=new Gt(Gt.Replace,s.aA.transparent,[!1,!1,!1,!1]),Gt.unblended=new Gt(Gt.Replace,s.aA.transparent,[!0,!0,!0,!0]),Gt.alphaBlended=new Gt([1,Ol,1,Ol],s.aA.transparent,[!0,!0,!0,!0]),Gt.multiply=new Gt([774,0,774,0],s.aA.transparent,[!0,!0,!0,!0]);const gu=1029,yu=2305;class Mt{constructor(i,o,u){this.enable=i,this.mode=o,this.frontFace=u}}Mt.disabled=new Mt(!1,gu,yu),Mt.backCCW=new Mt(!0,gu,yu),Mt.backCW=new Mt(!0,gu,2304),Mt.frontCW=new Mt(!0,1028,2304),Mt.frontCCW=new Mt(!0,1028,yu);class Un{constructor(i,o){this.gl=i,this.clearColor=new ln(this),this.clearDepth=new An(this),this.clearStencil=new wi(this),this.colorMask=new $o(this),this.depthMask=new Sa(this),this.stencilMask=new $i(this),this.stencilFunc=new jd(this),this.stencilOp=new Wt(this),this.stencilTest=new fu(this),this.depthRange=new qi(this),this.depthTest=new Kn(this),this.depthFunc=new n1(this),this.blend=new o1(this),this.blendFunc=new pu(this),this.blendColor=new s1(this),this.blendEquation=new a1(this),this.cullFace=new l1(this),this.cullFaceSide=new c1(this),this.frontFace=new u1(this),this.program=new zl(this),this.activeTexture=new kt(this),this.viewport=new mu(this),this.bindFramebuffer=new qo(this),this.bindRenderbuffer=new h1(this),this.bindTexture=new d1(this),this.bindVertexBuffer=new f1(this),this.bindElementBuffer=new p1(this),this.bindVertexArrayOES=new m1(this),this.pixelStoreUnpack=new _1(this),this.pixelStoreUnpackPremultiplyAlpha=new g1(this),this.pixelStoreUnpackFlipY=new y1(this),this.options=o?{...o}:{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=i.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=i.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=i.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=i.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=i.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=i.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=i.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),this.maxPointSize=i.getParameter(i.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(i,o,u){return new zr(this,i,o,u)}createVertexBuffer(i,o,u,d,p){return new Jr(this,i,o,u,d,p)}createRenderbuffer(i,o,u){const d=this.gl,p=d.createRenderbuffer();return this.bindRenderbuffer.set(p),d.renderbufferStorage(d.RENDERBUFFER,i,o,u),this.bindRenderbuffer.set(null),p}createFramebuffer(i,o,u,d){return new Zd(this,i,o,u,d)}clear({color:i,depth:o,stencil:u,colorMask:d}){const p=this.gl;let _=0;i&&(_|=p.COLOR_BUFFER_BIT,this.clearColor.set(i),this.colorMask.set(d||[!0,!0,!0,!0])),o!==void 0&&(_|=p.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(o),this.depthMask.set(!0)),u!==void 0&&(_|=p.STENCIL_BUFFER_BIT,this.clearStencil.set(u),this.stencilMask.set(255)),p.clear(_)}setCullFace(i){i.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(i.mode),this.frontFace.set(i.frontFace))}setDepthMode(i){i.func!==this.gl.ALWAYS||i.mask?(this.depthTest.set(!0),this.depthFunc.set(i.func),this.depthMask.set(i.mask),this.depthRange.set(i.range)):this.depthTest.set(!1)}setStencilMode(i){i.test.func!==this.gl.ALWAYS||i.mask?(this.stencilTest.set(!0),this.stencilMask.set(i.mask),this.stencilOp.set([i.fail,i.depthFail,i.pass]),this.stencilFunc.set({func:i.test.func,ref:i.ref,mask:i.test.mask})):this.stencilTest.set(!1)}setColorMode(i){ze(i.blendFunction,Gt.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor),i.blendEquation?this.blendEquation.set(i.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(i.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}var Wd=s.aB([{name:"a_index",type:"Int16",components:1}]);const Zo=.15000000000000002;class x1{constructor(i,o,u,d){const p={width:u[0],height:u[1],data:null},_=i.gl;this.targetColorTexture=new s.T(i,p,_.RGBA,{useMipmap:!1}),this.backgroundColorTexture=new s.T(i,p,_.RGBA,{useMipmap:!1}),this.context=i,this.setParticleTextureDimension(o,d),this.lastInvalidatedAt=0}setParticleTextureDimension(i,o){if(this.particleTextureDimension===o)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const u=this.context.gl,d=o*o,p=new Uint8Array(4*d),_=.7692307692307692,y=s.aC(i.key);for(let E=0;E<p.length;E+=4){const I=_*(y()+Zo),C=_*(y()+Zo),D=255*I%1,k=255*C%1,O=D,B=C-k/255,F=k;p[E+0]=Math.floor(255*(I-D/255)),p[E+1]=Math.floor(255*O),p[E+2]=Math.floor(255*B),p[E+3]=Math.floor(255*F)}const b=new s.h({width:o,height:o},p);this.particleTexture0=new s.T(this.context,b,u.RGBA,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new s.T(this.context,b,u.RGBA,{premultiply:!1,useMipmap:!1});const T=new s.aD;T.reserve(d);for(let E=0;E<d;E++)T.emplaceBack(E);this.particleIndexBuffer=this.context.createVertexBuffer(T,Wd.members,!0),this.particleSegment=s.aE.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=o}update(i){return!(this.lastInvalidatedAt<i&&(this.lastInvalidatedAt=s.f.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}const kl={type:2,extent:s.Y,loadGeometry:()=>[[new s.P(0,0),new s.P(s.Y+1,0),new s.P(s.Y+1,s.Y+1),new s.P(0,s.Y+1),new s.P(0,0)]]};class Mn{constructor(i,o,u,d,p){this.tileID=i,this.uid=s.aF(),this.uses=0,this.tileSize=o,this.tileZoom=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=p,d&&d.style&&(this._lastUpdatedBrightness=d.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",d&&d.transform&&(this.projection=d.transform.projection)}registerFadeDuration(i){const o=i+this.timeAdded;o<s.f.now()||this.fadeEndTime&&o<this.fadeEndTime||(this.fadeEndTime=o)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=s.av(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(i,o,u){if(this.unloadVectorData(),this.state="loaded",i){i.featureIndex&&(this.latestFeatureIndex=i.featureIndex,i.rawTileData?(this.latestRawTileData=i.rawTileData,this.latestFeatureIndex.rawTileData=i.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=i.collisionBoxArray,this.buckets=function(d,p){const _={};if(!p)return _;for(const y of d){const b=y.layerIds.map(T=>p.getLayer(T)).filter(Boolean);if(b.length!==0){y.layers=b,y.stateDependentLayerIds&&(y.stateDependentLayers=y.stateDependentLayerIds.map(T=>b.filter(E=>E.id===T)[0]));for(const T of b)_[T.fqid]=y}}return _}(i.buckets,o.style),this.hasSymbolBuckets=!1;for(const d in this.buckets){const p=this.buckets[d];if(p instanceof s.aH){if(this.hasSymbolBuckets=!0,!u)break;p.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const d in this.buckets){const p=this.buckets[d];if(p instanceof s.aH&&p.hasRTLText){this.hasRTLText=!0,s.aI();break}}this.queryPadding=0;for(const d in this.buckets){const p=this.buckets[d],_=o.style.getOwnLayer(d);if(!_)continue;const y=_.queryRadius(p);this.queryPadding=Math.max(this.queryPadding,y)}i.imageAtlas&&(this.imageAtlas=i.imageAtlas),i.glyphAtlasImage&&(this.glyphAtlasImage=i.glyphAtlasImage),i.lineAtlas&&(this.lineAtlas=i.lineAtlas),this._lastUpdatedBrightness=i.brightness}else this.collisionBoxArray=new s.aG}unloadVectorData(){if(this.hasData()){for(const i in this.buckets)this.buckets[i].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(i){return this.buckets[i.fqid]}upload(i){for(const d in this.buckets){const p=this.buckets[d];p.uploadPending()&&p.upload(i)}const o=i.gl,u=this.imageAtlas;if(u&&!u.uploaded){const d=!!Object.keys(u.patternPositions).length;this.imageAtlasTexture=new s.T(i,u.image,o.RGBA,{useMipmap:d}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new s.T(i,this.glyphAtlasImage,o.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new s.T(i,this.lineAtlas.image,o.R8),this.lineAtlas.uploaded=!0)}prepare(i,o,u){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(i,this.imageAtlasTexture,u),!o||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const d=o.style.getBrightness();(this._lastUpdatedBrightness||d)&&(this._lastUpdatedBrightness&&d&&Math.abs(this._lastUpdatedBrightness-d)<.001||(this._lastUpdatedBrightness=d,this.updateBuckets(void 0,o)))}queryRenderedFeatures(i,o,u,d,p,_,y,b){return this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)?this.latestFeatureIndex.query({tileResult:d,pixelPosMatrix:y,transform:_,params:p,tileTransform:this.tileTransform},i,o,u):{}}querySourceFeatures(i,o){const u=this.latestFeatureIndex;if(!u||!u.rawTileData)return;const d=u.loadVTLayers(),p=o?o.sourceLayer:"",_=d._geojsonTileLayer||d[p];if(!_)return;const y=s.aJ(o&&o.filter),{z:b,x:T,y:E}=this.tileID.canonical,I={z:b,x:T,y:E};for(let C=0;C<_.length;C++){const D=_.feature(C);if(y.needGeometry){const B=s.aK(D,!0);if(!y.filter(new s.N(this.tileID.overscaledZ),B,this.tileID.canonical))continue}else if(!y.filter(new s.N(this.tileID.overscaledZ),D))continue;const k=u.getId(D,p),O=new s.aL(D,b,T,E,k);O.tile=I,i.push(O)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}bucketsLoaded(){for(const i in this.buckets)if(this.buckets[i].uploadPending())return!1;return!0}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(i){const o=this.expirationTime;if(i.cacheControl){const u=s.aM(i.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else i.expires&&(this.expirationTime=new Date(i.expires).getTime());if(this.expirationTime){const u=Date.now();let d=!1;if(this.expirationTime>u)d=!1;else if(o)if(this.expirationTime<o)d=!0;else{const p=this.expirationTime-o;p?this.expirationTime=u+Math.max(p,3e4):d=!0}else d=!0;d?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(i,o){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(i).length!==0&&o&&this.updateBuckets(i,o)}updateBuckets(i,o){if(!this.latestFeatureIndex)return;const u=this.latestFeatureIndex.loadVTLayers(),d=o.style.listImages(),p=o.style.getBrightness();for(const _ in this.buckets){if(!o.style.hasLayer(_))continue;const y=this.buckets[_],b=y.layers[0].sourceLayer||"_geojsonTileLayer",T=u[b];let E={};if(i&&(E=i[b],!T||!E||Object.keys(E).length===0))continue;if(y.update(E,T,d,this.imageAtlas&&this.imageAtlas.patternPositions||{},p),y instanceof s.aN||y instanceof s.aO){const C=o.style.getOwnSourceCache(y.layers[0].source);o._terrain&&o._terrain.enabled&&C&&y.programConfigurations.needsUpload&&o._terrain._clearRenderCacheForTile(C.id,this.tileID)}const I=o&&o.style&&o.style.getOwnLayer(_);I&&(this.queryPadding=Math.max(this.queryPadding,I.queryRadius(y)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<s.f.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(i){this.symbolFadeHoldUntil=s.f.now()+i}setTexture(i,o){const u=o.context,d=u.gl;this.texture=this.texture||o.getTileTexture(i.width),this.texture&&this.texture instanceof s.T?this.texture.update(i,{useMipmap:!0}):(this.texture=new s.T(u,i,d.RGBA,{useMipmap:!0}),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE))}setDependencies(i,o){const u={};for(const d of o)u[d]=!0;this.dependencies[i]=u}hasDependency(i,o){for(const u of i){const d=this.dependencies[u];if(d){for(const p of o)if(d[p])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(i,o){if(!o||o.name==="mercator"||this._tileDebugBuffer)return;const u=s.aP(kl,this.tileID.canonical,this.tileTransform)[0],d=new s.aQ,p=new s.aR;for(let _=0;_<u.length;_++){const{x:y,y:b}=u[_];d.emplaceBack(y,b),p.emplaceBack(_)}p.emplaceBack(0),this._tileDebugIndexBuffer=i.createIndexBuffer(p),this._tileDebugBuffer=i.createVertexBuffer(d,s.aS.members),this._tileDebugSegments=s.aE.simpleSegment(0,0,d.length,p.length)}_makeTileBoundsBuffers(i,o){if(this._tileBoundsBuffer||!o||o.name==="mercator")return;const u=s.aP(kl,this.tileID.canonical,this.tileTransform)[0];let d,p;if(this.isRaster){const _=function(y,b){const T=s.av(y,b),E=Math.pow(2,y.z);for(let B=0;B<We;B++)for(let F=0;F<We;F++){const j=s.aw((y.x+(F+Hr(F))/tt)/E),Q=s.ax((y.y+(B+Hr(B))/tt)/E),H=b.project(j,Q),Y=B*We+F;Yt[2*Y+0]=Math.round((H.x*T.scale-T.x)*s.Y),Yt[2*Y+1]=Math.round((H.y*T.scale-T.y)*s.Y)}mt.fill(0),Ar.fill(0);for(let B=2045;B>=0;B--){const F=4*B,j=Pt[F+0],Q=Pt[F+1],H=Pt[F+2],Y=Pt[F+3],N=j+H>>1,$=Q+Y>>1,ie=N+$-Q,te=$+j-N,ae=Q*We+j,ge=Y*We+H,se=$*We+N,me=Math.hypot((Yt[2*ae+0]+Yt[2*ge+0])/2-Yt[2*se+0],(Yt[2*ae+1]+Yt[2*ge+1])/2-Yt[2*se+1])>=16;mt[se]=mt[se]||(me?1:0),B<1022&&(mt[se]=mt[se]||mt[(Q+te>>1)*We+(j+ie>>1)]||mt[(Y+te>>1)*We+(H+ie>>1)])}const I=new s.ay,C=new s.az;let D=0;function k(B,F){const j=F*We+B;return Ar[j]===0&&(I.emplaceBack(Yt[2*j+0],Yt[2*j+1],B*s.Y/tt,F*s.Y/tt),Ar[j]=++D),Ar[j]-1}function O(B,F,j,Q,H,Y){const N=B+j>>1,$=F+Q>>1;if(Math.abs(B-H)+Math.abs(F-Y)>1&&mt[$*We+N])O(H,Y,B,F,N,$),O(j,Q,H,Y,N,$);else{const ie=k(B,F),te=k(j,Q),ae=k(H,Y);C.emplaceBack(ie,te,ae)}}return O(0,0,tt,tt,tt,0),O(tt,tt,0,0,0,tt),{vertices:I,indices:C}}(this.tileID.canonical,o);d=_.vertices,p=_.indices}else{d=new s.ay,p=new s.az;for(const{x:y,y:b}of u)d.emplaceBack(y,b,0,0);const _=s.aT(d.int16,void 0,4);for(let y=0;y<_.length;y+=3)p.emplaceBack(_[y],_[y+1],_[y+2])}this._tileBoundsBuffer=i.createVertexBuffer(d,s.aU.members),this._tileBoundsIndexBuffer=i.createIndexBuffer(p),this._tileBoundsSegments=s.aE.simpleSegment(0,0,d.length,p.length)}_makeGlobeTileDebugBuffers(i,o){const u=o.projection;if(!u||u.name!=="globe"||o.freezeTileCoverage)return;const d=this.tileID.canonical,p=s.aV(d,o),_=s.aW(p),y=s.W(o.zoom);let b;y>0&&(b=s.a9.invert(new Float64Array(16),o.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(i,d,o,_,b,y),this._makeGlobeTileDebugTextBuffer(i,d,o,_,b,y)}_globePoint(i,o,u,d,p,_,y){let b=s.aX(i,o,u);if(_){const T=1<<u.z,E=s.a8(d.center.lng),I=s.ah(d.center.lat),C=(u.x+.5)/T-E;let D=0;C>.5?D=-1:C<-.5&&(D=1);let k=(i/s.Y+u.x)/T+D,O=(o/s.Y+u.y)/T;k=(k-E)*d._pixelsPerMercatorPixel+E,O=(O-I)*d._pixelsPerMercatorPixel+I;const B=[k*d.worldSize,O*d.worldSize,0];s.Q.transformMat4(B,B,_),b=s.aY(b,B,y)}return s.Q.transformMat4(b,b,p)}_makeGlobeTileDebugBorderBuffer(i,o,u,d,p,_){const y=new s.aQ,b=new s.aR,T=new s.aZ,E=(C,D,k,O,B)=>{const F=(k-C)/(B-1),j=(O-D)/(B-1),Q=y.length;for(let H=0;H<B;H++){const Y=C+H*F,N=D+H*j;y.emplaceBack(Y,N);const $=this._globePoint(Y,N,o,u,d,p,_);T.emplaceBack($[0],$[1],$[2]),b.emplaceBack(Q+H)}},I=s.Y;E(0,0,I,0,16),E(I,0,I,I,16),E(I,I,0,I,16),E(0,I,0,0,16),this._tileDebugIndexBuffer=i.createIndexBuffer(b),this._tileDebugBuffer=i.createVertexBuffer(y,s.aS.members),this._globeTileDebugBorderBuffer=i.createVertexBuffer(T,s.a_.members),this._tileDebugSegments=s.aE.simpleSegment(0,0,y.length,b.length)}_makeGlobeTileDebugTextBuffer(i,o,u,d,p,_){const y=s.Y/4,b=new s.aQ,T=new s.az,E=new s.aZ,I=25;T.reserve(32),b.reserve(I),E.reserve(I);const C=(D,k)=>I*D+k;for(let D=0;D<I;D++){const k=D*y;for(let O=0;O<I;O++){const B=O*y;b.emplaceBack(B,k);const F=this._globePoint(B,k,o,u,d,p,_);E.emplaceBack(F[0],F[1],F[2])}}for(let D=0;D<4;D++)for(let k=0;k<4;k++){const O=C(D,k),B=C(D,k+1),F=C(D+1,k),j=C(D+1,k+1);T.emplaceBack(O,B,F),T.emplaceBack(F,B,j)}this._tileDebugTextIndexBuffer=i.createIndexBuffer(T),this._tileDebugTextBuffer=i.createVertexBuffer(b,s.aS.members),this._globeTileDebugTextBuffer=i.createVertexBuffer(E,s.a_.members),this._tileDebugTextSegments=s.aE.simpleSegment(0,0,I,32)}destroy(i=!1){for(const o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!i&&this.texture&&this.texture instanceof s.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}const He={vector:Xe,raster:Ye,"raster-dem":class extends Ye{constructor(c,i,o,u){super(c,i,o,u),this.type="raster-dem",this.maxzoom=22,this._options=s.e({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox"}loadTile(c,i){const o=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function u(d,p){d&&(c.state="errored",i(d)),p&&(c.dem=p,c.dem.onDeserialize(),c.needsHillshadePrepare=!0,c.needsDEMTextureUpload=!0,c.state="loaded",i(null))}c.request=s.d(this.map._requestManager.transformRequest(o,s.R.Tile),(function(d,p,_,y){if(delete c.request,c.aborted)c.state="unloaded",i(null);else if(d)c.state="errored",i(d);else if(p){this.map._refreshExpiredTiles&&c.setExpiryData({cacheControl:_,expires:y});const b=ImageBitmap&&p instanceof ImageBitmap&&s.an(),T=1-(p.width-s.ao(p.width))/2;T<1||c.neighboringTiles||(c.neighboringTiles=this._getNeighboringTiles(c.tileID));const E=b?p:s.f.getImageData(p,T),I={uid:c.uid,coord:c.tileID,source:this.id,scope:this.scope,rawImageData:E,encoding:this.encoding,padding:T};c.actor&&c.state!=="expired"||(c.actor=this.dispatcher.getActor(),c.actor.send("loadDEMTile",I,u.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(c){const i=c.canonical,o=Math.pow(2,i.z),u=(i.x-1+o)%o,d=i.x===0?c.wrap-1:c.wrap,p=(i.x+1+o)%o,_=i.x+1===o?c.wrap+1:c.wrap,y={};return y[new s.ap(c.overscaledZ,d,i.z,u,i.y).key]={backfilled:!1},y[new s.ap(c.overscaledZ,_,i.z,p,i.y).key]={backfilled:!1},i.y>0&&(y[new s.ap(c.overscaledZ,d,i.z,u,i.y-1).key]={backfilled:!1},y[new s.ap(c.overscaledZ,c.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},y[new s.ap(c.overscaledZ,_,i.z,p,i.y-1).key]={backfilled:!1}),i.y+1<o&&(y[new s.ap(c.overscaledZ,d,i.z,u,i.y+1).key]={backfilled:!1},y[new s.ap(c.overscaledZ,c.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},y[new s.ap(c.overscaledZ,_,i.z,p,i.y+1).key]={backfilled:!1}),y}},"raster-array":$e,geojson:class extends s.E{constructor(c,i,o,u){super(),this.id=c,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=o.getActor(),this.setEventedParent(u),this._data=i.data,this._options=s.e({},i),this._collectResourceTiming=i.collectResourceTiming,i.maxzoom!==void 0&&(this.maxzoom=i.maxzoom),i.minzoom!==void 0&&(this.minzoom=i.minzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId;const d=s.Y/this.tileSize;this.workerOptions=s.e({source:this.id,scope:this.scope,cluster:i.cluster||!1,geojsonVtOptions:{buffer:(i.buffer!==void 0?i.buffer:128)*d,tolerance:(i.tolerance!==void 0?i.tolerance:.375)*d,extent:s.Y,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:i.clusterMaxZoom!==void 0?i.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,i.clusterMinPoints||2),extent:s.Y,radius:(i.clusterRadius!==void 0?i.clusterRadius:50)*d,log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter,dynamic:i.dynamic},i.workerOptions)}onAdd(c){this.map=c,this.setData(this._data)}setData(c){return this._data=c,this._updateWorkerData(),this}updateData(c){return this._options.dynamic?(this._data=c,this._updateWorkerData(!0),this):this.fire(new s.a(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")))}getClusterExpansionZoom(c,i){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:c,source:this.id,scope:this.scope},i),this}getClusterChildren(c,i){return this.actor.send("geojson.getClusterChildren",{clusterId:c,source:this.id,scope:this.scope},i),this}getClusterLeaves(c,i,o,u){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:c,limit:i,offset:o},u),this}_updateWorkerData(c=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new s.b("dataloading",{dataType:"source"})),this._loaded=!1;const i=s.e({append:c},this.workerOptions);i.scope=this.scope;const o=this._data;typeof o=="string"?(i.request=this.map._requestManager.transformRequest(s.f.resolveURL(o),s.R.Source),i.request.collectResourceTiming=this._collectResourceTiming):i.data=JSON.stringify(o),this._pendingLoad=this.actor.send(`${this.type}.loadData`,i,(u,d)=>{if(this._loaded=!0,this._pendingLoad=null,u)this.fire(new s.a(u));else{const p={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&d&&d.resourceTiming&&d.resourceTiming[this.id]&&(p.resourceTiming=d.resourceTiming[this.id]),this.fire(new s.b("data",p)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(c),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(c,i){const o=c.actor?"reloadTile":"loadTile";c.actor=this.actor;const u={type:this.type,uid:c.uid,tileID:c.tileID,tileZoom:c.tileZoom,zoom:c.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,scope:this.scope,pixelRatio:s.f.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0};c.request=this.actor.send(o,u,(d,p)=>(delete c.request,c.destroy(),c.aborted?i(null):d?i(d):(c.loadVectorData(p,this.map.painter,o==="reloadTile"),i(null))),void 0,o==="loadTile")}abortTile(c){c.request&&(c.request.cancel(),delete c.request),c.aborted=!0}unloadTile(c){this.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id,scope:this.scope}),c.destroy()}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return s.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends s.as{constructor(c,i,o,u){super(c,i,o,u),this.roundZoom=!0,this.type="video",this.options=i}load(){this._loaded=!1;const c=this.options;this.urls=[];for(const i of c.urls)this.urls.push(this.map._requestManager.transformRequest(i,s.R.Source).url);s.at(this.urls,(i,o)=>{this._loaded=!0,i?this.fire(new s.a(i)):o&&(this.video=o,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(c){if(this.video){const i=this.video.seekable;c<i.start(0)||c>i.end(0)?this.fire(new s.a(new s.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${i.start(0)} and ${i.end(0)}-second mark.`))):this.video.currentTime=c}}getVideo(){return this.video}onAdd(c){this.map||(this.map=c,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const c=this.map.painter.context,i=c.gl;this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new s.T(c,this.video,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(c)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:s.as,model:class extends s.E{constructor(c,i,o,u){super(),this.id=c,this.type="model",this.models=[],this._loaded=!1,this._options=i}load(){const c=[];for(const i in this._options.models){const o=this._options.models[i],u=s.l(this.map._requestManager.transformRequest(o.uri,s.R.Model).url).then(d=>{if(!d)return;const p=s.c(d),_=new s.M(i,o.position,o.orientation,p);_.computeBoundsAndApplyParent(),this.models.push(_)}).catch(d=>{this.fire(new s.a(new Error(`Could not load model ${i} from ${o.uri}: ${d.message}`)))});c.push(u)}return Promise.allSettled(c).then(()=>{this._loaded=!0,this.fire(new s.b("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(i=>{this.fire(new s.a(new Error(`Could not load models: ${i.message}`)))})}onAdd(c){this.map=c,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(c,i){}serialize(){return{type:"model"}}},"batched-model":class extends s.E{constructor(c,i,o,u){super(),this.type="batched-model",this.id=c,this.tileSize=512,this._options=i,this.tiles=this._options.tiles,this.maxzoom=i.maxzoom||19,this.minzoom=i.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=o,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(u)}onAdd(c){this.map=c,this.load()}load(c){this._loaded=!1,this.fire(new s.b("dataloading",{dataType:"source"}));const i=Array.isArray(this.map._language)?this.map._language.join():this.map._language,o=this.map._worldview;this._tileJSONRequest=Ge(this._options,this.map._requestManager,i,o,(u,d)=>{this._tileJSONRequest=null,this._loaded=!0,u?(i&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${i}`),o&&o.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${o}`),this.fire(new s.a(u))):d&&(s.e(this,d),d.bounds&&(this.tileBounds=new je(d.bounds,this.minzoom,this.maxzoom)),s.am(d.tiles,this.map._requestManager._customAccessToken),this.fire(new s.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.b("data",{dataType:"source",sourceDataType:"content"}))),c&&c(u)})}hasTransition(){return!1}hasTile(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)}loaded(){return this._loaded}loadTile(c,i){const o=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme)),u={request:this.map._requestManager.transformRequest(o,s.R.Tile),data:void 0,uid:c.uid,tileID:c.tileID,tileZoom:c.tileZoom,zoom:c.tileID.overscaledZ,tileSize:this.tileSize*c.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:c.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(c.actor&&c.state!=="expired")if(c.state==="loading")c.reloadCallback=i;else{if(c.buckets){const p=Object.values(c.buckets);for(const _ of p)_.dirty=!0;return void(c.state="loaded")}c.request=c.actor.send("reloadTile",u,d.bind(this))}else c.actor=this.dispatcher.getActor(),c.request=c.actor.send("loadTile",u,d.bind(this),void 0,!0);function d(p,_){return c.aborted?i(null):p&&p.status!==404?i(p):(_&&(_.resourceTiming&&(c.resourceTiming=_.resourceTiming),this.map._refreshExpiredTiles&&c.setExpiryData(_),c.buckets={...c.buckets,..._.buckets},_.featureIndex&&(c.latestFeatureIndex=_.featureIndex)),c.state="loaded",void i(null))}}serialize(){return s.e({},this._options)}},canvas:class extends s.as{constructor(c,i,o,u){super(c,i,o,u),i.coordinates?Array.isArray(i.coordinates)&&i.coordinates.length===4&&!i.coordinates.some(d=>!Array.isArray(d)||d.length!==2||d.some(p=>typeof p!="number"))||this.fire(new s.a(new s.V(`sources.${c}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.a(new s.V(`sources.${c}`,null,'missing required property "coordinates"'))),i.animate&&typeof i.animate!="boolean"&&this.fire(new s.a(new s.V(`sources.${c}`,null,'optional "animate" property must be a boolean value'))),i.canvas?typeof i.canvas=="string"||i.canvas instanceof HTMLCanvasElement||this.fire(new s.a(new s.V(`sources.${c}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.a(new s.V(`sources.${c}`,null,'missing required property "canvas"'))),this.options=i,this.animate=i.animate===void 0||i.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.a(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(c){this.map=c,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let c=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,c=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,c=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const i=this.map.painter.context;this.texture?!c&&!this._playing||this.texture instanceof s.au||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new s.T(i,this.canvas,i.gl.RGBA,{premultiply:!0}),this._prepareData(i)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const c of[this.canvas.width,this.canvas.height])if(isNaN(c)||c<=0)return!0;return!1}},custom:class extends s.E{constructor(c,i,o,u){super(),this.id=c,this.type="custom",this._dataType="raster",this._dispatcher=o,this._implementation=i,this.setEventedParent(u),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new s.a(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new s.a(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new je(this._implementation.bounds,this.minzoom,this.maxzoom)),i.update=this._update.bind(this),i.clearTiles=this._clearTiles.bind(this),i.coveringTiles=this._coveringTiles.bind(this),s.e(this,s.af(i,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return s.af(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new s.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.b("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(c){this._map=c,this._loaded=!1,this.fire(new s.b("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(c),this.load()}onRemove(c){this._implementation.onRemove&&this._implementation.onRemove(c)}hasTile(c){if(this._implementation.hasTile){const{x:i,y:o,z:u}=c.canonical;return this._implementation.hasTile({x:i,y:o,z:u})}return!this.tileBounds||this.tileBounds.contains(c.canonical)}loadTile(c,i){const{x:o,y:u,z:d}=c.tileID.canonical,p=new AbortController;c.request=Promise.resolve(this._implementation.loadTile({x:o,y:u,z:d},{signal:p.signal})).then((function(_){return delete c.request,c.aborted?(c.state="unloaded",i(null)):_===void 0?(c.state="errored",i(null)):_===null?(this.loadTileData(c,{width:this.tileSize,height:this.tileSize,data:null}),c.state="loaded",i(null)):function(y){return y instanceof ImageData||y instanceof HTMLCanvasElement||y instanceof ImageBitmap||y instanceof HTMLImageElement}(_)?(this.loadTileData(c,_),c.state="loaded",void i(null)):(c.state="errored",i(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(_=>{_.code!==20&&(c.state="errored",i(_))}),c.request.cancel=()=>p.abort()}loadTileData(c,i){c.setTexture(i,this._map.painter)}unloadTile(c,i){if(c.texture&&c.texture instanceof s.T?(c.destroy(!0),c.texture&&c.texture instanceof s.T&&this._map.painter.saveTileTexture(c.texture)):c.destroy(),this._implementation.unloadTile){const{x:o,y:u,z:d}=c.tileID.canonical;this._implementation.unloadTile({x:o,y:u,z:d})}i()}abortTile(c,i){c.request&&c.request.cancel&&(c.request.cancel(),delete c.request),i()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(c=>({x:c.canonical.x,y:c.canonical.y,z:c.canonical.z}))}_clearTiles(){const c=s.aj(this.id,this.scope);this._map.style.clearSource(c)}_update(){this.fire(new s.b("data",{dataType:"source",sourceDataType:"content"}))}}},xu=function(c,i,o,u){const d=new He[i.type](c,i,o,u);if(d.id!==c)throw new Error(`Expected Source id to be ${c} instead of ${d.id}`);return s.a$(["load","abort","unload","serialize","prepare"],d),d};function vu(c,i){const o=s.a9.identity([]);return s.a9.scale(o,o,[.5*c.width,.5*-c.height,1]),s.a9.translate(o,o,[1,-1,0]),s.a9.multiply(o,o,c.calculateProjMatrix(i.toUnwrapped())),Float32Array.from(o)}function er(c,i,o,u,d,p,_,y=!1){const b=c.tilesIn(u,_,y);b.sort(v1);const T=[];for(const I of b)T.push({wrappedTileID:I.tile.tileID.wrapped().key,queryResults:I.tile.queryRenderedFeatures(i,o,c._state,I,d,p,vu(c.transform,I.tile.tileID),y)});const E=function(I){const C={},D={};for(const k of I){const O=k.queryResults,B=k.wrappedTileID,F=D[B]=D[B]||{};for(const j in O){const Q=O[j],H=F[j]=F[j]||{},Y=C[j]=C[j]||[];for(const N of Q)H[N.featureIndex]||(H[N.featureIndex]=!0,Y.push(N))}}return C}(T);for(const I in E)E[I].forEach(C=>{const D=C.feature,k=D.layer;k&&k.type!=="background"&&k.type!=="sky"&&k.type!=="slot"&&(D.source=k.source,k["source-layer"]&&(D.sourceLayer=k["source-layer"]),D.state=D.id!==void 0?c.getFeatureState(k["source-layer"],D.id):{})});return E}function Zi(c,i){const o=c.getRenderableIds().map(p=>c.getTileByID(p)),u=[],d={};for(let p=0;p<o.length;p++){const _=o[p],y=_.tileID.canonical.key;d[y]||(d[y]=!0,_.querySourceFeatures(u,i))}return u}function v1(c,i){const o=c.tileID,u=i.tileID;return o.overscaledZ-u.overscaledZ||o.canonical.y-u.canonical.y||o.wrap-u.wrap||o.canonical.x-u.canonical.x}class Bl extends Mn{constructor(i,o,u,d,p){super(i,o,u,d,p),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(i,o){const u=o.context,d=u.gl;this.texture=this.texture||o.getTileTexture(i.width),this.texture&&this.texture instanceof s.T?this.texture.update(i,{useMipmap:!1,premultiply:!1}):this.texture=new s.T(u,i,d.RGBA,{useMipmap:!1,premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(i=16384,o){const u=this._mrt=new s.b0(30),d=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(i-1)}});return this.entireBuffer=null,this.request=s.b1(d,(p,_,y,b)=>{if(p)o(p);else try{const T=u.getHeaderLength(_);if(T>i)return void(this.request=this.fetchHeader(T,o));u.parseHeader(_),this._isHeaderLoaded=!0;let E=0;for(const I of Object.values(u.layers))E=Math.max(E,I.dataIndex[I.dataIndex.length-1].last_byte);_.byteLength>=E&&(this.entireBuffer=_),o(null,this.entireBuffer||_,y,b)}catch(T){o(T)}}),this.request}fetchBand(i,o,u){const d=this._mrt;if(!this._isHeaderLoaded||!d)return void u(new Error("Tile header is not ready"));const p=this.actor;if(!p)return void u(new Error("Can't fetch tile band without an actor"));let _;const y=(I,C)=>{_.complete(I,C),I?u(I):(this.updateTextureDescriptor(i,o),u(null,this.textureDescriptor&&this.textureDescriptor.img))},b=(I,C)=>{if(I)return u(I);const D=p.send("decodeRasterArray",{buffer:C,task:_},y,void 0,!0);this._workQueue.push(()=>{D&&D.cancel(),_.cancel()})},T=d.getLayer(i);if(!T)return void u(new Error(`Unknown sourceLayer "${i}"`));if(T.hasDataForBand(o))return this.updateTextureDescriptor(i,o),void u(null,this.textureDescriptor?this.textureDescriptor.img:null);const E=T.getDataRange([o]);if(_=d.createDecodingTask(E),!_||_.tasks.length)if(this.flushQueues(),this.entireBuffer)b(null,this.entireBuffer.slice(E.firstByte,E.lastByte+1));else{const I=Object.assign({},this.requestParams,{headers:{Range:`bytes=${E.firstByte}-${E.lastByte}`}}),C=s.b1(I,b);this._fetchQueue.push(()=>{C.cancel(),_.cancel()})}else u(null)}updateNeeded(i,o){return(!this.textureDescriptor||this.textureDescriptor.band!==o||this.textureDescriptor.layer!==i)&&this.state!=="errored"}updateTextureDescriptor(i,o){if(!this._mrt)return;const u=this._mrt.getLayer(i);if(!u||!u.hasBand(o)||!u.hasDataForBand(o))return;const{bytes:d,tileSize:p,buffer:_,offset:y,scale:b}=u.getBandView(o),T=p+2*_,E={data:d,width:T,height:T},I=this.texture;I&&I instanceof s.T&&I.update(E,{useMipmap:!1,premultiply:!1}),this.textureDescriptor={layer:i,band:o,img:E,buffer:_,offset:y,tileSize:p,format:u.pixelFormat,mix:[b,256*b,65536*b,16777216*b]}}}class b1{constructor(i,o){this.max=i,this.onRemove=o,this.reset()}reset(){for(const i in this.data)for(const o of this.data[i])o.timeout&&clearTimeout(o.timeout),this.onRemove(o.value);return this.data={},this.order=[],this}add(i,o,u){const d=i.wrapped().key;this.data[d]===void 0&&(this.data[d]=[]);const p={value:o,timeout:void 0};if(u!==void 0&&(p.timeout=setTimeout(()=>{this.remove(i,p)},u)),this.data[d].push(p),this.order.push(d),this.order.length>this.max){const _=this._getAndRemoveByKey(this.order[0]);_&&this.onRemove(_)}return this}has(i){return i.wrapped().key in this.data}getAndRemove(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null}_getAndRemoveByKey(i){const o=this.data[i].shift();return o.timeout&&clearTimeout(o.timeout),this.data[i].length===0&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),o.value}getByKey(i){const o=this.data[i];return o?o[0].value:null}get(i){return this.has(i)?this.data[i.wrapped().key][0].value:null}remove(i,o){if(!this.has(i))return this;const u=i.wrapped().key,d=o===void 0?0:this.data[u].indexOf(o),p=this.data[u][d];return this.data[u].splice(d,1),p.timeout&&clearTimeout(p.timeout),this.data[u].length===0&&delete this.data[u],this.onRemove(p.value),this.order.splice(this.order.indexOf(u),1),this}setMaxSize(i){for(this.max=i;this.order.length>this.max;){const o=this._getAndRemoveByKey(this.order[0]);o&&this.onRemove(o)}return this}filter(i){const o=[];for(const u in this.data)for(const d of this.data[u])i(d.value)||o.push(d);for(const u of o)this.remove(u.value.tileID,u)}}class In extends s.E{constructor(i,o,u){super(),this.id=i,this._onlySymbols=u,o.on("data",d=>{d.dataType==="source"&&d.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&d.dataType==="source"&&d.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),o.on("error",()=>{this._sourceErrored=!0}),this._source=o,this._tiles={},this._cache=new b1(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=o.minTileCacheSize,this._maxTileCacheSize=o.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Mi,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(i){this.map=i,this._minTileCacheSize=this._minTileCacheSize===void 0&&i?i._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&i?i._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const i in this._tiles){const o=this._tiles[i];if(o.state!=="errored"&&(o.state!=="loaded"||!o.bucketsLoaded()))return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const i=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,i&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(i,o){return i.isSymbolTile=this._onlySymbols,i.isExtraShadowCaster=this._shadowCasterTiles[i.tileID.key],this._source.loadTile(i,o)}_unloadTile(i){if(this._source.unloadTile)return this._source.unloadTile(i,()=>{})}_abortTile(i){if(this._source.abortTile)return this._source.abortTile(i,()=>{})}serialize(){return this._source.serialize()}prepare(i){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const o in this._tiles){const u=this._tiles[o];u.upload(i),u.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return s.b2(this._tiles).map(i=>i.tileID).sort(Ht).map(i=>i.key)}getRenderableIds(i,o){const u=[];for(const d in this._tiles)this._isIdRenderable(+d,i,o)&&u.push(this._tiles[d]);return i?u.sort((d,p)=>{const _=d.tileID,y=p.tileID,b=new s.P(_.canonical.x,_.canonical.y)._rotate(this.transform.angle),T=new s.P(y.canonical.x,y.canonical.y)._rotate(this.transform.angle);return _.overscaledZ-y.overscaledZ||T.y-b.y||T.x-b.x}).map(d=>d.tileID.key):u.map(d=>d.tileID).sort(Ht).map(d=>d.key)}hasRenderableParent(i){const o=this.findLoadedParent(i,0);return!!o&&this._isIdRenderable(o.tileID.key)}_isIdRenderable(i,o,u){return this._tiles[i]&&this._tiles[i].hasData()&&!this._coveredTiles[i]&&(o||!this._tiles[i].holdingForFade())&&(u||!this._shadowCasterTiles[i])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const i in this._tiles)this._tiles[i].state!=="errored"&&this._reloadTile(+i,"reloading")}}_reloadTile(i,o){const u=this._tiles[i];u&&(u.state!=="loading"&&(u.state=o),this._loadTile(u,this._tileLoaded.bind(this,u,i,o)))}_tileLoaded(i,o,u,d){if(d)if(i.state="errored",d.status!==404)this._source.fire(new s.a(d,{tile:i}));else{if(!(i.tileID.key in this._loadedParentTiles))return void this._source.fire(new s.b("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id}));if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const p=this.map.painter.terrain;this.update(this.transform,p.getScaledDemTileSize(),!0),p.resetTileLookupCache(this.id)}else this.update(this.transform)}else i.timeAdded=s.f.now(),u==="expired"&&(i.refreshedUponExpiration=!0),this._setTileReloadTimer(o,i),this._source.type==="raster-dem"&&i.dem&&this._backfillDEM(i),this._state.initializeTileState(i,this.map?this.map.painter:null),this._source.fire(new s.b("data",{dataType:"source",tile:i,coord:i.tileID,sourceCacheId:this.id}))}_backfillDEM(i){const o=this.getRenderableIds();for(let d=0;d<o.length;d++){const p=o[d];if(i.neighboringTiles&&i.neighboringTiles[p]){const _=this.getTileByID(p);u(i,_),u(_,i)}}function u(d,p){if(!d.dem||d.dem.borderReady)return;d.needsHillshadePrepare=!0,d.needsDEMTextureUpload=!0;let _=p.tileID.canonical.x-d.tileID.canonical.x;const y=p.tileID.canonical.y-d.tileID.canonical.y,b=Math.pow(2,d.tileID.canonical.z),T=p.tileID.key;_===0&&y===0||Math.abs(y)>1||(Math.abs(_)>1&&(Math.abs(_+b)===1?_+=b:Math.abs(_-b)===1&&(_-=b)),p.dem&&d.dem&&(d.dem.backfillBorder(p.dem,_,y),d.neighboringTiles&&d.neighboringTiles[T]&&(d.neighboringTiles[T].backfilled=!0)))}}getTile(i){return this.getTileByID(i.key)}getTileByID(i){return this._tiles[i]}_retainLoadedChildren(i,o,u,d){for(const p in this._tiles){let _=this._tiles[p];if(d[p]||!_.hasData()||_.tileID.overscaledZ<=o||_.tileID.overscaledZ>u)continue;let y=_.tileID;for(;_&&_.tileID.overscaledZ>o+1;){const T=_.tileID.scaledTo(_.tileID.overscaledZ-1);_=this._tiles[T.key],_&&_.hasData()&&(y=T)}let b=y;for(;b.overscaledZ>o;)if(b=b.scaledTo(b.overscaledZ-1),i[b.key]){d[y.key]=y;break}}}findLoadedParent(i,o){if(i.key in this._loadedParentTiles){const u=this._loadedParentTiles[i.key];return u&&u.tileID.overscaledZ>=o?u:null}for(let u=i.overscaledZ-1;u>=o;u--){const d=i.scaledTo(u),p=this._getLoadedTile(d);if(p)return p}}_getLoadedTile(i){const o=this._tiles[i.key];return o&&o.hasData()?o:this._cache.getByKey(this._source.reparseOverscaled?i.wrapped().key:i.canonical.key)}updateCacheSize(i,o){o=o||this._source.tileSize;const u=Math.ceil(i.width/o)+1,d=Math.ceil(i.height/o)+1,p=Math.floor(u*d*5),_=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,p):p,y=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,_):_;this._cache.setMaxSize(y)}handleWrapJump(i){const o=Math.round((i-(this._prevLng===void 0?i:this._prevLng))/360);if(this._prevLng=i,o){const u={};for(const d in this._tiles){const p=this._tiles[d];p.tileID=p.tileID.unwrapTo(p.tileID.wrap+o),u[p.tileID.key]=p}this._tiles=u;for(const d in this._timers)clearTimeout(this._timers[d]),delete this._timers[d];for(const d in this._tiles)this._setTileReloadTimer(+d,this._tiles[d])}}update(i,o,u,d){if(this.transform=i,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!u)return;let p;if(this.updateCacheSize(i,o),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={},this.used||this.usedForTerrain)if(this._source.tileID)p=i.getVisibleUnwrappedCoordinates(this._source.tileID).map(b=>new s.ap(b.canonical.z,b.wrap,b.canonical.z,b.canonical.x,b.canonical.y));else if(this.tileCoverLift!==0){const b=i.clone();b.tileCoverLift=this.tileCoverLift,p=b.coveringTiles({tileSize:o||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!u,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.minzoom<=1&&i.projection.name==="globe"&&(p.push(new s.ap(1,0,1,0,0)),p.push(new s.ap(1,0,1,1,0)),p.push(new s.ap(1,0,1,0,1)),p.push(new s.ap(1,0,1,1,1)))}else p=i.coveringTiles({tileSize:o||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!u,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(p=p.filter(b=>this._source.hasTile(b)));else p=[];if(p.length>0&&this.castsShadows&&d&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Ea(this._source.type)){const b=i.coveringZoomLevel({tileSize:o||this._source.tileSize,roundZoom:this._source.roundZoom&&!u}),T=Math.min(b,this._source.maxzoom),E=i.extendTileCoverForShadows(p,d,T);for(const I of E)this._shadowCasterTiles[I.key]=!0,p.push(I)}const _=this._updateRetainedTiles(p);if(Ea(this._source.type)&&p.length!==0){const b={},T={},E=Object.keys(_);for(const C of E){const D=_[C],k=this._tiles[C];if(!k||k.fadeEndTime&&k.fadeEndTime<=s.f.now())continue;const O=this.findLoadedParent(D,Math.max(D.overscaledZ-In.maxOverzooming,this._source.minzoom));O&&(this._addTile(O.tileID),b[O.tileID.key]=O.tileID),T[C]=D}const I=p[p.length-1].overscaledZ;for(const C in this._tiles){const D=this._tiles[C];if(_[C]||!D.hasData())continue;let k=D.tileID;for(;k.overscaledZ>I;){k=k.scaledTo(k.overscaledZ-1);const O=this._tiles[k.key];if(O&&O.hasData()&&T[k.key]){_[C]=D.tileID;break}}}for(const C in b)_[C]||(this._coveredTiles[C]=!0,_[C]=b[C])}for(const b in _)this._tiles[b].clearFadeHold();const y=s.b3(this._tiles,_);for(const b of y){const T=this._tiles[b];T.hasSymbolBuckets&&!T.holdingForFade()?T.setHoldDuration(this.map._fadeDuration):T.hasSymbolBuckets&&!T.symbolFadeFinished()||this._removeTile(+b)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const i in this._tiles)this._tiles[i].holdingForFade()&&this._removeTile(+i)}_updateRetainedTiles(i){const o={};if(i.length===0)return o;const u={},d=i.reduce((T,E)=>Math.min(T,E.overscaledZ),1/0),p=i[0].overscaledZ,_=Math.max(p-In.maxOverzooming,this._source.minzoom),y=Math.max(p+In.maxUnderzooming,this._source.minzoom),b={};for(const T of i){const E=this._addTile(T);o[T.key]=T,E.hasData()||d<this._source.maxzoom&&(b[T.key]=T)}this._retainLoadedChildren(b,d,y,o);for(const T of i){let E=this._tiles[T.key];if(E.hasData())continue;if(T.canonical.z>=this._source.maxzoom){const C=T.children(this._source.maxzoom)[0],D=this.getTile(C);if(D&&D.hasData()){o[C.key]=C;continue}}else{const C=T.children(this._source.maxzoom);if(o[C[0].key]&&o[C[1].key]&&o[C[2].key]&&o[C[3].key])continue}let I=E.wasRequested();for(let C=T.overscaledZ-1;C>=_;--C){const D=T.scaledTo(C);if(u[D.key]||(u[D.key]=!0,E=this.getTile(D),!E&&I&&(E=this._addTile(D)),E&&(o[D.key]=D,I=E.wasRequested(),E.hasData())))break}}return o}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const i in this._tiles){const o=[];let u,d=this._tiles[i].tileID;for(;d.overscaledZ>0;){if(d.key in this._loadedParentTiles){u=this._loadedParentTiles[d.key];break}o.push(d.key);const p=d.scaledTo(d.overscaledZ-1);if(u=this._getLoadedTile(p),u)break;d=p}for(const p of o)this._loadedParentTiles[p]=u}}_addTile(i){let o=this._tiles[i.key];if(o)return o.isExtraShadowCaster!==!0||this._shadowCasterTiles[i.key]||this._reloadTile(i.key,"reloading"),o;o=this._cache.getAndRemove(i),o&&(this._setTileReloadTimer(i.key,o),o.tileID=i,this._state.initializeTileState(o,this.map?this.map.painter:null),this._cacheTimers[i.key]&&(clearTimeout(this._cacheTimers[i.key]),delete this._cacheTimers[i.key],this._setTileReloadTimer(i.key,o)));const u=!!o;if(!u){const d=this.map?this.map.painter:null,p=this._source.tileSize*i.overscaleFactor();o=this._source.type==="raster-array"?new Bl(i,p,this.transform.tileZoom,d,this._isRaster):new Mn(i,p,this.transform.tileZoom,d,this._isRaster),this._loadTile(o,this._tileLoaded.bind(this,o,i.key,o.state))}return o?(o.uses++,this._tiles[i.key]=o,u||this._source.fire(new s.b("dataloading",{tile:o,coord:o.tileID,dataType:"source"})),o):null}_setTileReloadTimer(i,o){i in this._timers&&(clearTimeout(this._timers[i]),delete this._timers[i]);const u=o.getExpiryTimeout();u&&(this._timers[i]=setTimeout(()=>{this._reloadTile(i,"expired"),delete this._timers[i]},u))}_removeTile(i){const o=this._tiles[i];o&&(o.uses--,delete this._tiles[i],this._timers[i]&&(clearTimeout(this._timers[i]),delete this._timers[i]),o.uses>0||(o.hasData()&&o.state!=="reloading"||o.state==="empty"?this._cache.add(o.tileID,o,o.getExpiryTimeout()):(o.aborted=!0,this._abortTile(o),this._unloadTile(o))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const i in this._tiles)this._removeTile(+i);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(i,o,u){const d=[],p=this.transform;if(!p)return d;const _=p.projection.name==="globe",y=s.a8(p.center.lng);for(const b in this._tiles){const T=this._tiles[b];if(u&&T.clearQueryDebugViz(),T.holdingForFade())continue;let E;if(_){const I=T.tileID.canonical;if(I.z===0){const C=[Math.abs(s.ad(y,...eo(I,-1))-y),Math.abs(s.ad(y,...eo(I,1))-y)];E=[0,2*C.indexOf(Math.min(...C))-1]}else{const C=[Math.abs(s.ad(y,...eo(I,-1))-y),Math.abs(s.ad(y,...eo(I,0))-y),Math.abs(s.ad(y,...eo(I,1))-y)];E=[C.indexOf(Math.min(...C))-1]}}else E=[0];for(const I of E){const C=i.containsTile(T,p,o,I);C&&d.push(C)}}return d}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(i){return this._getRenderableCoordinates(i)}_getRenderableCoordinates(i,o){const u=this.getRenderableIds(i,o).map(p=>this._tiles[p].tileID),d=this.transform.projection.name==="globe";for(const p of u)p.projMatrix=this.transform.calculateProjMatrix(p.toUnwrapped()),p.expandedProjMatrix=d?this.transform.calculateProjMatrix(p.toUnwrapped(),!1,!0):p.projMatrix;return u}sortCoordinatesByDistance(i){const o=i.slice(),u=this.transform._camera.position,d=this.transform._camera.forward(),p={};for(const _ of o){const y=1/(1<<_.canonical.z);p[_.key]=((_.canonical.x+.5)*y+_.wrap-u[0])*d[0]+((_.canonical.y+.5)*y-u[1])*d[1]-u[2]*d[2]}return o.sort((_,y)=>p[_.key]-p[y.key]),o}hasTransition(){if(this._source.hasTransition())return!0;if(Ea(this._source.type))for(const i in this._tiles){const o=this._tiles[i];if(o.fadeEndTime!==void 0&&o.fadeEndTime>=s.f.now())return!0}return!1}setFeatureState(i,o,u){this._state.updateState(i=i||"_geojsonTileLayer",o,u)}removeFeatureState(i,o,u){this._state.removeFeatureState(i=i||"_geojsonTileLayer",o,u)}getFeatureState(i,o){return this._state.getState(i=i||"_geojsonTileLayer",o)}setDependencies(i,o,u){const d=this._tiles[i];d&&d.setDependencies(o,u)}reloadTilesForDependencies(i,o){for(const u in this._tiles)this._tiles[u].hasDependency(i,o)&&this._reloadTile(+u,"reloading");this._cache.filter(u=>!u.hasDependency(i,o))}_preloadTiles(i,o){if(!this._sourceLoaded){const b=()=>{this._sourceLoaded&&(this._source.off("data",b),this._preloadTiles(i,o))};return void this._source.on("data",b)}const u=new Map,d=Array.isArray(i)?i:[i],p=this.map.painter.terrain,_=this.usedForTerrain&&p?p.getScaledDemTileSize():this._source.tileSize;for(const b of d){const T=b.coveringTiles({tileSize:_,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const E of T)u.set(E.key,E);this.usedForTerrain&&b.updateElevation(!1)}const y=Array.from(u.values());s.b4(y,(b,T)=>{const E=new Mn(b,this._source.tileSize*b.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(E,I=>{this._source.type==="raster-dem"&&E.dem&&this._backfillDEM(E),T(I,E)})},o)}}function Ht(c,i){const o=Math.abs(2*c.wrap)-+(c.wrap<0),u=Math.abs(2*i.wrap)-+(i.wrap<0);return c.overscaledZ-i.overscaledZ||u-o||i.canonical.y-c.canonical.y||i.canonical.x-c.canonical.x}function Ea(c){return c==="raster"||c==="image"||c==="video"||c==="custom"}function eo(c,i){const o=1<<c.z;return[c.x/o+i,(c.x+1)/o+i]}In.maxOverzooming=10,In.maxUnderzooming=3;class bu{constructor(i){this.style=i,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const i=!1,o=!1;for(const u in this.style._mergedLayers){const d=this.style._mergedLayers[u];if(d.type==="fill-extrusion")this.layers.push({layer:d,visible:i,visibilityChanged:o});else if(d.type==="model"){const p=this.style.getLayerSource(d);p&&p.type==="batched-model"&&this.layers.push({layer:d,visible:i,visibilityChanged:o})}}}onNewFrame(i){this.layersGotHidden=!1;for(const o of this.layers){const u=o.layer;let d=!1;u.type==="fill-extrusion"?d=!u.isHidden(i)&&u.paint.get("fill-extrusion-opacity")>0:u.type==="model"&&(d=!u.isHidden(i)&&u.paint.get("model-opacity")>0),this.layersGotHidden=this.layersGotHidden||!d&&o.visible,o.visible=d}}updateZOffset(i,o){this.currentBuildingBuckets=[];for(const d of this.layers){const p=d.layer,_=this.style.getLayerSourceCache(p);let y=1;p.type==="fill-extrusion"&&(y=d.visible?p.paint.get("fill-extrusion-vertical-scale"):0);let b=_?_.getTile(o):null;if(!b&&_&&o.canonical.z>_.getSource().minzoom){let T=o.scaledTo(Math.min(_.getSource().maxzoom,o.overscaledZ-1));for(;T.overscaledZ>=_.getSource().minzoom&&(b=_.getTile(T),!b&&T.overscaledZ!==0);)T=T.scaledTo(T.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:b?b.getBucket(p):null,tileID:b?b.tileID:o,verticalScale:y})}i.hasAnyZOffset=!1;let u=!1;for(let d=0;d<i.symbolInstances.length;d++){const p=i.symbolInstances.get(d),_=p.zOffset,y=this._getHeightAtTileOffset(o,p.tileAnchorX,p.tileAnchorY);p.zOffset=y!==Number.NEGATIVE_INFINITY?y:_,u||_===p.zOffset||(u=!0),i.hasAnyZOffset||p.zOffset===0||(i.hasAnyZOffset=!0)}u&&(i.zOffsetBuffersNeedUpload=!0,i.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(i,o,u,d){let p=o,_=u;if(i.canonical.z!==d.canonical.z){const y=d.canonical,b=1/(1<<i.canonical.z-y.z);p=(o+i.canonical.x*s.Y)*b-y.x*s.Y|0,_=(u+i.canonical.y*s.Y)*b-y.y*s.Y|0}return{tileX:p,tileY:_}}_getHeightAtTileOffset(i,o,u){let d,p;for(let _=0;_<this.layers.length;++_){if(this.layers[_].layer.type!=="fill-extrusion")continue;const{bucket:y,tileID:b,verticalScale:T}=this.currentBuildingBuckets[_];if(!y)continue;const{tileX:E,tileY:I}=this._mapCoordToOverlappingTile(i,o,u,b),C=y.getHeightAtTileCoord(E,I);C&&C.height!==void 0&&(C.hidden?d=C.height:p=Math.max(C.height*T,p||0))}if(p!==void 0)return p;for(let _=0;_<this.layers.length;++_){const y=this.layers[_];if(y.layer.type!=="model"||!y.visible)continue;const{bucket:b,tileID:T}=this.currentBuildingBuckets[_];if(!b)continue;const{tileX:E,tileY:I}=this._mapCoordToOverlappingTile(i,o,u,T),C=b.getHeightAtTileCoord(E,I);if(C&&!C.hidden)return C.height===void 0&&d!==void 0?Math.min(C.maxHeight,d)*C.verticalScale:C.height?C.height*C.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function gn(c,i){const o={};for(const u in c)u!=="ref"&&(o[u]=c[u]);return s.b5.forEach(u=>{u in i&&(o[u]=i[u])}),o}function w1(c){c=c.slice();const i=Object.create(null);for(let o=0;o<c.length;o++)i[c[o].id]=c[o];for(let o=0;o<c.length;o++)"ref"in c[o]&&(c[o]=gn(c[o],i[c[o].ref]));return c}const ar={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function Fl(c,i,o){o.push({command:ar.addSource,args:[c,i[c]]})}function wu(c,i,o){i.push({command:ar.removeSource,args:[c]}),o[c]=!0}function T1(c,i,o,u){wu(c,o,u),Fl(c,i,o)}function Tu(c,i,o){let u;for(u in c[o])if(c[o].hasOwnProperty(u)&&u!=="data"&&!ze(c[o][u],i[o][u]))return!1;for(u in i[o])if(i[o].hasOwnProperty(u)&&u!=="data"&&!ze(c[o][u],i[o][u]))return!1;return!0}function Wo(c,i,o,u,d,p){let _;for(_ in i=i||{},c=c||{})c.hasOwnProperty(_)&&(ze(c[_],i[_])||o.push({command:p,args:[u,_,i[_],d]}));for(_ in i)i.hasOwnProperty(_)&&!c.hasOwnProperty(_)&&(ze(c[_],i[_])||o.push({command:p,args:[u,_,i[_],d]}))}function Ss(c){return c.id}function Aa(c,i){return c[i.id]=i,c}class to{constructor(i,o){this.reset(i,o)}reset(i,o){this.points=i||[],this._distances=[0];for(let u=1;u<this.points.length;u++)this._distances[u]=this._distances[u-1]+this.points[u].dist(this.points[u-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(o||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(i){if(this.points.length===1)return this.points[0];i=s.ad(i,0,1);let o=1,u=this._distances[o];const d=i*this.paddedLength+this.padding;for(;u<d&&o<this._distances.length;)u=this._distances[++o];const p=o-1,_=this._distances[p],y=u-_,b=y>0?(d-_)/y:0;return this.points[p].mult(1-b).add(this.points[o].mult(b))}}class Su{constructor(i,o,u){const d=this.boxCells=[],p=this.circleCells=[];this.xCellCount=Math.ceil(i/u),this.yCellCount=Math.ceil(o/u);for(let _=0;_<this.xCellCount*this.yCellCount;_++)d.push([]),p.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=i,this.height=o,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/o,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(i,o,u,d,p){this._forEachCell(o,u,d,p,this._insertBoxCell,this.boxUid++),this.boxKeys.push(i),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(d),this.bboxes.push(p)}insertCircle(i,o,u,d){this._forEachCell(o-d,u-d,o+d,u+d,this._insertCircleCell,this.circleUid++),this.circleKeys.push(i),this.circles.push(o),this.circles.push(u),this.circles.push(d)}_insertBoxCell(i,o,u,d,p,_){this.boxCells[p].push(_)}_insertCircleCell(i,o,u,d,p,_){this.circleCells[p].push(_)}_query(i,o,u,d,p,_){if(u<0||i>this.width||d<0||o>this.height)return!p&&[];const y=[];if(i<=0&&o<=0&&this.width<=u&&this.height<=d){if(p)return!0;for(let b=0;b<this.boxKeys.length;b++)y.push({key:this.boxKeys[b],x1:this.bboxes[4*b],y1:this.bboxes[4*b+1],x2:this.bboxes[4*b+2],y2:this.bboxes[4*b+3]});for(let b=0;b<this.circleKeys.length;b++){const T=this.circles[3*b],E=this.circles[3*b+1],I=this.circles[3*b+2];y.push({key:this.circleKeys[b],x1:T-I,y1:E-I,x2:T+I,y2:E+I})}return _?y.filter(_):y}return this._forEachCell(i,o,u,d,this._queryCell,y,{hitTest:p,seenUids:{box:{},circle:{}}},_),p?y.length>0:y}_queryCircle(i,o,u,d,p){const _=i-u,y=i+u,b=o-u,T=o+u;if(y<0||_>this.width||T<0||b>this.height)return!d&&[];const E=[];return this._forEachCell(_,b,y,T,this._queryCellCircle,E,{hitTest:d,circle:{x:i,y:o,radius:u},seenUids:{box:{},circle:{}}},p),d?E.length>0:E}query(i,o,u,d,p){return this._query(i,o,u,d,!1,p)}hitTest(i,o,u,d,p){return this._query(i,o,u,d,!0,p)}hitTestCircle(i,o,u,d){return this._queryCircle(i,o,u,!0,d)}_queryCell(i,o,u,d,p,_,y,b){const T=y.seenUids,E=this.boxCells[p];if(E!==null){const C=this.bboxes;for(const D of E)if(!T.box[D]){T.box[D]=!0;const k=4*D;if(i<=C[k+2]&&o<=C[k+3]&&u>=C[k+0]&&d>=C[k+1]&&(!b||b(this.boxKeys[D]))){if(y.hitTest)return _.push(!0),!0;_.push({key:this.boxKeys[D],x1:C[k],y1:C[k+1],x2:C[k+2],y2:C[k+3]})}}}const I=this.circleCells[p];if(I!==null){const C=this.circles;for(const D of I)if(!T.circle[D]){T.circle[D]=!0;const k=3*D;if(this._circleAndRectCollide(C[k],C[k+1],C[k+2],i,o,u,d)&&(!b||b(this.circleKeys[D]))){if(y.hitTest)return _.push(!0),!0;{const O=C[k],B=C[k+1],F=C[k+2];_.push({key:this.circleKeys[D],x1:O-F,y1:B-F,x2:O+F,y2:B+F})}}}}}_queryCellCircle(i,o,u,d,p,_,y,b){const T=y.circle,E=y.seenUids,I=this.boxCells[p];if(I!==null){const D=this.bboxes;for(const k of I)if(!E.box[k]){E.box[k]=!0;const O=4*k;if(this._circleAndRectCollide(T.x,T.y,T.radius,D[O+0],D[O+1],D[O+2],D[O+3])&&(!b||b(this.boxKeys[k])))return _.push(!0),!0}}const C=this.circleCells[p];if(C!==null){const D=this.circles;for(const k of C)if(!E.circle[k]){E.circle[k]=!0;const O=3*k;if(this._circlesCollide(D[O],D[O+1],D[O+2],T.x,T.y,T.radius)&&(!b||b(this.circleKeys[k])))return _.push(!0),!0}}}_forEachCell(i,o,u,d,p,_,y,b){const T=this._convertToXCellCoord(i),E=this._convertToYCellCoord(o),I=this._convertToXCellCoord(u),C=this._convertToYCellCoord(d);for(let D=T;D<=I;D++)for(let k=E;k<=C;k++)if(p.call(this,i,o,u,d,this.xCellCount*k+D,_,y,b))return}_convertToXCellCoord(i){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(i*this.xScale)))}_convertToYCellCoord(i){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(i*this.yScale)))}_circlesCollide(i,o,u,d,p,_){const y=d-i,b=p-o,T=u+_;return T*T>y*y+b*b}_circleAndRectCollide(i,o,u,d,p,_,y){const b=(_-d)/2,T=Math.abs(i-(d+b));if(T>b+u)return!1;const E=(y-p)/2,I=Math.abs(o-(p+E));if(I>E+u)return!1;if(T<=b||I<=E)return!0;const C=T-b,D=I-E;return C*C+D*D<=u*u}}const Qr={unknown:0,flipRequired:1,flipNotRequired:2},To=Math.tan(85*Math.PI/180);function Ma(c,i,o,u,d,p,_){const y=s.a9.create();if(o)if(p.name==="globe"){const b=s.b6(d,i);s.a9.multiply(y,y,b)}else{const b=s.b7.invert([],_);y[0]=b[0],y[1]=b[1],y[4]=b[2],y[5]=b[3],u||s.a9.rotateZ(y,y,d.angle)}else s.a9.multiply(y,d.labelPlaneMatrix,c);return y}function Ia(c,i,o,u,d,p,_){const y=Ma(c,i,o,u,d,p,_);return p.name==="globe"&&o||(y[2]=y[6]=y[10]=y[14]=0),y}function ro(c,i,o,u,d,p,_){if(o){if(p.name==="globe"){const y=Ma(c,i,o,u,d,p,_);return s.a9.invert(y,y),s.a9.multiply(y,c,y),y}{const y=s.a9.clone(c),b=s.a9.identity([]);return b[0]=_[0],b[1]=_[1],b[4]=_[2],b[5]=_[3],s.a9.multiply(y,y,b),u||s.a9.rotateZ(y,y,-d.angle),y}}return d.glCoordMatrix}function cn(c,i,o,u){const d=[c,i,o,1];o?s.aa.transformMat4(d,d,u):Au(d,d,u);const p=d[3];return d[0]/=p,d[1]/=p,d[2]/=p,d}function Nl(c,i){return Math.min(.5+c/i*.5,1.5)}function Vl(c,i){const o=c[0]/c[3],u=c[1]/c[3];return o>=-i[0]&&o<=i[0]&&u>=-i[1]&&u<=i[1]}function Ul(c,i,o,u,d,p,_,y,b,T){const E=o.transform,I=u?c.textSizeData:c.iconSizeData,C=s.b8(I,o.transform.zoom),D=E.projection.name==="globe",k=[256/o.width*2+1,256/o.height*2+1],O=u?c.text.dynamicLayoutVertexArray:c.icon.dynamicLayoutVertexArray;O.clear();let B=null;D&&(B=u?c.text.globeExtVertexArray:c.icon.globeExtVertexArray);const F=c.lineVertexArray,j=u?c.text.placedSymbolArray:c.icon.placedSymbolArray,Q=o.transform.width/o.transform.height;let H,Y=!1;for(let N=0;N<j.length;N++){const $=j.get(N),{numGlyphs:ie,writingMode:te}=$;if(te!==s.b9.vertical||Y||H===s.b9.horizontal||(Y=!0),H=te,($.hidden||te===s.b9.vertical)&&!Y){Qo(ie,O);continue}Y=!1;const ae=new s.P($.tileAnchorX,$.tileAnchorY);let{x:ge,y:se,z:me}=E.projection.projectTilePoint(ae.x,ae.y,T.canonical);if(b){const[Je,st,_t]=b(ae);ge+=Je,se+=st,me+=_t}const xe=[ge,se,me,1];if(s.aa.transformMat4(xe,xe,i),!Vl(xe,k)){Qo(ie,O);continue}const oe=xe[3],fe=Nl(o.transform.getCameraToCenterDistance(E.projection),oe),Re=s.ba(I,C,$),ue=_?Re/fe:Re*fe,_e=cn(ge,se,me,d);if(_e[3]<=0){Qo(ie,O);continue}let ye={};const X=_?null:b,Ee=Es($,ue,!1,y,i,d,p,c.glyphOffsetArray,F,O,B,_e,ae,ye,Q,X,E.projection,T,_);Y=Ee.useVertical,X&&Ee.needsFlipping&&(ye={}),(Ee.notEnoughRoom||Y||Ee.needsFlipping&&Es($,ue,!0,y,i,d,p,c.glyphOffsetArray,F,O,B,_e,ae,ye,Q,X,E.projection,T,_).notEnoughRoom)&&Qo(ie,O)}u?(c.text.dynamicLayoutVertexBuffer.updateData(O),B&&c.text.globeExtVertexBuffer&&c.text.globeExtVertexBuffer.updateData(B)):(c.icon.dynamicLayoutVertexBuffer.updateData(O),B&&c.icon.globeExtVertexBuffer&&c.icon.globeExtVertexBuffer.updateData(B))}function Pa(c,i,o,u,d,p,_,y,b,T,E,I,C,D,k,O){const{lineStartIndex:B,glyphStartIndex:F,segment:j}=y,Q=F+y.numGlyphs,H=B+y.lineLength,Y=i.getoffsetX(F),N=i.getoffsetX(Q-1),$=Ho(c*Y,o,u,d,p,_,j,B,H,b,T,E,I,C,!0,D,k,O);if(!$)return null;const ie=Ho(c*N,o,u,d,p,_,j,B,H,b,T,E,I,C,!0,D,k,O);return ie?{first:$,last:ie}:null}function So(c,i,o,u){return c===s.b9.horizontal&&Math.abs(u)>Math.abs(o)?{useVertical:!0}:c===s.b9.vertical?u>0?{needsFlipping:!0}:null:i!==Qr.unknown&&function(d,p){return d===0||Math.abs(p/d)>To}(o,u)?i===Qr.flipRequired?{needsFlipping:!0}:null:o<0?{needsFlipping:!0}:null}function Es(c,i,o,u,d,p,_,y,b,T,E,I,C,D,k,O,B,F,j){const Q=i/24,H=c.lineOffsetX*Q,Y=c.lineOffsetY*Q,{lineStartIndex:N,glyphStartIndex:$,numGlyphs:ie,segment:te,writingMode:ae,flipState:ge}=c,se=N+c.lineLength,me=xe=>{if(E){const[ue,_e,ye]=xe.up,X=T.length;s.bb(E,X+0,ue,_e,ye),s.bb(E,X+1,ue,_e,ye),s.bb(E,X+2,ue,_e,ye),s.bb(E,X+3,ue,_e,ye)}const[oe,fe,Re]=xe.point;s.bc(T,oe,fe,Re,xe.angle)};if(ie>1){const xe=Pa(Q,y,H,Y,o,I,C,c,b,p,D,O,!1,B,F,j);if(!xe)return{notEnoughRoom:!0};if(u&&!o){let[oe,fe,Re]=xe.first.point,[ue,_e,ye]=xe.last.point;[oe,fe]=cn(oe,fe,Re,_),[ue,_e]=cn(ue,_e,ye,_);const X=So(ae,ge,(ue-oe)*k,_e-fe);if(c.flipState=X&&X.needsFlipping?Qr.flipRequired:Qr.flipNotRequired,X)return X}me(xe.first);for(let oe=$+1;oe<$+ie-1;oe++){const fe=Ho(Q*y.getoffsetX(oe),H,Y,o,I,C,te,N,se,b,p,D,O,!1,!1,B,F,j);if(!fe)return T.length-=4*(oe-$),{notEnoughRoom:!0};me(fe)}me(xe.last)}else{if(u&&!o){const oe=cn(C.x,C.y,0,d),fe=N+te+1,Re=new s.P(b.getx(fe),b.gety(fe)),ue=cn(Re.x,Re.y,0,d),_e=ue[3]>0?ue:Eu(C,Re,oe,1,d,void 0,B,F.canonical),ye=So(ae,ge,(_e[0]-oe[0])*k,_e[1]-oe[1]);if(c.flipState=ye&&ye.needsFlipping?Qr.flipRequired:Qr.flipNotRequired,ye)return ye}const xe=Ho(Q*y.getoffsetX($),H,Y,o,I,C,te,N,se,b,p,D,O,!1,!1,B,F,j);if(!xe)return{notEnoughRoom:!0};me(xe)}return{}}function jl(c,i,o,u,d){const{x:p,y:_,z:y}=u.projectTilePoint(c.x,c.y,i);if(!d)return cn(p,_,y,o);const[b,T,E]=d(c);return cn(p+b,_+T,y+E,o)}function Eu(c,i,o,u,d,p,_,y){const b=jl(c.sub(i)._unit()._add(c),y,d,_,p);return s.Q.sub(b,o,b),s.Q.normalize(b,b),s.Q.scaleAndAdd(b,o,b,u)}function Ho(c,i,o,u,d,p,_,y,b,T,E,I,C,D,k,O,B,F){const j=u?c-i:c+i;let Q=j>0?1:-1,H=0;u&&(Q*=-1,H=Math.PI),Q<0&&(H+=Math.PI);let Y=y+_+(Q>0?0:1)|0,N=d,$=d,ie=0,te=0;const ae=Math.abs(j),ge=[],se=[];let me=p,xe=me;const oe=()=>Eu(xe,me,$,ae-ie+1,E,C,O,B.canonical);for(;ie+te<=ae;){if(Y+=Q,Y<y||Y>=b)return null;if($=N,xe=me,ge.push($),D&&se.push(xe),me=new s.P(T.getx(Y),T.gety(Y)),N=I[Y],!N){const st=jl(me,B.canonical,E,O,C);N=st[3]>0?I[Y]=st:oe()}ie+=te,te=s.Q.distance($,N)}k&&C&&(I[Y]&&(N=oe(),te=s.Q.distance($,N)),I[Y]=N);const fe=(ae-ie)/te,Re=me.sub(xe)._mult(fe)._add(xe),ue=s.Q.sub([],N,$),_e=s.Q.scaleAndAdd([],$,ue,fe);let ye=[0,0,1],X=ue[0],Ee=ue[1];if(F&&(ye=O.upVector(B.canonical,Re.x,Re.y),ye[0]!==0||ye[1]!==0||ye[2]!==1)){const st=[ye[2],0,-ye[0]],_t=s.Q.cross([],ye,st);s.Q.normalize(st,st),s.Q.normalize(_t,_t),X=s.Q.dot(ue,st),Ee=s.Q.dot(ue,_t)}if(o){const st=s.Q.cross([],ye,ue);s.Q.normalize(st,st),s.Q.scaleAndAdd(_e,_e,st,o*Q)}const Je=H+Math.atan2(Ee,X);return ge.push(_e),D&&se.push(Re),{point:_e,angle:Je,path:ge,tilePath:se,up:ye}}function Qo(c,i){const o=i.length,u=o+4*c;i.resize(u),i.float32.fill(-1/0,4*o,4*u)}function Au(c,i,o){const u=i[0],d=i[1];return c[0]=o[0]*u+o[4]*d+o[12],c[1]=o[1]*u+o[5]*d+o[13],c[3]=o[3]*u+o[7]*d+o[15],c}const Pn=100;class S1{constructor(i,o,u=new Su(i.width+200,i.height+200,25),d=new Su(i.width+200,i.height+200,25)){this.transform=i,this.grid=u,this.ignoredGrid=d,this.pitchfactor=Math.cos(i._pitch)*i.cameraToCenterDistance,this.screenRightBoundary=i.width+Pn,this.screenBottomBoundary=i.height+Pn,this.gridRightBoundary=i.width+200,this.gridBottomBoundary=i.height+200,this.fogState=o}placeCollisionBox(i,o,u,d,p,_,y,b){let T=u.projectedAnchorX,E=u.projectedAnchorY,I=u.projectedAnchorZ;const C=u.elevation,D=u.tileID,k=i.getProjection();if(C&&D){const[N,$,ie]=k.upVector(D.canonical,u.tileAnchorX,u.tileAnchorY),te=k.upVectorScale(D.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;T+=N*C*te,E+=$*C*te,I+=ie*C*te}const O=this.projectAndGetPerspectiveRatio(y,T,E,I,u.tileID,k.name==="globe"||!!C||this.transform.pitch>0,k),B=_*O.perspectiveRatio,F=(u.x1*o+d.x-u.padding)*B+O.point.x,j=(u.y1*o+d.y-u.padding)*B+O.point.y,Q=(u.x2*o+d.x+u.padding)*B+O.point.x,H=(u.y2*o+d.y+u.padding)*B+O.point.y,Y=O.perspectiveRatio<=.55||O.occluded;return!this.isInsideGrid(F,j,Q,H)||!p&&this.grid.hitTest(F,j,Q,H,b)||Y?{box:[],offscreen:!1,occluded:O.occluded}:{box:[F,j,Q,H],offscreen:this.isOffscreen(F,j,Q,H),occluded:!1}}placeCollisionCircles(i,o,u,d,p,_,y,b,T,E,I,C,D,k,O){const B=[],F=this.transform.elevation,j=i.getProjection(),Q=F?F.getAtTileOffsetFunc(O,this.transform.center.lat,this.transform.worldSize,j):null,H=new s.P(u.tileAnchorX,u.tileAnchorY);let{x:Y,y:N,z:$}=j.projectTilePoint(H.x,H.y,O.canonical);if(Q){const[Re,ue,_e]=Q(H);Y+=Re,N+=ue,$+=_e}const ie=j.name==="globe",te=this.projectAndGetPerspectiveRatio(y,Y,N,$,O,ie||!!F||this.transform.pitch>0,j),{perspectiveRatio:ae}=te,ge=(I?_/ae:_*ae)/s.bf,se=cn(Y,N,$,b),me=te.signedDistanceFromCamera>0?Pa(ge,p,u.lineOffsetX*ge,u.lineOffsetY*ge,!1,se,H,u,d,b,{},F&&!I?Q:null,I&&!!F,j,O,I):null;let xe=!1,oe=!1,fe=!0;if(me&&!te.occluded){const Re=.5*D*ae+k,ue=new s.P(-100,-100),_e=new s.P(this.screenRightBoundary,this.screenBottomBoundary),ye=new to,{first:X,last:Ee}=me,Je=X.path.length;let st=[];for(let xt=Je-1;xt>=1;xt--)st.push(X.path[xt]);for(let xt=1;xt<Ee.path.length;xt++)st.push(Ee.path[xt]);const _t=2.5*Re;T&&(st=st.map(([xt,Qt,Ct],Jt)=>(Q&&!ie&&(Ct=Q(Jt<Je-1?X.tilePath[Je-1-Jt]:Ee.tilePath[Jt-Je+2])[2]),cn(xt,Qt,Ct,T))),st.some(xt=>xt[3]<=0)&&(st=[]));let ht=[];if(st.length>0){let xt=1/0,Qt=-1/0,Ct=1/0,Jt=-1/0;for(const Xt of st)xt=Math.min(xt,Xt[0]),Ct=Math.min(Ct,Xt[1]),Qt=Math.max(Qt,Xt[0]),Jt=Math.max(Jt,Xt[1]);Qt>=ue.x&&xt<=_e.x&&Jt>=ue.y&&Ct<=_e.y&&(ht=[st.map(Xt=>new s.P(Xt[0],Xt[1]))],(xt<ue.x||Qt>_e.x||Ct<ue.y||Jt>_e.y)&&(ht=s.bd(ht,ue.x,ue.y,_e.x,_e.y)))}for(const xt of ht){ye.reset(xt,.25*Re);let Qt=0;Qt=ye.length<=.5*Re?1:Math.ceil(ye.paddedLength/_t)+1;for(let Ct=0;Ct<Qt;Ct++){const Jt=Ct/Math.max(Qt-1,1),Xt=ye.lerp(Jt),Ur=Xt.x+Pn,yr=Xt.y+Pn;B.push(Ur,yr,Re,0);const hi=Ur-Re,ii=yr-Re,Mr=Ur+Re,xr=yr+Re;if(fe=fe&&this.isOffscreen(hi,ii,Mr,xr),oe=oe||this.isInsideGrid(hi,ii,Mr,xr),!o&&this.grid.hitTestCircle(Ur,yr,Re,C)&&(xe=!0,!E))return{circles:[],offscreen:!1,collisionDetected:xe,occluded:!1}}}}return{circles:!E&&xe||!oe?[]:B,offscreen:fe,collisionDetected:xe,occluded:te.occluded}}queryRenderedSymbols(i){if(i.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const o=[];let u=1/0,d=1/0,p=-1/0,_=-1/0;for(const E of i){const I=new s.P(E.x+Pn,E.y+Pn);u=Math.min(u,I.x),d=Math.min(d,I.y),p=Math.max(p,I.x),_=Math.max(_,I.y),o.push(I)}const y=this.grid.query(u,d,p,_).concat(this.ignoredGrid.query(u,d,p,_)),b={},T={};for(const E of y){const I=E.key;if(b[I.bucketInstanceId]===void 0&&(b[I.bucketInstanceId]={}),b[I.bucketInstanceId][I.featureIndex])continue;const C=[new s.P(E.x1,E.y1),new s.P(E.x2,E.y1),new s.P(E.x2,E.y2),new s.P(E.x1,E.y2)];s.be(o,C)&&(b[I.bucketInstanceId][I.featureIndex]=!0,T[I.bucketInstanceId]===void 0&&(T[I.bucketInstanceId]=[]),T[I.bucketInstanceId].push(I.featureIndex))}return T}insertCollisionBox(i,o,u,d,p){(o?this.ignoredGrid:this.grid).insert({bucketInstanceId:u,featureIndex:d,collisionGroupID:p},i[0],i[1],i[2],i[3])}insertCollisionCircles(i,o,u,d,p){const _=o?this.ignoredGrid:this.grid,y={bucketInstanceId:u,featureIndex:d,collisionGroupID:p};for(let b=0;b<i.length;b+=4)_.insertCircle(y,i[b],i[b+1],i[b+2])}projectAndGetPerspectiveRatio(i,o,u,d,p,_,y){const b=[o,u,d,1];let T=!1;d||this.transform.pitch>0?(s.aa.transformMat4(b,b,i),this.fogState&&p&&y.name!=="globe"&&(T=function(C,D,k,O,B,F){const j=F.calculateFogTileMatrix(B),Q=[D,k,O];return s.Q.transformMat4(Q,Q,j),mr(C,s.Q.length(Q),F.pitch,F._fov)}(this.fogState,o,u,d,p.toUnwrapped(),this.transform)>.9)):Au(b,b,i);const E=b[3];return{point:new s.P((b[0]/E+1)/2*this.transform.width+Pn,(-b[1]/E+1)/2*this.transform.height+Pn),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(y)/E*.5,1.5),signedDistanceFromCamera:E,occluded:_&&b[2]>E||T}}isOffscreen(i,o,u,d){return u<Pn||i>=this.screenRightBoundary||d<Pn||o>this.screenBottomBoundary}isInsideGrid(i,o,u,d){return u>=0&&i<this.gridRightBoundary&&d>=0&&o<this.gridBottomBoundary}getViewportMatrix(){const i=s.a9.identity([]);return s.a9.translate(i,i,[-100,-100,0]),i}}function Gl(c,i,o){const u=i.createTileMatrix(c,c.worldSize,o.toUnwrapped());return s.a9.multiply(new Float32Array(16),c.projMatrix,u)}function jn(c,i,o){if(i.projection.name===o.projection.name)return c.projMatrix;const u=o.clone();return u.setProjection(i.projection),Gl(u,i.getProjection(),c)}function $l(c,i,o){return i.name===o.projection.name?c.projMatrix:Gl(o,i,c)}class ql{constructor(i,o,u,d){this.opacity=i?Math.max(0,Math.min(1,i.opacity+(i.placed?o:-o))):d&&u?1:0,this.placed=u}isHidden(){return this.opacity===0&&!this.placed}}class As{constructor(i,o,u,d,p,_=!1){this.text=new ql(i?i.text:null,o,u,p),this.icon=new ql(i?i.icon:null,o,d,p),this.clipped=_}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Zl{constructor(i,o,u,d=!1){this.text=i,this.icon=o,this.skipFade=u,this.clipped=d}}class E1{constructor(){this.invProjMatrix=s.a9.create(),this.viewportMatrix=s.a9.create(),this.circles=[]}}class io{constructor(i,o,u,d,p){this.bucketInstanceId=i,this.featureIndex=o,this.sourceLayerIndex=u,this.bucketIndex=d,this.tileID=p}}class Wl{constructor(i){this.crossSourceCollisions=i,this.maxGroupID=0,this.collisionGroups={}}get(i){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[i]){const o=++this.maxGroupID;this.collisionGroups[i]={ID:o,predicate:u=>u.collisionGroupID===o}}return this.collisionGroups[i]}}function Mu(c,i,o,u,d){const{horizontalAlign:p,verticalAlign:_}=s.bi(c),y=-(p-.5)*i,b=-(_-.5)*o,T=s.bh(c,u);return new s.P(y+T[0]*d,b+T[1]*d)}function Ms(c,i,o,u,d){const p=new s.P(c,i);return o&&p._rotate(u?d:-d),p}class Iu{constructor(i,o,u,d,p,_){this.transform=i.clone(),this.projection=i.projection.name,this.collisionIndex=new S1(this.transform,p),this.buildingIndex=_,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=o,this.retainedQueryData={},this.collisionGroups=new Wl(u),this.collisionCircleArrays={},this.prevPlacement=d,d&&(d.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(i,o,u,d){const p=u.getBucket(o),_=u.latestFeatureIndex;if(!p||!_||o.fqid!==p.layerIds[0])return;const y=p.layers[0].layout,b=u.collisionBoxArray,T=Math.pow(2,this.transform.zoom-u.tileID.overscaledZ),E=u.tileSize/s.Y,I=u.tileID.toUnwrapped();this.transform.setProjection(p.projection);const C=(D=u.tileID,k=p.getProjection(),O=this.transform,k.name===this.projection?O.calculateProjMatrix(D.toUnwrapped()):Gl(O,k,D));var D,k,O;const B=y.get("text-pitch-alignment")==="map",F=y.get("text-rotation-alignment")==="map";o.compileFilter();const j=o.dynamicFilter(),Q=o.dynamicFilterNeedsFeature(),H=this.transform.calculatePixelsToTileUnitsMatrix(u),Y=Ia(C,u.tileID.canonical,B,F,this.transform,p.getProjection(),H);let N=null;if(B){const te=ro(C,u.tileID.canonical,B,F,this.transform,p.getProjection(),H);N=s.a9.multiply([],this.transform.labelPlaneMatrix,te)}let $=null;j&&u.latestFeatureIndex&&($={unwrappedTileID:I,dynamicFilter:j,dynamicFilterNeedsFeature:Q,featureIndex:u.latestFeatureIndex}),this.retainedQueryData[p.bucketInstanceId]=new io(p.bucketInstanceId,_,p.sourceLayerIndex,p.index,u.tileID);const ie={bucket:p,layout:y,posMatrix:C,textLabelPlaneMatrix:Y,labelToScreenMatrix:N,clippingData:$,scale:T,textPixelRatio:E,holdingForFade:u.holdingForFade(),collisionBoxArray:b,partiallyEvaluatedTextSize:s.b8(p.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:s.b8(p.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(p.sourceID)};if(d)for(const te of p.sortKeyRanges){const{sortKey:ae,symbolInstanceStart:ge,symbolInstanceEnd:se}=te;i.push({sortKey:ae,symbolInstanceStart:ge,symbolInstanceEnd:se,parameters:ie})}else i.push({symbolInstanceStart:0,symbolInstanceEnd:p.symbolInstances.length,parameters:ie})}attemptAnchorPlacement(i,o,u,d,p,_,y,b,T,E,I,C,D,k,O,B,F,j){const{textOffset0:Q,textOffset1:H,crossTileID:Y}=C,N=[Q,H],$=Mu(i,u,d,N,p),ie=this.collisionIndex.placeCollisionBox(k,p,o,Ms($.x,$.y,_,y,this.transform.angle),I,b,T,E.predicate);if(B){const te=k.getSymbolInstanceIconSize(j,this.transform.zoom,C.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(k,te,B,Ms($.x,$.y,_,y,this.transform.angle),I,b,T,E.predicate).box.length===0)return}if(ie.box.length>0){let te;return this.prevPlacement&&this.prevPlacement.variableOffsets[Y]&&this.prevPlacement.placements[Y]&&this.prevPlacement.placements[Y].text&&(te=this.prevPlacement.variableOffsets[Y].anchor),this.variableOffsets[Y]={textOffset:N,width:u,height:d,anchor:i,textScale:p,prevAnchor:te},this.markUsedJustification(k,i,C,O),k.allowVerticalPlacement&&(this.markUsedOrientation(k,O,C),this.placedOrientations[Y]=O),{shift:$,placedGlyphBoxes:ie}}}placeLayerBucketPart(i,o,u,d){const{bucket:p,layout:_,posMatrix:y,textLabelPlaneMatrix:b,labelToScreenMatrix:T,clippingData:E,textPixelRatio:I,holdingForFade:C,collisionBoxArray:D,partiallyEvaluatedTextSize:k,partiallyEvaluatedIconSize:O,collisionGroup:B}=i.parameters,F=_.get("text-optional"),j=_.get("icon-optional"),Q=_.get("text-allow-overlap"),H=_.get("icon-allow-overlap"),Y=_.get("text-rotation-alignment")==="map",N=_.get("text-pitch-alignment")==="map",$=_.get("symbol-z-order")==="viewport-y",ie=_.get("symbol-z-elevate");this.transform.setProjection(p.projection);let te=Q&&(H||!p.hasIconData()||j),ae=H&&(Q||!p.hasTextData()||F);!p.collisionArrays&&D&&p.deserializeCollisionBoxes(D),u&&d&&p.updateCollisionDebugBuffers(this.transform.zoom,D);const ge=(se,me,xe)=>{const{crossTileID:oe,numVerticalGlyphVertices:fe}=se;if(E){const Mr={zoom:this.transform.zoom,pitch:this.transform.pitch};let xr=null;if(E.dynamicFilterNeedsFeature){const Bt=this.retainedQueryData[p.bucketInstanceId];xr=E.featureIndex.loadFeature({featureIndex:se.featureIndex,bucketIndex:Bt.bucketIndex,sourceLayerIndex:Bt.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,E.dynamicFilter)(Mr,xr,this.retainedQueryData[p.bucketInstanceId].tileID.canonical,new s.P(se.tileAnchorX,se.tileAnchorY),this.transform.calculateDistanceTileData(E.unwrappedTileID)))return this.placements[oe]=new Zl(!1,!1,!1,!0),void o.add(oe)}if(o.has(oe))return;if(C)return void(this.placements[oe]=new Zl(!1,!1,!1));let Re=!1,ue=!1,_e=!0,ye=!1,X=!1,Ee=null,Je={box:null,offscreen:null,occluded:null},st={box:null,offscreen:null,occluded:null},_t=null,ht=null,xt=null,Qt=0,Ct=0,Jt=0;xe.textFeatureIndex?Qt=xe.textFeatureIndex:se.useRuntimeCollisionCircles&&(Qt=se.featureIndex),xe.verticalTextFeatureIndex&&(Ct=xe.verticalTextFeatureIndex);const Xt=Mr=>{Mr.tileID=this.retainedQueryData[p.bucketInstanceId].tileID;const xr=this.transform.elevation;Mr.elevation=se.zOffset+(xr?xr.getAtTileOffset(Mr.tileID,Mr.tileAnchorX,Mr.tileAnchorY):0)},Ur=xe.textBox;if(Ur){Xt(Ur);const Mr=Bt=>{let Nt=s.b9.horizontal;if(p.allowVerticalPlacement&&!Bt&&this.prevPlacement){const Or=this.prevPlacement.placedOrientations[oe];Or&&(this.placedOrientations[oe]=Or,Nt=Or,this.markUsedOrientation(p,Nt,se))}return Nt},xr=(Bt,Nt)=>{if(p.allowVerticalPlacement&&fe>0&&xe.verticalTextBox){for(const Or of p.writingModes)if(Or===s.b9.vertical?(Je=Nt(),st=Je):Je=Bt(),Je&&Je.box&&Je.box.length)break}else Je=Bt()};if(_.get("text-variable-anchor")){let Bt=_.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[oe]){const Ir=this.prevPlacement.variableOffsets[oe];Bt.indexOf(Ir.anchor)>0&&(Bt=Bt.filter(qt=>qt!==Ir.anchor),Bt.unshift(Ir.anchor))}const Nt=(Ir,qt,Rt)=>{const Wi=p.getSymbolInstanceTextSize(k,se,this.transform.zoom,me),Ci=(Ir.x2-Ir.x1)*Wi+2*Ir.padding,mi=(Ir.y2-Ir.y1)*Wi+2*Ir.padding,Di=se.hasIconTextFit&&!H?qt:null;Di&&Xt(Di);let Hi={box:[],offscreen:!1,occluded:!1};const Fi=Q?2*Bt.length:Bt.length;for(let _i=0;_i<Fi;++_i){const Ti=this.attemptAnchorPlacement(Bt[_i%Bt.length],Ir,Ci,mi,Wi,Y,N,I,y,B,_i>=Bt.length,se,me,p,Rt,Di,k,O);if(Ti&&(Hi=Ti.placedGlyphBoxes,Hi&&Hi.box&&Hi.box.length)){Re=!0,Ee=Ti.shift;break}}return Hi};xr(()=>Nt(Ur,xe.iconBox,s.b9.horizontal),()=>{const Ir=xe.verticalTextBox;return Ir&&Xt(Ir),p.allowVerticalPlacement&&!(Je&&Je.box&&Je.box.length)&&fe>0&&Ir?Nt(Ir,xe.verticalIconBox,s.b9.vertical):{box:null,offscreen:null,occluded:null}}),Je&&(Re=Je.box,_e=Je.offscreen,ye=Je.occluded);const Or=Mr(!(!Je||!Je.box));if(!Re&&this.prevPlacement){const Ir=this.prevPlacement.variableOffsets[oe];Ir&&(this.variableOffsets[oe]=Ir,this.markUsedJustification(p,Ir.anchor,se,Or))}}else{const Bt=(Nt,Or)=>{const Ir=p.getSymbolInstanceTextSize(k,se,this.transform.zoom,me),qt=this.collisionIndex.placeCollisionBox(p,Ir,Nt,new s.P(0,0),Q,I,y,B.predicate);return qt&&qt.box&&qt.box.length&&(this.markUsedOrientation(p,Or,se),this.placedOrientations[oe]=Or),qt};xr(()=>Bt(Ur,s.b9.horizontal),()=>{const Nt=xe.verticalTextBox;return p.allowVerticalPlacement&&fe>0&&Nt?(Xt(Nt),Bt(Nt,s.b9.vertical)):{box:null,offscreen:null,occluded:null}}),Mr(!!(Je&&Je.box&&Je.box.length))}}if(_t=Je,Re=_t&&_t.box&&_t.box.length>0,_e=_t&&_t.offscreen,ye=_t&&_t.occluded,se.useRuntimeCollisionCircles){const Mr=p.text.placedSymbolArray.get(se.centerJustifiedTextSymbolIndex>=0?se.centerJustifiedTextSymbolIndex:se.verticalPlacedTextSymbolIndex),xr=s.ba(p.textSizeData,k,Mr),Bt=_.get("text-padding");ht=this.collisionIndex.placeCollisionCircles(p,Q,Mr,p.lineVertexArray,p.glyphOffsetArray,xr,y,b,T,u,N,B.predicate,se.collisionCircleDiameter*xr/s.bf,Bt,this.retainedQueryData[p.bucketInstanceId].tileID),Re=Q||ht.circles.length>0&&!ht.collisionDetected,_e=_e&&ht.offscreen,ye=ht.occluded}if(xe.iconFeatureIndex&&(Jt=xe.iconFeatureIndex),xe.iconBox){const Mr=xr=>{Xt(xr);const Bt=se.hasIconTextFit&&Ee?Ms(Ee.x,Ee.y,Y,N,this.transform.angle):new s.P(0,0),Nt=p.getSymbolInstanceIconSize(O,this.transform.zoom,se.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(p,Nt,xr,Bt,H,I,y,B.predicate)};st&&st.box&&st.box.length&&xe.verticalIconBox?(xt=Mr(xe.verticalIconBox),ue=xt.box.length>0):(xt=Mr(xe.iconBox),ue=xt.box.length>0),_e=_e&&xt.offscreen,X=xt.occluded}const yr=F||se.numHorizontalGlyphVertices===0&&fe===0,hi=j||se.numIconVertices===0;if(yr||hi?hi?yr||(ue=ue&&Re):Re=ue&&Re:ue=Re=ue&&Re,Re&&_t&&_t.box&&this.collisionIndex.insertCollisionBox(_t.box,_.get("text-ignore-placement"),p.bucketInstanceId,st&&st.box&&Ct?Ct:Qt,B.ID),ue&&xt&&this.collisionIndex.insertCollisionBox(xt.box,_.get("icon-ignore-placement"),p.bucketInstanceId,Jt,B.ID),ht&&(Re&&this.collisionIndex.insertCollisionCircles(ht.circles,_.get("text-ignore-placement"),p.bucketInstanceId,Qt,B.ID),u)){const Mr=p.bucketInstanceId;let xr=this.collisionCircleArrays[Mr];xr===void 0&&(xr=this.collisionCircleArrays[Mr]=new E1);for(let Bt=0;Bt<ht.circles.length;Bt+=4)xr.circles.push(ht.circles[Bt+0]),xr.circles.push(ht.circles[Bt+1]),xr.circles.push(ht.circles[Bt+2]),xr.circles.push(ht.collisionDetected?1:0)}const ii=p.projection.name!=="globe";te=te&&(ii||!ye),ae=ae&&(ii||!X),this.placements[oe]=new Zl(Re||te,ue||ae,_e||p.justReloaded),o.add(oe)};if(ie&&this.buildingIndex&&(this.buildingIndex.updateZOffset(p,this.retainedQueryData[p.bucketInstanceId].tileID),p.updateZOffset()),$){const se=p.getSortedSymbolIndexes(this.transform.angle);for(let me=se.length-1;me>=0;--me){const xe=se[me];ge(p.symbolInstances.get(xe),xe,p.collisionArrays[xe])}p.hasAnyZOffset&&s.w(`${p.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(p.hasAnyZOffset){const se=p.getSortedIndexesByZOffset();for(let me=0;me<se.length;++me){const xe=se[me];ge(p.symbolInstances.get(xe),xe,p.collisionArrays[xe])}}else for(let se=i.symbolInstanceStart;se<i.symbolInstanceEnd;se++)ge(p.symbolInstances.get(se),se,p.collisionArrays[se]);if(u&&p.bucketInstanceId in this.collisionCircleArrays){const se=this.collisionCircleArrays[p.bucketInstanceId];s.a9.invert(se.invProjMatrix,y),se.viewportMatrix=this.collisionIndex.getViewportMatrix()}p.justReloaded=!1}markUsedJustification(i,o,u,d){const{leftJustifiedTextSymbolIndex:p,centerJustifiedTextSymbolIndex:_,rightJustifiedTextSymbolIndex:y,verticalPlacedTextSymbolIndex:b,crossTileID:T}=u,E=s.bg(o),I=d===s.b9.vertical?b:E==="left"?p:E==="center"?_:E==="right"?y:-1;p>=0&&(i.text.placedSymbolArray.get(p).crossTileID=I>=0&&p!==I?0:T),_>=0&&(i.text.placedSymbolArray.get(_).crossTileID=I>=0&&_!==I?0:T),y>=0&&(i.text.placedSymbolArray.get(y).crossTileID=I>=0&&y!==I?0:T),b>=0&&(i.text.placedSymbolArray.get(b).crossTileID=I>=0&&b!==I?0:T)}markUsedOrientation(i,o,u){const d=o===s.b9.horizontal||o===s.b9.horizontalOnly?o:0,p=o===s.b9.vertical?o:0,{leftJustifiedTextSymbolIndex:_,centerJustifiedTextSymbolIndex:y,rightJustifiedTextSymbolIndex:b,verticalPlacedTextSymbolIndex:T}=u,E=i.text.placedSymbolArray;_>=0&&(E.get(_).placedOrientation=d),y>=0&&(E.get(y).placedOrientation=d),b>=0&&(E.get(b).placedOrientation=d),T>=0&&(E.get(T).placedOrientation=p)}commit(i){this.commitTime=i,this.zoomAtLastRecencyCheck=this.transform.zoom;const o=this.prevPlacement;let u=!1;this.prevZoomAdjustment=o?o.zoomAdjustment(this.transform.zoom):0;const d=o?o.symbolFadeChange(i):1,p=o?o.opacities:{},_=o?o.variableOffsets:{},y=o?o.placedOrientations:{};for(const b in this.placements){const T=this.placements[b],E=p[b];E?(this.opacities[b]=new As(E,d,T.text,T.icon,null,T.clipped),u=u||T.text!==E.text.placed||T.icon!==E.icon.placed):(this.opacities[b]=new As(null,d,T.text,T.icon,T.skipFade,T.clipped),u=u||T.text||T.icon)}for(const b in p){const T=p[b];if(!this.opacities[b]){const E=new As(T,d,!1,!1);E.isHidden()||(this.opacities[b]=E,u=u||T.text.placed||T.icon.placed)}}for(const b in _)this.variableOffsets[b]||!this.opacities[b]||this.opacities[b].isHidden()||(this.variableOffsets[b]=_[b]);for(const b in y)this.placedOrientations[b]||!this.opacities[b]||this.opacities[b].isHidden()||(this.placedOrientations[b]=y[b]);u?this.lastPlacementChangeTime=i:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=o?o.lastPlacementChangeTime:i)}updateLayerOpacities(i,o){const u=new Set;for(const d of o){const p=d.getBucket(i);p&&d.latestFeatureIndex&&i.fqid===p.layerIds[0]&&(this.updateBucketOpacities(p,u,d.collisionBoxArray),p.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(p,d.tileID),p.updateZOffset()))}}updateBucketOpacities(i,o,u){i.hasTextData()&&i.text.opacityVertexArray.clear(),i.hasIconData()&&i.icon.opacityVertexArray.clear(),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexArray.clear(),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexArray.clear();const d=i.layers[0].layout,p=!!i.layers[0].dynamicFilter(),_=new As(null,0,!1,!1,!0),y=d.get("text-allow-overlap"),b=d.get("icon-allow-overlap"),T=d.get("text-variable-anchor"),E=d.get("text-rotation-alignment")==="map",I=d.get("text-pitch-alignment")==="map",C=new As(null,0,y&&(b||!i.hasIconData()||d.get("icon-optional")),b&&(y||!i.hasTextData()||d.get("text-optional")),!0);!i.collisionArrays&&u&&(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData())&&i.deserializeCollisionBoxes(u);const D=(O,B,F)=>{for(let j=0;j<B/4;j++)O.opacityVertexArray.emplaceBack(F)};let k=0;for(let O=0;O<i.symbolInstances.length;O++){const B=i.symbolInstances.get(O),{numHorizontalGlyphVertices:F,numVerticalGlyphVertices:j,crossTileID:Q,numIconVertices:H}=B,Y=o.has(Q);let N=this.opacities[Q];Y?N=_:N||(N=C,this.opacities[Q]=N),o.add(Q);const $=F>0||j>0,ie=H>0,te=this.placedOrientations[Q],ae=te===s.b9.vertical,ge=te===s.b9.horizontal||te===s.b9.horizontalOnly;if(!$&&!ie||N.isHidden()||k++,$){const se=Ql(N.text);D(i.text,F,ae?Ps:se),D(i.text,j,ge?Ps:se);const me=N.text.isHidden(),{leftJustifiedTextSymbolIndex:xe,centerJustifiedTextSymbolIndex:oe,rightJustifiedTextSymbolIndex:fe,verticalPlacedTextSymbolIndex:Re}=B,ue=i.text.placedSymbolArray,_e=me||ae?1:0;xe>=0&&(ue.get(xe).hidden=_e),oe>=0&&(ue.get(oe).hidden=_e),fe>=0&&(ue.get(fe).hidden=_e),Re>=0&&(ue.get(Re).hidden=me||ge?1:0);const ye=this.variableOffsets[Q];ye&&this.markUsedJustification(i,ye.anchor,B,te);const X=this.placedOrientations[Q];X&&(this.markUsedJustification(i,"left",B,X),this.markUsedOrientation(i,X,B))}if(ie){const se=Ql(N.icon),{placedIconSymbolIndex:me,verticalPlacedIconSymbolIndex:xe}=B,oe=i.icon.placedSymbolArray,fe=N.icon.isHidden()?1:0;me>=0&&(D(i.icon,H,ae?Ps:se),oe.get(me).hidden=fe),xe>=0&&(D(i.icon,B.numVerticalIconVertices,ge?Ps:se),oe.get(xe).hidden=fe)}if(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData()){const se=i.collisionArrays[O];if(se){let me=new s.P(0,0),xe=!0;if(se.textBox||se.verticalTextBox){if(T){const fe=this.variableOffsets[Q];fe?(me=Mu(fe.anchor,fe.width,fe.height,fe.textOffset,fe.textScale),E&&me._rotate(I?this.transform.angle:-this.transform.angle)):xe=!1}p&&(xe=!N.clipped),se.textBox&&Xo(i.textCollisionBox.collisionVertexArray,N.text.placed,!xe||ae,me.x,me.y),se.verticalTextBox&&Xo(i.textCollisionBox.collisionVertexArray,N.text.placed,!xe||ge,me.x,me.y)}const oe=xe&&!!(!ge&&se.verticalIconBox);se.iconBox&&Xo(i.iconCollisionBox.collisionVertexArray,N.icon.placed,oe,B.hasIconTextFit?me.x:0,B.hasIconTextFit?me.y:0),se.verticalIconBox&&Xo(i.iconCollisionBox.collisionVertexArray,N.icon.placed,!oe,B.hasIconTextFit?me.x:0,B.hasIconTextFit?me.y:0)}}}if(i.fullyClipped=k===0,i.sortFeatures(this.transform.angle),this.retainedQueryData[i.bucketInstanceId]&&(this.retainedQueryData[i.bucketInstanceId].featureSortOrder=i.featureSortOrder),i.hasTextData()&&i.text.opacityVertexBuffer&&i.text.opacityVertexBuffer.updateData(i.text.opacityVertexArray),i.hasIconData()&&i.icon.opacityVertexBuffer&&i.icon.opacityVertexBuffer.updateData(i.icon.opacityVertexArray),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexBuffer&&i.iconCollisionBox.collisionVertexBuffer.updateData(i.iconCollisionBox.collisionVertexArray),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexBuffer&&i.textCollisionBox.collisionVertexBuffer.updateData(i.textCollisionBox.collisionVertexArray),i.bucketInstanceId in this.collisionCircleArrays){const O=this.collisionCircleArrays[i.bucketInstanceId];i.placementInvProjMatrix=O.invProjMatrix,i.placementViewportMatrix=O.viewportMatrix,i.collisionCircleArray=O.circles,delete this.collisionCircleArrays[i.bucketInstanceId]}}symbolFadeChange(i){return this.fadeDuration===0?1:(i-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(i){return Math.max(0,(this.transform.zoom-i)/1.5)}hasTransitions(i){return this.stale||i-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(i,o){const u=this.zoomAtLastRecencyCheck===o?1-this.zoomAdjustment(o):1;return this.zoomAtLastRecencyCheck=o,this.commitTime+this.fadeDuration*u>i}setStale(){this.stale=!0}}function Xo(c,i,o,u,d){c.emplaceBack(i?1:0,o?1:0,u||0,d||0),c.emplaceBack(i?1:0,o?1:0,u||0,d||0),c.emplaceBack(i?1:0,o?1:0,u||0,d||0),c.emplaceBack(i?1:0,o?1:0,u||0,d||0)}const Ca=Math.pow(2,25),Is=Math.pow(2,24),Pu=Math.pow(2,17),A1=Math.pow(2,16),M1=Math.pow(2,9),I1=Math.pow(2,8),Hl=Math.pow(2,1);function Ql(c){if(c.opacity===0&&!c.placed)return 0;if(c.opacity===1&&c.placed)return 4294967295;const i=c.placed?1:0,o=Math.floor(127*c.opacity);return o*Ca+i*Is+o*Pu+i*A1+o*M1+i*I1+o*Hl+i}const Ps=0;class Da{constructor(i){this._sortAcrossTiles=i.layout.get("symbol-z-order")!=="viewport-y"&&i.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(i,o,u,d,p){const _=this._bucketParts;for(;this._currentTileIndex<i.length;)if(o.getBucketParts(_,d,i[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,p())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,_.sort((y,b)=>y.sortKey-b.sortKey));this._currentPartIndex<_.length;){const y=_[this._currentPartIndex];if(o.placeLayerBucketPart(y,this._seenCrossTileIDs,u,y.symbolInstanceStart===0),this._currentPartIndex++,p())return!0}return!1}}class za{constructor(i,o,u,d,p,_,y,b,T){this.placement=new Iu(i,p,_,y,b,T),this._currentPlacementIndex=o.length-1,this._forceFullPlacement=u,this._showCollisionBoxes=d,this._done=!1}isDone(){return this._done}continuePlacement(i,o,u,d){const p=s.f.now(),_=()=>{const y=s.f.now()-p;return!this._forceFullPlacement&&y>2};for(;this._currentPlacementIndex>=0;){const y=o[i[this._currentPlacementIndex]],b=this.placement.collisionIndex.transform.zoom;if(y.type==="symbol"&&(!y.minzoom||y.minzoom<=b)&&(!y.maxzoom||y.maxzoom>b)){const T=y,E=T.layout.get("symbol-z-elevate"),I=this._inProgressLayer=this._inProgressLayer||new Da(T),C=s.aj(y.source,y.scope);if(I.continuePlacement(E?d[C]:u[C],this.placement,this._showCollisionBoxes,y,_))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(i){return this.placement.commit(i),this.placement}}const Cu=512/s.Y/2;class P1{constructor(i,o,u){this.tileID=i,this.bucketInstanceId=u,this.index=new s.bj(o.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const d=i.canonical.x*s.Y,p=i.canonical.y*s.Y;for(let _=0;_<o.length;_++){const{key:y,crossTileID:b,tileAnchorX:T,tileAnchorY:E}=o.get(_),I=Math.floor((d+T)*Cu),C=Math.floor((p+E)*Cu);this.index.add(I,C),this.keys.push(y),this.crossTileIDs.push(b)}this.index.finish()}findMatches(i,o,u){const d=this.tileID.canonical.z<o.canonical.z?1:Math.pow(2,this.tileID.canonical.z-o.canonical.z),p=Cu/Math.pow(2,o.canonical.z-this.tileID.canonical.z),_=o.canonical.x*s.Y,y=o.canonical.y*s.Y;for(let b=0;b<i.length;b++){const T=i.get(b);if(T.crossTileID)continue;const{key:E,tileAnchorX:I,tileAnchorY:C}=T,D=Math.floor((_+I)*p),k=Math.floor((y+C)*p),O=this.index.range(D-d,k-d,D+d,k+d);for(const B of O){const F=this.crossTileIDs[B];if(this.keys[B]===E&&!u.has(F)){u.add(F),T.crossTileID=F;break}}}}}class Xl{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Ra{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(i){const o=Math.round((i-this.lng)/360);if(o!==0)for(const u in this.indexes){const d=this.indexes[u],p={};for(const _ in d){const y=d[_];y.tileID=y.tileID.unwrapTo(y.tileID.wrap+o),p[y.tileID.key]=y}this.indexes[u]=p}this.lng=i}addBucket(i,o,u){if(this.indexes[i.overscaledZ]&&this.indexes[i.overscaledZ][i.key]){if(this.indexes[i.overscaledZ][i.key].bucketInstanceId===o.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(i.overscaledZ,this.indexes[i.overscaledZ][i.key])}for(let p=0;p<o.symbolInstances.length;p++)o.symbolInstances.get(p).crossTileID=0;this.usedCrossTileIDs[i.overscaledZ]||(this.usedCrossTileIDs[i.overscaledZ]=new Set);const d=this.usedCrossTileIDs[i.overscaledZ];for(const p in this.indexes){const _=this.indexes[p];if(Number(p)>i.overscaledZ)for(const y in _){const b=_[y];b.tileID.isChildOf(i)&&b.findMatches(o.symbolInstances,i,d)}else{const y=_[i.scaledTo(Number(p)).key];y&&y.findMatches(o.symbolInstances,i,d)}}for(let p=0;p<o.symbolInstances.length;p++){const _=o.symbolInstances.get(p);_.crossTileID||(_.crossTileID=u.generate(),d.add(_.crossTileID))}return this.indexes[i.overscaledZ]===void 0&&(this.indexes[i.overscaledZ]={}),this.indexes[i.overscaledZ][i.key]=new P1(i,o.symbolInstances,o.bucketInstanceId),!0}removeBucketCrossTileIDs(i,o){for(const u of o.crossTileIDs)this.usedCrossTileIDs[i].delete(u)}removeStaleBuckets(i){let o=!1;for(const u in this.indexes){const d=this.indexes[u];for(const p in d)i[d[p].bucketInstanceId]||(this.removeBucketCrossTileIDs(u,d[p]),delete d[p],o=!0)}return o}}class Du{constructor(){this.layerIndexes={},this.crossTileIDs=new Xl,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(i,o,u,d){let p=this.layerIndexes[i.fqid];p===void 0&&(p=this.layerIndexes[i.fqid]=new Ra);let _=!1;const y={};d.name!=="globe"&&p.handleWrapJump(u);for(const b of o){const T=b.getBucket(i);T&&i.fqid===T.layerIds[0]&&(T.bucketInstanceId||(T.bucketInstanceId=++this.maxBucketInstanceId),p.addBucket(b.tileID,T,this.crossTileIDs)&&(_=!0),y[T.bucketInstanceId]=!0)}return p.removeStaleBuckets(y)&&(_=!0),_}pruneUnusedLayers(i){const o={};i.forEach(u=>{o[u]=!0});for(const u in this.layerIndexes)o[u]||delete this.layerIndexes[u]}}class La{constructor(i=0,o=0,u=0,d=0){if(isNaN(i)||i<0||isNaN(o)||o<0||isNaN(u)||u<0||isNaN(d)||d<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=i,this.bottom=o,this.left=u,this.right=d}interpolate(i,o,u){return o.top!=null&&i.top!=null&&(this.top=s.X(i.top,o.top,u)),o.bottom!=null&&i.bottom!=null&&(this.bottom=s.X(i.bottom,o.bottom,u)),o.left!=null&&i.left!=null&&(this.left=s.X(i.left,o.left,u)),o.right!=null&&i.right!=null&&(this.right=s.X(i.right,o.right,u)),this}getCenter(i,o){const u=s.ad((this.left+i-this.right)/2,0,i),d=s.ad((this.top+o-this.bottom)/2,0,o);return new s.P(u,d)}equals(i){return this.top===i.top&&this.bottom===i.bottom&&this.left===i.left&&this.right===i.right}clone(){return new La(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Yl(c,i){const o=s.bn(c,3);s.a9.fromQuat(c,i),s.bp(c,3,o)}function zu(c,i){const o=s.bl.identity([]);return s.bl.rotateZ(o,o,-i),s.bl.rotateX(o,o,-c),o}function Cn(c,i){const o=[c[0],c[1],0],u=[i[0],i[1],0];if(s.Q.length(o)>=1e-15){const _=s.Q.normalize([],o);s.Q.scale(u,_,s.Q.dot(u,_)),i[0]=u[0],i[1]=u[1]}const d=s.Q.cross([],i,c);if(s.Q.len(d)<1e-15)return null;const p=Math.atan2(-d[1],d[0]);return zu(Math.atan2(Math.sqrt(c[0]*c[0]+c[1]*c[1]),-c[2]),p)}class Cs{constructor(i,o){this.position=i,this.orientation=o}get position(){return this._position}set position(i){if(i){const o=i instanceof s.O?i:new s.O(i[0],i[1],i[2]);this._renderWorldCopies&&(o.x=s.bk(o.x,0,1)),this._position=o}else this._position=null}lookAtPoint(i,o){if(this.orientation=null,!this.position)return;const u=this.position,d=this._elevation?this._elevation.getAtPointOrZero(s.O.fromLngLat(i)):0,p=s.O.fromLngLat(i,d),_=[p.x-u.x,p.y-u.y,p.z-u.z];o||(o=[0,0,1]),o[2]=Math.abs(o[2]),this.orientation=Cn(_,o)}setPitchBearing(i,o){this.orientation=zu(s.bm(i),s.bm(-o))}}class Oa{constructor(i,o){this._transform=s.a9.identity([]),this.orientation=o,this.position=i}get mercatorPosition(){const i=this.position;return new s.O(i[0],i[1],i[2])}get position(){const i=s.bn(this._transform,3);return[i[0],i[1],i[2]]}set position(i){var o;i&&s.bp(this._transform,3,[(o=i)[0],o[1],o[2],1])}get orientation(){return this._orientation}set orientation(i){this._orientation=i||s.bl.identity([]),i&&Yl(this._transform,this._orientation)}getPitchBearing(){const i=this.forward(),o=this.right();return{bearing:Math.atan2(-o[1],o[0]),pitch:Math.atan2(Math.sqrt(i[0]*i[0]+i[1]*i[1]),-i[2])}}setPitchBearing(i,o){this._orientation=zu(i,o),Yl(this._transform,this._orientation)}forward(){const i=s.bn(this._transform,2);return[-i[0],-i[1],-i[2]]}up(){const i=s.bn(this._transform,1);return[-i[0],-i[1],-i[2]]}right(){const i=s.bn(this._transform,0);return[i[0],i[1],i[2]]}getCameraToWorld(i,o){const u=new Float64Array(16);return s.a9.invert(u,this.getWorldToCamera(i,o)),u}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(i,o,u){const d=this.position;s.Q.scale(d,d,-i);const p=new Float64Array(16);return s.a9.fromScaling(p,[u,u,u]),s.a9.translate(p,p,d),p[10]*=o,p}getWorldToCamera(i,o){const u=new Float64Array(16),d=new Float64Array(4),p=this.position;return s.bl.conjugate(d,this._orientation),s.Q.scale(p,p,-i),s.a9.fromQuat(u,d),s.a9.translate(u,u,p),u[1]*=-1,u[5]*=-1,u[9]*=-1,u[13]*=-1,u[8]*=o,u[9]*=o,u[10]*=o,u[11]*=o,u}getCameraToClipPerspective(i,o,u,d){const p=new Float64Array(16);return s.a9.perspective(p,i,o,u,d),p}getCameraToClipOrthographic(i,o,u,d,p,_){const y=new Float64Array(16);return s.a9.ortho(y,i,o,u,d,p,_),y}getDistanceToElevation(i,o=!1){const u=i===0?0:s.bo(i,o?s.ax(this.position[1]):this.position[1]),d=this.forward();return(u-this.position[2])/d[2]}clone(){return new Oa([...this.position],[...this.orientation])}}const Ru=(c,i,o)=>(1-o)*c+o*i,Ds=c=>c*c*c*c*c;class Jl{constructor(i,o,u,d,p,_,y){this.tileSize=512,this._renderWorldCopies=p===void 0||p,this._minZoom=i||0,this._maxZoom=o||22,this._minPitch=u??0,this._maxPitch=d??60,this.setProjection(_),this.setMaxBounds(y),this.width=0,this.height=0,this._center=new s.bq(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new La,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Oa,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const i=new Jl(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return i._elevation=this._elevation,i._centerAltitude=this._centerAltitude,i._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,i.tileSize=this.tileSize,i.mercatorFromTransition=this.mercatorFromTransition,i.width=this.width,i.height=this.height,i.cameraElevationReference=this.cameraElevationReference,i._center=this._center,i._setZoom(this.zoom),i._seaLevelZoom=this._seaLevelZoom,i.angle=this.angle,i._fov=this._fov,i._pitch=this._pitch,i._nearZ=this._nearZ,i._farZ=this._farZ,i._averageElevation=this._averageElevation,i._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,i._unmodified=this._unmodified,i._edgeInsets=this._edgeInsets.clone(),i._camera=this._camera.clone(),i._calcMatrices(),i.freezeTileCoverage=this.freezeTileCoverage,i.frustumCorners=this.frustumCorners,i}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(i){this._elevation!==i&&(this._elevation=i,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(i,o=!1){const u=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||u)&&this._updateCameraOnTerrain(),(i||u)&&this._constrainCamera(o),this._calcMatrices()}getProjection(){return s.af(this.projection,["name","center","parallels"])}setProjection(i){this.projectionOptions=i||{name:"mercator"};const o=this.projection?this.getProjection():void 0;this.projection=s.br(this.projectionOptions);const u=!ze(o,this.getProjection());return u&&this._calcMatrices(),this.mercatorFromTransition=!1,u}setOrthographicProjectionAtLowPitch(i){return this._orthographicProjectionAtLowPitch!==i&&(this._orthographicProjectionAtLowPitch=i,this._calcMatrices(),!0)}setMercatorFromTransition(){const i=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=s.br({name:"mercator"});const o=i!==this.projection.name;return o&&this._calcMatrices(),o}get minZoom(){return this._minZoom}set minZoom(i){this._minZoom!==i&&(this._minZoom=i,this.zoom=Math.max(this.zoom,i))}get maxZoom(){return this._maxZoom}set maxZoom(i){this._maxZoom!==i&&(this._maxZoom=i,this.zoom=Math.min(this.zoom,i))}get minPitch(){return this._minPitch}set minPitch(i){this._minPitch!==i&&(this._minPitch=i,this.pitch=Math.max(this.pitch,i))}get maxPitch(){return this._maxPitch}set maxPitch(i){this._maxPitch!==i&&(this._maxPitch=i,this.pitch=Math.min(this.pitch,i))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(i){i===void 0?i=!0:i===null&&(i=!1),this._renderWorldCopies=i}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const i=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(i))}get cameraWorldSize(){const i=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(i))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return s.bo(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.P(this.width,this.height)}get bearing(){return s.bk(this.rotation,-180,180)}set bearing(i){this.rotation=i}get rotation(){return-this.angle/Math.PI*180}set rotation(i){const o=-i*Math.PI/180;this.angle!==o&&(this._unmodified=!1,this.angle=o,this._calcMatrices(),this.rotationMatrix=s.b7.create(),s.b7.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(i){const o=s.ad(i,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==o&&(this._unmodified=!1,this._pitch=o,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const i=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/i)}set fov(i){i=Math.max(.01,Math.min(60,i)),this._fov!==i&&(this._unmodified=!1,this._fov=s.bm(i),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(i){this._averageElevation=i,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(i){const o=Math.min(Math.max(i,this.minZoom),this.maxZoom);this._zoom!==o&&(this._unmodified=!1,this._setZoom(o),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(i){this._zoom=i,this.scale=this.zoomScale(i),this.tileZoom=Math.floor(i),this.zoomFraction=i-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(i){this._tileCoverLift!==i&&(this._tileCoverLift=i)}_updateCameraOnTerrain(){const i=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,o=this.elevation&&i===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||i===Number.NEGATIVE_INFINITY&&(!o||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const u=this._elevation;o||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&u.exaggeration()&&this._centerAltitudeValidForExaggeration!==u.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*u.exaggeration(),this._centerAltitudeValidForExaggeration=u.exaggeration()):(this._centerAltitude=i||0,this._centerAltitudeValidForExaggeration=u.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const i=this._elevation,o=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],u=this.horizonLineFromTop();let d=0,p=0;for(let _=0;_<o.length;_++){const y=new s.P(o[_][0]*this.width,u+o[_][1]*(this.height-u)),b=i.pointCoordinate(y);if(!b)continue;const T=1/Math.hypot(b[0]-this._camera.position[0],b[1]-this._camera.position[1]);d+=b[3]*T,p+=T}return p===0?NaN:d/p}get center(){return this._center}set center(i){i.lat===this._center.lat&&i.lng===this._center.lng||(this._unmodified=!1,this._center=i,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const i=this._seaLevelZoom,o=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),u=this.pixelsPerMeter/this.worldSize*o,d=this._mercatorZfromZoom(i),p=this._mercatorZfromZoom(this._maxZoom),_=Math.max(d-u,p);this._setZoom(this._zoomFromMercatorZ(_))}get padding(){return this._edgeInsets.toJSON()}set padding(i){this._edgeInsets.equals(i)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,i,1),this._calcMatrices())}computeZoomRelativeTo(i){const o=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,i.toAltitude()));let u;u=i.z<this._camera.position[2]?[o.x,o.y,o.z]:[i.x,i.y,i.z];const d=s.Q.length(s.Q.sub([],this._camera.position,u));return s.ad(this._zoomFromMercatorZ(d),this._minZoom,this._maxZoom)}setFreeCameraOptions(i){if(!this.height||!i.position&&!i.orientation)return;this._updateCameraState();let o=!1;if(i.orientation&&!s.bl.exactEquals(i.orientation,this._camera.orientation)&&(o=this._setCameraOrientation(i.orientation)),i.position){const u=[i.position.x,i.position.y,i.position.z];s.Q.exactEquals(u,this._camera.position)||(this._setCameraPosition(u),o=!0)}o&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const i=this._camera.position,o=new Cs;return o.position=new s.O(i[0],i[1],i[2]),o.orientation=this._camera.orientation,o._elevation=this.elevation,o._renderWorldCopies=this.renderWorldCopies,o}_setCameraOrientation(i){if(!s.bl.length(i))return!1;s.bl.normalize(i,i);const o=s.Q.transformQuat([],[0,0,-1],i),u=s.Q.transformQuat([],[0,-1,0],i);if(u[2]<0)return!1;const d=Cn(o,u);return!!d&&(this._camera.orientation=d,!0)}_setCameraPosition(i){const o=this.zoomScale(this.minZoom)*this.tileSize,u=this.zoomScale(this.maxZoom)*this.tileSize,d=this.cameraToCenterDistance;i[2]=s.ad(i[2],d/u,d/o),this._camera.position=i}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(i){return this._edgeInsets.equals(i)}interpolatePadding(i,o,u){this._unmodified=!1,this._edgeInsets.interpolate(i,o,u),this._constrain(),this._calcMatrices()}coveringZoomLevel(i){const o=(i.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/i.tileSize));return Math.max(0,o)}getVisibleUnwrappedCoordinates(i){const o=[new s.bs(0,i)];if(this.renderWorldCopies){const u=this.pointCoordinate(new s.P(0,0)),d=this.pointCoordinate(new s.P(this.width,0)),p=this.pointCoordinate(new s.P(this.width,this.height)),_=this.pointCoordinate(new s.P(0,this.height)),y=Math.floor(Math.min(u.x,d.x,p.x,_.x)),b=Math.floor(Math.max(u.x,d.x,p.x,_.x)),T=1;for(let E=y-T;E<=b+T;E++)E!==0&&o.push(new s.bs(E,i))}return o}isLODDisabled(i){return(!i||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCoverForShadows(i,o,u){let d=[];if(o[0]===0&&o[1]===0)return d;for(const _ of i){const y=_.canonical,b=_.overscaledZ,T=_.wrap,E=1<<y.z,I=y.x+1<E,C=y.x>0,D=y.y+1<E,k=y.y>0,O=_.wrap-(C?0:1),B=_.wrap+(I?0:1),F=C?y.x-1:E-1,j=I?y.x+1:0;o[0]<0?(d.push(new s.ap(b,B,y.z,j,y.y)),o[1]<0&&D&&(d.push(new s.ap(b,T,y.z,y.x,y.y+1)),d.push(new s.ap(b,B,y.z,j,y.y+1))),o[1]>0&&k&&(d.push(new s.ap(b,T,y.z,y.x,y.y-1)),d.push(new s.ap(b,B,y.z,j,y.y-1)))):o[0]>0?(d.push(new s.ap(b,O,y.z,F,y.y)),o[1]<0&&D&&(d.push(new s.ap(b,T,y.z,y.x,y.y+1)),d.push(new s.ap(b,O,y.z,F,y.y+1))),o[1]>0&&k&&(d.push(new s.ap(b,T,y.z,y.x,y.y-1)),d.push(new s.ap(b,O,y.z,F,y.y-1)))):o[1]<0&&D?d.push(new s.ap(b,T,y.z,y.x,y.y+1)):k&&d.push(new s.ap(b,T,y.z,y.x,y.y-1))}if(d.length>1){d.sort((b,T)=>b.overscaledZ-T.overscaledZ||b.wrap-T.wrap||b.canonical.z-T.canonical.z||b.canonical.x-T.canonical.x||b.canonical.y-T.canonical.y);let _=0,y=0;for(;y<d.length;)d[y].equals(d[_])?++y:d[++_]=d[y++];d.length=_+1}const p=[];for(const _ of d)d.some(y=>_.isChildOf(y))||p.push(_);return d=p.filter(_=>!i.some(y=>!!(_.overscaledZ<u&&y.isChildOf(_))||_.equals(y)||_.isChildOf(y))),d}coveringTiles(i){let o=this.coveringZoomLevel(i);const u=o,d=this.elevation&&this.elevation.exaggeration(),p=d&&!i.isTerrainDEM,_=this.projection.name==="mercator";if(i.minzoom!==void 0&&o<i.minzoom)return[];i.maxzoom!==void 0&&o>i.maxzoom&&(o=i.maxzoom);const y=this.locationCoordinate(this.center),b=this.center.lat,T=1<<o,E=[T*y.x,T*y.y,0],I=this.projection.name==="globe",C=!I,D=s.bt.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,o,C),k=I?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),O=T*s.bo(1,this.center.lat),B=this._camera.position[2]/s.bo(1,this.center.lat),F=[T*k.x,T*k.y,B*(C?1:O)],j=I||d,Q=this.cameraToCenterDistance/i.tileSize*(i.roundZoom?1:.502),H=this.isLODDisabled(!0)?o:0;let Y;if(this._elevation&&i.isTerrainDEM)Y=1e4*this._elevation.exaggeration();else if(this._elevation){const ue=this._elevation.getMinMaxForVisibleTiles();Y=ue?ue.max:this._centerAltitude}else Y=this._centerAltitude;const N=i.isTerrainDEM?-Y:this._elevation?this._elevation.getMinElevationBelowMSL():0,$=this.projection.isReprojectedInTileSpace?s.bu(this):1,ie=ue=>{const ye=new s.O(ue.x+25e-6,ue.y,ue.z),X=new s.O(ue.x,ue.y+25e-6,ue.z),Ee=ue.toLngLat(),Je=ye.toLngLat(),st=X.toLngLat(),_t=this.locationCoordinate(Ee),ht=this.locationCoordinate(Je),xt=this.locationCoordinate(st),Qt=Math.hypot(ht.x-_t.x,ht.y-_t.y),Ct=Math.hypot(xt.x-_t.x,xt.y-_t.y);return Math.sqrt(Qt*Ct)*$/25e-6},te=ue=>{const _e=Y,ye=N;return{aabb:s.bx(this,T,0,0,0,ue,ye,_e,this.projection),zoom:0,x:0,y:0,minZ:ye,maxZ:_e,wrap:ue,fullyVisible:!1}},ae=[];let ge=[];const se=o,me=i.reparseOverscaled?u:o,xe=ue=>ue*ue,oe=xe((B-this._centerAltitude)*O),fe=ue=>{if(!this._elevation||!ue.tileID||!_)return;const _e=this._elevation.getMinMaxForTile(ue.tileID),ye=ue.aabb;_e?(ye.min[2]=_e.min,ye.max[2]=_e.max,ye.center[2]=(ye.min[2]+ye.max[2])/2):(ue.shouldSplit=Re(ue),ue.shouldSplit||(ye.min[2]=ye.max[2]=ye.center[2]=this._centerAltitude))},Re=ue=>{if(ue.zoom<H)return!0;if(ue.zoom===se)return!1;if(ue.shouldSplit!=null)return ue.shouldSplit;const _e=ue.aabb.distanceX(F),ye=ue.aabb.distanceY(F);let X=oe,Ee=1;if(I){X=xe(ue.aabb.distanceZ(F));const _t=Math.pow(2,ue.zoom),ht=s.ax((ue.y+1)/_t),xt=s.ax(ue.y/_t),Qt=Math.min(Math.max(b,ht),xt),Ct=s.bM(Qt)/s.bM(b);if(Ee=Qt===b?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Ct/this._mercatorScaleRatio),this.zoom<=s.bJ&&ue.zoom===se-1&&Ct>=.9)return!0}else if(p&&(X=xe(ue.aabb.distanceZ(F)*O)),this.projection.isReprojectedInTileSpace&&u<=5){const _t=Math.pow(2,ue.zoom),ht=ie(new s.O((ue.x+.5)/_t,(ue.y+.5)/_t));Ee=ht>.85?1:ht}const Je=_e*_e+ye*ye+X,st=xe((1<<se-ue.zoom)*Q*Ee*((_t,ht)=>{if(ht*xe(.707)<_t)return 1;const xt=Math.sqrt(ht/_t);return xt/(1.4144271570014144+(Math.pow(1.1,xt-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(X,oe),Je));return Je<st};if(this.renderWorldCopies)for(let ue=1;ue<=3;ue++)ae.push(te(-ue)),ae.push(te(ue));for(ae.push(te(0));ae.length>0;){const ue=ae.pop(),_e=ue.x,ye=ue.y;let X=ue.fullyVisible;const Ee=()=>this.projection.name==="globe"&&(ue.y===0||ue.y===(1<<ue.zoom)-1);if(!X){let Je=j?ue.aabb.intersects(D):ue.aabb.intersectsFlat(D);if(Je===0&&Ee()){const st=new s.bv(ue.zoom,_e,ye);Je=s.bw(this,T,st,!0).intersects(D)}if(Je===0)continue;X=Je===2}if(ue.zoom!==se&&Re(ue))for(let Je=0;Je<4;Je++){const st=(_e<<1)+Je%2,_t=(ye<<1)+(Je>>1),ht={aabb:_?ue.aabb.quadrant(Je):s.bx(this,T,ue.zoom+1,st,_t,ue.wrap,ue.minZ,ue.maxZ,this.projection),zoom:ue.zoom+1,x:st,y:_t,wrap:ue.wrap,fullyVisible:X,tileID:void 0,shouldSplit:void 0,minZ:ue.minZ,maxZ:ue.maxZ};p&&!I&&(ht.tileID=new s.ap(ue.zoom+1===se?me:ue.zoom+1,ue.wrap,ue.zoom+1,st,_t),fe(ht)),ae.push(ht)}else{const Je=ue.zoom===se?me:ue.zoom;if(i.minzoom&&i.minzoom>Je)continue;if(!X){let xt=j?ue.aabb.intersectsPrecise(D):ue.aabb.intersectsPreciseFlat(D);if(xt===0&&Ee()){const Qt=new s.bv(ue.zoom,_e,ye);xt=s.bw(this,T,Qt,!0).intersectsPrecise(D)}if(xt===0)continue}const st=E[0]-(.5+_e+(ue.wrap<<ue.zoom))*(1<<o-ue.zoom),_t=E[1]-.5-ye,ht=ue.tileID?ue.tileID:new s.ap(Je,ue.wrap,ue.zoom,_e,ye);ge.push({tileID:ht,distanceSq:st*st+_t*_t})}}if(this.fogCullDistSq){const ue=this.fogCullDistSq,_e=this.horizonLineFromTop();ge=ge.filter(ye=>{const X=[0,0,0,1],Ee=[s.Y,s.Y,0,1],Je=this.calculateFogTileMatrix(ye.tileID.toUnwrapped());s.aa.transformMat4(X,X,Je),s.aa.transformMat4(Ee,Ee,Je);const st=s.aa.min([],X,Ee),_t=s.aa.max([],X,Ee),ht=s.by(st,_t);if(ht===0)return!0;let xt=!1;const Qt=this._elevation;if(Qt&&ht>ue&&_e!==0){const Ct=this.calculateProjMatrix(ye.tileID.toUnwrapped());let Jt;i.isTerrainDEM||(Jt=Qt.getMinMaxForTile(ye.tileID)),Jt||(Jt={min:N,max:Y});const Xt=s.bK(this.rotation),Ur=[Xt[0]*s.Y,Xt[1]*s.Y,Jt.max];s.Q.transformMat4(Ur,Ur,Ct),xt=(1-Ur[1])*this.height*.5<_e}return ht<ue||xt})}return ge.sort((ue,_e)=>ue.distanceSq-_e.distanceSq).map(ue=>ue.tileID)}resize(i,o){this.width=i,this.height=o,this.pixelsToGLUnits=[2/i,-2/o],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(i){return Math.pow(2,i)}scaleZoom(i){return Math.log(i)/Math.LN2}project(i){const o=s.ad(i.lat,-s.bz,s.bz),u=this.projection.project(i.lng,o);return new s.P(u.x*this.worldSize,u.y*this.worldSize)}unproject(i){return this.projection.unproject(i.x/this.worldSize,i.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/s.bo(1,this.center.lat)/this.worldSize}setLocationAtPoint(i,o){let u,d;const p=this.centerPoint;if(this.projection.name==="globe"){const y=this.worldSize;u=(o.x-p.x)/y,d=(o.y-p.y)/y}else{const y=this.pointCoordinate(o),b=this.pointCoordinate(p);u=y.x-b.x,d=y.y-b.y}const _=this.locationCoordinate(i);this.setLocation(new s.O(_.x-u,_.y-d))}setLocation(i){this.center=this.coordinateLocation(i),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(i){return this.projection.locationPoint(this,i)}locationPoint3D(i){return this.projection.locationPoint(this,i,!0)}pointLocation(i){return this.coordinateLocation(this.pointCoordinate(i))}pointLocation3D(i){return this.coordinateLocation(this.pointCoordinate3D(i))}locationCoordinate(i,o){const u=o?s.bo(o,i.lat):void 0,d=this.projection.project(i.lng,i.lat);return new s.O(d.x,d.y,u)}coordinateLocation(i){return this.projection.unproject(i.x,i.y)}pointRayIntersection(i,o){const u=o??this._centerAltitude,d=[i.x,i.y,0,1],p=[i.x,i.y,1,1];s.aa.transformMat4(d,d,this.pixelMatrixInverse),s.aa.transformMat4(p,p,this.pixelMatrixInverse);const _=p[3];s.aa.scale(d,d,1/d[3]),s.aa.scale(p,p,1/_);const y=d[2],b=p[2];return{p0:d,p1:p,t:y===b?0:(u-y)/(b-y)}}screenPointToMercatorRay(i){const o=[i.x,i.y,0,1],u=[i.x,i.y,1,1];return s.aa.transformMat4(o,o,this.pixelMatrixInverse),s.aa.transformMat4(u,u,this.pixelMatrixInverse),s.aa.scale(o,o,1/o[3]),s.aa.scale(u,u,1/u[3]),o[2]=s.bo(o[2],this._center.lat)*this.worldSize,u[2]=s.bo(u[2],this._center.lat)*this.worldSize,s.aa.scale(o,o,1/this.worldSize),s.aa.scale(u,u,1/this.worldSize),new s.a5([o[0],o[1],o[2]],s.Q.normalize([],s.Q.sub([],u,o)))}rayIntersectionCoordinate(i){const{p0:o,p1:u,t:d}=i,p=s.bo(o[2],this._center.lat),_=s.bo(u[2],this._center.lat);return new s.O(s.X(o[0],u[0],d)/this.worldSize,s.X(o[1],u[1],d)/this.worldSize,s.X(p,_,d))}pointCoordinate(i,o=this._centerAltitude){return this.projection.pointCoordinate(this,i.x,i.y,o)}pointCoordinate3D(i){if(!this.elevation)return this.pointCoordinate(i);let o=this.projection.pointCoordinate3D(this,i.x,i.y);if(o)return new s.O(o[0],o[1],o[2]);let u=0,d=this.horizonLineFromTop();if(i.y>d)return this.pointCoordinate(i);const p=.02*d,_=i.clone();for(let y=0;y<10&&d-u>p;y++){_.y=s.X(u,d,.66);const b=this.projection.pointCoordinate3D(this,_.x,_.y);b?(d=_.y,o=b):u=_.y}return o?new s.O(o[0],o[1],o[2]):this.pointCoordinate(i)}isPointAboveHorizon(i){return this.projection.isPointAboveHorizon(this,i)}isPointOnSurface(i){if(i.y<0||i.y>this.height||i.x<0||i.x>this.width)return!1;if(this.elevation||this.zoom>=s.bA)return!this.isPointAboveHorizon(i);const o=this.pointCoordinate(i);return o.y>=0&&o.y<=1}_coordinatePoint(i,o){const u=o&&this.elevation?this.elevation.getAtPointOrZero(i,this._centerAltitude):this._centerAltitude,d=[i.x*this.worldSize,i.y*this.worldSize,u+i.toAltitude(),1];return s.aa.transformMat4(d,d,this.pixelMatrix),d[3]>0?new s.P(d[0]/d[3],d[1]/d[3]):new s.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:i,left:o}=this._edgeInsets,u=this.height-this._edgeInsets.bottom,d=this.width-this._edgeInsets.right,p=this.pointLocation3D(new s.P(o,i)),_=this.pointLocation3D(new s.P(d,i)),y=this.pointLocation3D(new s.P(d,u)),b=this.pointLocation3D(new s.P(o,u));let T=Math.min(p.lng,_.lng,y.lng,b.lng),E=Math.max(p.lng,_.lng,y.lng,b.lng),I=Math.min(p.lat,_.lat,y.lat,b.lat),C=Math.max(p.lat,_.lat,y.lat,b.lat);const D=Math.pow(2,-this.zoom)/16*270,k=this.projection.name==="globe"?1:4,O=(B,F,j,Q,H)=>{const Y=(B+j)/2,N=(F+Q)/2,$=new s.P(Y,N),{lng:ie,lat:te}=this.pointLocation3D($),ae=Math.max(0,T-ie,I-te,ie-E,te-C);T=Math.min(T,ie),E=Math.max(E,ie),I=Math.min(I,te),C=Math.max(C,te),(H<k||ae>D)&&(O(B,F,Y,N,H+1),O(Y,N,j,Q,H+1))};if(O(o,i,d,i,1),O(d,i,d,u,1),O(d,u,o,u,1),O(o,u,o,i,1),this.projection.name==="globe"){const[B,F]=s.bB(this);B?(C=90,E=180,T=-180):F&&(I=-90,E=180,T=-180)}return new s.ag(new s.bq(T,I),new s.bq(E,C))}_getBoundsRectangular(i,o){const{top:u,left:d}=this._edgeInsets,p=this.height-this._edgeInsets.bottom,_=this.width-this._edgeInsets.right,y=new s.P(d,u),b=new s.P(_,u),T=new s.P(_,p),E=new s.P(d,p);let I=this.pointCoordinate(y,i),C=this.pointCoordinate(b,i);const D=this.pointCoordinate(T,o),k=this.pointCoordinate(E,o),O=(B,F)=>(F.y-B.y)/(F.x-B.x);return I.y>1&&C.y>=0?I=new s.O((1-k.y)/O(k,I)+k.x,1):I.y<0&&C.y<=1&&(I=new s.O(-k.y/O(k,I)+k.x,0)),C.y>1&&I.y>=0?C=new s.O((1-D.y)/O(D,C)+D.x,1):C.y<0&&I.y<=1&&(C=new s.O(-D.y/O(D,C)+D.x,0)),new s.ag().extend(this.coordinateLocation(I)).extend(this.coordinateLocation(C)).extend(this.coordinateLocation(k)).extend(this.coordinateLocation(D))}_getBoundsRectangularTerrain(){const i=this.elevation;if(!i.visibleDemTiles.length||i.isUsingMockSource())return this._getBoundsRectangular(0,0);const o=i.visibleDemTiles.reduce((u,d)=>{if(d.dem){const p=d.dem.tree;u.min=Math.min(u.min,p.minimums[0]),u.max=Math.max(u.max,p.maximums[0])}return u},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(o.min*i.exaggeration(),o.max*i.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(i=!0){const o=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,u=this.height/2-o*(1-this._horizonShift);return i?Math.max(0,u):u}getMaxBounds(){return this.maxBounds}setMaxBounds(i){this.maxBounds=i,this.minLat=-s.bz,this.maxLat=s.bz,this.minLng=-180,this.maxLng=180,i&&(this.minLat=i.getSouth(),this.maxLat=i.getNorth(),this.minLng=i.getWest(),this.maxLng=i.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=s.a8(this.minLng)*this.tileSize,this.worldMaxX=s.a8(this.maxLng)*this.tileSize,this.worldMinY=s.ah(this.maxLat)*this.tileSize,this.worldMaxY=s.ah(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(i,o){return this.projection.createTileMatrix(this,o,i)}calculateDistanceTileData(i){const o=i.key,u=this._distanceTileDataCache;if(u[o])return u[o];const d=i.canonical,p=1/this.height,_=this.cameraWorldSize,y=_/this.zoomScale(d.z),b=(d.x+Math.pow(2,d.z)*i.wrap)*y,T=d.y*y,E=this.point;E.x*=_/this.worldSize,E.y*=_/this.worldSize;const I=this.angle,C=Math.sin(-I),D=-Math.cos(-I);return u[o]={bearing:[C,D],center:[(E.x-b)*p,(E.y-T)*p],scale:y/s.Y*p},u[o]}calculateFogTileMatrix(i){const o=i.key,u=this._fogTileMatrixCache;if(u[o])return u[o];const d=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,i);return s.a9.multiply(d,this.worldToFogMatrix,d),u[o]=new Float32Array(d),u[o]}calculateProjMatrix(i,o=!1,u=!1){const d=i.key;let p;if(p=u?this._expandedProjMatrixCache:o?this._alignedProjMatrixCache:this._projMatrixCache,p[d])return p[d];const _=this.calculatePosMatrix(i,this.worldSize);let y;return y=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:u?this.expandedFarZProjMatrix:o?this.alignedProjMatrix:this.projMatrix,s.a9.multiply(_,y,_),p[d]=new Float32Array(_),p[d]}calculatePixelsToTileUnitsMatrix(i){const o=i.tileID.key,u=this._pixelsToTileUnitsCache;if(u[o])return u[o];const d=s.bC(i,this);return u[o]=d,u[o]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const i=1/this.worldSize,o=s.a9.fromScaling([],[i,i,i]);return s.a9.multiply(o,o,this.globeMatrix),o}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const i=this._elevation;this._updateCameraState();const o=s.bo(1,this._center.lat)*this.worldSize,u=this._computeCameraPosition(o),d=this._camera.forward(),p=s.bo(1,this._center.lat);u[2]/=p,d[2]/=p,s.Q.normalize(d,d);const _=i.raycast(u,d,i.exaggeration());if(_){const y=s.Q.scaleAndAdd([],u,d,_),b=new s.O(y[0],y[1],s.bo(y[2],s.ax(y[1]))),T=(b.z+s.Q.length([b.x-u[0],b.y-u[1],b.z-u[2]*p]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(T),this._centerAltitude=b.toAltitude(),this._center=this.coordinateLocation(b),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(i=!1){if(!this._elevation)return;const o=this._elevation,u=s.bo(1,this._center.lat)*this.worldSize,d=this._computeCameraPosition(u),p=o.getAtPointOrZero(new s.O(...d)),_=this.pixelsPerMeter/this.worldSize*p,y=this._minimumHeightOverTerrain(),b=d[2]-_;if(b<=y)if(b<0||i){const T=this.locationCoordinate(this._center,this._centerAltitude),E=[d[0],d[1],T.z-d[2]],I=s.Q.length(E);E[2]-=(y-b)/this._pixelsPerMercatorPixel;const C=s.Q.length(E);if(C===0)return;s.Q.scale(E,E,I/C*this._pixelsPerMercatorPixel),this._camera.position=[d[0],d[1],T.z*this._pixelsPerMercatorPixel-E[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const i=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||i){const C=this.center;return C.lat=s.ad(C.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!i)&&(C.lng=s.ad(C.lng,this.minLng,this.maxLng)),this.center=C,void(this._constraining=!1)}const o=this._unmodified,{x:u,y:d}=this.point;let p=0,_=u,y=d;const b=this.width/2,T=this.height/2,E=this.worldMinY*this.scale,I=this.worldMaxY*this.scale;if(d-T<E&&(y=E+T),d+T>I&&(y=I-T),I-E<this.height&&(p=Math.max(p,this.height/(I-E)),y=(I+E)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const C=this.worldMinX*this.scale,D=this.worldMaxX*this.scale,k=this.worldSize/2-(C+D)/2;_=(u+k+this.worldSize)%this.worldSize-k,_-b<C&&(_=C+b),_+b>D&&(_=D-b),D-C<this.width&&(p=Math.max(p,this.width/(D-C)),_=(D+C)/2)}_===u&&y===d||(this.center=this.unproject(new s.P(_,y))),p&&(this.zoom+=this.scaleZoom(p)),this._constrainCamera(),this._unmodified=o,this._constraining=!1}_minZoomForBounds(){let i=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(i=Math.max(i,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),i}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const i=this.centerOffset,o=this.projection.name==="globe",u=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=s.bo(1,this.center.lat)/s.bo(1,s.bL));const d=s.bD(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,d),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const p=this.projection.zAxisUnit==="meters"?u:1,_=this._camera.getWorldToCamera(this.worldSize,p);let y;const b=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(b[8]=2*-i.x/this.width,b[9]=2*i.y/this.height,this.isOrthographic){let te=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),ae=te*this.aspect,ge=-ae,se=-te;ae-=i.x,ge-=i.x,te+=i.y,se+=i.y,y=this._camera.getCameraToClipOrthographic(ge,ae,se,te,this._nearZ,this._farZ),((me,xe,oe,fe)=>{for(let Re=0;Re<16;Re++)me[Re]=Ru(xe[Re],oe[Re],fe)})(y,y,b,Ds(this.pitch>=15?1:this.pitch/15))}else y=b;const T=s.a9.mul([],b,_);let E=s.a9.mul([],y,_);if(this.projection.isReprojectedInTileSpace){const te=this.locationCoordinate(this.center),ae=s.a9.identity([]);s.a9.translate(ae,ae,[te.x*this.worldSize,te.y*this.worldSize,0]),s.a9.multiply(ae,ae,s.bE(this)),s.a9.translate(ae,ae,[-te.x*this.worldSize,-te.y*this.worldSize,0]),s.a9.multiply(E,E,ae),s.a9.multiply(T,T,ae),this.inverseAdjustmentMatrix=s.bF(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=s.a9.scale([],E,[this.worldSize,this.worldSize,this.worldSize/p,1]),this.projMatrix=E,this.invProjMatrix=s.a9.invert(new Float64Array(16),this.projMatrix),o){const te=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);te[8]=2*-i.x/this.width,te[9]=2*i.y/this.height,this.expandedFarZProjMatrix=s.a9.mul([],te,_)}else this.expandedFarZProjMatrix=this.projMatrix;const I=s.a9.invert([],y);this.frustumCorners=s.bG.fromInvProjectionMatrix(I,this.horizonLineFromTop(),this.height),this.cameraFrustum=s.bt.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!o);const C=new Float32Array(16);s.a9.identity(C),s.a9.scale(C,C,[1,-1,1]),s.a9.rotateX(C,C,this._pitch),s.a9.rotateZ(C,C,this.angle);const D=s.a9.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=s.a9.clone(D);const k=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;D[8]=2*-i.x/this.width,D[9]=2*(i.y+k)/this.height,this.skyboxMatrix=s.a9.multiply(C,D,C);const O=this.point,B=O.x,F=O.y,j=this.width%2/2,Q=this.height%2/2,H=Math.cos(this.angle),Y=Math.sin(this.angle),N=B-Math.round(B)+H*j+Y*Q,$=F-Math.round(F)+H*Q+Y*j,ie=new Float64Array(E);if(s.a9.translate(ie,ie,[N>.5?N-1:N,$>.5?$-1:$,0]),this.alignedProjMatrix=ie,E=s.a9.create(),s.a9.scale(E,E,[this.width/2,-this.height/2,1]),s.a9.translate(E,E,[1,-1,0]),this.labelPlaneMatrix=E,E=s.a9.create(),s.a9.scale(E,E,[1,-1,1]),s.a9.translate(E,E,[-1,-1,0]),s.a9.scale(E,E,[2/this.width,2/this.height,1]),this.glCoordMatrix=E,this.pixelMatrix=s.a9.multiply(new Float64Array(16),this.labelPlaneMatrix,T),this._calcFogMatrices(),this._distanceTileDataCache={},E=s.a9.invert(new Float64Array(16),this.pixelMatrix),!E)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=E,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=s.bH(this);const te=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=s.Q.transformMat4(te,te,_),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=E;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const i=this.cameraWorldSizeForFog,o=this.cameraPixelsPerMeter,u=this._camera.position,d=1/this.height/this._pixelsPerMercatorPixel,p=[i,i,o];s.Q.scale(p,p,d),s.Q.scale(u,u,-1),s.Q.multiply(u,u,p);const _=s.a9.create();s.a9.translate(_,_,u),s.a9.scale(_,_,p),this.mercatorFogMatrix=_,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(i,o,d)}_computeCameraPosition(i){const o=(i=i||this.pixelsPerMeter)/this.pixelsPerMeter,u=this._camera.forward(),d=this.point,p=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*o-i/this.worldSize*this._centerAltitude;return[d.x/this.worldSize-u[0]*p,d.y/this.worldSize-u[1]*p,i/this.worldSize*this._centerAltitude-u[2]*p]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(i){const o=this._maxCameraBoundsDistance()*Math.cos(this._pitch),u=this._camera.position[2],d=i[2];let p=1;this.projection.wrap&&(this.center=this.center.wrap()),d>0&&(p=Math.min((o-u)/d,1)),this._camera.position=s.Q.scaleAndAdd([],this._camera.position,i,p),this._updateStateFromCamera()}_updateStateFromCamera(){const i=this._camera.position,o=this._camera.forward(),{pitch:u,bearing:d}=this._camera.getPitchBearing(),p=s.bo(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,_=this._mercatorZfromZoom(this._maxZoom)*Math.cos(s.bm(this._maxPitch)),y=Math.max((i[2]-p)/Math.cos(u),_),b=this._zoomFromMercatorZ(y);s.Q.scaleAndAdd(i,i,o,y),this._pitch=s.ad(u,s.bm(this.minPitch),s.bm(this.maxPitch)),this.angle=s.bk(d,-Math.PI,Math.PI),this._setZoom(s.ad(b,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new s.O(i[0],i[1],i[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(i){return Math.pow(2,i)*this.tileSize}_mercatorZfromZoom(i){return this.cameraToCenterDistance/this._worldSizeFromZoom(i)}_minimumHeightOverTerrain(){const i=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(i)}_zoomFromMercatorZ(i){return this.scaleZoom(this.cameraToCenterDistance/(i*this.tileSize))}zoomFromMercatorZAdjusted(i){let o=0,u=s.bA,d=0,p=1/0;for(;u-o>1e-6&&u>o;){const _=o+.5*(u-o),y=this.tileSize*Math.pow(2,_),b=this.getCameraToCenterDistance(this.projection,_,y),T=this.scaleZoom(b/(i*this.tileSize)),E=Math.abs(_-T);E<p&&(p=E,d=_),_<T?o=_:u=_}return d}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(s.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(i,o){const u=Math.min(i.x,o.x),d=Math.max(i.x,o.x),p=Math.min(i.y,o.y),_=Math.max(i.y,o.y);if(p<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const y=[new s.P(u,p),new s.P(d,_),new s.P(u,_),new s.P(d,p)],b=this.renderWorldCopies?-3:0,T=this.renderWorldCopies?4:1;for(const E of y){const I=this.pointRayIntersection(E);if(I.t<0)return!0;const C=this.rayIntersectionCoordinate(I);if(C.x<b||C.y<0||C.x>T||C.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+s.bI(this.fovAboveCenter)>88||this.anyCornerOffEdge(new s.P(0,0),new s.P(this.width,this.height))}zoomDeltaToMovement(i,o){const u=s.Q.length(s.Q.sub([],this._camera.position,i)),d=this._zoomFromMercatorZ(u)+o;return u-this._mercatorZfromZoom(d)}getCameraPoint(){if(this.projection.name==="globe"){const i=function([o,u,d],p){const _=[o,u,d,1];s.aa.transformMat4(_,_,p);const y=_[3]=Math.max(_[3],1e-6);return _[0]/=y,_[1]/=y,_[2]/=y,_}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new s.P(i[0],i[1])}{const i=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.P(0,i))}}getCameraToCenterDistance(i,o=this.zoom,u=this.worldSize){const d=s.bD(i,o,this.width,this.height,1024),p=i.pixelSpaceConversion(this.center.lat,u,d);let _=.5/Math.tan(.5*this._fov)*this.height*p;return this.isOrthographic&&(_=Ru(1,_,Ds(this.pitch>=15?1:this.pitch/15))),_}getWorldToCameraMatrix(){const i=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&s.a9.multiply(i,i,this.globeMatrix),i}getFrustum(i){return s.bt.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,i,this.projection.zAxisUnit==="meters")}}const Xi={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,ShadowMap0:10},Eo=(c,i)=>{if(i>0&&c.terrain&&s.w("Cutoff is currently disabled on terrain"),i<=0||c.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const o=c.transform,u=Math.max(Math.abs(o._zoom-(c.minCutoffZoom-1)),1),d=o.isLODDisabled(!1)?s.S(60,45,o.pitch):s.S(30,15,o.pitch),p=o._farZ-o._nearZ,_=i*o.height,y=((1-(b=d))*o.cameraToCenterDistance+b*(o._farZ+_))*u;var b;return{shouldRenderCutoff:d<1,uniformValues:{u_cutoff_params:[o._nearZ,o._farZ,(y-o._nearZ)/p,(y-_-o._nearZ)/p]}}},Yi={cascadeCount:2,shadowMapResolution:2048};class C1{constructor(i,o){this.aabb=i,this.lastCascade=o}}class Hd{add(i,o){const u=this.receivers[i.key];u!==void 0?(u.aabb.min[0]=Math.min(u.aabb.min[0],o.min[0]),u.aabb.min[1]=Math.min(u.aabb.min[1],o.min[1]),u.aabb.min[2]=Math.min(u.aabb.min[2],o.min[2]),u.aabb.max[0]=Math.max(u.aabb.max[0],o.max[0]),u.aabb.max[1]=Math.max(u.aabb.max[1],o.max[1]),u.aabb.max[2]=Math.max(u.aabb.max[2],o.max[2])):this.receivers[i.key]=new C1(o,null)}clear(){this.receivers={}}get(i){return this.receivers[i.key]}computeRequiredCascades(i,o,u){const d=s.bV.fromPoints(i.points);let p=0;for(const _ in this.receivers){const y=this.receivers[_];if(!y||!d.intersectsAabb(y.aabb))continue;y.aabb.min=d.closestPoint(y.aabb.min),y.aabb.max=d.closestPoint(y.aabb.max);const b=y.aabb.getCorners();for(let T=0;T<u.length;T++){let E=!0;for(const I of b){const C=[I[0]*o,I[1]*o,I[2]];if(s.Q.transformMat4(C,C,u[T].matrix),C[0]<-1||C[0]>1||C[1]<-1||C[1]>1){E=!1;break}}if(y.lastCascade=T,p=Math.max(p,T),E)break}}return p+1}}class D1{constructor(i){this.painter=i,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new Hd,this._depthMode=new vt(i.context.gl.LEQUAL,vt.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,i.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),i.tp.registerParameter(Yi,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),i.tp.registerParameter(Yi,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),i.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const i of this._cascades)i.texture.destroy(),i.framebuffer.destroy();this._cascades=[]}updateShadowParameters(i,o){const u=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!o||!o.properties)return;const d=o.properties.get("shadow-intensity");if(!o.shadowsEnabled()||d<=0||(this._shadowLayerCount=u.style.order.reduce((k,O)=>{const B=u.style._mergedLayers[O];return k+(B.hasShadowPass()&&!B.isHidden(i.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const p=u.context,_=Yi.shadowMapResolution,y=Yi.shadowMapResolution;if(this._cascades.length===0||Yi.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let k=0;k<Yi.cascadeCount;++k){const O=u._shadowMapDebug,B=p.gl,F=p.createFramebuffer(_,y,O,"texture"),j=new s.T(p,{width:_,height:y,data:null},B.DEPTH_COMPONENT);if(F.depthAttachment.set(j.texture),O){const Q=new s.T(p,{width:_,height:y,data:null},B.RGBA);F.colorAttachment.set(Q.texture)}this._cascades.push({framebuffer:F,texture:j,matrix:[],far:0,boundingSphereRadius:0,frustum:new s.bt,scale:0})}}this.shadowDirection=ec(o);let b=0;if(i.elevation){const k=i.elevation,O=[1e4,-1e4];k.visibleDemTiles.filter(B=>B.dem).forEach(B=>{const F=B.dem.tree;O[0]=Math.min(O[0],F.minimums[0]),O[1]=Math.max(O[1],F.maximums[0])}),O[0]!==1e4&&(b=(O[1]-O[0])*k.exaggeration())}const T=1.5*i.cameraToCenterDistance,E=3*T,I=new Float64Array(16);for(let k=0;k<this._cascades.length;++k){const O=this._cascades[k];let B=i.height/50,F=1;Yi.cascadeCount===1?F=E:k===0?F=T:(B=T,F=E);const[j,Q]=tc(i,this.shadowDirection,B,F,Yi.shadowMapResolution,b);O.scale=i.scale,O.matrix=j,O.boundingSphereRadius=Q,s.a9.invert(I,O.matrix),O.frustum=s.bt.fromInvProjectionMatrix(I,1,0,!0),O.far=F}const C=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[C].far,this._cascades[C].far],this._uniformValues.u_shadow_intensity=d,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Yi.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Yi.shadowMapResolution,this._uniformValues.u_shadowmap_0=Xi.ShadowMap0,this._uniformValues.u_shadowmap_1=Xi.ShadowMap0+1,this._groundShadowTiles=u.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const D=u.transform.elevation;for(const k of this._groundShadowTiles){let O={min:0,max:0};if(D){const B=D.getMinMaxForTile(k);B&&(O=B)}this.addShadowReceiver(k.toUnwrapped(),O.min,O.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(i){this._enabled=i}drawShadowPass(i,o){if(!this.enabled)return;const u=this.painter,d=u.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(u.transform.getFrustum(0),u.transform.worldSize,this._cascades),d.viewport.set([0,0,Yi.shadowMapResolution,Yi.shadowMapResolution]);for(let p=0;p<this._numCascadesToRender;++p){u.currentShadowCascade=p,d.bindFramebuffer.set(this._cascades[p].framebuffer.framebuffer),d.clear({color:s.aA.white,depth:1});for(const _ of i.order){const y=i._mergedLayers[_];if(!y.hasShadowPass()||y.isHidden(u.transform.zoom))continue;const b=i.getLayerSourceCache(y),T=b?o[b.id]:void 0;(y.type==="model"||T&&T.length)&&u.renderLayer(u,b,y,T)}}u.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const i=this.painter,o=i.style,u=i.context,d=o.directionalLight,p=o.ambientLight;if(!d||!p)return;const _=[],y=Eo(i,i.longestCutoffRange);y.shouldRenderCutoff&&_.push("RENDER_CUTOFF");const b=Lu(d,p),T=new vt(u.gl.LEQUAL,vt.ReadOnly,i.depthRangeFor3D);for(const E of this._groundShadowTiles){const I=E.toUnwrapped(),C=i.isTileAffectedByFog(E),D=i.getOrCreateProgram("groundShadow",{defines:_,overrideFog:C});this.setupShadows(I,D),i.uploadCommonUniforms(u,D,I,null,y);const k={u_matrix:i.transform.calculateProjMatrix(I),u_ground_shadow_factor:b};D.draw(i,u.gl.TRIANGLES,T,Dt.disabled,Gt.multiply,Mt.disabled,k,"ground_shadow",i.tileExtentBuffer,i.quadTriangleIndexBuffer,i.tileExtentSegments,{},i.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Gt.unblended:Gt.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(i){const o=this.painter.transform,u=o.calculatePosMatrix(i,o.worldSize);return s.a9.multiply(u,this._cascades[this.painter.currentShadowCascade].matrix,u),Float32Array.from(u)}calculateShadowPassMatrixFromMatrix(i){return s.a9.multiply(i,this._cascades[this.painter.currentShadowCascade].matrix,i),Float32Array.from(i)}setupShadows(i,o,u,d=0){if(!this.enabled)return;const p=this.painter.transform,_=this.painter.context,y=_.gl,b=this._uniformValues,T=new Float64Array(16),E=p.calculatePosMatrix(i,p.worldSize);for(let I=0;I<this._cascades.length;I++)s.a9.multiply(T,this._cascades[I].matrix,E),b[I===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(T),_.activeTexture.set(y.TEXTURE0+Xi.ShadowMap0+I),this._cascades[I].texture.bind(y.NEAREST,y.CLAMP_TO_EDGE);if(this.useNormalOffset=!!u,this.useNormalOffset){const I=s.bU(i.canonical),C=2/p.tileSize*s.Y/Yi.shadowMapResolution,D=C*this._cascades[0].boundingSphereRadius,k=C*this._cascades[this._cascades.length-1].boundingSphereRadius,O=(u==="vector-tile"?1:3)/Math.pow(2,d-i.canonical.z-(1-p.zoom+Math.floor(p.zoom)));b.u_shadow_normal_offset=[I,D*O,k*O],b.u_shadow_bias=[6e-5,.0012,.012]}else b.u_shadow_bias=[36e-5,.0012,.012];o.setShadowUniformValues(_,b)}setupShadowsFromMatrix(i,o,u=!1){if(!this.enabled)return;const d=this.painter.context,p=d.gl,_=this._uniformValues,y=new Float64Array(16);for(let b=0;b<Yi.cascadeCount;b++)s.a9.multiply(y,this._cascades[b].matrix,i),_[b===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(y),d.activeTexture.set(p.TEXTURE0+Xi.ShadowMap0+b),this._cascades[b].texture.bind(p.NEAREST,p.CLAMP_TO_EDGE);this.useNormalOffset=u,u?(_.u_shadow_normal_offset=[1,5,5],_.u_shadow_bias=[6e-5,.0012,.012]):_.u_shadow_bias=[36e-5,.0012,.012],o.setShadowUniformValues(d,_)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(i,o,u,d){if(d[2]>=0)return{};const p=function(b,T,E){const I=E/(1<<b.canonical.z);return new s.bV([b.canonical.x*I+b.wrap*E,b.canonical.y*I+b.wrap*E,0],[(b.canonical.x+1)*I+b.wrap*E,(b.canonical.y+1)*I+b.wrap*E,T])}(i,o,u).getCorners(),_=o/-d[2];d[0]<0?(s.Q.add(p[0],p[0],[d[0]*_,0,0]),s.Q.add(p[3],p[3],[d[0]*_,0,0])):d[0]>0&&(s.Q.add(p[1],p[1],[d[0]*_,0,0]),s.Q.add(p[2],p[2],[d[0]*_,0,0])),d[1]<0?(s.Q.add(p[0],p[0],[0,d[1]*_,0]),s.Q.add(p[1],p[1],[0,d[1]*_,0])):d[1]>0&&(s.Q.add(p[2],p[2],[0,d[1]*_,0]),s.Q.add(p[3],p[3],[0,d[1]*_,0]));const y={};return y.vertices=p,y.planes=[Kl(p[1],p[0],p[4]),Kl(p[2],p[1],p[5]),Kl(p[3],p[2],p[6]),Kl(p[0],p[3],p[7])],y}addShadowReceiver(i,o,u){this._receivers.add(i,s.bV.fromTileIdAndHeight(i,o,u))}getMaxCascadeForTile(i){const o=this._receivers.get(i);return o&&o.lastCascade?o.lastCascade:0}}function Kl(c,i,o){const u=s.Q.sub([],o,i),d=s.Q.sub([],c,i),p=s.Q.cross([],u,d),_=s.Q.length(p);return _===0?[0,0,1,0]:(s.Q.scale(p,p,1/_),[p[0],p[1],p[2],-s.Q.dot(p,i)])}function ec(c){const i=c.properties.get("direction"),o=s.bT(i.x,i.y,i.z);o[2]=s.ad(o[2],0,75);const u=s.bW([o[0],o[1],o[2]]);return s.Q.fromValues(u.x,u.y,u.z)}function Lu(c,i){const o=c.properties.get("color"),u=c.properties.get("intensity"),d=c.properties.get("direction"),p=[d.x,d.y,d.z],_=i.properties.get("color"),y=i.properties.get("intensity"),b=Math.max(s.Q.dot([0,0,1],p),0),T=[0,0,0];s.Q.scale(T,_.toArray01Linear().slice(0,3),y);const E=[0,0,0];return s.Q.scale(E,o.toArray01Linear().slice(0,3),b*u),s.bX([T[0]>0?T[0]/(T[0]+E[0]):0,T[1]>0?T[1]/(T[1]+E[1]):0,T[2]>0?T[2]/(T[2]+E[2]):0])}function tc(c,i,o,u,d,p){const _=c.zoom,y=c.scale,b=c.worldSize,T=1/b,E=c.aspect,I=Math.sqrt(1+E*E)*Math.tan(.5*c.fovX),C=I*I,D=u-o,k=u+o;let O,B;C>D/k?(O=u,B=u*I):(O=.5*k*(1+C),B=.5*Math.sqrt(D*D+2*(u*u+o*o)*C+k*k*C*C));const F=c.projection.pixelsPerMeter(c.center.lat,b),j=c._camera.getCameraToWorldMercator(),Q=[0,0,-O*T];s.Q.transformMat4(Q,Q,j);let H=B*T;const Y=c._edgeInsets;if(!(Y.left===0&&Y.top===0&&Y.right===0&&Y.bottom===0||Y.left===Y.right&&Y.top===Y.bottom)){const X=c._camera.getWorldToCamera(c.worldSize,c.projection.zAxisUnit==="meters"?F:1),Ee=c._camera.getCameraToClipPerspective(c._fov,c.width/c.height,o,u);Ee[8]=2*-c.centerOffset.x/c.width,Ee[9]=2*c.centerOffset.y/c.height;const Je=new Float64Array(16);s.a9.mul(Je,Ee,X);const st=new Float64Array(16);s.a9.invert(st,Je);const _t=s.bt.fromInvProjectionMatrix(st,b,_,!0);for(const ht of _t.points){const xt=((N=ht)[0]/=y,N[1]/=y,N[2]=s.bo(N[2],c._center.lat),N);H=Math.max(H,s.Q.len(s.Q.subtract([],Q,xt)))}}var N;H*=d/(d-1);const $=Math.acos(i[2]),ie=Math.atan2(-i[0],-i[1]),te=new Oa;te.position=Q,te.setPitchBearing($,ie);const ae=te.getWorldToCamera(b,F),ge=H*b,se=Math.min(c._mercatorZfromZoom(17)*b*-2,-2*ge),me=te.getCameraToClipOrthographic(-ge,ge,-ge,ge,se,(ge+p*F)/i[2]),xe=new Float64Array(16);s.a9.multiply(xe,me,ae);const oe=s.Q.fromValues(Math.floor(1e6*Q[0])/1e6*b,Math.floor(1e6*Q[1])/1e6*b,0),fe=.5*d,Re=[0,0,0];s.Q.transformMat4(Re,oe,xe),s.Q.scale(Re,Re,fe);const ue=[Math.floor(Re[0]),Math.floor(Re[1]),Math.floor(Re[2])],_e=[0,0,0];s.Q.sub(_e,Re,ue),s.Q.scale(_e,_e,-1/fe);const ye=new Float64Array(16);return s.a9.identity(ye),s.a9.translate(ye,ye,_e),s.a9.multiply(xe,ye,xe),[xe,ge]}const Gn=(c,i)=>ot(c,i&&i.filter(o=>o.identifier!=="source.canvas")),z1=s.af(ar,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","updateImport"]),Qd=s.af(ar,["setCenter","setZoom","setBearing","setPitch"]),Ou={version:8,layers:[],sources:{}},ku={duration:300,delay:0};class Dn extends s.E{constructor(i,o={}){super(),this.map=i,this.scope=o.scope||"",this.globalId=null,this.fragments=[],this.importDepth=o.importDepth||0,this.importsCache=o.importsCache||new Map,this.resolvedImports=o.resolvedImports||new Set,this.transition=s.e({},ku),this._buildingIndex=new bu(this),this.crossTileSymbolIndex=new Du,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=o.styleChanges||new sr,this.dispatcher=o.dispatcher?o.dispatcher:new s.bZ(s.b_(),this),o.imageManager?this.imageManager=o.imageManager:(this.imageManager=new Vn,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=o.glyphManager?o.glyphManager:new s.b$(i._requestManager,o.localFontFamily?s.c0.all:o.localIdeographFontFamily?s.c0.ideographs:s.c0.none,o.localFontFamily||o.localIdeographFontFamily),o.modelManager?this.modelManager=o.modelManager:(this.modelManager=new vo(i._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=o.configOptions?o.configOptions:new Map,this._configDependentLayers=o.configDependentLayers?o.configDependentLayers:new Set,this._config=o.config,this._initialConfig=o.initialConfig,this.dispatcher.broadcast("setReferrer",s.c1());const u=this;this._rtlTextPluginCallback=Dn.registerForPluginStateChange(d=>{u.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:d.pluginStatus,pluginURL:d.pluginURL},(p,_)=>{if(s.c2(p),_&&_.every(y=>y))for(const y in u._sourceCaches){const b=u._sourceCaches[y],T=b.getSource().type;T!=="vector"&&T!=="geojson"||b.reload()}})}),this.on("data",d=>{if(d.dataType!=="source"||d.sourceDataType!=="metadata")return;const p=this.getOwnSource(d.sourceId);if(p&&p.vectorLayerIds)for(const _ in this._layers){const y=this._layers[_];y.source===p.id&&this._validateLayer(y)}})}load(i){return i?(typeof i=="string"?this.loadURL(i):this.loadJSON(i),this):this}_getGlobalId(i){if(!i)return null;if(typeof i=="string"){if(s.c3(i))return i;const o=s.c4(i);if(!o.startsWith("http"))try{return new URL(o,location.href).toString()}catch{return o}return o}return`json://${s.c5(JSON.stringify(i))}`}_diffStyle(i,o,u){this.globalId=this._getGlobalId(i);const d=(p,_)=>{try{_(null,this.setState(p,u))}catch(y){_(y,!1)}};if(typeof i=="string"){const p=this.map._requestManager.normalizeStyleURL(i),_=this.map._requestManager.transformRequest(p,s.R.Style);s.g(_,(y,b)=>{y?this.fire(new s.a(y)):b&&d(b,o)})}else typeof i=="object"&&d(i,o)}loadURL(i,o={}){this.fire(new s.b("dataloading",{dataType:"style"}));const u=typeof o.validate=="boolean"?o.validate:!s.c3(i);this.globalId=this._getGlobalId(i),i=this.map._requestManager.normalizeStyleURL(i,o.accessToken),this.resolvedImports.add(i);const d=this.importsCache.get(i);if(d)return this._load(d,u);const p=this.map._requestManager.transformRequest(i,s.R.Style);this._request=s.g(p,(_,y)=>{if(this._request=null,_)this.fire(new s.a(_));else if(y)return this.importsCache.set(i,y),this._load(y,u)})}loadJSON(i,o={}){this.fire(new s.b("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(i),this._request=s.f.frame(()=>{this._request=null,this._load(i,o.validate!==!1)})}loadEmpty(){this.fire(new s.b("dataloading",{dataType:"style"})),this._load(Ou,!1)}_loadImports(i,o,u){if(this.importDepth>=4)return s.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const d=[];for(const p of i){const _=this._createFragmentStyle(p),y=new Promise(E=>{_.once("style.import.load",E),_.once("error",E)}).then(()=>this.mergeAll());if(d.push(y),this.resolvedImports.has(p.url)){_.loadEmpty();continue}const b=p.data||this.importsCache.get(p.url);b?(_.loadJSON(b,{validate:o}),this._isInternalStyle(b)&&(_.globalId=null)):p.url?_.loadURL(p.url,{validate:o}):_.loadEmpty();const T={style:_,id:p.id,config:p.config};if(u){const E=this.fragments.findIndex(({id:I})=>I===u);this.fragments=this.fragments.slice(0,E).concat(T).concat(this.fragments.slice(E))}else this.fragments.push(T)}return Promise.allSettled(d)}getImportGlobalIds(i=this,o=new Set){for(const u of i.fragments)u.style.globalId&&o.add(u.style.globalId),this.getImportGlobalIds(u.style,o);return[...o.values()]}_createFragmentStyle(i){const o=this.scope?s.aj(i.id,this.scope):i.id;let u;const d=this._initialConfig&&this._initialConfig[o];(i.config||d)&&(u=s.e({},i.config,d));const p=new Dn(this.map,{scope:o,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:u,configOptions:this.options,configDependentLayers:this._configDependentLayers});return p.setEventedParent(this.map,{style:p}),p}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.isRootStyle()}_isInternalStyle(i){return this.isRootStyle()&&(i.fragment||!!i.schema&&i.fragment!==!1)}_load(i,o){const u=i.schema;if(this._isInternalStyle(i)){const y=s.e({},Ou,{imports:[{id:"basemap",data:i,url:""}]});return void this._load(y,o)}if(this.updateConfig(this._config,u),o&&Gn(this,Et(i)))return;this._loaded=!0,this.stylesheet=s.c6(i);for(const y in i.sources)this.addSource(y,i.sources[y],{validate:!1,isInitialLoad:!0});i.sprite?this._loadSprite(i.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(i.glyphs,this.scope);const d=w1(this.stylesheet.layers);if(this._order=d.map(y=>y.id),this.stylesheet.light&&s.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const y=this.stylesheet.lights[0];this.light=new gt(y.properties,y.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new gt(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(const y of d){const b=s.c7(y,this.scope,this.options);b.isConfigDependent&&this._configDependentLayers.add(b.fqid),b.setEventedParent(this,{layer:{id:b.id}}),this._layers[b.id]=b,this._serializedLayers[b.id]=b.serialize();const T=this.getOwnLayerSourceCache(b),E=!!this.directionalLight&&this.directionalLight.shadowsEnabled();T&&b.canCastShadows()&&E&&(T.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const p=this.stylesheet.terrain;p&&(this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=s.f.hasCanvasFingerprintNoise()),this.disableElevatedTerrain?s.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."):this.terrainSetForDrapingOnly()||this._createTerrain(p,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new s.b("data",{dataType:"style"}));const _=this.isRootStyle();i.imports?this._loadImports(i.imports,o).then(()=>{this._reloadImports(),this.fire(new s.b(_?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new s.b(_?"style.load":"style.import.load")))}isRootStyle(){return this.importDepth===0}mergeAll(){let i,o,u,d,p,_,y,b;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(T=>{if(T.stylesheet){if(T.light!=null&&(i=T.light),T.stylesheet.lights)for(const E of T.stylesheet.lights)E.type==="ambient"&&T.ambientLight!=null&&(o=T.ambientLight),E.type==="directional"&&T.directionalLight!=null&&(u=T.directionalLight);d=this._prioritizeTerrain(d,T.terrain,T.stylesheet.terrain),T.stylesheet.fog&&T.fog!=null&&(p=T.fog),T.stylesheet.camera!=null&&(b=T.stylesheet.camera),T.stylesheet.projection!=null&&(_=T.stylesheet.projection),T.stylesheet.transition!=null&&(y=T.stylesheet.transition)}}),this.light=i,this.ambientLight=o,this.directionalLight=u,this.fog=p,d===null?delete this.terrain:this.terrain=d,this.camera=b||{"camera-projection":"perspective"},this.projection=_||{name:"mercator"},this.transition=s.e({},ku,y),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(i){const o=u=>{for(const d of u.fragments)o(d.style);i(u)};o(this)}_prioritizeTerrain(i,o,u){const d=i&&i.drapeRenderMode===0;return u===null?o&&o.drapeRenderMode===0?o:d?i:null:o!=null&&(!i||d||o&&o.drapeRenderMode===1)?o:i}mergeTerrain(){let i;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(o=>{i=this._prioritizeTerrain(i,o.terrain,o.stylesheet.terrain)}),i===null?delete this.terrain:this.terrain=i}mergeProjection(){let i;this.forEachFragmentStyle(o=>{o.stylesheet.projection!=null&&(i=o.stylesheet.projection)}),this.projection=i||{name:"mercator"}}mergeSources(){const i={},o={},u={};this.forEachFragmentStyle(d=>{for(const p in d._sourceCaches){const _=s.aj(p,d.scope);i[_]=d._sourceCaches[p]}for(const p in d._otherSourceCaches){const _=s.aj(p,d.scope);o[_]=d._otherSourceCaches[p]}for(const p in d._symbolSourceCaches){const _=s.aj(p,d.scope);u[_]=d._symbolSourceCaches[p]}}),this._mergedSourceCaches=i,this._mergedOtherSourceCaches=o,this._mergedSymbolSourceCaches=u}mergeLayers(){const i={},o=[],u={};this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(p=>{for(const _ of p._order){const y=p._layers[_];if(y.type==="slot"){const b=s.c8(_);if(i[b])continue;i[b]=[]}y.slot&&i[y.slot]?i[y.slot].push(y):o.push(y)}}),this._mergedOrder=[];const d=(p=[])=>{for(const _ of p)if(_.type==="slot"){const y=s.c8(_.id);i[y]&&d(i[y])}else{const y=s.aj(_.id,_.scope);this._mergedOrder.push(y),u[y]=_,_.is3D()&&(this._has3DLayers=!0),_.type==="circle"&&(this._hasCircleLayers=!0),_.type==="symbol"&&(this._hasSymbolLayers=!0)}};d(o),this._mergedLayers=u,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(i){return this.stylesheet.camera=s.e({},this.stylesheet.camera,i),this.camera=this.stylesheet.camera,this}setProjection(i){i?this.stylesheet.projection=i:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(i){this._spriteRequest=function(o,u,d){let p,_,y;const b=s.f.devicePixelRatio>1?"@2x":"";let T=s.g(u.transformRequest(u.normalizeSpriteURL(o,b,".json"),s.R.SpriteJSON),(C,D)=>{T=null,y||(y=C,p=D,I())}),E=s.d(u.transformRequest(u.normalizeSpriteURL(o,b,".png"),s.R.SpriteImage),(C,D)=>{E=null,y||(y=C,_=D,I())});function I(){if(y)d(y);else if(p&&_){const C=s.f.getImageData(_),D={};for(const k in p){const{width:O,height:B,x:F,y:j,sdf:Q,pixelRatio:H,stretchX:Y,stretchY:N,content:$}=p[k],ie=new s.h({width:O,height:B});s.h.copy(C,ie,{x:F,y:j},{x:0,y:0},{width:O,height:B}),D[k]={data:ie,pixelRatio:H,sdf:Q,stretchX:Y,stretchY:N,content:$}}d(null,D)}}return{cancel(){T&&(T.cancel(),T=null),E&&(E.cancel(),E=null)}}}(i,this.map._requestManager,(o,u)=>{if(this._spriteRequest=null,o)this.fire(new s.a(o));else if(u)for(const d in u)this.imageManager.addImage(d,this.scope,u[d]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new s.b("data",{dataType:"style"}))})}_validateLayer(i){const o=this.getOwnSource(i.source);if(!o)return;const u=i.sourceLayer;u&&(o.type==="geojson"||o.vectorLayerIds&&o.vectorLayerIds.indexOf(u)===-1)&&this.fire(new s.a(new Error(`Source layer "${u}" does not exist on source "${o.id}" as specified by style layer "${i.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const i in this._sourceCaches)if(!this._sourceCaches[i].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded())return!1;for(const{style:i}of this.fragments)if(!i.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((i,o)=>{const u=this.fragments[o];return u&&u.style&&(i.data=u.style.serialize()),i})}_serializeSources(){const i={};for(const o in this._sourceCaches){const u=this._sourceCaches[o].getSource();i[u.id]||(i[u.id]=u.serialize())}return i}_serializeLayers(i){const o=[];for(const u of i){const d=this._layers[u];d&&d.type!=="custom"&&o.push(d.serialize())}return o}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(const i in this._sourceCaches)if(this._sourceCaches[i].hasTransition())return!0;for(const i in this._layers)if(this._layers[i].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(i){return!!this.terrain&&i.isDraped(this.getLayerSourceCache(i))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(i){const o=this.getOwnLayer(i);if(o)return o;this.fire(new s.a(new Error(`The layer '${i}' does not exist in the map's style.`)))}_checkSource(i){const o=this.getOwnSource(i);if(o)return o;this.fire(new s.a(new Error(`The source '${i}' does not exist in the map's style.`)))}update(i){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(i),this.directionalLight&&this.directionalLight.recalculate(i);const o=this.calculateLightsBrightness();i.brightness=o||0,o!==this._brightness&&(this._brightness=o,this.dispatcher.broadcast("setBrightness",o));const u=this._changes.isDirty();if(this._changes.isDirty()){const p=this._changes.getLayerUpdatesByScope();for(const _ in p){const{updatedIds:y,removedIds:b}=p[_];(y||b)&&this._updateWorkerLayers(_,y,b)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(i),this.light&&this.light.updateTransitions(i),this.ambientLight&&this.ambientLight.updateTransitions(i),this.directionalLight&&this.directionalLight.updateTransitions(i),this.fog&&this.fog.updateTransitions(i),this._changes.reset()}const d={};for(const p in this._mergedSourceCaches){const _=this._mergedSourceCaches[p];d[p]=_.used,_.used=!1,_.tileCoverLift=0}for(const p of this._mergedOrder){const _=this._mergedLayers[p];if(_.recalculate(i,this._availableImages),!_.isHidden(i.zoom)){const y=this.getLayerSourceCache(_);y&&(y.used=!0,y.tileCoverLift=Math.max(y.tileCoverLift,_.tileCoverLift()))}if(!this._precompileDone&&this._shouldPrecompile)for(let y=_.minzoom||0;y<(_.maxzoom||25.5);y++){const b=this.map.painter;if(b){const T=_.getProgramIds();if(!T)continue;for(const E of T){const I=_.getDefaultProgramParams(E,i.zoom);I&&(b.style=this,this.fog&&(b._fogVisible=!0,I.overrideFog=!0,b.getOrCreateProgram(E,I)),b._fogVisible=!1,I.overrideFog=!1,b.getOrCreateProgram(E,I),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(I.overrideRtt=!0,b.getOrCreateProgram(E,I)))}}}}this._shouldPrecompile&&(this._precompileDone=!0);for(const p in d){const _=this._mergedSourceCaches[p];d[p]!==_.used&&_.getSource().fire(new s.b("data",{sourceDataType:"visibility",dataType:"source",sourceId:_.getSource().id}))}this.light&&this.light.recalculate(i),this.terrain&&this.terrain.recalculate(i),this.fog&&this.fog.recalculate(i),this.z=i.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),u&&this.fire(new s.b("data",{dataType:"style"}))}_updateTilesForChangedImages(){const i=this._changes.getUpdatedImages();if(i.length){for(const o in this._sourceCaches)this._sourceCaches[o].reloadTilesForDependencies(["icons","patterns"],i);this._changes.resetUpdatedImages()}}_updateWorkerLayers(i,o,u){const d=this.getFragmentStyle(i);d&&this.dispatcher.broadcast("updateLayers",{layers:o?d._serializeLayers(o):[],scope:i,removedIds:u||[],options:d.options})}setState(i,o){if(this._checkLoaded(),Gn(this,Et(i)))return!1;(i=s.c6(i)).layers=w1(i.layers);const u=function(_,y){if(!_)return[{command:ar.setStyle,args:[y]}];let b=[];try{if(!ze(_.version,y.version))return[{command:ar.setStyle,args:[y]}];ze(_.center,y.center)||b.push({command:ar.setCenter,args:[y.center]}),ze(_.zoom,y.zoom)||b.push({command:ar.setZoom,args:[y.zoom]}),ze(_.bearing,y.bearing)||b.push({command:ar.setBearing,args:[y.bearing]}),ze(_.pitch,y.pitch)||b.push({command:ar.setPitch,args:[y.pitch]}),ze(_.sprite,y.sprite)||b.push({command:ar.setSprite,args:[y.sprite]}),ze(_.glyphs,y.glyphs)||b.push({command:ar.setGlyphs,args:[y.glyphs]}),ze(_.imports,y.imports)||function(D=[],k=[],O){k=k||[];const B=(D=D||[]).map(Ss),F=k.map(Ss),j=D.reduce(Aa,{}),Q=k.reduce(Aa,{}),H=B.slice();let Y,N,$,ie;for(Y=0,N=0;Y<B.length;Y++)$=B[Y],Q.hasOwnProperty($)?N++:(O.push({command:ar.removeImport,args:[$]}),H.splice(H.indexOf($,N),1));for(Y=0,N=0;Y<F.length;Y++)$=F[F.length-1-Y],H[H.length-1-Y]!==$&&(j.hasOwnProperty($)?(O.push({command:ar.removeImport,args:[$]}),H.splice(H.lastIndexOf($,H.length-N),1)):N++,ie=H[H.length-Y],O.push({command:ar.addImport,args:[Q[$],ie]}),H.splice(H.length-Y,0,$));for(const te of k){const ae=j[te.id];ae&&!ze(ae,te)&&O.push({command:ar.updateImport,args:[te.id,te]})}}(_.imports,y.imports,b),ze(_.transition,y.transition)||b.push({command:ar.setTransition,args:[y.transition]}),ze(_.light,y.light)||b.push({command:ar.setLight,args:[y.light]}),ze(_.fog,y.fog)||b.push({command:ar.setFog,args:[y.fog]}),ze(_.projection,y.projection)||b.push({command:ar.setProjection,args:[y.projection]}),ze(_.lights,y.lights)||b.push({command:ar.setLights,args:[y.lights]}),ze(_.camera,y.camera)||b.push({command:ar.setCamera,args:[y.camera]});const T={},E=[];(function(D,k,O,B){let F;for(F in k=k||{},D=D||{})D.hasOwnProperty(F)&&(k.hasOwnProperty(F)||wu(F,O,B));for(F in k){if(!k.hasOwnProperty(F))continue;const j=k[F];D.hasOwnProperty(F)?ze(D[F],j)||(D[F].type==="geojson"&&j.type==="geojson"&&Tu(D,k,F)?O.push({command:ar.setGeoJSONSourceData,args:[F,j.data]}):T1(F,k,O,B)):Fl(F,k,O)}})(_.sources,y.sources,E,T);const I=[];_.layers&&_.layers.forEach(D=>{D.source&&T[D.source]?b.push({command:ar.removeLayer,args:[D.id]}):I.push(D)});let C=_.terrain;C&&T[C.source]&&(b.push({command:ar.setTerrain,args:[void 0]}),C=void 0),b=b.concat(E),ze(C,y.terrain)||b.push({command:ar.setTerrain,args:[y.terrain]}),function(D,k,O){k=k||[];const B=(D=D||[]).map(Ss),F=k.map(Ss),j=D.reduce(Aa,{}),Q=k.reduce(Aa,{}),H=B.slice(),Y=Object.create(null);let N,$,ie,te,ae,ge,se;for(N=0,$=0;N<B.length;N++)ie=B[N],Q.hasOwnProperty(ie)?$++:(O.push({command:ar.removeLayer,args:[ie]}),H.splice(H.indexOf(ie,$),1));for(N=0,$=0;N<F.length;N++)ie=F[F.length-1-N],H[H.length-1-N]!==ie&&(j.hasOwnProperty(ie)?(O.push({command:ar.removeLayer,args:[ie]}),H.splice(H.lastIndexOf(ie,H.length-$),1)):$++,ge=H[H.length-N],O.push({command:ar.addLayer,args:[Q[ie],ge]}),H.splice(H.length-N,0,ie),Y[ie]=!0);for(N=0;N<F.length;N++)if(ie=F[N],te=j[ie],ae=Q[ie],!Y[ie]&&!ze(te,ae))if(ze(te.source,ae.source)&&ze(te["source-layer"],ae["source-layer"])&&ze(te.type,ae.type)){for(se in Wo(te.layout,ae.layout,O,ie,null,ar.setLayoutProperty),Wo(te.paint,ae.paint,O,ie,null,ar.setPaintProperty),ze(te.slot,ae.slot)||O.push({command:ar.setSlot,args:[ie,ae.slot]}),ze(te.filter,ae.filter)||O.push({command:ar.setFilter,args:[ie,ae.filter]}),ze(te.minzoom,ae.minzoom)&&ze(te.maxzoom,ae.maxzoom)||O.push({command:ar.setLayerZoomRange,args:[ie,ae.minzoom,ae.maxzoom]}),te)te.hasOwnProperty(se)&&se!=="layout"&&se!=="paint"&&se!=="filter"&&se!=="metadata"&&se!=="minzoom"&&se!=="maxzoom"&&se!=="slot"&&(se.indexOf("paint.")===0?Wo(te[se],ae[se],O,ie,se.slice(6),ar.setPaintProperty):ze(te[se],ae[se])||O.push({command:ar.setLayerProperty,args:[ie,se,ae[se]]}));for(se in ae)ae.hasOwnProperty(se)&&!te.hasOwnProperty(se)&&se!=="layout"&&se!=="paint"&&se!=="filter"&&se!=="metadata"&&se!=="minzoom"&&se!=="maxzoom"&&se!=="slot"&&(se.indexOf("paint.")===0?Wo(te[se],ae[se],O,ie,se.slice(6),ar.setPaintProperty):ze(te[se],ae[se])||O.push({command:ar.setLayerProperty,args:[ie,se,ae[se]]}))}else O.push({command:ar.removeLayer,args:[ie]}),ge=H[H.lastIndexOf(ie)+1],O.push({command:ar.addLayer,args:[ae,ge]})}(I,y.layers,b)}catch(T){console.warn("Unable to compute style diff:",T),b=[{command:ar.setStyle,args:[y]}]}return b}(this.serialize(),i).filter(_=>!(_.command in Qd));if(u.length===0)return!1;const d=u.filter(_=>!(_.command in z1));if(d.length>0)throw new Error(`Unimplemented: ${d.map(_=>_.command).join(", ")}.`);const p=[];return u.forEach(_=>{p.push(this[_.command].apply(this,_.args))}),o&&Promise.all(p).then(o),this.stylesheet=i,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(i,o){return this.getImage(i)?this.fire(new s.a(new Error("An image with this name already exists."))):(this.imageManager.addImage(i,this.scope,o),this._afterImageUpdated(i),this)}updateImage(i,o){this.imageManager.updateImage(i,this.scope,o)}getImage(i){return this.imageManager.getImage(i,this.scope)}removeImage(i){return this.getImage(i)?(this.imageManager.removeImage(i,this.scope),this._afterImageUpdated(i),this):this.fire(new s.a(new Error("No image with this name exists.")))}_afterImageUpdated(i){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(i),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new s.b("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(i,o,u={}){return this._checkLoaded(),this._validate(dt,`models.${i}`,o,null,u)||(this.modelManager.addModel(i,o,this.scope),this._changes.setDirty()),this}hasModel(i){return this.modelManager.hasModel(i,this.scope)}removeModel(i){return this.hasModel(i)?(this.modelManager.removeModel(i,this.scope),this):this.fire(new s.a(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(i,o,u={}){if(this._checkLoaded(),this.getOwnSource(i)!==void 0)throw new Error(`There is already a source with ID "${i}".`);if(!o.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(o).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(o.type)>=0&&this._validate(Ta,`sources.${i}`,o,null,u))return;this.map&&this.map._collectResourceTiming&&(o.collectResourceTiming=!0);const d=xu(i,o,this.dispatcher,this);d.scope=this.scope,d.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(d.id),source:d.serialize(),sourceId:d.id}));const p=_=>{const y=(_?"symbol:":"other:")+d.id,b=s.aj(y,this.scope),T=this._sourceCaches[y]=new In(b,d,_);(_?this._symbolSourceCaches:this._otherSourceCaches)[d.id]=T,T.onAdd(this.map)};p(!1),o.type!=="vector"&&o.type!=="geojson"||p(!0),d.onAdd&&d.onAdd(this.map),u.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(i){this._checkLoaded();const o=this.getOwnSource(i);if(!o)throw new Error("There is no source with this ID");for(const d in this._layers)if(this._layers[d].source===i)return this.fire(new s.a(new Error(`Source "${i}" cannot be removed while layer "${d}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===i)return this.fire(new s.a(new Error(`Source "${i}" cannot be removed while terrain is using it.`)));const u=this.getOwnSourceCaches(i);for(const d of u){const p=s.c8(d.id);delete this._sourceCaches[p],this._changes.discardSourceCacheUpdate(d.id),d.fire(new s.b("data",{sourceDataType:"metadata",dataType:"source",sourceId:d.getSource().id})),d.setEventedParent(null),d.clearTiles()}return delete this._otherSourceCaches[i],delete this._symbolSourceCaches[i],this.mergeSources(),o.setEventedParent(null),o.onRemove&&o.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(i,o){this._checkLoaded(),this.getOwnSource(i).setData(o),this._changes.setDirty()}getOwnSource(i){const o=this.getOwnSourceCache(i);return o&&o.getSource()}getOwnSources(){const i=[];for(const o in this._otherSourceCaches){const u=this.getOwnSourceCache(o);u&&i.push(u.getSource())}return i}areTilesLoaded(){const i=this._mergedSourceCaches;for(const o in i){const u=i[o]._tiles;for(const d in u){const p=u[d];if(p.state!=="loaded"&&p.state!=="errored")return!1}}return!0}setLights(i){if(this._checkLoaded(),!i)return delete this.ambientLight,void delete this.directionalLight;const o=this._getTransitionParameters();for(const d of i){if(this._validate(Ve,"lights",d))return;switch(d.type){case"ambient":if(this.ambientLight){const p=this.ambientLight;p.set(d),p.updateTransitions(o)}else this.ambientLight=new Bi(d,En,this.scope,this.options);break;case"directional":if(this.directionalLight){const p=this.directionalLight;p.set(d),p.updateTransitions(o)}else this.directionalLight=new Bi(d,ci,this.scope,this.options)}}const u=new s.N(this.z||0,o);this.ambientLight&&this.ambientLight.recalculate(u),this.directionalLight&&this.directionalLight.recalculate(u),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const i=this.directionalLight,o=this.ambientLight;if(!i||!o)return;const u=I=>.2126*(I[0]<=.03928?I[0]/12.92:Math.pow((I[0]+.055)/1.055,2.4))+.7152*(I[1]<=.03928?I[1]/12.92:Math.pow((I[1]+.055)/1.055,2.4))+.0722*(I[2]<=.03928?I[2]/12.92:Math.pow((I[2]+.055)/1.055,2.4)),d=i.properties.get("color").toArray01(),p=i.properties.get("intensity"),_=i.properties.get("direction"),y=1-s.bT(_.x,_.y,_.z)[2]/90,b=u(d)*p*y,T=o.properties.get("color").toArray01(),E=o.properties.get("intensity");return(b+u(T)*E)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const i=[];return this.directionalLight&&i.push(this.directionalLight.get()),this.ambientLight&&i.push(this.ambientLight.get()),i}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(i){if(!i)return this;if(s.c9(i)){const o=s.ca(i),u=this.fragments.find(({id:p})=>p===o);if(!u)throw new Error(`Style import not found: ${i}`);const d=s.c8(i);return u.style.getFragmentStyle(d)}{const o=this.fragments.find(({id:u})=>u===i);if(!o)throw new Error(`Style import not found: ${i}`);return o.style}}getConfigProperty(i,o){const u=this.getFragmentStyle(i);if(!u)return null;const d=s.aj(o,u.scope),p=u.options.get(d),_=p?p.value||p.default:null;return _?_.serialize():null}setConfigProperty(i,o,u){const d=this.getFragmentStyle(i);if(!d)return;const p=d.stylesheet.schema;if(!p||!p[o])return;const _=s.t(u);if(_.result!=="success")return void Gn(this,_.value);const y=_.value.expression,b=s.aj(o,d.scope),T=d.options.get(b);if(!T)return;let E;const{minValue:I,maxValue:C,stepValue:D,type:k,values:O}=p[o],B=s.t(p[o].default);B.result==="success"&&(E=B.value.expression),E?(this.options.set(b,{...T,value:y,default:E,minValue:I,maxValue:C,stepValue:D,type:k,values:O}),this.updateConfigDependencies()):this.fire(new s.a(new Error(`No schema defined for the config option "${o}" in the "${i}" fragment.`)))}getConfig(i){const o=this.getFragmentStyle(i);if(!o)return null;const u=o.stylesheet.schema;if(!u)return null;const d={};for(const p in u){const _=s.aj(p,o.scope),y=o.options.get(_),b=y?y.value||y.default:null;d[p]=b?b.serialize():null}return d}setConfig(i,o){const u=this.getFragmentStyle(i);u&&(u.updateConfig(o,u.stylesheet.schema),this.updateConfigDependencies())}getSchema(i){const o=this.getFragmentStyle(i);return o?o.stylesheet.schema:null}setSchema(i,o){const u=this.getFragmentStyle(i);u&&(u.stylesheet.schema=o,u.updateConfig(u._config,o),this.updateConfigDependencies())}updateConfig(i,o){if(this._config=i,i||o)if(o)for(const u in o){let d,p;const _=s.t(o[u].default);if(_.result==="success"&&(d=_.value.expression),i&&i[u]!==void 0){const C=s.t(i[u]);C.result==="success"&&(p=C.value.expression)}const{minValue:y,maxValue:b,stepValue:T,type:E,values:I}=o[u];if(d){const C=s.aj(u,this.scope);this.options.set(C,{default:d,value:p,minValue:y,maxValue:b,stepValue:T,type:E,values:I})}else this.fire(new s.a(new Error(`No schema defined for config option "${u}".`)))}else this.fire(new s.a(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(){for(const i of this._configDependentLayers){const o=this.getLayer(i);o&&(o.possiblyEvaluateVisibility(),this._updateLayer(o))}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this._changes.setDirty()}addLayer(i,o,u={}){this._checkLoaded();const d=i.id;if(this._layers[d])return void this.fire(new s.a(new Error(`Layer with id "${d}" already exists on this map`)));let p;if(i.type==="custom"){if(Gn(this,s.cb(i)))return;p=s.c7(i,this.scope,this.options)}else{if(typeof i.source=="object"&&(this.addSource(d,i.source),i=s.c6(i),i=s.e(i,{source:d})),this._validate(ce,`layers.${d}`,i,{arrayIndex:-1},u))return;p=s.c7(i,this.scope,this.options),this._validateLayer(p),p.setEventedParent(this,{layer:{id:d}}),this._serializedLayers[p.id]=p.serialize()}p.isConfigDependent&&this._configDependentLayers.add(p.fqid);let _=this._order.length;if(o){const E=this._order.indexOf(o);if(E===-1)return void this.fire(new s.a(new Error(`Layer with id "${o}" does not exist on this map.`)));p.slot===this._layers[o].slot?_=E:s.w(`Layer with id "${o}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(_,0,d),this._layerOrderChanged=!0,this._layers[d]=p;const y=this.getOwnLayerSourceCache(p),b=!!this.directionalLight&&this.directionalLight.shadowsEnabled();y&&p.canCastShadows()&&b&&(y.castsShadows=!0);const T=this._changes.getRemovedLayer(p);if(T&&p.source&&y&&p.type!=="custom"){this._changes.discardLayerRemoval(p);const E=s.aj(p.source,p.scope);T.type!==p.type?this._changes.updateSourceCache(E,"clear"):(this._changes.updateSourceCache(E,"reload"),y.pause())}this._updateLayer(p),p.onAdd&&p.onAdd(this.map),p.scope=this.scope,this.mergeLayers()}moveLayer(i,o){this._checkLoaded();const u=this._checkLayer(i);if(!u||i===o)return;const d=this._order.indexOf(i);this._order.splice(d,1);let p=this._order.length;if(o){const _=this._order.indexOf(o);if(_===-1)return void this.fire(new s.a(new Error(`Layer with id "${o}" does not exist on this map.`)));u.slot===this._layers[o].slot?p=_:s.w(`Layer with id "${o}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(p,0,i),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(i){this._checkLoaded();const o=this._checkLayer(i);if(!o)return;o.setEventedParent(null);const u=this._order.indexOf(i);this._order.splice(u,1),delete this._layers[i],delete this._serializedLayers[i],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(o.fqid),this._changes.removeLayer(o);const d=this.getOwnLayerSourceCache(o);if(d&&d.castsShadows){let p=!1;for(const _ in this._layers)if(this._layers[_].source===o.source&&this._layers[_].canCastShadows()){p=!0;break}d.castsShadows=p}o.onRemove&&o.onRemove(this.map),this.mergeLayers()}getOwnLayer(i){return this._layers[i]}hasLayer(i){return i in this._mergedLayers}hasLayerType(i){for(const o in this._layers)if(this._layers[o].type===i)return!0;return!1}setLayerZoomRange(i,o,u){this._checkLoaded();const d=this._checkLayer(i);d&&(d.minzoom===o&&d.maxzoom===u||(o!=null&&(d.minzoom=o),u!=null&&(d.maxzoom=u),this._updateLayer(d)))}setSlot(i,o){this._checkLoaded();const u=this._checkLayer(i);u&&u.slot!==o&&(u.slot=o,this._updateLayer(u))}setFilter(i,o,u={}){this._checkLoaded();const d=this._checkLayer(i);if(d&&!ze(d.filter,o))return o==null?(d.filter=void 0,void this._updateLayer(d)):void(this._validate(De,`layers.${d.id}.filter`,o,{layerType:d.type},u)||(d.filter=s.c6(o),this._updateLayer(d)))}getFilter(i){const o=this._checkLayer(i);if(o)return s.c6(o.filter)}setLayoutProperty(i,o,u,d={}){this._checkLoaded();const p=this._checkLayer(i);if(p&&!ze(p.getLayoutProperty(o),u)){if(u!=null&&(!d||d.validate!==!1)&&Gn(p,Ue.call(Et,{key:`layers.${i}.layout.${o}`,layerType:p.type,objectKey:o,value:u,styleSpec:s.G,style:{glyphs:!0,sprite:!0}})))return;p.setLayoutProperty(o,u),p.isConfigDependent&&this._configDependentLayers.add(p.fqid),this._updateLayer(p)}}getLayoutProperty(i,o){const u=this._checkLayer(i);if(u)return u.getLayoutProperty(o)}setPaintProperty(i,o,u,d={}){this._checkLoaded();const p=this._checkLayer(i);if(!p||ze(p.getPaintProperty(o),u)||u!=null&&(!d||d.validate!==!1)&&Gn(p,Oe.call(Et,{key:`layers.${i}.paint.${o}`,layerType:p.type,objectKey:o,value:u,styleSpec:s.G})))return;const _=p.setPaintProperty(o,u);p.isConfigDependent&&this._configDependentLayers.add(p.fqid),_&&this._updateLayer(p),this._changes.updatePaintProperties(p)}getPaintProperty(i,o){const u=this._checkLayer(i);if(u)return u.getPaintProperty(o)}setFeatureState(i,o){this._checkLoaded();const u=i.source,d=i.sourceLayer,p=this._checkSource(u);if(!p)return;const _=p.type;if(_==="geojson"&&d)return void this.fire(new s.a(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(_==="vector"&&!d)return void this.fire(new s.a(new Error("The sourceLayer parameter must be provided for vector source types.")));i.id===void 0&&this.fire(new s.a(new Error("The feature id parameter must be provided.")));const y=this.getOwnSourceCaches(u);for(const b of y)b.setFeatureState(d,i.id,o)}removeFeatureState(i,o){this._checkLoaded();const u=i.source,d=this._checkSource(u);if(!d)return;const p=d.type,_=p==="vector"?i.sourceLayer:void 0;if(p==="vector"&&!_)return void this.fire(new s.a(new Error("The sourceLayer parameter must be provided for vector source types.")));if(o&&typeof i.id!="string"&&typeof i.id!="number")return void this.fire(new s.a(new Error("A feature id is required to remove its specific state property.")));const y=this.getOwnSourceCaches(u);for(const b of y)b.removeFeatureState(_,i.id,o)}getFeatureState(i){this._checkLoaded();const o=i.source,u=i.sourceLayer,d=this._checkSource(o);if(d){if(d.type!=="vector"||u)return i.id===void 0&&this.fire(new s.a(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(o)[0].getFeatureState(u,i.id);this.fire(new s.a(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(i){return this.stylesheet.transition=s.e({},this.stylesheet.transition,i),this.transition=this.stylesheet.transition,this}getTransition(){return s.e({},this.stylesheet.transition)}serialize(){this._checkLoaded();const i=this.getTerrain(),o=i&&this.terrain&&this.terrain.scope===this.scope?i:this.stylesheet.terrain;return s.cc({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:o,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},u=>u!==void 0)}_updateLayer(i){this._changes.updateLayer(i);const o=this.getLayerSourceCache(i),u=s.aj(i.source,i.scope),d=this._changes.getUpdatedSourceCaches();i.source&&!d[u]&&o&&o.getSource().type!=="raster"&&(this._changes.updateSourceCache(u,"reload"),o.pause()),i.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(i){const o=y=>this._mergedLayers[y].type==="fill-extrusion"||this._mergedLayers[y].type==="model",u=this.order,d={},p=[];for(let y=u.length-1;y>=0;y--){const b=u[y];if(o(b)){d[b]=y;for(const T of i){const E=T[b];if(E)for(const I of E)p.push(I)}}}p.sort((y,b)=>b.intersectionZ-y.intersectionZ);const _=[];for(let y=u.length-1;y>=0;y--){const b=u[y];if(o(b))for(let T=p.length-1;T>=0;T--){const E=p[T].feature;if(d[E.layer.id]<y)break;_.push(E),p.pop()}else for(const T of i){const E=T[b];if(E)for(const I of E)_.push(I.feature)}}return _}queryRenderedFeatures(i,o,u){o&&o.filter&&this._validate(De,"queryRenderedFeatures.filter",o.filter,null,o),o.scope=this.scope,o.availableImages=this._availableImages,o.serializedLayers=this._serializedLayers;const d={};if(o&&o.layers){if(!Array.isArray(o.layers))return this.fire(new s.a(new Error("parameters.layers must be an Array."))),[];for(const T of o.layers){const E=this._mergedLayers[T];if(!E)return this.fire(new s.a(new Error(`The layer '${T}' does not exist in the map's style and cannot be queried for features.`))),[];d[E.source]=!0}}const p=[],_=o.serializedLayers||{},y=o&&o.layers?o.layers.some(T=>{const E=this.getLayer(T);return E&&E.is3D()}):this.has3DLayers(),b=Wr.createFromScreenPoints(i,u);for(const T in this._mergedSourceCaches){const E=this._mergedSourceCaches[T].getSource();if(!E||E.scope!==o.scope)continue;const I=this._mergedSourceCaches[T].getSource().id;o.layers&&!d[I]||p.push(er(this._mergedSourceCaches[T],this._mergedLayers,_,b,o,u,y,!!this.map._showQueryGeometry))}return this.placement&&p.push(function(T,E,I,C,D,k,O){const B={},F=k.queryRenderedSymbols(C),j=[];for(const Q of Object.keys(F).map(Number))j.push(O[Q]);j.sort(v1);for(const Q of j){const H=Q.featureIndex.lookupSymbolFeatures(F[Q.bucketInstanceId],E,Q.bucketIndex,Q.sourceLayerIndex,D.filter,D.layers,D.availableImages,T);for(const Y in H){const N=B[Y]=B[Y]||[],$=H[Y];$.sort((ie,te)=>{const ae=Q.featureSortOrder;if(ae){const ge=ae.indexOf(ie.featureIndex);return ae.indexOf(te.featureIndex)-ge}return te.featureIndex-ie.featureIndex});for(const ie of $)N.push(ie)}}for(const Q in B)B[Q].forEach(H=>{const Y=H.feature,N=I(T[Q]);if(!N)return;const $=N.getFeatureState(Y.layer["source-layer"],Y.id);Y.source=Y.layer.source,Y.layer["source-layer"]&&(Y.sourceLayer=Y.layer["source-layer"]),Y.state=$});return B}(this._mergedLayers,_,this.getLayerSourceCache.bind(this),b.screenGeometry,o,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(p)}querySourceFeatures(i,o){o&&o.filter&&this._validate(De,"querySourceFeatures.filter",o.filter,null,o);const u=this.getOwnSourceCaches(i);let d=[];for(const p of u)d=d.concat(Zi(p,o));return d}addSourceType(i,o,u){return Dn.getSourceType(i)?u(new Error(`A source type called "${i}" already exists.`)):(Dn.setSourceType(i,o),o.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:i,url:o.workerSourceURL},u):u(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(i,o,u={}){this._checkLoaded();const d=this.light.getLight();let p=!1;for(const y in i)if(!ze(i[y],d[y])){p=!0;break}if(!p)return;const _=this._getTransitionParameters();this.light.setLight(i,o,u),this.light.updateTransitions(_)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(i,o=1){if(this._checkLoaded(),!i)return this.terrainSetForDrapingOnly()&&o!==0||delete this.terrain,i===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let u=i;const d=i.source==null;if(o===1){if(typeof u.source=="object"){const y="terrain-dem-src";this.addSource(y,u.source),u=s.c6(u),u=s.e(u,{source:y})}const p=s.e({},u),_={};if(this.terrain&&d){p.source=this.terrain.get().source;const y=this.terrain?this.getFragmentStyle(this.terrain.scope):null;y&&(_.style=y.serialize())}if(this._validate(Z,"terrain",p,_))return}if(!this.terrain||this.terrain.scope!==this.scope&&!d||this.terrain&&o!==this.terrain.drapeRenderMode){if(!u)return;this._createTerrain(u,o),this.fire(new s.b("data",{dataType:"style"}))}else{const p=this.terrain,_=p.get();for(const y of Object.keys(s.G.terrain))!u.hasOwnProperty(y)&&s.G.terrain[y].default&&(u[y]=s.G.terrain[y].default);for(const y in i)if(!ze(i[y],_[y])){p.set(i,this.options),this.stylesheet.terrain=i;const b=this._getTransitionParameters({duration:0});p.updateTransitions(b),this.fire(new s.b("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(i){const o=this.fog=new Gi(i,this.map.transform,this.scope,this.options);this.stylesheet.fog=o.get();const u=this._getTransitionParameters({duration:0});o.updateTransitions(u)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const i of this.map._markers)i._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(i){if(this._checkLoaded(),!i)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const o=this.fog;if(!ze(o.get(),i)){o.set(i,this.options),this.stylesheet.fog=o.get();const u=this._getTransitionParameters({duration:0});o.updateTransitions(u)}}else this._createFog(i);this._markersNeedUpdate=!0}_getTransitionParameters(i){return{now:s.f.now(),transition:s.e(this.transition,i)}}updateDrapeFirstLayers(){if(!this.terrain)return;const i=[],o=[];for(const u in this._mergedLayers)this.isLayerDraped(this._mergedLayers[u])?i.push(u):o.push(u);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...i),this._drapedFirstOrder.push(...o)}_createTerrain(i,o){const u=this.terrain=new Sr(i,o,this.scope,this.options);o===1&&(this.stylesheet.terrain=i),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const d=this._getTransitionParameters({duration:0});u.updateTransitions(d)}_force3DLayerUpdate(){for(const i in this._layers){const o=this._layers[i];o.type==="fill-extrusion"&&this._updateLayer(o)}}_forceSymbolLayerUpdate(){for(const i in this._layers){const o=this._layers[i];o.type==="symbol"&&this._updateLayer(o)}}_validate(i,o,u,d,p={}){if(p&&p.validate===!1)return!1;const _=s.e({},this.serialize());return Gn(this,i.call(Et,s.e({key:o,style:_,value:u,styleSpec:s.G},d)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.cd.off("pluginStateChange",this._rtlTextPluginCallback);for(const i in this._mergedLayers)this._mergedLayers[i].setEventedParent(null);for(const i in this._mergedSourceCaches)this._mergedSourceCaches[i].clearTiles(),this._mergedSourceCaches[i].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(i){const o=this.getSourceCaches(i);for(const u of o)u.clearTiles()}clearSources(){for(const i in this._mergedSourceCaches)this._mergedSourceCaches[i].clearTiles()}reloadSource(i){const o=this.getSourceCaches(i);for(const u of o)u.resume(),u.reload()}reloadSources(){for(const i of this.getSources())i.reload&&i.reload()}updateSources(i){let o;this.directionalLight&&(o=ec(this.directionalLight));for(const u in this._mergedSourceCaches)this._mergedSourceCaches[u].update(i,void 0,void 0,o)}_generateCollisionBoxes(){for(const i in this._sourceCaches){const o=this._sourceCaches[i];o.resume(),o.reload()}}_updatePlacement(i,o,u,d,p=!1){let _=!1,y=!1;const b={},T={};for(const E of this._mergedOrder){const I=this._mergedLayers[E];if(I.type!=="symbol")continue;const C=s.aj(I.source,I.scope);let D=b[C];if(!D){const O=this.getLayerSourceCache(I);if(!O)continue;const B=O.getRenderableIds(!0).map(F=>O.getTileByID(F));T[C]=B.slice(),D=b[C]=B.sort((F,j)=>j.tileID.overscaledZ-F.tileID.overscaledZ||(F.tileID.isLessThan(j.tileID)?-1:1))}const k=this.crossTileSymbolIndex.addLayer(I,D,i.center.lng,i.projection);_=_||k}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),p=p||this._layerOrderChanged||u===0,this._layerOrderChanged&&this.fire(new s.b("neworder")),(p||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.f.now(),i.zoom))&&(this.pauseablePlacement=new za(i,this._mergedOrder,p,o,u,d,this.placement,this.fog&&i.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,b,T),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.f.now()),y=!0),_&&this.pauseablePlacement.placement.setStale()),y||_){this._buildingIndex.onNewFrame(i.zoom);for(const E of this._mergedOrder){const I=this._mergedLayers[E];I.type==="symbol"&&this.placement.updateLayerOpacities(I,b[s.aj(I.source,I.scope)])}}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.f.now())}_releaseSymbolFadeTiles(){for(const i in this._sourceCaches)this._sourceCaches[i].releaseSymbolFadeTiles()}addImport(i,o){this._checkLoaded();const u=this.stylesheet.imports=this.stylesheet.imports||[];if(u.findIndex(({id:p})=>p===i.id)!==-1)return void this.fire(new s.a(new Error(`Import with id '${i.id}' already exists in the map's style.`)));if(!o)return u.push(i),this._loadImports([i],!0);const d=u.findIndex(({id:p})=>p===o);return d===-1&&this.fire(new s.a(new Error(`Import with id "${o}" does not exist on this map.`))),this.stylesheet.imports=u.slice(0,d).concat(i).concat(u.slice(d)),this._loadImports([i],!0,o)}updateImport(i,o){this._checkLoaded();const u=this.stylesheet.imports||[],d=this.getImportIndex(i);return d===-1?this:typeof o=="string"?(this.setImportUrl(i,o),this):(o.url&&o.url!==u[d].url&&this.setImportUrl(i,o.url),ze(o.config,u[d].config)||this.setImportConfig(i,o.config),ze(o.data,u[d].data)||this.setImportData(i,o.data),this)}moveImport(i,o){this._checkLoaded();let u=this.stylesheet.imports||[];const d=this.getImportIndex(i);if(d===-1)return this;const p=this.getImportIndex(o);if(p===-1)return this;const _=u[d],y=this.fragments[d];return u=u.filter(({id:b})=>b!==i),this.fragments=this.fragments.filter(({id:b})=>b!==i),this.stylesheet.imports=u.slice(0,p).concat(_).concat(u.slice(p)),this.fragments=this.fragments.slice(0,p).concat(y).concat(this.fragments.slice(p)),this.mergeLayers(),this}setImportUrl(i,o){this._checkLoaded();const u=this.stylesheet.imports||[],d=this.getImportIndex(i);if(d===-1)return this;u[d].url=o;const p=this.fragments[d];return p.style=this._createFragmentStyle(u[d]),p.style.on("style.import.load",()=>this.mergeAll()),p.style.loadURL(o),this}setImportData(i,o){this._checkLoaded();const u=this.getImportIndex(i),d=this.stylesheet.imports||[];return u===-1?this:o?(this.fragments[u].style.setState(o),this._reloadImports(),this):(delete d[u].data,this.setImportUrl(i,d[u].url))}setImportConfig(i,o){this._checkLoaded();const u=this.getImportIndex(i),d=this.stylesheet.imports||[];if(u===-1)return this;o?d[u].config=o:delete d[u].config;const p=this.fragments[u],_=p.style.stylesheet&&p.style.stylesheet.schema;return p.config=o,p.style.updateConfig(o,_),this.updateConfigDependencies(),this}removeImport(i){this._checkLoaded();const o=this.stylesheet.imports||[],u=this.getImportIndex(i);u!==-1&&(o.splice(u,1),this.fragments[u].style._remove(),this.fragments.splice(u,1),this._reloadImports())}getImportIndex(i){const o=(this.stylesheet.imports||[]).findIndex(u=>u.id===i);return o===-1&&this.fire(new s.a(new Error(`Import '${i}' does not exist in the map's style and cannot be updated.`))),o}getLayer(i){return this._mergedLayers[i]}getSources(){const i=[];for(const o in this._mergedOtherSourceCaches){const u=this._mergedOtherSourceCaches[o];u&&i.push(u.getSource())}return i}getSource(i,o){const u=this.getSourceCache(i,o);return u&&u.getSource()}getLayerSource(i){const o=this.getLayerSourceCache(i);return o&&o.getSource()}getSourceCache(i,o){const u=s.aj(i,o);return this._mergedOtherSourceCaches[u]}getLayerSourceCache(i){const o=s.aj(i.source,i.scope);return i.type==="symbol"?this._mergedSymbolSourceCaches[o]:this._mergedOtherSourceCaches[o]}getSourceCaches(i){if(i==null)return Object.values(this._mergedSourceCaches);const o=[];return this._mergedOtherSourceCaches[i]&&o.push(this._mergedOtherSourceCaches[i]),this._mergedSymbolSourceCaches[i]&&o.push(this._mergedSymbolSourceCaches[i]),o}updateSourceCaches(){const i=this._changes.getUpdatedSourceCaches();for(const o in i){const u=i[o];u==="reload"?this.reloadSource(o):u==="clear"&&this.clearSource(o)}}updateLayers(i){const o=this._changes.getUpdatedPaintProperties();for(const u of o){const d=this.getLayer(u);d&&d.updateTransitions(i)}}getImages(i,o,u){this.imageManager.getImages(o.icons,o.scope,u),this._updateTilesForChangedImages();const d=p=>{p&&p.setDependencies(o.tileID.key,o.type,o.icons)};d(this._otherSourceCaches[o.source]),d(this._symbolSourceCaches[o.source])}getGlyphs(i,o,u){this.glyphManager.getGlyphs(o.stacks,o.scope,u)}getResource(i,o,u){return s.ce(o,u)}getOwnSourceCache(i){return this._otherSourceCaches[i]}getOwnLayerSourceCache(i){return i.type==="symbol"?this._symbolSourceCaches[i.source]:this._otherSourceCaches[i.source]}getOwnSourceCaches(i){const o=[];return this._otherSourceCaches[i]&&o.push(this._otherSourceCaches[i]),this._symbolSourceCaches[i]&&o.push(this._symbolSourceCaches[i]),o}_isSourceCacheLoaded(i){const o=this.getOwnSourceCaches(i);return o.length===0?(this.fire(new s.a(new Error(`There is no source with ID '${i}'`))),!1):o.every(u=>u.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(i=>{i.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Dn.getSourceType=function(c){return He[c]},Dn.setSourceType=function(c,i){He[c]=i},Dn.registerForPluginStateChange=s.bY;var ka=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Bu=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color) {
#ifdef INDICATOR_CUTOUT
float holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,vec2 pos,vec2 lod_coord) {vec2 size=vec2(textureSize(image,0));vec2 dx=dFdx(lod_coord.xy*size);vec2 dy=dFdy(lod_coord.xy*size);float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}`,rc=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,Ao="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",ic=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture(u_depth,uv-df.xz)),unpack_depth(texture(u_depth,uv+df.xz)),unpack_depth(texture(u_depth,uv-df.zy)),unpack_depth(texture(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,Yo=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Fu=`highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {
#ifdef FOG_DITHERING
vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);
#else
return color;
#endif
}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Ba=`#ifdef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,nc=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec4 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=vec2(u_data_offset+dot(t.rg,u_data_scale.yx),-(u_data_offset+dot(t.ba,u_data_scale.yx)));velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,Fa=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,oc=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef NATIVE
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const gr=[];Mo(ka,gr),Mo(rc,gr),Mo(Bu,gr);const jt={"_prelude_fog.vertex.glsl":Yo,"_prelude_terrain.vertex.glsl":ic,"_prelude_shadow.vertex.glsl":Fa,"_prelude_fog.fragment.glsl":Fu,"_prelude_shadow.fragment.glsl":oc,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":Ba,"_prelude_raster_particle.glsl":nc},Na={};$t("",ic),$t(Fu,Yo),$t(oc,Fa),$t(Ba,""),$t(nc,"");const Va=$t(Bu,rc),sc=ka;var zn={background:$t(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:$t(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:$t(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:$t("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:$t(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:$t(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:$t("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in float a_size_scale;in vec2 a_padding;in float a_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(a_z_offset+elevation(a_anchor_pos)),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:$t("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:$t("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:$t(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:$t(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:$t(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:$t(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:$t(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
uniform float u_emissive_strength;in float v_height;void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,u_emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=max(0.01,cutoff_opacity(u_cutoff_params,ground.z));if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff < 0.01 && centroid_pos.x !=0.0));gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:$t(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:$t(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
out vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:$t(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:$t(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:$t(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:$t(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:$t(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {    
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trimmed,out_color.rgb,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:$t(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform mediump float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 v_uv;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float pattern_x=v_linesofar/pattern_size.x*aspect;float x=mod(pattern_x,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {color=vec4(0,0,0,0);}}
#endif
#ifdef LINE_JOIN_NONE
float pattern_len=pattern_size.x/aspect;float segment_phase=pattern_len-mod((v_linesofar-v_pattern_data.x),pattern_len);float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_ground(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 a_packed;
#endif
in float a_linesofar;
#ifdef LINE_JOIN_NONE
in vec2 a_pattern_data;out vec2 v_pattern_data;
#endif
uniform mat4 u_matrix;uniform mediump float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec4 v_uv;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
float a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef LINE_JOIN_NONE
v_width+=ANTIALIASING;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5/u_tile_units_to_pixels;v_linesofar+=line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:$t(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:$t(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:$t("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-vec2(1.0),0.0,1.0);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:$t("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:$t(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp float speed=velocity==INVALID_VELOCITY ? 0.0 : length(velocity);highp float reset_rate_bump=speed*u_reset_rate;highp vec2 particle_pos_min=-u_particle_pos_offset;highp vec2 particle_pos_max=vec2(1.0)+u_particle_pos_offset;highp vec2 pos_drop_rate=vec2(1.0)-step(particle_pos_min,pos)+step(particle_pos_max,pos);highp float drop_rate=max(u_reset_rate+reset_rate_bump,length(pos_drop_rate));highp float drop=step(1.0-drop_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbolIcon:$t(`#include "_prelude_lighting.glsl"
uniform sampler2D u_texture;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
in float v_fade_opacity;in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
lowp float alpha=opacity*v_fade_opacity;vec4 out_color;
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
out_color*=alpha;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
v_tex_a=a_tex/u_texsize;
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
v_fade_opacity=out_fade_opacity;}`),symbolSDF:$t(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;in float v_draw_halo;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}`),symbolTextAndIcon:$t(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;in float v_draw_halo;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}`),terrainRaster:$t(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:$t("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:$t(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Ao),skyboxGradient:$t(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Ao),skyboxCapture:$t(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:$t(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:$t(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;
#ifndef NATIVE
c=dither(c,gl_FragCoord.xy+u_temporal_offset);
#endif
glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:$t(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;bool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;highp float depth=unpack_depth(texture(u_depthTexture,coord));return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
return vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);color=mix(color,v_color_mix.rgb,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=u_matrix*pos;pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normalize(normal_3f));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:$t(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=u_matrix*pos;
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:$t(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`)};function Mo(c,i){const o=c.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let u of o)if(u=u.trim(),u[0]==="#"&&u.includes("if")&&!u.includes("endif")){u=u.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const d=u.split(" ");for(const p of d)i.includes(p)||i.push(p)}}function $t(c,i){const o=/#include\s+"([^"]+)"/g,u=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let d=i.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);d&&(d=d.map(T=>{const E=T.split(" ");return E[E.length-1]}),d=[...new Set(d)]);const p={},_=[],y=[];if(c=c.replace(o,(T,E)=>(y.push(E),"")),(i=i.replace(o,(T,E)=>(_.push(E),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let b=[...gr];Mo(c,b),Mo(i,b);for(const T of[..._,...y])jt[T]||console.error(`Undefined include: ${T}`),Na[T]||(Na[T]=[],Mo(jt[T],Na[T])),b=[...b,...Na[T]];return{fragmentSource:c=c.replace(u,(T,E,I,C,D)=>(p[D]=!0,E==="define"?`
#ifndef HAS_UNIFORM_u_${D}
in ${I} ${C} ${D};
#else
uniform ${I} ${C} u_${D};
#endif
`:E==="initialize"?`
#ifdef HAS_UNIFORM_u_${D}
    ${I} ${C} ${D} = u_${D};
#endif
`:E==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${D}
    in ${I} ${C} ${D};
#endif
`:E==="initialize-attribute"?"":void 0)),vertexSource:i=i.replace(u,(T,E,I,C,D)=>{const k=C==="float"?"vec2":C,O=D.match(/color/)?"color":k;return E==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${D}
in ${I} ${C} a_${D};
#endif
`:p[D]?E==="define"?`
#ifndef HAS_UNIFORM_u_${D}
uniform lowp float u_${D}_t;
in ${I} ${k} a_${D};
out ${I} ${C} ${D};
#else
uniform ${I} ${C} u_${D};
#endif
`:E==="initialize"?O==="vec4"?`
#ifndef HAS_UNIFORM_u_${D}
    ${D} = a_${D};
#else
    ${I} ${C} ${D} = u_${D};
#endif
`:`
#ifndef HAS_UNIFORM_u_${D}
    ${D} = unpack_mix_${O}(a_${D}, u_${D}_t);
#else
    ${I} ${C} ${D} = u_${D};
#endif
`:E==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${D}
    in ${I} ${C} a_${D};
    out ${I} ${C} ${D};
#endif
`:E==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${D}
    ${D} = a_${D};
#endif
`:void 0:E==="define"?`
#ifndef HAS_UNIFORM_u_${D}
uniform lowp float u_${D}_t;
in ${I} ${k} a_${D};
#else
uniform ${I} ${C} u_${D};
#endif
`:E==="define-instanced"?O==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${D}0;
in vec4 a_${D}1;
in vec4 a_${D}2;
in vec4 a_${D}3;
#else
uniform ${I} ${C} u_${D};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${I} ${k} a_${D};
#else
uniform ${I} ${C} u_${D};
#endif
`:E==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${D}
    ${I} ${C} ${D} = a_${D};
#endif
`:O==="vec4"?`
#ifndef HAS_UNIFORM_u_${D}
    ${I} ${C} ${D} = a_${D};
#else
    ${I} ${C} ${D} = u_${D};
#endif
`:`
#ifndef HAS_UNIFORM_u_${D}
    ${I} ${C} ${D} = unpack_mix_${O}(a_${D}, u_${D}_t);
#else
    ${I} ${C} ${D} = u_${D};
#endif
`}),staticAttributes:d,usedDefines:b,vertexIncludes:_,fragmentIncludes:y}}class it{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(i,o,u,d,p,_,y,b){this.context=i;let T=this.boundPaintVertexBuffers.length!==d.length;for(let I=0;!T&&I<d.length;I++)this.boundPaintVertexBuffers[I]!==d[I]&&(T=!0);let E=this.boundDynamicVertexBuffers.length!==y.length;for(let I=0;!E&&I<y.length;I++)this.boundDynamicVertexBuffers[I]!==y[I]&&(E=!0);if(!this.vao||this.boundProgram!==o||this.boundLayoutVertexBuffer!==u||T||E||this.boundIndexBuffer!==p||this.boundVertexOffset!==_)this.freshBind(o,u,d,p,_,y,b);else{i.bindVertexArrayOES.set(this.vao);for(const I of y)I&&(I.bind(),b&&I.instanceCount&&I.setVertexAttribDivisor(i.gl,o,b));p&&p.dynamicDraw&&p.bind()}}freshBind(i,o,u,d,p,_,y){const b=i.numAttributes,T=this.context,E=T.gl;this.vao&&this.destroy(),this.vao=T.gl.createVertexArray(),T.bindVertexArrayOES.set(this.vao),this.boundProgram=i,this.boundLayoutVertexBuffer=o,this.boundPaintVertexBuffers=u,this.boundIndexBuffer=d,this.boundVertexOffset=p,this.boundDynamicVertexBuffers=_,o.enableAttributes(E,i),o.bind(),o.setVertexAttribPointers(E,i,p);for(const I of u)I.enableAttributes(E,i),I.bind(),I.setVertexAttribPointers(E,i,p);for(const I of _)I&&(I.enableAttributes(E,i),I.bind(),I.setVertexAttribPointers(E,i,p),y&&I.instanceCount&&I.setVertexAttribDivisor(E,i,y));d&&d.bind(),T.currentNumAttributes=b}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function lr(c,i){const o=Math.pow(2,i.canonical.z),u=i.canonical.y;return[new s.O(0,u/o).toLngLat().lat,new s.O(0,(u+1)/o).toLngLat().lat]}function cr(c,i,o,u,d,p,_){const y=c.context,b=y.gl,T=o.hillshadeFBO;if(!T)return;c.prepareDrawTile();const E=c.isTileAffectedByFog(i),I=c.getOrCreateProgram("hillshade",{overrideFog:E});y.activeTexture.set(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,T.colorAttachment.get());const C=((B,F,j,Q)=>{const H=j.paint.get("hillshade-shadow-color"),Y=j.paint.get("hillshade-highlight-color"),N=j.paint.get("hillshade-accent-color"),$=j.paint.get("hillshade-emissive-strength");let ie=s.bm(j.paint.get("hillshade-illumination-direction"));if(j.paint.get("hillshade-illumination-anchor")==="viewport")ie-=B.transform.angle;else if(B.style&&B.style.enable3dLights()&&B.style.directionalLight){const ae=B.style.directionalLight.properties.get("direction"),ge=s.bT(ae.x,ae.y,ae.z);ie=s.bm(ge[1])}const te=!B.options.moving;return{u_matrix:Q||B.transform.calculateProjMatrix(F.tileID.toUnwrapped(),te),u_image:0,u_latrange:lr(0,F.tileID),u_light:[j.paint.get("hillshade-exaggeration"),ie],u_shadow:H,u_highlight:Y,u_emissive_strength:$,u_accent:N}})(c,o,u,c.terrain?i.projMatrix:null);c.uploadCommonUniforms(y,I,i.toUnwrapped());const{tileBoundsBuffer:D,tileBoundsIndexBuffer:k,tileBoundsSegments:O}=c.getTileBoundsBuffers(o);I.draw(c,b.TRIANGLES,d,p,_,Mt.disabled,C,u.id,D,k,O)}function un(c,i,o){if(!i.needsDEMTextureUpload)return;const u=c.context,d=u.gl;u.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||c.getTileTexture(o.stride);const p=o.getPixels();i.demTexture?i.demTexture.update(p,{premultiply:!1}):i.demTexture=new s.T(u,p,d.R32F,{premultiply:!1}),i.needsDEMTextureUpload=!1}function zs(c,i,o){const u=c.context,d=u.gl;if(!i.dem)return;const p=i.dem;if(u.activeTexture.set(d.TEXTURE1),un(c,i,p),!i.demTexture)return;i.demTexture.bind(d.NEAREST,d.CLAMP_TO_EDGE);const _=p.dim;u.activeTexture.set(d.TEXTURE0);let y=i.hillshadeFBO;if(!y){const C=new s.T(u,{width:_,height:_,data:null},d.RGBA);C.bind(d.LINEAR,d.CLAMP_TO_EDGE),y=i.hillshadeFBO=u.createFramebuffer(_,_,!0,"renderbuffer"),y.colorAttachment.set(C.texture)}u.bindFramebuffer.set(y.framebuffer),u.viewport.set([0,0,_,_]);const{tileBoundsBuffer:b,tileBoundsIndexBuffer:T,tileBoundsSegments:E}=c.getMercatorTileBoundsBuffers(),I=[];c.linearFloatFilteringSupported()&&I.push("TERRAIN_DEM_FLOAT_FORMAT"),c.getOrCreateProgram("hillshadePrepare",{defines:I}).draw(c,d.TRIANGLES,vt.disabled,Dt.disabled,Gt.unblended,Mt.disabled,((C,D)=>{const k=D.stride,O=s.a9.create();return s.a9.ortho(O,0,s.Y,-s.Y,0,0,1),s.a9.translate(O,O,[0,-s.Y,0]),{u_matrix:O,u_image:1,u_dimension:[k,k],u_zoom:C.overscaledZ}})(i.tileID,p),o.id,b,T,E),i.needsHillshadePrepare=!1}const tr=c=>({u_matrix:new s.bN(c),u_image0:new s.bR(c),u_skirt_height:new s.bQ(c),u_ground_shadow_factor:new s.bP(c)}),Ua=(c,i,o)=>({u_matrix:c,u_image0:0,u_skirt_height:i,u_ground_shadow_factor:o}),Rs=(c,i,o,u,d,p,_,y,b,T,E,I,C,D,k,O)=>({u_proj_matrix:Float32Array.from(c),u_globe_matrix:i,u_normalize_matrix:Float32Array.from(u),u_merc_matrix:o,u_zoom_transition:d,u_merc_center:p,u_image0:0,u_frustum_tl:_,u_frustum_tr:y,u_frustum_br:b,u_frustum_bl:T,u_globe_pos:E,u_globe_radius:I,u_viewport:C,u_grid_matrix:O?Float32Array.from(O):new Float32Array(9),u_skirt_height:D,u_far_z_cutoff:k});function Ls(c,i){return c!=null&&i!=null&&!(!c.hasData()||!i.hasData())&&c.demTexture!=null&&i.demTexture!=null&&c.tileID.key!==i.tileID.key}const vi=new class{constructor(){this.operations={}}newMorphing(c,i,o,u,d){if(c in this.operations){const p=this.operations[c];p.to.tileID.key!==o.tileID.key&&(p.queued=o)}else this.operations[c]={startTime:u,phase:0,duration:d,from:i,to:o,queued:null}}getMorphValuesForProxy(c){if(!(c in this.operations))return null;const i=this.operations[c];return{from:i.from,to:i.to,phase:i.phase}}update(c){for(const i in this.operations){const o=this.operations[i];for(o.phase=(c-o.startTime)/o.duration;o.phase>=1||!this._validOp(o);)if(!this._nextOp(o,c)){delete this.operations[i];break}}}_nextOp(c,i){return!!c.queued&&(c.from=c.to,c.to=c.queued,c.queued=null,c.phase=0,c.startTime=i,!0)}_validOp(c){return c.from.hasData()&&c.to.hasData()}},Kr={0:null,1:"TERRAIN_VERTEX_MORPHING"};function R1(c,i,o){if(i===0)return 0;const u=i<1&&o===514?.25/i:1;return 6*Math.pow(1.5,22-c)*Math.max(i,1)*u}function ja(c,i){const o=1<<c.z;return!i&&(c.x===0||c.x===o-1)||c.y===0||c.y===o-1}const Ga=c=>({u_matrix:c});function Jo(c,i,o,u,d){if(d>0){const p=s.f.now(),_=(p-c.timeAdded)/d,y=i?(p-i.timeAdded)/d:-1,b=o.getSource(),T=u.coveringZoomLevel({tileSize:b.tileSize,roundZoom:b.roundZoom}),E=!i||Math.abs(i.tileID.overscaledZ-T)>Math.abs(c.tileID.overscaledZ-T),I=E&&c.refreshedUponExpiration?1:s.ad(E?_:1-y,0,1);return c.refreshedUponExpiration&&_>=1&&(c.refreshedUponExpiration=!1),i?{opacity:1,mix:1-I}:{opacity:I,mix:0}}return{opacity:1,mix:0}}class Nu extends In{constructor(i){const o={type:"raster-dem",maxzoom:i.transform.maxZoom},u=new s.bZ(s.b_(),null),d=xu("mock-dem",o,u,i.style);super("mock-dem",d,!1),d.setEventedParent(this),this._sourceLoaded=!0}_loadTile(i,o){i.state="loaded",o(null)}}class ac extends In{constructor(i){const o=xu("proxy",{type:"geojson",maxzoom:i.transform.maxZoom},new s.bZ(s.b_(),null),i.style);super("proxy",o,!1),o.setEventedParent(this),this.map=this.getSource().map=i,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(i,o,u){if(i.freezeTileCoverage)return;this.transform=i;const d=i.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((p,_)=>{if(p[_.key]="",!this._tiles[_.key]){const y=new Mn(_,this._source.tileSize*_.overscaleFactor(),i.tileZoom);y.state="loaded",this._tiles[_.key]=y}return p},{});for(const p in this._tiles)p in d||(this.freeFBO(p),this._tiles[p].unloadVectorData(),delete this._tiles[p])}freeFBO(i){const o=this.proxyCachedFBO[i];if(o!==void 0){const u=Object.values(o);this.renderCachePool.push(...u),delete this.proxyCachedFBO[i]}}deallocRenderCache(){this.renderCache.forEach(i=>i.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Ii extends s.ap{constructor(i,o,u){super(i.overscaledZ,i.wrap,i.canonical.z,i.canonical.x,i.canonical.y),this.proxyTileKey=o,this.projMatrix=u}}class hn extends s.cp{constructor(i,o){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},i.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),i.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),i.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=i,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[u,d,p]=function(b){const T=new s.aQ,E=new s.az,I=131;T.reserve(17161),E.reserve(33800);const C=s.Y/128,D=s.Y+C/2,k=D+C;for(let B=-C;B<k;B+=C)for(let F=-C;F<k;F+=C){const j=F<0||F>D||B<0||B>D?24575:0,Q=s.ad(Math.round(F),0,s.Y),H=s.ad(Math.round(B),0,s.Y);T.emplaceBack(Q+j,H)}const O=(B,F)=>{const j=F*I+B;E.emplaceBack(j+1,j,j+I),E.emplaceBack(j+I,j+I+1,j+1)};for(let B=1;B<129;B++)for(let F=1;F<129;F++)O(F,B);return[0,129].forEach(B=>{for(let F=0;F<130;F++)O(F,B),O(B,F)}),[T,E,32768]}(),_=i.context;this.gridBuffer=_.createVertexBuffer(u,s.aS.members),this.gridIndexBuffer=_.createIndexBuffer(d),this.gridSegments=s.aE.simpleSegment(0,0,u.length,d.length),this.gridNoSkirtSegments=s.aE.simpleSegment(0,0,u.length,p),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new ac(o.map),this.orthoMatrix=s.a9.create(),s.a9.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,s.Y,0,s.Y,0,1);const y=_.gl;this._overlapStencilMode=new Dt({func:y.GEQUAL,mask:255},0,255,y.KEEP,y.KEEP,y.REPLACE),this._previousZoom=i.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=o,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Nu(o.map),this._pendingGroundEffectLayers=[]}set style(i){i.on("data",this._onStyleDataEvent.bind(this)),this._style=i,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(i,o,u){if(i&&i.terrain){this._style!==i&&(this.style=i,this._evaluationZoom=void 0);const d=i.terrain.properties,p=i.terrain.drapeRenderMode===0,_=i.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=s.f.now();const y=i.terrain&&i.terrain.scope,b=d.get("source"),T=p?this._mockSourceCache:i.getSourceCache(b,y);if(!T)return void s.w(`Couldn't find terrain source "${b}".`);if(this.sourceCache=T,this._exaggeration=_?this.calculateExaggeration(o):d.get("exaggeration"),!o.projection.requiresDraping&&_&&this._exaggeration===0)return void this._disable();this.enabled=!0;const E=()=>{this.sourceCache.used&&s.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const I=this.getScaledDemTileSize();this.sourceCache.update(o,I,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,E(),this._initializing=!0),E(),o.updateElevation(!0,u),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(o),this._emptyDEMTextureDirty=!0,this._previousZoom=o.zoom}else this._disable()}calculateExaggeration(i){const o=this._previousCameraAltitude,u=i.getFreeCameraOptions().position.z/i.pixelsPerMeter*i.worldSize;this._previousCameraAltitude=u;const d=o!=null?u-o:Number.MAX_VALUE;if(Math.abs(d)<2)return this._exaggeration;const p=i.zoom,_=this._style.terrain;if(!this._previousUpdateTimestamp)return _.getExaggeration(p);let y=p-this._previousZoom;const b=this._previousUpdateTimestamp;let T=p;this._evaluationZoom!=null&&(T=this._evaluationZoom,Math.abs(p-T)>.5&&(y=.5*(p-T+y)),y*d<0&&(T+=y)),this._evaluationZoom=T;const E=_.getExaggeration(T),I=E===_.getExaggeration(Math.max(0,T-.1));if(I&&Math.abs(E-this._exaggeration)<.01)return E;let C=Math.min(.1,.00375*(this._updateTimestamp-b));return(I||E<.1||Math.abs(y)<1e-4)&&(C=Math.min(.2,4*C)),s.X(this._exaggeration,E,C)}resetTileLookupCache(i){this._findCoveringTileCache[i]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(i){i.coord&&i.dataType==="source"?this._clearRenderCacheForTile(i.sourceCacheId,i.coord):i.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const i in this._style._mergedSourceCaches)this._style._mergedSourceCaches[i].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(i=>i.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const i=2*this.proxySourceCache.getSource().tileSize;return[i,i]}set useVertexMorphing(i){this._useVertexMorphing=i}updateTileBinding(i){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const o=this.proxySourceCache,u=this.painter.transform;this._initializing&&(this._initializing=u._centerAltitude===0&&this.getAtPointOrZero(s.O.fromLngLat(u.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const d=this.proxyCoords=o.getIds().map(b=>{const T=o.getTileByID(b).tileID;return T.projMatrix=u.calculateProjMatrix(T.toUnwrapped()),T});(function(b,T){const E=T.transform.pointCoordinate(T.transform.getCameraPoint()),I=new s.P(E.x,E.y);b.sort((C,D)=>{if(D.overscaledZ-C.overscaledZ)return D.overscaledZ-C.overscaledZ;const k=new s.P(C.canonical.x+(1<<C.canonical.z)*C.wrap,C.canonical.y),O=new s.P(D.canonical.x+(1<<D.canonical.z)*D.wrap,D.canonical.y),B=I.mult(1<<C.canonical.z);return B.x-=.5,B.y-=.5,B.distSqr(k)-B.distSqr(O)})})(d,this.painter);const p=this.proxyToSource||{};this.proxyToSource={},d.forEach(b=>{this.proxyToSource[b.key]={}}),this.terrainTileForTile={};const _=this._style._mergedSourceCaches;for(const b in _){const T=_[b];if(!T.used||(T!==this.sourceCache&&this.resetTileLookupCache(T.id),this._setupProxiedCoordsForOrtho(T,i[b],p),T.usedForTerrain))continue;const E=i[b];T.getSource().reparseOverscaled&&this._assignTerrainTiles(E)}this.proxiedCoords[o.id]=d.map(b=>new Ii(b,b.key,this.orthoMatrix)),this._assignTerrainTiles(d),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(p),this.renderingToTexture=!1;const y={};this._visibleDemTiles=[];for(const b of this.proxyCoords){const T=this.terrainTileForTile[b.key];if(!T)continue;const E=T.tileID.key;E in y||(this._visibleDemTiles.push(T),y[E]=E)}}_assignTerrainTiles(i){this._initializing||i.forEach(o=>{if(this.terrainTileForTile[o.key])return;const u=this._findTileCoveringTileID(o,this.sourceCache);u&&(this.terrainTileForTile[o.key]=u)})}_prepareDEMTextures(){const i=this.painter.context,o=i.gl;for(const u in this.terrainTileForTile){const d=this.terrainTileForTile[u],p=d.dem;!p||d.demTexture&&!d.needsDEMTextureUpload||(i.activeTexture.set(o.TEXTURE1),un(this.painter,d,p))}}_prepareDemTileUniforms(i,o,u,d){if(!o||o.demTexture==null)return!1;const p=i.tileID.canonical,_=Math.pow(2,o.tileID.canonical.z-p.z),y=d||"";return u[`u_dem_tl${y}`]=[p.x*_%1,p.y*_%1],u[`u_dem_scale${y}`]=_,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const i=this.painter.context,o=i.gl;if(!this._emptyDepthBufferTexture){const u=new s.h({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new s.T(i,u,o.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let i=0;const o=this._visibleDemTiles.reduce((u,d)=>{if(!d.dem)return u;const p=d.dem.tree.minimums[0];return p>0&&i++,u+p},0);return i?o/i:0}_updateEmptyDEMTexture(){const i=this.painter.context,o=i.gl;i.activeTexture.set(o.TEXTURE2);const u=this._getLoadedAreaMinimum(),[d,p]=(()=>{const y=new s.cr({width:1,height:1},new Float32Array([u]));return[o.R32F,y]})();this._emptyDEMTextureDirty=!1;let _=this._emptyDEMTexture;return _?_.update(p,{premultiply:!1}):_=this._emptyDEMTexture=new s.T(i,p,d,{premultiply:!1}),_}setupElevationDraw(i,o,u){const d=this.painter.context,p=d.gl,_={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0};_.u_exaggeration=this.exaggeration();let y=null,b=null,T=1;if(u&&u.morphing&&this._useVertexMorphing){const C=u.morphing.srcDemTile,D=u.morphing.dstDemTile;T=u.morphing.phase,C&&D&&(this._prepareDemTileUniforms(i,C,_,"_prev")&&(b=C),this._prepareDemTileUniforms(i,D,_)&&(y=D))}const E=C=>C&&C.demTexture&&this.painter.linearFloatFilteringSupported()?p.LINEAR:p.NEAREST,I=C=>{_.u_dem_size=C.size[0]===1?1:C.size[0]-2};if(b&&y)d.activeTexture.set(p.TEXTURE2),y.demTexture.bind(E(y),p.CLAMP_TO_EDGE),d.activeTexture.set(p.TEXTURE4),b.demTexture.bind(E(b),p.CLAMP_TO_EDGE),y.demTexture&&I(y.demTexture),_.u_dem_lerp=T;else{y=this.terrainTileForTile[i.tileID.key],d.activeTexture.set(p.TEXTURE2);const C=this._prepareDemTileUniforms(i,y,_)?y.demTexture:this.emptyDEMTexture;C.bind(E(y),p.CLAMP_TO_EDGE),I(C)}if(d.activeTexture.set(p.TEXTURE3),u&&u.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(p.NEAREST,p.CLAMP_TO_EDGE),this._depthFBO&&(_.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(p.NEAREST,p.CLAMP_TO_EDGE),_.u_depth_size_inv=[1,1]),u&&u.useMeterToDem&&y){const C=(1<<y.tileID.canonical.z)*s.bo(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;_.u_meter_to_dem=C}if(u&&u.labelPlaneMatrixInv&&(_.u_label_plane_matrix_inv=u.labelPlaneMatrixInv),o.setTerrainUniformValues(d,_),this.painter.transform.projection.name==="globe"){const C=this.globeUniformValues(this.painter.transform,i.tileID.canonical,u&&u.useDenormalizedUpVectorScale);o.setGlobeUniformValues(d,C)}}globeUniformValues(i,o,u){const d=i.projection;return{u_tile_tl_up:d.upVector(o,0,0),u_tile_tr_up:d.upVector(o,s.Y,0),u_tile_br_up:d.upVector(o,s.Y,s.Y),u_tile_bl_up:d.upVector(o,0,s.Y),u_tile_up_scale:u?s.cq(1):d.upVectorScale(o,i.center.lat,i.worldSize).metersToTile}}renderToBackBuffer(i){const o=this.painter,u=this.painter.context;i.length!==0&&(u.bindFramebuffer.set(null),u.viewport.set([0,0,o.width,o.height]),o.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(d,p,_,y,b){if(d.transform.projection.name==="globe")(function(T,E,I,C,D){const k=T.context,O=k.gl;let B,F;const j=T.transform,Q=s.ci(T,k,j),H=(me,xe)=>{if(F===xe)return;const oe=[Kr[xe],"PROJECTION_GLOBE_VIEW"];Q&&oe.push("CUSTOM_ANTIALIASING");const fe=T.isTileAffectedByFog(me);B=T.getOrCreateProgram("globeRaster",{defines:oe,overrideFog:fe}),F=xe},Y=T.colorModeForRenderPass(),N=new vt(O.LEQUAL,vt.ReadWrite,T.depthRangeFor3D);vi.update(D);const $=s.cj(j),ie=[s.a8(j.center.lng),s.ah(j.center.lat)],te=T.globeSharedBuffers,ae=[j.width*s.f.devicePixelRatio,j.height*s.f.devicePixelRatio],ge=Float32Array.from(j.globeMatrix),se={useDenormalizedUpVectorScale:!0};{const me=T.transform,xe=R1(me.zoom,E.exaggeration(),E.sourceCache._source.tileSize);F=-1;const oe=O.TRIANGLES;for(const fe of C){const Re=I.getTile(fe),ue=Dt.disabled,_e=E.prevTerrainTileForTile[fe.key],ye=E.terrainTileForTile[fe.key];Ls(_e,ye)&&vi.newMorphing(fe.key,_e,ye,D,250),k.activeTexture.set(O.TEXTURE0),Re.texture&&Re.texture.bind(O.LINEAR,O.CLAMP_TO_EDGE);const X=vi.getMorphValuesForProxy(fe.key),Ee=X?1:0;X&&s.k(se,{morphing:{srcDemTile:X.from,dstDemTile:X.to,phase:s.ch(X.phase)}});const Je=s.ck(fe.canonical),st=s.cl(Je.getCenter().lat),_t=s.cm(fe.canonical,Je,st,me.worldSize/me._pixelsPerMercatorPixel),ht=s.aW(s.cn(fe.canonical)),xt=Rs(me.expandedFarZProjMatrix,ge,$,ht,s.W(me.zoom),ie,me.frustumCorners.TL,me.frustumCorners.TR,me.frustumCorners.BR,me.frustumCorners.BL,me.globeCenterInViewSpace,me.globeRadius,ae,xe,me._farZ,_t);if(H(fe,Ee),B&&(E.setupElevationDraw(Re,B,se),T.uploadCommonUniforms(k,B,fe.toUnwrapped()),te)){const[Qt,Ct,Jt]=te.getGridBuffers(st,xe!==0);B.draw(T,oe,N,ue,Y,Mt.backCCW,xt,"globe_raster",Qt,Ct,Jt)}}}if(te&&(T.renderDefaultNorthPole||T.renderDefaultSouthPole)){const me=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];Q&&me.push("CUSTOM_ANTIALIASING"),B=T.getOrCreateProgram("globeRaster",{defines:me});for(const xe of C){const{x:oe,y:fe,z:Re}=xe.canonical,ue=fe===0,_e=fe===(1<<Re)-1,[ye,X,Ee,Je]=te.getPoleBuffers(Re,!1);if(Je&&(ue||_e)){const st=I.getTile(xe);k.activeTexture.set(O.TEXTURE0),st.texture&&st.texture.bind(O.LINEAR,O.CLAMP_TO_EDGE);let _t=s.co(Re,oe,j);const ht=s.aW(s.cn(xe.canonical)),xt=(Qt,Ct)=>Qt.draw(T,O.TRIANGLES,N,Dt.disabled,Y,Mt.disabled,Rs(j.expandedFarZProjMatrix,_t,_t,ht,0,ie,j.frustumCorners.TL,j.frustumCorners.TR,j.frustumCorners.BR,j.frustumCorners.BL,j.globeCenterInViewSpace,j.globeRadius,ae,0,j._farZ),"globe_pole_raster",Ct,Ee,Je);E.setupElevationDraw(st,B,se),T.uploadCommonUniforms(k,B,xe.toUnwrapped()),ue&&T.renderDefaultNorthPole&&xt(B,ye),_e&&T.renderDefaultSouthPole&&(_t=s.a9.scale(s.a9.create(),_t,[1,-1,1]),xt(B,X))}}}})(d,p,_,y,b);else{const T=d.context,E=T.gl;let I,C;const D=d.shadowRenderer,k=Eo(d,d.longestCutoffRange),O=Y=>{if(C===Y)return;const N=[];N.push(Kr[Y]),k.shouldRenderCutoff&&N.push("RENDER_CUTOFF"),I=d.getOrCreateProgram("terrainRaster",{defines:N}),C=Y},B=d.colorModeForRenderPass(),F=new vt(E.LEQUAL,vt.ReadWrite,d.depthRangeFor3D);vi.update(b);const j=d.transform,Q=R1(j.zoom,p.exaggeration(),p.sourceCache._source.tileSize);let H=[0,0,0];if(D){const Y=d.style.directionalLight,N=d.style.ambientLight;Y&&N&&(H=Lu(Y,N))}{C=-1;const Y=E.TRIANGLES,[N,$]=[p.gridIndexBuffer,p.gridSegments];for(const ie of y){const te=_.getTile(ie),ae=Dt.disabled,ge=p.prevTerrainTileForTile[ie.key],se=p.terrainTileForTile[ie.key];Ls(ge,se)&&vi.newMorphing(ie.key,ge,se,b,250),T.activeTexture.set(E.TEXTURE0),te.texture&&te.texture.bind(E.LINEAR,E.CLAMP_TO_EDGE);const me=vi.getMorphValuesForProxy(ie.key),xe=me?1:0;let oe;me&&(oe={morphing:{srcDemTile:me.from,dstDemTile:me.to,phase:s.ch(me.phase)}});const fe=Ua(ie.projMatrix,ja(ie.canonical,j.renderWorldCopies)?Q/10:Q,H);if(O(xe),!I)continue;p.setupElevationDraw(te,I,oe);const Re=ie.toUnwrapped();D&&D.setupShadows(Re,I),d.uploadCommonUniforms(T,I,Re,null,k),I.draw(d,Y,F,ae,B,Mt.backCCW,fe,"terrain_raster",p.gridBuffer,N,$)}}}}(o,this,this.proxySourceCache,i,this._updateTimestamp),this.renderingToTexture=!0,o.gpuTimingDeferredRenderEnd(),i.splice(0,i.length))}renderBatch(i){if(this._drapedRenderBatches.length===0)return i+1;this.renderingToTexture=!0;const o=this.painter,u=this.painter.context,d=this.proxySourceCache,p=this.proxiedCoords[d.id],_=this._drapedRenderBatches.shift(),y=o.style.order,b=[];let T=0;for(const E of p){const I=d.getTileByID(E.proxyTileKey),C=d.proxyCachedFBO[E.key]?d.proxyCachedFBO[E.key][i]:void 0,D=C!==void 0?d.renderCache[C]:this.pool[T++],k=C!==void 0;if(I.texture=D.tex,k&&!D.dirty){b.push(I.tileID);continue}let O;u.bindFramebuffer.set(D.fb.framebuffer),this.renderedToTile=!1,D.dirty&&(u.clear({color:s.aA.transparent,stencil:0}),D.dirty=!1);for(let B=_.start;B<=_.end;++B){const F=o.style._mergedLayers[y[B]];if(F.isHidden(o.transform.zoom))continue;const j=o.style.getLayerSourceCache(F),Q=j?this.proxyToSource[E.key][j.id]:[E];if(!Q)continue;const H=Q;u.viewport.set([0,0,D.fb.width,D.fb.height]),O!==(j?j.id:null)&&(this._setupStencil(D,Q,F,j),O=j?j.id:null),o.renderLayer(o,j,F,H)}if(this._drapedRenderBatches.length===0)for(const B of this._pendingGroundEffectLayers){const F=o.style._mergedLayers[y[B]];if(F.isHidden(o.transform.zoom))continue;const j=o.style.getLayerSourceCache(F),Q=j?this.proxyToSource[E.key][j.id]:[E];if(!Q)continue;const H=Q;u.viewport.set([0,0,D.fb.width,D.fb.height]),O!==(j?j.id:null)&&(this._setupStencil(D,Q,F,j),O=j?j.id:null),o.renderLayer(o,j,F,H)}this.renderedToTile?(D.dirty=!0,b.push(I.tileID)):k||--T,T===5&&(T=0,this.renderToBackBuffer(b))}return this.renderToBackBuffer(b),this.renderingToTexture=!1,u.bindFramebuffer.set(null),u.viewport.set([0,0,o.width,o.height]),_.end+1}postRender(){}isLayerOrderingCorrect(i){const o=i.order.length;let u=-1,d=o;for(let p=0;p<o;++p)this._style.isLayerDraped(i._mergedLayers[i.order[p]])?u=Math.max(u,p):d=Math.min(d,p);return d>u}getMinElevationBelowMSL(){let i=0;return this._visibleDemTiles.filter(o=>o.dem).forEach(o=>{i=Math.min(i,o.dem.tree.minimums[0])}),i===0?i:(i-30)*this._exaggeration}raycast(i,o,u){if(!this._visibleDemTiles)return null;const d=this._visibleDemTiles.filter(p=>p.dem).map(p=>{const _=p.tileID,y=1<<_.overscaledZ,{x:b,y:T}=_.canonical,E=b/y,I=(b+1)/y,C=T/y,D=(T+1)/y;return{minx:E,miny:C,maxx:I,maxy:D,t:p.dem.tree.raycastRoot(E,C,I,D,i,o,u),tile:p}});d.sort((p,_)=>(p.t!==null?p.t:Number.MAX_VALUE)-(_.t!==null?_.t:Number.MAX_VALUE));for(const p of d){if(p.t==null)return null;const _=p.tile.dem.tree.raycast(p.minx,p.miny,p.maxx,p.maxy,i,o,u);if(_!=null)return _}return null}_createFBO(){const i=this.painter.context,o=i.gl,u=this.drapeBufferSize;i.activeTexture.set(o.TEXTURE0);const d=new s.T(i,{width:u[0],height:u[1],data:null},o.RGBA);d.bind(o.LINEAR,o.CLAMP_TO_EDGE);const p=i.createFramebuffer(u[0],u[1],!0,null);return p.colorAttachment.set(d.texture),p.depthAttachment=new qd(i,p.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=i.createRenderbuffer(i.gl.DEPTH_STENCIL,u[0],u[1]),this._stencilRef=0,p.depthAttachment.set(this._sharedDepthStencil),i.clear({stencil:0})):p.depthAttachment.set(this._sharedDepthStencil),i.extTextureFilterAnisotropic&&o.texParameterf(o.TEXTURE_2D,i.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,i.extTextureFilterAnisotropicMax),{fb:p,tex:d,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const i in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[i].hasTransition())return!0;return this._style.order.some(i=>{const o=this._style._mergedLayers[i],u=o.isHidden(this.painter.transform.zoom);return o.type==="custom"?!u&&o.shouldRedrape():!u&&o.hasTransition()})}_clearLineLayersFromRenderCache(){let i=!1;for(const u of this._style.getSources())if(u instanceof Xe){i=!0;break}if(!i)return;const o={};for(let u=0;u<this._style.order.length;++u){const d=this._style._mergedLayers[this._style.order[u]],p=this._style.getLayerSourceCache(d);if(p&&!o[p.id]&&!d.isHidden(this.painter.transform.zoom)&&d.type==="line"&&d.widthExpression()instanceof s.Z){o[p.id]=!0;for(const _ of this.proxyCoords){const y=this.proxyToSource[_.key][p.id];if(y)for(const b of y)this._clearRenderCacheForTile(p.id,b)}}}}_clearRasterLayersFromRenderCache(){let i=!1;for(const u in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[u]._source instanceof Ye){i=!0;break}if(!i)return;const o={};for(let u=0;u<this._style.order.length;++u){const d=this._style._mergedLayers[this._style.order[u]],p=this._style.getLayerSourceCache(d);if(!p||o[p.id]||d.isHidden(this.painter.transform.zoom)||d.type!=="raster")continue;const _=d.paint.get("raster-fade-duration");for(const y of this.proxyCoords){const b=this.proxyToSource[y.key][p.id];if(b)for(const T of b){const E=Jo(p.getTile(T),p.findLoadedParent(T,0),p,this.painter.transform,_);(E.opacity!==1||E.mix!==0)&&this._clearRenderCacheForTile(p.id,T)}}}}_setupDrapedRenderBatches(){const i=this._style.order,o=i.length;if(o===0)return;const u=[];this._pendingGroundEffectLayers=[];let d,p=0,_=this._style._mergedLayers[i[p]];for(;!this._style.isLayerDraped(_)&&_.isHidden(this.painter.transform.zoom)&&++p<o;)_=this._style._mergedLayers[i[p]];for(;p<o;++p){const y=this._style._mergedLayers[i[p]];y.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(y)?d===void 0&&(d=p):(y.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(p),d!==void 0&&(u.push({start:d,end:p-1}),d=void 0)))}if(d!==void 0&&u.push({start:d,end:p-1}),u.length!==0){const y=u[u.length-1];this._pendingGroundEffectLayers.every(b=>b>y.end)||s.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=u}_setupRenderCache(i){const o=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,o.renderCache.length>o.renderCachePool.length){const _=Object.values(o.proxyCachedFBO);o.proxyCachedFBO={};for(let y=0;y<_.length;++y){const b=Object.values(_[y]);o.renderCachePool.push(...b)}}return}this._clearRasterLayersFromRenderCache();const u=this.proxyCoords,d=this._tilesDirty;for(let _=u.length-1;_>=0;_--){const y=u[_];if(o.getTileByID(y.key),o.proxyCachedFBO[y.key]!==void 0){const b=i[y.key],T=this.proxyToSource[y.key];let E=0;for(const I in T){const C=T[I],D=b[I];if(!D||D.length!==C.length||C.some((k,O)=>k!==D[O]||d[I]&&d[I].hasOwnProperty(k.key))){E=-1;break}++E}for(const I in o.proxyCachedFBO[y.key])o.renderCache[o.proxyCachedFBO[y.key][I]].dirty=E<0||E!==Object.values(b).length}}const p=[...this._drapedRenderBatches];p.sort((_,y)=>y.end-y.start-(_.end-_.start));for(const _ of p)for(const y of u){if(o.proxyCachedFBO[y.key])continue;let b=o.renderCachePool.pop();b===void 0&&o.renderCache.length<50&&(b=o.renderCache.length,o.renderCache.push(this._createFBO())),b!==void 0&&(o.proxyCachedFBO[y.key]={},o.proxyCachedFBO[y.key][_.start]=b,o.renderCache[b].dirty=!0)}this._tilesDirty={}}_setupStencil(i,o,u,d){if(!d||!this._sourceTilesOverlap[d.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const p=this.painter.context,_=p.gl;if(o.length<=1)return void(this._overlapStencilType=!1);let y;if(u.isTileClipped())y=o.length,this._overlapStencilMode.test={func:_.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(o[0].overscaledZ>o[o.length-1].overscaledZ))return void(this._overlapStencilType=!1);y=1,this._overlapStencilMode.test={func:_.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+y>255&&(p.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=y,this._overlapStencilMode.ref=this._stencilRef,u.isTileClipped()&&this._renderTileClippingMasks(o,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(i){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[i.key]),this._overlapStencilMode):Dt.disabled}_renderTileClippingMasks(i,o){const u=this.painter,d=this.painter.context,p=d.gl;u._tileClippingMaskIDs={},d.setColorMode(Gt.disabled),d.setDepthMode(vt.disabled);const _=u.getOrCreateProgram("clippingMask");for(const y of i){const b=u._tileClippingMaskIDs[y.key]=--o;_.draw(u,p.TRIANGLES,vt.disabled,new Dt({func:p.ALWAYS,mask:0},b,255,p.KEEP,p.KEEP,p.REPLACE),Gt.disabled,Mt.disabled,Ga(y.projMatrix),"$clipping",u.tileExtentBuffer,u.quadTriangleIndexBuffer,u.tileExtentSegments)}}pointCoordinate(i){const o=this.painter.transform;if(i.x<0||i.x>o.width||i.y<0||i.y>o.height)return null;const u=[i.x,i.y,1,1];s.aa.transformMat4(u,u,o.pixelMatrixInverse),s.aa.scale(u,u,1/u[3]),u[0]/=o.worldSize,u[1]/=o.worldSize;const d=o._camera.position,p=s.bo(1,o.center.lat),_=[d[0],d[1],d[2]/p,0],y=s.Q.subtract([],u.slice(0,3),_);s.Q.normalize(y,y);const b=this.raycast(_,y,this._exaggeration);return b!==null&&b?(s.Q.scaleAndAdd(_,_,y,b),_[3]=_[2],_[2]*=p,_):null}drawDepth(){const i=this.painter,o=i.context,u=this.proxySourceCache,d=Math.ceil(i.width),p=Math.ceil(i.height);if(!this._depthFBO||this._depthFBO.width===d&&this._depthFBO.height===p||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const _=o.gl,y=o.createFramebuffer(d,p,!0,"renderbuffer");o.activeTexture.set(_.TEXTURE0);const b=new s.T(o,{width:d,height:p,data:null},_.RGBA);b.bind(_.NEAREST,_.CLAMP_TO_EDGE),y.colorAttachment.set(b.texture);const T=o.createRenderbuffer(o.gl.DEPTH_COMPONENT16,d,p);y.depthAttachment.set(T),this._depthFBO=y,this._depthTexture=b}o.bindFramebuffer.set(this._depthFBO.framebuffer),o.viewport.set([0,0,d,p]),function(_,y,b,T){if(_.transform.projection.name==="globe")return;const E=_.context,I=E.gl;E.clear({depth:1});const C=_.getOrCreateProgram("terrainDepth"),D=new vt(I.LESS,vt.ReadWrite,_.depthRangeFor3D);for(const k of T){const O=b.getTile(k),B=Ua(k.projMatrix,0,[0,0,0]);y.setupElevationDraw(O,C),C.draw(_,I.TRIANGLES,D,Dt.disabled,Gt.unblended,Mt.backCCW,B,"terrain_depth",y.gridBuffer,y.gridIndexBuffer,y.gridNoSkirtSegments)}}(i,this,u,this.proxyCoords)}_setupProxiedCoordsForOrtho(i,o,u){if(i.getSource()instanceof s.as)return this._setupProxiedCoordsForImageSource(i,o,u);this._findCoveringTileCache[i.id]=this._findCoveringTileCache[i.id]||{};const d=this.proxiedCoords[i.id]=[],p=this.proxyCoords;for(let b=0;b<p.length;b++){const T=p[b],E=this._findTileCoveringTileID(T,i);if(E){const I=this._createProxiedId(T,E,u[T.key]&&u[T.key][i.id]);d.push(I),this.proxyToSource[T.key][i.id]=[I]}}let _=!1;const y=new Set;for(let b=0;b<o.length;b++){const T=i.getTile(o[b]);if(!T||!T.hasData())continue;const E=this._findTileCoveringTileID(T.tileID,this.proxySourceCache);if(E&&E.tileID.canonical.z!==T.tileID.canonical.z){const I=this.proxyToSource[E.tileID.key][i.id],C=this._createProxiedId(E.tileID,T,u[E.tileID.key]&&u[E.tileID.key][i.id]);I?I.splice(I.length-1,0,C):this.proxyToSource[E.tileID.key][i.id]=[C];const D=this.proxyToSource[E.tileID.key][i.id];y.has(D)||y.add(D),d.push(C),_=!0}}if(this._sourceTilesOverlap[i.id]=_,_&&this._debugParams.sortTilesHiZFirst)for(const b of y)b.sort((T,E)=>E.overscaledZ-T.overscaledZ)}_setupProxiedCoordsForImageSource(i,o,u){if(!i.getSource().loaded())return;const d=this.proxiedCoords[i.id]=[],p=this.proxyCoords,_=i.getSource(),y=_.tileID;if(!y)return;const b=new s.P(y.x,y.y)._div(1<<y.z),T=_.coordinates.map(s.O.fromLngLat).reduce((I,C)=>(I.min.x=Math.min(I.min.x,C.x-b.x),I.min.y=Math.min(I.min.y,C.y-b.y),I.max.x=Math.max(I.max.x,C.x-b.x),I.max.y=Math.max(I.max.y,C.y-b.y),I),{min:new s.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new s.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),E=(I,C)=>{const D=I.wrap+I.canonical.x/(1<<I.canonical.z),k=I.canonical.y/(1<<I.canonical.z),O=s.Y/(1<<I.canonical.z),B=C.wrap+C.canonical.x/(1<<C.canonical.z),F=C.canonical.y/(1<<C.canonical.z);return D+O<B+T.min.x||D>B+T.max.x||k+O<F+T.min.y||k>F+T.max.y};for(let I=0;I<p.length;I++){const C=p[I];for(let D=0;D<o.length;D++){const k=i.getTile(o[D]);if(!k||!k.hasData()||E(C,k.tileID))continue;const O=this._createProxiedId(C,k,u[C.key]&&u[C.key][i.id]),B=this.proxyToSource[C.key][i.id];B?B.push(O):this.proxyToSource[C.key][i.id]=[O],d.push(O)}}}_createProxiedId(i,o,u){let d=this.orthoMatrix;if(u){const p=u.find(_=>_.key===o.tileID.key);if(p)return p}if(o.tileID.key!==i.key){const p=i.canonical.z-o.tileID.canonical.z;let _,y,b;d=s.a9.create();const T=o.tileID.wrap-i.wrap<<i.overscaledZ;p>0?(_=s.Y>>p,y=_*((o.tileID.canonical.x<<p)-i.canonical.x+T),b=_*((o.tileID.canonical.y<<p)-i.canonical.y)):(_=s.Y<<-p,y=s.Y*(o.tileID.canonical.x-(i.canonical.x+T<<-p)),b=s.Y*(o.tileID.canonical.y-(i.canonical.y<<-p))),s.a9.ortho(d,0,_,0,_,0,1),s.a9.translate(d,d,[y,b,0])}return new Ii(o.tileID,i.key,d)}_findTileCoveringTileID(i,o){let u=o.getTile(i);if(u&&u.hasData())return u;const d=this._findCoveringTileCache[o.id],p=d[i.key];if(u=p?o.getTileByID(p):null,u&&u.hasData()||p===null)return u;let _=u?u.tileID:i,y=_.overscaledZ;const b=o.getSource().minzoom,T=[];if(!p){const I=o.getSource().maxzoom;if(i.canonical.z>=I){const C=i.canonical.z-I;o.getSource().reparseOverscaled?(y=Math.max(i.canonical.z+2,o.transform.tileZoom),_=new s.ap(y,i.wrap,I,i.canonical.x>>C,i.canonical.y>>C)):C!==0&&(y=I,_=new s.ap(y,i.wrap,I,i.canonical.x>>C,i.canonical.y>>C))}_.key!==i.key&&(T.push(_.key),u=o.getTile(_))}const E=I=>{T.forEach(C=>{d[C]=I}),T.length=0};for(y-=1;y>=b&&(!u||!u.hasData());y--){u&&E(u.tileID.key);const I=_.calculateScaledKey(y);if(u=o.getTileByID(I),u&&u.hasData())break;const C=d[I];if(C===null)break;C===void 0?T.push(I):u=o.getTileByID(C)}return E(u?u.tileID.key:null),u&&u.hasData()?u:null}findDEMTileFor(i){return this.enabled?this._findTileCoveringTileID(i,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(i,o){let u=this._tilesDirty[i];u||(u=this._tilesDirty[i]={}),u[o.key]=!0}}function L1(c,i,o){const u=function(y,b,T){const E=s.Q.dot(b,y),I=s.Q.dot(T,[.2126,.7152,.0722]),C=(k,O,B)=>(1-B)*k+B*O,D=C(1-.3*Math.min(I,1),1,Math.min(E+1,1));return C(.92,1,Math.asin(s.ad(b[2],-1,1))/Math.PI+.5)*D}(c,[0,0,1],i),d=[0,0,0];s.Q.scale(d,o.slice(0,3),u);const p=[0,0,0];s.Q.scale(p,i.slice(0,3),c[2]);const _=[0,0,0];return s.Q.add(_,d,p),s.bX(_)}const Os=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],ui=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class yn{static cacheKey(i,o,u,d){let p=`${o}${d?d.cacheKey:""}`;for(const _ of u)i.usedDefines.includes(_)&&(p+=`/${_}`);return p}constructor(i,o,u,d,p,_){const y=i.gl;this.program=y.createProgram(),this.configuration=d,this.name=o,this.fixedDefines=[..._];const b=d?d.getBinderAttributes():[],T=(u.staticAttributes||[]).concat(b);let E=d?d.defines():[];E=E.concat(_.map(B=>`#define ${B}`));const I=`#version 300 es
`;let C=I+E.concat("precision mediump float;",sc,Va.fragmentSource).join(`
`);for(const B of u.fragmentIncludes)C+=`
${jt[B]}`;C+=`
${u.fragmentSource}`;let D=I+E.concat("precision highp float;",sc,Va.vertexSource).join(`
`);for(const B of u.vertexIncludes)D+=`
${jt[B]}`;D+=`
${u.vertexSource}`;const k=y.createShader(y.FRAGMENT_SHADER);if(y.isContextLost())return void(this.failedToCreate=!0);y.shaderSource(k,C),y.compileShader(k),y.attachShader(this.program,k);const O=y.createShader(y.VERTEX_SHADER);if(y.isContextLost())this.failedToCreate=!0;else{y.shaderSource(O,D),y.compileShader(O),y.attachShader(this.program,O),this.attributes={},this.numAttributes=T.length;for(let B=0;B<this.numAttributes;B++)if(T[B]){const F=T[B].startsWith("a_")?T[B]:`a_${T[B]}`;y.bindAttribLocation(this.program,B,F),this.attributes[F]=B}y.linkProgram(this.program),y.deleteShader(O),y.deleteShader(k),this.fixedUniforms=p(i),this.binderUniforms=d?d.getUniforms(i):[],_.includes("TERRAIN")&&(this.terrainUniforms=(B=>({u_dem:new s.bR(B),u_dem_prev:new s.bR(B),u_dem_tl:new s.bO(B),u_dem_scale:new s.bQ(B),u_dem_tl_prev:new s.bO(B),u_dem_scale_prev:new s.bQ(B),u_dem_size:new s.bQ(B),u_dem_lerp:new s.bQ(B),u_exaggeration:new s.bQ(B),u_depth:new s.bR(B),u_depth_size_inv:new s.bO(B),u_meter_to_dem:new s.bQ(B),u_label_plane_matrix_inv:new s.bN(B)}))(i)),_.includes("GLOBE")&&(this.globeUniforms=(B=>({u_tile_tl_up:new s.bP(B),u_tile_tr_up:new s.bP(B),u_tile_br_up:new s.bP(B),u_tile_bl_up:new s.bP(B),u_tile_up_scale:new s.bQ(B)}))(i)),_.includes("FOG")&&(this.fogUniforms=(B=>({u_fog_matrix:new s.bN(B),u_fog_range:new s.bO(B),u_fog_color:new s.bS(B),u_fog_horizon_blend:new s.bQ(B),u_fog_vertical_limit:new s.bO(B),u_fog_temporal_offset:new s.bQ(B),u_frustum_tl:new s.bP(B),u_frustum_tr:new s.bP(B),u_frustum_br:new s.bP(B),u_frustum_bl:new s.bP(B),u_globe_pos:new s.bP(B),u_globe_radius:new s.bQ(B),u_globe_transition:new s.bQ(B),u_is_globe:new s.bR(B),u_viewport:new s.bO(B)}))(i)),_.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(B=>({u_cutoff_params:new s.bS(B)}))(i)),_.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(B=>({u_lighting_ambient_color:new s.bP(B),u_lighting_directional_dir:new s.bP(B),u_lighting_directional_color:new s.bP(B),u_ground_radiance:new s.bP(B)}))(i)),_.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(B=>({u_light_matrix_0:new s.bN(B),u_light_matrix_1:new s.bN(B),u_fade_range:new s.bO(B),u_shadow_normal_offset:new s.bP(B),u_shadow_intensity:new s.bQ(B),u_shadow_texel_size:new s.bQ(B),u_shadow_map_resolution:new s.bQ(B),u_shadow_direction:new s.bP(B),u_shadow_bias:new s.bP(B),u_shadowmap_0:new s.bR(B),u_shadowmap_1:new s.bR(B)}))(i))}}setTerrainUniformValues(i,o){if(!this.terrainUniforms)return;const u=this.terrainUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const d in o)u[d]&&u[d].set(this.program,d,o[d])}}setGlobeUniformValues(i,o){if(!this.globeUniforms)return;const u=this.globeUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const d in o)u[d]&&u[d].set(this.program,d,o[d])}}setFogUniformValues(i,o){if(!this.fogUniforms)return;const u=this.fogUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const d in o)u[d].set(this.program,d,o[d])}}setCutoffUniformValues(i,o){if(!this.cutoffUniforms)return;const u=this.cutoffUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const d in o)u[d].set(this.program,d,o[d])}}setLightsUniformValues(i,o){if(!this.lightsUniforms)return;const u=this.lightsUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const d in o)u[d].set(this.program,d,o[d])}}setShadowUniformValues(i,o){if(this.failedToCreate||!this.shadowUniforms)return;const u=this.shadowUniforms;i.program.set(this.program);for(const d in o)u[d].set(this.program,d,o[d])}_drawDebugWireframe(i,o,u,d,p,_,y,b,T,E){const I=i.options.wireframe;if(I.terrain===!1&&I.layers2D===!1&&I.layers3D===!1)return;const C=i.context;if(!(!(!I.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!I.layers2D||i._terrain&&i._terrain.renderingToTexture||!Os.includes(this.name))||!(!I.layers3D||!ui.includes(this.name))))return;const D=C.gl,k=i.wireframeDebugCache.getLinesFromTrianglesBuffer(i.frameCounter,p,C);if(!k)return;const O=[...this.fixedDefines];O.push("DEBUG_WIREFRAME");const B=i.getOrCreateProgram(this.name,{config:this.configuration,defines:O});C.program.set(B.program);const F=(H,Y,N)=>{if(Y[H]&&N[H])for(const $ in Y[H])N[H][$]&&N[H][$].set(N.program,$,Y[H][$].current)};T&&T.setUniforms(B.program,C,B.binderUniforms,y,{zoom:b}),F("fixedUniforms",this,B),F("terrainUniforms",this,B),F("globeUniforms",this,B),F("fogUniforms",this,B),F("lightsUniforms",this,B),F("shadowUniforms",this,B),k.bind(),C.setColorMode(new Gt([D.ONE,D.ONE_MINUS_SRC_ALPHA,D.ZERO,D.ONE],s.aA.transparent,[!0,!0,!0,!1])),C.setDepthMode(new vt(o.func===D.LESS?D.LEQUAL:o.func,vt.ReadOnly,o.range)),C.setStencilMode(Dt.disabled);const j=3*_.primitiveLength*2,Q=3*_.primitiveOffset*2*2;E&&E>1?D.drawElementsInstanced(D.LINES,j,D.UNSIGNED_SHORT,Q,E):D.drawElements(D.LINES,j,D.UNSIGNED_SHORT,Q),p.bind(),C.program.set(this.program),C.setDepthMode(o),C.setStencilMode(u),C.setColorMode(d)}draw(i,o,u,d,p,_,y,b,T,E,I,C,D,k,O,B){const F=i.context,j=F.gl;if(this.failedToCreate)return;F.program.set(this.program),F.setDepthMode(u),F.setStencilMode(d),F.setColorMode(p),F.setCullFace(_);for(const Y of Object.keys(this.fixedUniforms))this.fixedUniforms[Y].set(this.program,Y,y[Y]);k&&k.setUniforms(this.program,F,this.binderUniforms,C,{zoom:D});const Q={[j.POINTS]:1,[j.LINES]:2,[j.TRIANGLES]:3,[j.LINE_STRIP]:1}[o],H=B&&B>0?1:void 0;for(const Y of I.get()){const N=Y.vaos||(Y.vaos={});(N[b]||(N[b]=new it)).bind(F,this,T,k?k.getPaintVertexBuffers():[],E,Y.vertexOffset,O||[],H),B&&B>1?j.drawElementsInstanced(o,Y.primitiveLength*Q,j.UNSIGNED_SHORT,Y.primitiveOffset*Q*2,B):E?j.drawElements(o,Y.primitiveLength*Q,j.UNSIGNED_SHORT,Y.primitiveOffset*Q*2):j.drawArrays(o,Y.vertexOffset,Y.vertexLength),o===j.TRIANGLES&&E&&this._drawDebugWireframe(i,u,d,p,E,Y,C,D,k,B)}}}function $n(c,i){const o=Math.pow(2,i.tileID.overscaledZ),u=i.tileSize*Math.pow(2,c.transform.tileZoom)/o,d=u*(i.tileID.canonical.x+i.tileID.wrap*o),p=u*i.tileID.canonical.y;return{u_image:0,u_texsize:i.imageAtlasTexture?i.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/s.a6(i,1,c.transform.tileZoom),u_pixel_coord_upper:[d>>16,p>>16],u_pixel_coord_lower:[65535&d,65535&p]}}const pi=s.a9.create(),lc=(c,i,o,u,d,p,_,y,b,T,E,I,C,D,k,O)=>{const B=i.style.light,F=B.properties.get("position"),j=[F.x,F.y,F.z],Q=s.ct.create();B.properties.get("anchor")==="viewport"&&(s.ct.fromRotation(Q,-i.transform.angle),s.Q.transformMat3(j,j,Q));const H=B.properties.get("color"),Y=i.transform,N={u_matrix:c,u_lightpos:j,u_lightintensity:B.properties.get("intensity"),u_lightcolor:[H.r,H.g,H.b],u_vertical_gradient:+o,u_opacity:u,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:pi,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:d,u_edge_radius:p,u_flood_light_color:I,u_vertical_scale:C,u_flood_light_intensity:D,u_ground_shadow_factor:k,u_emissive_strength:O};return Y.projection.name==="globe"&&(N.u_tile_id=[_.canonical.x,_.canonical.y,1<<_.canonical.z],N.u_zoom_transition=b,N.u_inv_rot_matrix=E,N.u_merc_center=T,N.u_up_dir=Y.projection.upVector(new s.bv(0,0,0),T[0]*s.Y,T[1]*s.Y),N.u_height_lift=y),N},Rn=(c,i,o)=>({u_matrix:c,u_edge_radius:i,u_vertical_scale:o}),$a=(c,i,o,u,d,p,_,y,b,T,E,I,C,D)=>{const k=lc(c,i,o,u,d,p,_,b,T,E,I,C,D,1,[0,0,0],0),O={u_height_factor:-Math.pow(2,_.overscaledZ)/y.tileSize/8};return s.e(k,$n(i,y),O)},ks=(c,i)=>({u_matrix:c,u_emissive_strength:i}),Io=(c,i,o,u)=>s.e(ks(c,i),$n(o,u)),Xd=(c,i,o)=>({u_matrix:c,u_world:o,u_emissive_strength:i}),no=(c,i,o,u,d)=>s.e(Io(c,i,o,u),{u_world:d}),Yd=(c,i,o,u)=>{const d=s.Y/o.tileSize;return{u_matrix:c,u_camera_to_center_distance:i.getCameraToCenterDistance(u),u_extrude_scale:[i.pixelsToGLUnits[0]/d,i.pixelsToGLUnits[1]/d]}},Vu=(c,i,o=1)=>({u_matrix:c,u_color:i,u_overlay:0,u_overlay_scale:o}),Ji=s.a9.create(),Jd=(c,i,o,u,d,p,_)=>{const y=c.transform,b=y.projection.name==="globe",T=b?s.cu(y.zoom,i.canonical)*y._pixelsPerMercatorPixel:s.a6(o,1,p),E={u_matrix:i.projMatrix,u_extrude_scale:T,u_intensity:_,u_inv_rot_matrix:Ji,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(b){E.u_inv_rot_matrix=u,E.u_merc_center=d,E.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],E.u_zoom_transition=s.W(y.zoom);const I=d[0]*s.Y,C=d[1]*s.Y;E.u_up_dir=y.projection.upVector(new s.bv(0,0,0),I,C)}return E};function qa(c,[i,o,u,d],[p,_]){if(p===_)return[0,0,0,0];const y=255*(c-1)/(c*(_-p));return[i*y,o*y,u*y,d*y]}function Uu(c,i,[o,u]){return o===u?0:.5/c+(i-o)*(c-1)/(c*(u-o))}const O1=(c,i,o,u,d,p,_,y,b,T,E,I,C,D,k,O,B,F,j,Q,H)=>({u_matrix:c,u_normalize_matrix:i,u_globe_matrix:o,u_merc_matrix:u,u_grid_matrix:d,u_tl_parent:p,u_scale_parent:T,u_fade_t:E.mix,u_opacity:E.opacity*I.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:I.paint.get("raster-brightness-min"),u_brightness_high:I.paint.get("raster-brightness-max"),u_saturation_factor:s.cv(I.paint.get("raster-saturation")),u_contrast_factor:s.cw(I.paint.get("raster-contrast")),u_spin_weights:Kd(I.paint.get("raster-hue-rotate")),u_perspective_transform:C,u_raster_elevation:D,u_zoom_transition:_,u_merc_center:y,u_cutoff_params:b,u_colorization_mix:qa(s.cx,O,F),u_colorization_offset:Uu(s.cx,B,F),u_color_ramp:k,u_texture_offset:[Q/(j+2*Q),j/(j+2*Q)],u_texture_res:[j+2*Q,j+2*Q],u_emissive_strength:H});function Kd(c){c*=Math.PI/180;const i=Math.sin(c),o=Math.cos(c);return[(2*o+1)/3,(-Math.sqrt(3)*i-o+1)/3,(Math.sqrt(3)*i-o+1)/3]}const Za=(c,i,o,u,d,p,_,y,b,T,E,I)=>({u_matrix:c,u_normalize_matrix:i,u_globe_matrix:o,u_merc_matrix:u,u_grid_matrix:d,u_tl_parent:p,u_scale_parent:T,u_fade_t:E.mix,u_opacity:E.opacity,u_image0:0,u_image1:1,u_raster_elevation:I,u_zoom_transition:_,u_merc_center:y,u_cutoff_params:b}),Wa=(c,i,o,u,d,p,_,y,b,T)=>({u_particle_texture:c,u_particle_texture_side_len:i,u_tile_offset:o,u_velocity:u,u_color_ramp:p,u_velocity_res:d,u_max_speed:_,u_uv_offset:y,u_data_scale:b,u_data_offset:T,u_particle_pos_scale:1.3,u_particle_pos_offset:[Zo,Zo]}),ef=(c,i,o,u,d,p,_,y,b,T)=>({u_particle_texture:c,u_particle_texture_side_len:i,u_velocity:o,u_velocity_res:u,u_max_speed:d,u_speed_factor:p,u_reset_rate:_,u_rand_seed:Math.random(),u_uv_offset:y,u_data_scale:b,u_data_offset:T,u_particle_pos_scale:1.3,u_particle_pos_offset:[Zo,Zo]}),Ko=s.a9.create(),ju=(c,i,o,u,d,p,_,y,b,T,E,I,C,D,k,O,B,F)=>{const j=d.transform,Q={u_is_size_zoom_constant:+(c==="constant"||c==="source"),u_is_size_feature_constant:+(c==="constant"||c==="camera"),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:j.getCameraToCenterDistance(O),u_rotate_symbol:+o,u_aspect_ratio:j.width/j.height,u_fade_change:d.options.fadeDuration?d.symbolFadeChange:1,u_matrix:p,u_label_plane_matrix:_,u_coord_matrix:y,u_is_text:+b,u_pitch_with_map:+u,u_texsize:T,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Ko,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Ko,u_up_vector:[0,-1,0],u_color_adj_mat:B,u_icon_transition:F||0};return O.name==="globe"&&(Q.u_tile_id=[E.canonical.x,E.canonical.y,1<<E.canonical.z],Q.u_zoom_transition=I,Q.u_inv_rot_matrix=D,Q.u_merc_center=C,Q.u_camera_forward=j._camera.forward(),Q.u_ecef_origin=s.cy(j.globeMatrix,E.toUnwrapped()),Q.u_tile_matrix=Float32Array.from(j.globeMatrix),Q.u_up_vector=k),Q},Bs=(c,i,o,u,d,p,_,y,b,T,E,I,C,D,k,O,B)=>s.e(ju(c,i,o,u,d,p,_,y,b,T,I,C,D,k,O,B),{u_gamma_scale:u?d.transform.getCameraToCenterDistance(B)*Math.cos(d.terrain?0:d.transform._pitch):1,u_device_pixel_ratio:s.f.devicePixelRatio,u_is_halo:+E,undefined:void 0}),Po=(c,i,o,u,d,p,_,y,b,T,E,I,C,D,k,O)=>s.e(Bs(c,i,o,u,d,p,_,y,!0,b,!0,E,I,C,D,k,O),{u_texsize_icon:T,u_texture_icon:1}),tf=(c,i,o,u)=>({u_matrix:c,u_emissive_strength:i,u_opacity:o,u_color:u}),rf=(c,i,o,u,d,p,_)=>s.e(function(y,b,T,E){const I=T.imageManager.getPattern(y.toString(),b),{width:C,height:D}=T.imageManager.getPixelSize(b),k=Math.pow(2,E.tileID.overscaledZ),O=E.tileSize*Math.pow(2,T.transform.tileZoom)/k,B=O*(E.tileID.canonical.x+E.tileID.wrap*k),F=O*E.tileID.canonical.y;return{u_image:0,u_pattern_tl:I.tl,u_pattern_br:I.br,u_texsize:[C,D],u_pattern_size:I.displaySize,u_tile_units_to_pixels:1/s.a6(E,1,T.transform.tileZoom),u_pixel_coord_upper:[B>>16,F>>16],u_pixel_coord_lower:[65535&B,65535&F]}}(d,p,u,_),{u_matrix:c,u_emissive_strength:i,u_opacity:o}),Gu=new Float32Array(s.a9.identity([])),cc=(c,i,o,u,d,p,_,y,b,T,E,I,C,D=[0,0,0],k)=>{const O=d.style.light,B=O.properties.get("position"),F=[-B.x,-B.y,B.z],j=s.ct.create();O.properties.get("anchor")==="viewport"&&(s.ct.fromRotation(j,-d.transform.angle),s.Q.transformMat3(F,F,j));const Q=E.alphaMode==="MASK",H=O.properties.get("color"),Y=C.paint.get("model-ambient-occlusion-intensity"),N=C.paint.get("model-color").constantOr(s.aA.white),$=C.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:c,u_lighting_matrix:i,u_normal_matrix:o,u_node_matrix:u||Gu,u_lightpos:F,u_lightintensity:O.properties.get("intensity"),u_lightcolor:[H.r,H.g,H.b],u_camera_pos:D,u_opacity:p,u_baseTextureIsAlpha:0,u_alphaMask:+Q,u_alphaCutoff:E.alphaCutoff,u_baseColorFactor:[_.r,_.g,_.b,_.a],u_emissiveFactor:[y[0],y[1],y[2],1],u_metallicFactor:b,u_roughnessFactor:T,u_baseColorTexture:Xi.BaseColor,u_metallicRoughnessTexture:Xi.MetallicRoughness,u_normalTexture:Xi.Normal,u_occlusionTexture:Xi.Occlusion,u_emissionTexture:Xi.Emission,u_color_mix:[N.r,N.g,N.b,$],u_aoIntensity:Y,u_emissive_strength:I,u_occlusionTextureTransform:k||[0,0,0,0]}},k1=(c,i=Gu,o=Gu)=>({u_matrix:c,u_instance:i,u_node_matrix:o}),$u={fillExtrusion:c=>({u_matrix:new s.bN(c),u_lightpos:new s.bP(c),u_lightintensity:new s.bQ(c),u_lightcolor:new s.bP(c),u_vertical_gradient:new s.bQ(c),u_opacity:new s.bQ(c),u_edge_radius:new s.bQ(c),u_ao:new s.bO(c),u_tile_id:new s.bP(c),u_zoom_transition:new s.bQ(c),u_inv_rot_matrix:new s.bN(c),u_merc_center:new s.bO(c),u_up_dir:new s.bP(c),u_height_lift:new s.bQ(c),u_flood_light_color:new s.bP(c),u_vertical_scale:new s.bQ(c),u_flood_light_intensity:new s.bQ(c),u_ground_shadow_factor:new s.bP(c),u_emissive_strength:new s.bQ(c)}),fillExtrusionDepth:c=>({u_matrix:new s.bN(c),u_edge_radius:new s.bQ(c),u_vertical_scale:new s.bQ(c)}),fillExtrusionPattern:c=>({u_matrix:new s.bN(c),u_lightpos:new s.bP(c),u_lightintensity:new s.bQ(c),u_lightcolor:new s.bP(c),u_vertical_gradient:new s.bQ(c),u_height_factor:new s.bQ(c),u_edge_radius:new s.bQ(c),u_ao:new s.bO(c),u_tile_id:new s.bP(c),u_zoom_transition:new s.bQ(c),u_inv_rot_matrix:new s.bN(c),u_merc_center:new s.bO(c),u_up_dir:new s.bP(c),u_height_lift:new s.bQ(c),u_image:new s.bR(c),u_texsize:new s.bO(c),u_pixel_coord_upper:new s.bO(c),u_pixel_coord_lower:new s.bO(c),u_tile_units_to_pixels:new s.bQ(c),u_opacity:new s.bQ(c)}),fillExtrusionGroundEffect:c=>({u_matrix:new s.bN(c),u_opacity:new s.bQ(c),u_ao_pass:new s.bQ(c),u_meter_to_tile:new s.bQ(c),u_ao:new s.bO(c),u_flood_light_intensity:new s.bQ(c),u_flood_light_color:new s.bP(c),u_attenuation:new s.bQ(c),u_edge_radius:new s.bQ(c),u_fb:new s.bR(c),u_fb_size:new s.bQ(c)}),fill:c=>({u_matrix:new s.bN(c),u_emissive_strength:new s.bQ(c)}),fillPattern:c=>({u_matrix:new s.bN(c),u_emissive_strength:new s.bQ(c),u_image:new s.bR(c),u_texsize:new s.bO(c),u_pixel_coord_upper:new s.bO(c),u_pixel_coord_lower:new s.bO(c),u_tile_units_to_pixels:new s.bQ(c)}),fillOutline:c=>({u_matrix:new s.bN(c),u_emissive_strength:new s.bQ(c),u_world:new s.bO(c)}),fillOutlinePattern:c=>({u_matrix:new s.bN(c),u_emissive_strength:new s.bQ(c),u_world:new s.bO(c),u_image:new s.bR(c),u_texsize:new s.bO(c),u_pixel_coord_upper:new s.bO(c),u_pixel_coord_lower:new s.bO(c),u_tile_units_to_pixels:new s.bQ(c)}),circle:s.cz,collisionBox:c=>({u_matrix:new s.bN(c),u_camera_to_center_distance:new s.bQ(c),u_extrude_scale:new s.bO(c)}),collisionCircle:c=>({u_matrix:new s.bN(c),u_inv_matrix:new s.bN(c),u_camera_to_center_distance:new s.bQ(c),u_viewport_size:new s.bO(c)}),debug:c=>({u_color:new s.cf(c),u_matrix:new s.bN(c),u_overlay:new s.bR(c),u_overlay_scale:new s.bQ(c)}),clippingMask:c=>({u_matrix:new s.bN(c)}),heatmap:c=>({u_extrude_scale:new s.bQ(c),u_intensity:new s.bQ(c),u_matrix:new s.bN(c),u_inv_rot_matrix:new s.bN(c),u_merc_center:new s.bO(c),u_tile_id:new s.bP(c),u_zoom_transition:new s.bQ(c),u_up_dir:new s.bP(c)}),heatmapTexture:c=>({u_image:new s.bR(c),u_color_ramp:new s.bR(c),u_opacity:new s.bQ(c)}),hillshade:c=>({u_matrix:new s.bN(c),u_image:new s.bR(c),u_latrange:new s.bO(c),u_light:new s.bO(c),u_shadow:new s.cf(c),u_highlight:new s.cf(c),u_emissive_strength:new s.bQ(c),u_accent:new s.cf(c)}),hillshadePrepare:c=>({u_matrix:new s.bN(c),u_image:new s.bR(c),u_dimension:new s.bO(c),u_zoom:new s.bQ(c)}),line:s.cA,linePattern:s.cB,raster:c=>({u_matrix:new s.bN(c),u_normalize_matrix:new s.bN(c),u_globe_matrix:new s.bN(c),u_merc_matrix:new s.bN(c),u_grid_matrix:new s.cg(c),u_tl_parent:new s.bO(c),u_scale_parent:new s.bQ(c),u_fade_t:new s.bQ(c),u_opacity:new s.bQ(c),u_image0:new s.bR(c),u_image1:new s.bR(c),u_brightness_low:new s.bQ(c),u_brightness_high:new s.bQ(c),u_saturation_factor:new s.bQ(c),u_contrast_factor:new s.bQ(c),u_spin_weights:new s.bP(c),u_perspective_transform:new s.bO(c),u_raster_elevation:new s.bQ(c),u_zoom_transition:new s.bQ(c),u_merc_center:new s.bO(c),u_cutoff_params:new s.bS(c),u_colorization_mix:new s.bS(c),u_colorization_offset:new s.bQ(c),u_color_ramp:new s.bR(c),u_texture_offset:new s.bO(c),u_texture_res:new s.bO(c),u_emissive_strength:new s.bQ(c)}),rasterParticle:c=>({u_matrix:new s.bN(c),u_normalize_matrix:new s.bN(c),u_globe_matrix:new s.bN(c),u_merc_matrix:new s.bN(c),u_grid_matrix:new s.cg(c),u_tl_parent:new s.bO(c),u_scale_parent:new s.bQ(c),u_fade_t:new s.bQ(c),u_opacity:new s.bQ(c),u_image0:new s.bR(c),u_image1:new s.bR(c),u_raster_elevation:new s.bQ(c),u_zoom_transition:new s.bQ(c),u_merc_center:new s.bO(c),u_cutoff_params:new s.bS(c)}),rasterParticleTexture:c=>({u_texture:new s.bR(c),u_opacity:new s.bQ(c)}),rasterParticleDraw:c=>({u_particle_texture:new s.bR(c),u_particle_texture_side_len:new s.bQ(c),u_tile_offset:new s.bO(c),u_velocity:new s.bR(c),u_color_ramp:new s.bR(c),u_velocity_res:new s.bO(c),u_max_speed:new s.bQ(c),u_uv_offset:new s.bO(c),u_data_scale:new s.bS(c),u_data_offset:new s.bQ(c),u_particle_pos_scale:new s.bQ(c),u_particle_pos_offset:new s.bO(c)}),rasterParticleUpdate:c=>({u_particle_texture:new s.bR(c),u_particle_texture_side_len:new s.bQ(c),u_velocity:new s.bR(c),u_velocity_res:new s.bO(c),u_max_speed:new s.bQ(c),u_speed_factor:new s.bQ(c),u_reset_rate:new s.bQ(c),u_rand_seed:new s.bQ(c),u_uv_offset:new s.bO(c),u_data_scale:new s.bS(c),u_data_offset:new s.bQ(c),u_particle_pos_scale:new s.bQ(c),u_particle_pos_offset:new s.bO(c)}),symbolIcon:c=>({u_is_size_zoom_constant:new s.bR(c),u_is_size_feature_constant:new s.bR(c),u_size_t:new s.bQ(c),u_size:new s.bQ(c),u_camera_to_center_distance:new s.bQ(c),u_rotate_symbol:new s.bR(c),u_aspect_ratio:new s.bQ(c),u_fade_change:new s.bQ(c),u_matrix:new s.bN(c),u_label_plane_matrix:new s.bN(c),u_coord_matrix:new s.bN(c),u_is_text:new s.bR(c),u_pitch_with_map:new s.bR(c),u_texsize:new s.bO(c),u_tile_id:new s.bP(c),u_zoom_transition:new s.bQ(c),u_inv_rot_matrix:new s.bN(c),u_merc_center:new s.bO(c),u_camera_forward:new s.bP(c),u_tile_matrix:new s.bN(c),u_up_vector:new s.bP(c),u_ecef_origin:new s.bP(c),u_texture:new s.bR(c),u_icon_transition:new s.bQ(c),u_color_adj_mat:new s.bN(c)}),symbolSDF:c=>({u_is_size_zoom_constant:new s.bR(c),u_is_size_feature_constant:new s.bR(c),u_size_t:new s.bQ(c),u_size:new s.bQ(c),u_camera_to_center_distance:new s.bQ(c),u_rotate_symbol:new s.bR(c),u_aspect_ratio:new s.bQ(c),u_fade_change:new s.bQ(c),u_matrix:new s.bN(c),u_label_plane_matrix:new s.bN(c),u_coord_matrix:new s.bN(c),u_is_text:new s.bR(c),u_pitch_with_map:new s.bR(c),u_texsize:new s.bO(c),u_texture:new s.bR(c),u_gamma_scale:new s.bQ(c),u_device_pixel_ratio:new s.bQ(c),u_tile_id:new s.bP(c),u_zoom_transition:new s.bQ(c),u_inv_rot_matrix:new s.bN(c),u_merc_center:new s.bO(c),u_camera_forward:new s.bP(c),u_tile_matrix:new s.bN(c),u_up_vector:new s.bP(c),u_ecef_origin:new s.bP(c),u_is_halo:new s.bR(c)}),symbolTextAndIcon:c=>({u_is_size_zoom_constant:new s.bR(c),u_is_size_feature_constant:new s.bR(c),u_size_t:new s.bQ(c),u_size:new s.bQ(c),u_camera_to_center_distance:new s.bQ(c),u_rotate_symbol:new s.bR(c),u_aspect_ratio:new s.bQ(c),u_fade_change:new s.bQ(c),u_matrix:new s.bN(c),u_label_plane_matrix:new s.bN(c),u_coord_matrix:new s.bN(c),u_is_text:new s.bR(c),u_pitch_with_map:new s.bR(c),u_texsize:new s.bO(c),u_texsize_icon:new s.bO(c),u_texture:new s.bR(c),u_texture_icon:new s.bR(c),u_gamma_scale:new s.bQ(c),u_device_pixel_ratio:new s.bQ(c),u_is_halo:new s.bR(c)}),background:c=>({u_matrix:new s.bN(c),u_emissive_strength:new s.bQ(c),u_opacity:new s.bQ(c),u_color:new s.cf(c)}),backgroundPattern:c=>({u_matrix:new s.bN(c),u_emissive_strength:new s.bQ(c),u_opacity:new s.bQ(c),u_image:new s.bR(c),u_pattern_tl:new s.bO(c),u_pattern_br:new s.bO(c),u_texsize:new s.bO(c),u_pattern_size:new s.bO(c),u_pixel_coord_upper:new s.bO(c),u_pixel_coord_lower:new s.bO(c),u_tile_units_to_pixels:new s.bQ(c)}),terrainRaster:tr,terrainDepth:tr,skybox:c=>({u_matrix:new s.bN(c),u_sun_direction:new s.bP(c),u_cubemap:new s.bR(c),u_opacity:new s.bQ(c),u_temporal_offset:new s.bQ(c)}),skyboxGradient:c=>({u_matrix:new s.bN(c),u_color_ramp:new s.bR(c),u_center_direction:new s.bP(c),u_radius:new s.bQ(c),u_opacity:new s.bQ(c),u_temporal_offset:new s.bQ(c)}),skyboxCapture:c=>({u_matrix_3f:new s.cg(c),u_sun_direction:new s.bP(c),u_sun_intensity:new s.bQ(c),u_color_tint_r:new s.bS(c),u_color_tint_m:new s.bS(c),u_luminance:new s.bQ(c)}),globeRaster:c=>({u_proj_matrix:new s.bN(c),u_globe_matrix:new s.bN(c),u_normalize_matrix:new s.bN(c),u_merc_matrix:new s.bN(c),u_zoom_transition:new s.bQ(c),u_merc_center:new s.bO(c),u_image0:new s.bR(c),u_grid_matrix:new s.cg(c),u_skirt_height:new s.bQ(c),u_far_z_cutoff:new s.bQ(c),u_frustum_tl:new s.bP(c),u_frustum_tr:new s.bP(c),u_frustum_br:new s.bP(c),u_frustum_bl:new s.bP(c),u_globe_pos:new s.bP(c),u_globe_radius:new s.bQ(c),u_viewport:new s.bO(c)}),globeAtmosphere:c=>({u_frustum_tl:new s.bP(c),u_frustum_tr:new s.bP(c),u_frustum_br:new s.bP(c),u_frustum_bl:new s.bP(c),u_horizon:new s.bQ(c),u_transition:new s.bQ(c),u_fadeout_range:new s.bQ(c),u_color:new s.bS(c),u_high_color:new s.bS(c),u_space_color:new s.bS(c),u_temporal_offset:new s.bQ(c),u_horizon_angle:new s.bQ(c)}),model:c=>({u_matrix:new s.bN(c),u_lighting_matrix:new s.bN(c),u_normal_matrix:new s.bN(c),u_node_matrix:new s.bN(c),u_lightpos:new s.bP(c),u_lightintensity:new s.bQ(c),u_lightcolor:new s.bP(c),u_camera_pos:new s.bP(c),u_opacity:new s.bQ(c),u_baseColorFactor:new s.bS(c),u_emissiveFactor:new s.bS(c),u_metallicFactor:new s.bQ(c),u_roughnessFactor:new s.bQ(c),u_baseTextureIsAlpha:new s.bR(c),u_alphaMask:new s.bR(c),u_alphaCutoff:new s.bQ(c),u_baseColorTexture:new s.bR(c),u_metallicRoughnessTexture:new s.bR(c),u_normalTexture:new s.bR(c),u_occlusionTexture:new s.bR(c),u_emissionTexture:new s.bR(c),u_color_mix:new s.bS(c),u_aoIntensity:new s.bQ(c),u_emissive_strength:new s.bQ(c),u_occlusionTextureTransform:new s.bS(c)}),modelDepth:c=>({u_matrix:new s.bN(c),u_instance:new s.bN(c),u_node_matrix:new s.bN(c)}),groundShadow:c=>({u_matrix:new s.bN(c),u_ground_shadow_factor:new s.bP(c)}),stars:c=>({u_matrix:new s.bN(c),u_up:new s.bP(c),u_right:new s.bP(c),u_intensity_multiplier:new s.bQ(c)})};let Ha;function qu(c,i,o,u,d,p,_){const y=c.context,b=y.gl,T=c.transform,E=c.getOrCreateProgram("collisionBox"),I=[];let C=0,D=0;for(let H=0;H<u.length;H++){const Y=u[H],N=i.getTile(Y),$=N.getBucket(o);if(!$)continue;const ie=jn(Y,$,T);let te=ie;d[0]===0&&d[1]===0||(te=c.translatePosMatrix(ie,N,d,p));const ae=_?$.textCollisionBox:$.iconCollisionBox,ge=$.collisionCircleArray;if(ge.length>0){const se=s.a9.create(),me=te;s.a9.mul(se,$.placementInvProjMatrix,T.glCoordMatrix),s.a9.mul(se,se,$.placementViewportMatrix),I.push({circleArray:ge,circleOffset:D,transform:me,invTransform:se,projection:$.getProjection()}),C+=ge.length/4,D=C}ae&&(c.terrain&&c.terrain.setupElevationDraw(N,E),E.draw(c,b.LINES,vt.disabled,Dt.disabled,c.colorModeForRenderPass(),Mt.disabled,Yd(te,T,N,$.getProjection()),o.id,ae.layoutVertexBuffer,ae.indexBuffer,ae.segments,null,T.zoom,null,[ae.collisionVertexBuffer,ae.collisionVertexBufferExt]))}if(!_||!I.length)return;const k=c.getOrCreateProgram("collisionCircle"),O=new s.cC;O.resize(4*C),O._trim();let B=0;for(const H of I)for(let Y=0;Y<H.circleArray.length/4;Y++){const N=4*Y,$=H.circleArray[N+0],ie=H.circleArray[N+1],te=H.circleArray[N+2],ae=H.circleArray[N+3];O.emplace(B++,$,ie,te,ae,0),O.emplace(B++,$,ie,te,ae,1),O.emplace(B++,$,ie,te,ae,2),O.emplace(B++,$,ie,te,ae,3)}(!Ha||Ha.length<2*C)&&(Ha=function(H){const Y=2*H,N=new s.az;N.resize(Y),N._trim();for(let $=0;$<Y;$++){const ie=6*$;N.uint16[ie+0]=4*$+0,N.uint16[ie+1]=4*$+1,N.uint16[ie+2]=4*$+2,N.uint16[ie+3]=4*$+2,N.uint16[ie+4]=4*$+3,N.uint16[ie+5]=4*$+0}return N}(C));const F=y.createIndexBuffer(Ha,!0),j=y.createVertexBuffer(O,s.cD.members,!0);for(const H of I){const Y={u_matrix:H.transform,u_inv_matrix:H.invTransform,u_camera_to_center_distance:(Q=T).getCameraToCenterDistance(H.projection),u_viewport_size:[Q.width,Q.height]};k.draw(c,b.TRIANGLES,vt.disabled,Dt.disabled,c.colorModeForRenderPass(),Mt.disabled,Y,o.id,j,F,s.aE.simpleSegment(0,2*H.circleOffset,H.circleArray.length,H.circleArray.length/2),null,T.zoom)}var Q;j.destroy(),F.destroy()}const Qa=s.a9.create();function Zu(c){const i=c._camera.getWorldToCamera(c.worldSize,1),o=s.a9.multiply([],i,c.globeMatrix);s.a9.invert(o,o);const u=[0,0,0],d=[0,1,0,0];return s.aa.transformMat4(d,d,o),u[0]=d[0],u[1]=d[1],u[2]=d[2],s.Q.normalize(u,u),u}function es({width:c,height:i,anchor:o,textOffset:u,textScale:d},p){const{horizontalAlign:_,verticalAlign:y}=s.bi(o),b=-(_-.5)*c,T=-(y-.5)*i,E=s.bh(o,u);return new s.P((b/d+E[0])*p,(T/d+E[1])*p)}function B1(c,i,o,u,d,p,_,y,b,T,E){const I=c.text.placedSymbolArray,C=c.text.dynamicLayoutVertexArray,D=c.icon.dynamicLayoutVertexArray,k={},O=c.getProjection(),B=$l(y,O,p),F=p.elevation,j=O.upVectorScale(y.canonical,p.center.lat,p.worldSize).metersToTile;C.clear();for(let Q=0;Q<I.length;Q++){const H=I.get(Q),{tileAnchorX:Y,tileAnchorY:N,numGlyphs:$}=H,ie=H.hidden||!H.crossTileID||c.allowVerticalPlacement&&!H.placedOrientation?null:u[H.crossTileID];if(ie){let te=0,ae=0,ge=0;if(F){const ye=F?F.getAtTileOffset(y,Y,N):0,[X,Ee,Je]=O.upVector(y.canonical,Y,N);te=ye*X*j,ae=ye*Ee*j,ge=ye*Je*j}let[se,me,xe,oe]=cn(H.projectedAnchorX+te,H.projectedAnchorY+ae,H.projectedAnchorZ+ge,o?B:_);const fe=Nl(p.getCameraToCenterDistance(O),oe);let Re=d.evaluateSizeForFeature(c.textSizeData,T,H)*fe/s.bf;o&&(Re*=c.tilePixelRatio/b);const ue=es(ie,Re);o?({x:se,y:me,z:xe}=O.projectTilePoint(Y+ue.x,N+ue.y,y.canonical),[se,me,xe]=cn(se+te,me+ae,xe+ge,_)):(i&&ue._rotate(-p.angle),se+=ue.x,me+=ue.y,xe=0);const _e=c.allowVerticalPlacement&&H.placedOrientation===s.b9.vertical?Math.PI/2:0;for(let ye=0;ye<$;ye++)s.bc(C,se,me,xe,_e);E&&H.associatedIconIndex>=0&&(k[H.associatedIconIndex]={x:se,y:me,z:xe,angle:_e})}else Qo($,C)}if(E){D.clear();const Q=c.icon.placedSymbolArray;for(let H=0;H<Q.length;H++){const Y=Q.get(H),{numGlyphs:N}=Y,$=k[H];if(Y.hidden||!$)Qo(N,D);else{const{x:ie,y:te,z:ae,angle:ge}=$;for(let se=0;se<N;se++)s.bc(D,ie,te,ae,ge)}}c.icon.dynamicLayoutVertexBuffer.updateData(D)}c.text.dynamicLayoutVertexBuffer.updateData(C)}function Xa(c,i,o,u,d,p,_={}){const y=o.paint.get("icon-translate"),b=o.paint.get("text-translate"),T=o.paint.get("icon-translate-anchor"),E=o.paint.get("text-translate-anchor"),I=o.layout.get("icon-rotation-alignment"),C=o.layout.get("text-rotation-alignment"),D=o.layout.get("icon-pitch-alignment"),k=o.layout.get("text-pitch-alignment"),O=o.layout.get("icon-keep-upright"),B=o.layout.get("text-keep-upright"),F=o.paint.get("icon-color-saturation"),j=o.paint.get("icon-color-contrast"),Q=o.paint.get("icon-color-brightness-min"),H=o.paint.get("icon-color-brightness-max"),Y=c.context,N=Y.gl,$=c.transform,ie=I==="map",te=C==="map",ae=D==="map",ge=k==="map",se=o.layout.get("symbol-sort-key").constantOr(1)!==void 0;let me=!1;const xe=c.depthModeForSublayer(0,vt.ReadOnly),oe=[s.a8($.center.lng),s.ah($.center.lat)],fe=o.layout.get("text-variable-anchor"),Re=$.projection.name==="globe",ue=[],_e=[0,-1,0];for(const ye of u){const X=i.getTile(ye),Ee=X.getBucket(o);if(!Ee||Ee.projection.name==="mercator"&&Re||Ee.fullyClipped)continue;const Je=Ee.projection.name==="globe",st=Je?s.W($.zoom):0,_t=$l(ye,Ee.getProjection(),$),ht=$.calculatePixelsToTileUnitsMatrix(X),xt=fe&&Ee.hasTextData(),Qt=Ee.hasIconTextFit()&&xt&&Ee.hasIconData(),Ct=Ee.getProjection().createInversionMatrix($,ye.canonical),Jt=()=>{const Bt=ie&&o.layout.get("symbol-placement")!=="point",Nt=[],Or=Bt||Qt,Ir=o.paint.get("icon-image-cross-fade").constantOr(0);c.terrainRenderModeElevated()&&ae&&Nt.push("PITCH_WITH_MAP_TERRAIN"),Je&&(Nt.push("PROJECTION_GLOBE_VIEW"),Or&&Nt.push("PROJECTED_POS_ON_VIEWPORT")),Ir>0&&Nt.push("ICON_TRANSITION"),Ee.icon.zOffsetVertexBuffer&&Nt.push("Z_OFFSET"),F===0&&j===0&&Q===0&&H===1||Nt.push("COLOR_ADJUSTMENT");const qt=Ee.icon.programConfigurations.get(o.id),Rt=c.getOrCreateProgram(Ee.sdfIcons?"symbolSDF":"symbolIcon",{config:qt,defines:Nt});let Wi;const Ci=X.imageAtlasTexture?X.imageAtlasTexture.size:[0,0],mi=Ee.iconSizeData,Di=s.b8(mi,$.zoom),Hi=ae||$.pitch!==0,Fi=Ma(_t,X.tileID.canonical,ae,ie,$,Ee.getProjection(),ht),_i=ro(_t,X.tileID.canonical,ae,ie,$,Ee.getProjection(),ht),Ti=c.translatePosMatrix(_i,X,y,T,!0),Si=c.translatePosMatrix(_t,X,y,T),Zn=Or?Qa:Fi,On=ie&&!ae&&!Bt;let Wn=_e;!Re&&!$.mercatorFromTransition||ie||(Wn=Zu($));const Hn=Je?Wn:_e;if(Ee.sdfIcons&&!Ee.iconsInText)Wi=Bs(mi.kind,Di,On,ae,c,Si,Zn,Ti,!1,Ci,!0,ye,st,oe,Ct,Hn,Ee.getProjection());else{const ao=o.getColorAdjustmentMatrix(F,j,Q,H);Wi=ju(mi.kind,Di,On,ae,c,Si,Zn,Ti,!1,Ci,ye,st,oe,Ct,Hn,Ee.getProjection(),ao,Ir)}const Lo=X.imageAtlasTexture?X.imageAtlasTexture:null,xn=o.layout.get("icon-size").constantOr(0)!==1||Ee.iconsNeedLinear,ul=Ee.sdfIcons||c.options.rotating||c.options.zooming||xn||Hi?N.LINEAR:N.NEAREST,Ws=Ee.sdfIcons&&o.paint.get("icon-halo-width").constantOr(1)!==0,hl=c.terrain&&ae&&Bt?s.a9.invert(s.a9.create(),Fi):Qa;if(Bt&&Ee.icon){const ao=$.elevation,gi=ao?ao.getAtTileOffsetFunc(ye,$.center.lat,$.worldSize,Ee.getProjection()):null,dl=Ia(_t,X.tileID.canonical,ae,ie,$,Ee.getProjection(),ht);Ul(Ee,_t,c,!1,dl,_i,ae,O,gi,ye)}return{program:Rt,buffers:Ee.icon,uniformValues:Wi,atlasTexture:Lo,atlasTextureIcon:null,atlasInterpolation:ul,atlasInterpolationIcon:null,isSDF:Ee.sdfIcons,hasHalo:Ws,tile:X,labelPlaneMatrixInv:hl}},Xt=()=>{const Bt=te&&o.layout.get("symbol-placement")!=="point",Nt=[],Or=Bt||fe||Qt;c.terrainRenderModeElevated()&&ge&&Nt.push("PITCH_WITH_MAP_TERRAIN"),Je&&(Nt.push("PROJECTION_GLOBE_VIEW"),Or&&Nt.push("PROJECTED_POS_ON_VIEWPORT")),Ee.text.zOffsetVertexBuffer&&Nt.push("Z_OFFSET");const Ir=Ee.text.programConfigurations.get(o.id),qt=c.getOrCreateProgram(Ee.iconsInText?"symbolTextAndIcon":"symbolSDF",{config:Ir,defines:Nt});let Rt,Wi=[0,0],Ci=null;const mi=Ee.textSizeData;Ee.iconsInText&&(Wi=X.imageAtlasTexture?X.imageAtlasTexture.size:[0,0],Ci=X.imageAtlasTexture?X.imageAtlasTexture:null,Rt=ge||$.pitch!==0||c.options.rotating||c.options.zooming||mi.kind==="composite"||mi.kind==="camera"?N.LINEAR:N.NEAREST);const Di=X.glyphAtlasTexture?X.glyphAtlasTexture.size:[0,0],Hi=s.b8(mi,$.zoom),Fi=Ma(_t,X.tileID.canonical,ge,te,$,Ee.getProjection(),ht),_i=ro(_t,X.tileID.canonical,ge,te,$,Ee.getProjection(),ht),Ti=c.translatePosMatrix(_i,X,b,E,!0),Si=c.translatePosMatrix(_t,X,b,E),Zn=Or?Qa:Fi,On=te&&!ge&&!Bt;let Wn=_e;!Re&&!$.mercatorFromTransition||te||(Wn=Zu($));const Hn=Je?Wn:_e;let Lo;Lo=Ee.iconsInText?Po(mi.kind,Hi,On,ge,c,Si,Zn,Ti,Di,Wi,ye,st,oe,Ct,Hn,Ee.getProjection()):Bs(mi.kind,Hi,On,ge,c,Si,Zn,Ti,!0,Di,!0,ye,st,oe,Ct,Hn,Ee.getProjection());const xn=X.glyphAtlasTexture?X.glyphAtlasTexture:null,ul=N.LINEAR,Ws=o.paint.get("text-halo-width").constantOr(1)!==0,hl=c.terrain&&ge&&Bt?s.a9.invert(s.a9.create(),Fi):Qa;if(Bt&&Ee.text){const ao=$.elevation,gi=ao?ao.getAtTileOffsetFunc(ye,$.center.lat,$.worldSize,Ee.getProjection()):null,dl=Ia(_t,X.tileID.canonical,ge,te,$,Ee.getProjection(),ht);Ul(Ee,_t,c,!0,dl,_i,ge,B,gi,ye)}return{program:qt,buffers:Ee.text,uniformValues:Lo,atlasTexture:xn,atlasTextureIcon:Ci,atlasInterpolation:ul,atlasInterpolationIcon:Rt,isSDF:!0,hasHalo:Ws,tile:X,labelPlaneMatrixInv:hl}},Ur=Ee.icon.segments.get().length,yr=Ee.text.segments.get().length,hi=Ur&&!_.onlyText?Jt():null,ii=yr&&!_.onlyIcons?Xt():null,Mr=o.paint.get("icon-opacity").constantOr(1),xr=o.paint.get("text-opacity").constantOr(1);if(se&&Ee.canOverlap){me=!0;const Bt=Mr&&!_.onlyText?Ee.icon.segments.get():[],Nt=xr&&!_.onlyIcons?Ee.text.segments.get():[];for(const Or of Bt)ue.push({segments:new s.aE([Or]),sortKey:Or.sortKey,state:hi});for(const Or of Nt)ue.push({segments:new s.aE([Or]),sortKey:Or.sortKey,state:ii})}else _.onlyText||ue.push({segments:Mr?Ee.icon.segments:new s.aE([]),sortKey:0,state:hi}),_.onlyIcons||ue.push({segments:xr?Ee.text.segments:new s.aE([]),sortKey:0,state:ii})}me&&ue.sort((ye,X)=>ye.sortKey-X.sortKey);for(const ye of ue){const X=ye.state;if(X)if(c.terrain&&c.terrain.setupElevationDraw(X.tile,X.program,{useDepthForOcclusion:$.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:X.labelPlaneMatrixInv}),Y.activeTexture.set(N.TEXTURE0),X.atlasTexture&&X.atlasTexture.bind(X.atlasInterpolation,N.CLAMP_TO_EDGE,!0),X.atlasTextureIcon&&(Y.activeTexture.set(N.TEXTURE1),X.atlasTextureIcon&&X.atlasTextureIcon.bind(X.atlasInterpolationIcon,N.CLAMP_TO_EDGE,!0)),c.uploadCommonLightUniforms(c.context,X.program),X.hasHalo){const Ee=X.uniformValues;Ee.u_is_halo=1,uc(X.buffers,ye.segments,o,c,X.program,xe,d,p,Ee,2),Ee.u_is_halo=0}else{if(X.isSDF){const Ee=X.uniformValues;X.hasHalo&&(Ee.u_is_halo=1,uc(X.buffers,ye.segments,o,c,X.program,xe,d,p,Ee,1)),Ee.u_is_halo=0}uc(X.buffers,ye.segments,o,c,X.program,xe,d,p,X.uniformValues,1)}}}function uc(c,i,o,u,d,p,_,y,b,T){const E=[c.dynamicLayoutVertexBuffer,c.opacityVertexBuffer,c.iconTransitioningVertexBuffer,c.globeExtVertexBuffer,c.zOffsetVertexBuffer];d.draw(u,u.context.gl.TRIANGLES,p,_,y,Mt.disabled,b,o.id,c.layoutVertexBuffer,c.indexBuffer,i,o.paint,u.transform.zoom,c.programConfigurations.get(o.id),E,T)}function hc(c,i,o,u,d,p,_){const y=c.context.gl,b=o.paint.get("fill-pattern"),T=b&&b.constantOr(1);let E,I,C,D,k;_?(I=T&&!o.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",E=y.LINES):(I=T?"fillPattern":"fill",E=y.TRIANGLES);for(const O of u){const B=i.getTile(O);if(T&&!B.patternsLoaded())continue;const F=B.getBucket(o);if(!F)continue;c.prepareDrawTile();const j=F.programConfigurations.get(o.id),Q=c.isTileAffectedByFog(O),H=c.getOrCreateProgram(I,{config:j,overrideFog:Q});T&&(c.context.activeTexture.set(y.TEXTURE0),B.imageAtlasTexture&&B.imageAtlasTexture.bind(y.LINEAR,y.CLAMP_TO_EDGE),j.updatePaintBuffers());const Y=b.constantOr(null);if(Y&&B.imageAtlas){const ie=B.imageAtlas.patternPositions[Y.toString()];ie&&j.setConstantPatternPositions(ie)}const N=c.translatePosMatrix(O.projMatrix,B,o.paint.get("fill-translate"),o.paint.get("fill-translate-anchor")),$=o.paint.get("fill-emissive-strength");if(_){D=F.indexBuffer2,k=F.segments2;const ie=c.terrain&&c.terrain.renderingToTexture?c.terrain.drapeBufferSize:[y.drawingBufferWidth,y.drawingBufferHeight];C=I==="fillOutlinePattern"&&T?no(N,$,c,B,ie):Xd(N,$,ie)}else D=F.indexBuffer,k=F.segments,C=T?Io(N,$,c,B):ks(N,$);c.uploadCommonUniforms(c.context,H,O.toUnwrapped()),H.draw(c,E,d,c.stencilModeForClipping(O),p,Mt.disabled,C,o.id,F.layoutVertexBuffer,D,k,o.paint,c.transform.zoom,j,void 0)}}function Qe(c,i,o,u,d,p,_,y){o.resetLayerRenderingStats(c);const b=c.context,T=b.gl,E=c.transform,I=o.paint.get("fill-extrusion-pattern"),C=I.constantOr(1),D=o.paint.get("fill-extrusion-opacity"),k=c.style.enable3dLights(),O=o.paint.get(k&&!C?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),B=[o.paint.get("fill-extrusion-ambient-occlusion-intensity"),O],F=o.layout.get("fill-extrusion-edge-radius"),j=F>0&&!o.paint.get("fill-extrusion-rounded-roof"),Q=j?0:F,H=E.projection.name==="globe"?s.cM():0,Y=E.projection.name==="globe",N=Y?s.W(E.zoom):0,$=[s.a8(E.center.lng),s.ah(E.center.lat)],ie=o.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),te=o.paint.get("fill-extrusion-flood-light-intensity"),ae=o.paint.get("fill-extrusion-vertical-scale"),ge=Eo(c,o.paint.get("fill-extrusion-cutoff-fade-range")),se=o.paint.get("fill-extrusion-emissive-strength"),me=[];let xe;Y&&me.push("PROJECTION_GLOBE_VIEW"),B[0]>0&&me.push("FAUX_AO"),j&&me.push("ZERO_ROOF_RADIUS"),y&&me.push("HAS_CENTROID"),te>0&&me.push("FLOOD_LIGHT"),ge.shouldRenderCutoff&&me.push("RENDER_CUTOFF");const oe=c.renderPass==="shadow",fe=c.shadowRenderer,Re=oe&&!!fe;c.shadowRenderer&&(c.shadowRenderer.useNormalOffset=!0);let ue=[0,0,0];if(fe){const X=c.style.directionalLight,Ee=c.style.ambientLight;X&&Ee&&(ue=Lu(X,Ee)),xe=me.concat(["SHADOWS_SINGLE_CASCADE"])}const _e=Re?"fillExtrusionDepth":C?"fillExtrusionPattern":"fillExtrusion",ye=o.getLayerRenderingStats();for(const X of u){const Ee=i.getTile(X),Je=Ee.getBucket(o);if(!Je||Je.projection.name!==E.projection.name)continue;let st=!1;fe&&(st=fe.getMaxCascadeForTile(X.toUnwrapped())===0);const _t=c.isTileAffectedByFog(X),ht=Je.programConfigurations.get(o.id),xt=c.getOrCreateProgram(_e,{config:ht,defines:st?xe:me,overrideFog:_t});if(c.terrain&&c.terrain.setupElevationDraw(Ee,xt,{useMeterToDem:!0}),!Je.centroidVertexBuffer){const yr=xt.attributes.a_centroid_pos;yr!==void 0&&T.vertexAttrib2f(yr,0,0)}!oe&&fe&&fe.setupShadows(Ee.tileID.toUnwrapped(),xt,"vector-tile",Ee.tileID.overscaledZ),C&&(c.context.activeTexture.set(T.TEXTURE0),Ee.imageAtlasTexture&&Ee.imageAtlasTexture.bind(T.LINEAR,T.CLAMP_TO_EDGE),ht.updatePaintBuffers());const Qt=I.constantOr(null);if(Qt&&Ee.imageAtlas){const yr=Ee.imageAtlas.patternPositions[Qt.toString()];yr&&ht.setConstantPatternPositions(yr)}const Ct=o.paint.get("fill-extrusion-vertical-gradient");let Jt;if(oe&&fe){if(oo(Ee.tileID,Je,c))continue;const yr=fe.calculateShadowPassMatrixFromTile(Ee.tileID.toUnwrapped());Jt=Rn(yr,Q,ae)}else{const yr=c.translatePosMatrix(X.expandedProjMatrix,Ee,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),hi=E.projection.createInversionMatrix(E,X.canonical);Jt=C?$a(yr,c,Ct,D,B,Q,X,Ee,H,N,$,hi,ie,ae):lc(yr,c,Ct,D,B,Q,X,H,N,$,hi,ie,ae,te,ue,se)}c.uploadCommonUniforms(b,xt,X.toUnwrapped(),null,ge);let Xt=Je.segments;if(E.projection.name==="mercator"&&!oe&&(Xt=Je.getVisibleSegments(Ee.tileID,c.terrain,c.transform.getFrustum(0)),!Xt.get().length))continue;if(ye)if(oe)for(const yr of Xt.get())ye.numRenderedVerticesInShadowPass+=yr.primitiveLength;else for(const yr of Xt.get())ye.numRenderedVerticesInTransparentPass+=yr.primitiveLength;const Ur=[];(c.terrain||y)&&Ur.push(Je.centroidVertexBuffer),Y&&Ur.push(Je.layoutVertexExtBuffer),xt.draw(c,b.gl.TRIANGLES,d,p,_,Mt.backCCW,Jt,o.id,Je.layoutVertexBuffer,Je.indexBuffer,Xt,o.paint,c.transform.zoom,ht,Ur)}c.shadowRenderer&&(c.shadowRenderer.useNormalOffset=!1)}function ts(c,i,o,u,d,p,_,y,b,T,E,I,C,D,k,O,B,F,j){const Q=c.context,H=Q.gl,Y=c.transform,N=c.transform.zoom,$=[],ie=Eo(c,o.paint.get("fill-extrusion-cutoff-fade-range"));T==="clear"?($.push("CLEAR_SUBPASS"),j&&($.push("CLEAR_FROM_TEXTURE"),Q.activeTexture.set(H.TEXTURE0),j.bind(H.LINEAR,H.CLAMP_TO_EDGE))):T==="sdf"&&$.push("SDF_SUBPASS"),B&&$.push("HAS_CENTROID"),ie.shouldRenderCutoff&&$.push("RENDER_CUTOFF");const te=o.layout.get("fill-extrusion-edge-radius"),ae=(ge,se,me,xe,oe)=>{const fe=se.programConfigurations.get(o.id),Re=c.isTileAffectedByFog(ge),ue=c.getOrCreateProgram("fillExtrusionGroundEffect",{config:fe,defines:$,overrideFog:Re}),_e=((X,Ee,Je,st,_t,ht,xt,Qt,Ct,Jt,Xt)=>({u_matrix:Ee,u_opacity:Je,u_ao_pass:st?1:0,u_meter_to_tile:_t,u_ao:ht,u_flood_light_intensity:xt,u_flood_light_color:Qt,u_attenuation:Ct,u_edge_radius:Jt,u_fb:0,u_fb_size:Xt}))(0,xe,E,b,oe,[I,C*oe],D,k,O,N>=17?0:te*oe,j?j.size[0]:0),ye=[];B&&ye.push(se.hiddenByLandmarkVertexBuffer),c.uploadCommonUniforms(Q,ue,ge.toUnwrapped(),null,ie),ue.draw(c,Q.gl.TRIANGLES,d,p,_,y,_e,o.id,se.vertexBuffer,se.indexBuffer,me,o.paint,N,fe,ye)};for(const ge of u){const se=i.getTile(ge),me=se.getBucket(o);if(!me||me.projection.name!==Y.projection.name||!me.groundEffect||me.groundEffect&&!me.groundEffect.hasData())continue;const xe=me.groundEffect,oe=1/me.tileToMeter;{const fe=c.translatePosMatrix(ge.projMatrix,se,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),Re=xe.getDefaultSegment();ae(ge,xe,Re,fe,oe)}if(F)for(let fe=0;fe<4;fe++){const Re=s.cN[fe](ge),ue=i.getTile(Re);if(!ue)continue;const _e=ue.getBucket(o);if(!_e||_e.projection.name!==Y.projection.name||!_e.groundEffect||_e.groundEffect&&!_e.groundEffect.hasData())continue;const ye=_e.groundEffect;let X,Ee;fe===0?(X=[-s.Y,0,0],Ee=1):fe===1?(X=[s.Y,0,0],Ee=0):fe===2?(X=[0,-s.Y,0],Ee=3):(X=[0,s.Y,0],Ee=2);const Je=ye.regionSegments[Ee];if(!Je)continue;const st=new Float32Array(16);s.a9.translate(st,ge.projMatrix,X),ae(ge,ye,Je,c.translatePosMatrix(st,se,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),oe)}}}function Wu(c,i,o,u,d,p,_){u.centroidVertexArray.length===0&&u.createCentroidsBuffer();const y=p?p.findDEMTileFor(o):null;if(!(y&&y.dem||_))return;const b=F=>new s.P(Math.ceil((F+s.cQ)*s.cR),0),T=F=>{const j=i.getSource().minzoom,Q=Y=>{const N=i.getTileByID(Y);if(N&&N.hasData())return N.getBucket(d)},H=[0,-1,1];for(const Y of H){if(F.overscaledZ+Y<j)continue;const N=Q(F.calculateScaledKey(F.overscaledZ+Y));if(N)return N}},E=[0,0,0],I=(F,j)=>(E[0]=Math.min(F.min.y,j.min.y),E[1]=Math.max(F.max.y,j.max.y),E[2]=s.Y-j.min.x>F.max.x?j.min.x-s.Y:F.max.x,E),C=(F,j)=>(E[0]=Math.min(F.min.x,j.min.x),E[1]=Math.max(F.max.x,j.max.x),E[2]=s.Y-j.min.y>F.max.y?j.min.y-s.Y:F.max.y,E),D=[(F,j)=>I(F,j),(F,j)=>I(j,F),(F,j)=>C(F,j),(F,j)=>C(j,F)],k=(F,j,Q,H,Y,N,$)=>{if(!p)return 0;const ie=[[N?Q:F,N?F:Q,0],[N?Q:j,N?j:Q,0]],te=$<0?s.Y+$:$,ae=[N?te:(F+j)/2,N?(F+j)/2:te,0];return Q===0&&$<0||Q!==0&&$>0?p.getForTilePoints(Y,[ae],!0,H):ie.push(ae),p.getForTilePoints(o,ie,!0,y),Math.max(ie[0][2],ie[1][2],ae[2])/p.exaggeration()};for(let F=0;F<4;F++){const j=u.borderFeatureIndices[F];if(j.length===0)continue;const Q=s.cN[F](o),H=T(Q);if(!(H&&H instanceof s.cO)||u.borderDoneWithNeighborZ[F]===H.canonical.z)continue;H.centroidVertexArray.length===0&&H.createCentroidsBuffer();const Y=p?p.findDEMTileFor(Q):null;if(!(Y&&Y.dem||_))continue;const N=(F<2?1:5)-F,$=H.borderDoneWithNeighborZ[N]!==u.canonical.z,ie=H.borderFeatureIndices[N];let te=0;if(u.canonical.z!==H.canonical.z){for(const ae of j)u.showCentroid(u.featuresOnBorder[ae]);if($)for(const ae of ie)H.showCentroid(H.featuresOnBorder[ae]);u.borderDoneWithNeighborZ[F]=H.canonical.z,H.borderDoneWithNeighborZ[N]=u.canonical.z}for(const ae of j){const ge=u.featuresOnBorder[ae],se=u.centroidData[ge.centroidDataIndex],me=ge.borders[F];let xe;for(;te<ie.length;){xe=H.featuresOnBorder[ie[te]];const oe=xe.borders[N];if(oe[1]>me[0]+3||oe[0]>me[0]-3)break;H.showCentroid(xe),te++}if(xe&&te<ie.length){const oe=te;let fe=0;for(;!(xe.borders[N][0]>me[1]-3)&&(fe++,++te!==ie.length);)xe=H.featuresOnBorder[ie[te]];if(xe=H.featuresOnBorder[ie[oe]],fe>1){const _e=xe.borders[N];Math.abs(me[0]-_e[0])<3&&Math.abs(me[1]-_e[1])<3&&(fe=1,te=oe+1)}else if(fe===0){u.showCentroid(ge);continue}const Re=H.centroidData[xe.centroidDataIndex];_&&fe===1&&(((O=se).flags|(B=Re).flags)&s.cP?(O.flags|=s.cP,B.flags|=s.cP):(O.flags&=~s.cP,B.flags&=~s.cP));const ue=ge.intersectsCount()>1||xe.intersectsCount()>1;if(fe>1)te=oe,se.centroidXY=Re.centroidXY=new s.P(0,0);else if(Y&&Y.dem&&!ue){const _e=D[F](se,Re),ye=F%2?s.Y-1:0,X=k(_e[0],Math.min(s.Y-1,_e[1]),ye,Y,Q,F<2,_e[2]);se.centroidXY=Re.centroidXY=b(X)}else ue?se.centroidXY=Re.centroidXY=new s.P(0,0):(se.centroidXY=u.encodeBorderCentroid(ge),Re.centroidXY=H.encodeBorderCentroid(xe));u.writeCentroidToBuffer(se),H.writeCentroidToBuffer(Re)}else u.showCentroid(ge)}u.borderDoneWithNeighborZ[F]=H.canonical.z,H.borderDoneWithNeighborZ[N]=u.canonical.z}var O,B;(u.needsCentroidUpdate||!u.centroidVertexBuffer&&u.centroidVertexArray.length!==0)&&u.uploadCentroid(c)}const Hu=[1,0,0],F1=[0,1,0],dc=[0,0,1];function oo(c,i,o){const u=o.transform,d=o.shadowRenderer;if(!d)return!0;const p=c.toUnwrapped(),_=u.tileSize*d._cascades[o.currentShadowCascade].scale;let y=i.maxHeight;if(u.elevation){const O=u.elevation.getMinMaxForTile(c);O&&(y+=O.max)}const b=[...d.shadowDirection];b[2]=-b[2];const T=d.computeSimplifiedTileShadowVolume(p,y,_,b);if(!T)return!1;const E=[Hu,F1,dc,b,[b[0],0,b[2]],[0,b[1],b[2]]],I=u.projection.name==="globe",C=u.scaleZoom(_),D=s.bt.fromInvProjectionMatrix(u.invProjMatrix,u.worldSize,C,!I),k=d.getCurrentCascadeFrustum();return D.intersectsPrecise(T.vertices,T.planes,E)===0||k.intersectsPrecise(T.vertices,T.planes,E)===0}function fc(c){return[c[0]*s.cS,c[1]*s.cS,c[2]*s.cS,0]}function so(c,i,o,u,d,p,_,y,b){const T=u.getSource(),E=o.globeSharedBuffers;if(!E)return;let I,C,D;if(i&&(I=u.getTile(i)),T instanceof s.as?(C=T.texture,D=s.co(0,0,o.transform)):I&&i&&(C=I.texture,D=s.co(i.canonical.z,i.canonical.x,o.transform)),!C||!D)return;c||(D=s.a9.scale(s.a9.create(),D,[1,-1,1]));const k=o.context,O=k.gl,B=d.paint.get("raster-resampling")==="nearest"?O.NEAREST:O.LINEAR,F=o.colorModeForDrapableLayerRenderPass(p),j=_.defines;j.push("GLOBE_POLES");const Q=new vt(O.LEQUAL,vt.ReadWrite,o.depthRangeFor3D),H=Float32Array.from(o.transform.expandedFarZProjMatrix),Y=Float32Array.from(s.aW(s.cn(new s.bv(0,0,0))));o.terrain&&o.terrain.prepareDrawTile(),k.activeTexture.set(O.TEXTURE0),C.bind(B,O.CLAMP_TO_EDGE),k.activeTexture.set(O.TEXTURE1),C.bind(B,O.CLAMP_TO_EDGE),C.useMipmap&&k.extTextureFilterAnisotropic&&o.transform.pitch>20&&O.texParameterf(O.TEXTURE_2D,k.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,k.extTextureFilterAnisotropicMax);const[N,$,ie,te]=i?E.getPoleBuffers(i.canonical.z,!1):E.getPoleBuffers(0,!0),ae=d.paint.get("raster-elevation");let ge;c?(ge=N,o.renderDefaultNorthPole=ae!==0):(ge=$,o.renderDefaultSouthPole=ae!==0);const se=fc(_.mix),me=((oe,fe,Re,ue,_e,ye,X,Ee,Je,st,_t,ht,xt)=>O1(oe,fe,Re,new Float32Array(16),new Float32Array(9),[0,0],ue,[0,0],[0,0,0,0],1,{opacity:1,mix:0},ye,[0,0],Ee,2,st,_t,ht,1,0,xt))(H,Y,D,s.W(o.transform.zoom),0,d,0,ae,0,se,_.offset,_.range,p),xe=o.getOrCreateProgram("raster",{defines:j});o.uploadCommonUniforms(k,xe,null),xe.draw(o,O.TRIANGLES,Q,b,F,y,me,d.id,ge,ie,te)}function pc(c){const i=c._nearZ,o=c.projection.farthestPixelDistance(c),u=o-i,d=.2*c.height,p=i+d;return[i,o,(p-d-i)/u,(p-i)/u]}function Fs(c,i,o,u){if(c)return i instanceof $e&&c instanceof Bl?i.getTextureDescriptor(c,o,!0):{texture:c.texture,mix:fc(u.mix),offset:u.offset,buffer:0,tileSize:1}}function nf(c,i,o){if(!c)return null;const u=i.getTextureDescriptor(c,o,!0);if(!u)return null;let{texture:d,mix:p,offset:_,tileSize:y,buffer:b,format:T}=u;if(!d||!T)return null;let E=!1;return T==="uint32"&&(E=!0,p[3]=0,p=qa(s.cT,p,[0,o.paint.get("raster-particle-max-speed")]),_=Uu(s.cT,_,[0,o.paint.get("raster-particle-max-speed")])),{texture:d,textureOffset:[b/(y+2*b),y/(y+2*b)],tileSize:y,scalarData:E,scale:p,offset:_,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[T]]}}function of(c){const i=c._nearZ,o=c.projection.farthestPixelDistance(c),u=o-i,d=.2*c.height,p=i+d;return[i,o,(p-d-i)/u,(p-i)/u]}const Qu=new s.aA(1,0,0,1),sf=new s.aA(0,1,0,1),N1=new s.aA(0,0,1,1),V1=new s.aA(1,0,1,1),Xu=new s.aA(0,1,1,1);function Ns(c,i,o,u,d,p,_){const y=c.context,b=c.transform,T=y.gl,E=b.projection.name==="globe",I=E?["PROJECTION_GLOBE_VIEW"]:[];let C=s.a9.clone(o.projMatrix);if(E&&s.W(b.zoom)>0){const se=s.aV(o.canonical,b),me=s.cU(se);C=s.a9.multiply(new Float32Array(16),b.globeMatrix,me),s.a9.multiply(C,b.projMatrix,C)}const D=s.a9.create();D[12]+=2*d/(s.f.devicePixelRatio*b.width),D[13]+=2*p/(s.f.devicePixelRatio*b.height),s.a9.multiply(C,D,C);const k=c.getOrCreateProgram("debug",{defines:I}),O=i.getTileByID(o.key);c.terrain&&c.terrain.setupElevationDraw(O,k);const B=vt.disabled,F=Dt.disabled,j=c.colorModeForRenderPass(),Q="$debug";y.activeTexture.set(T.TEXTURE0),c.emptyTexture.bind(T.LINEAR,T.CLAMP_TO_EDGE),E?O._makeGlobeTileDebugBuffers(c.context,b):O._makeDebugTileBoundsBuffers(c.context,b.projection);const H=O._tileDebugBuffer||c.debugBuffer,Y=O._tileDebugIndexBuffer||c.debugIndexBuffer,N=O._tileDebugSegments||c.debugSegments;if(k.draw(c,T.LINE_STRIP,B,F,j,Mt.disabled,Vu(C,u),Q,H,Y,N,null,null,null,[O._globeTileDebugBorderBuffer]),_){const se=O.latestRawTileData,me=Math.floor((se&&se.byteLength||0)/1024);let xe=o.canonical.toString();o.overscaledZ!==o.canonical.z&&(xe+=` => ${o.overscaledZ}`),xe+=` ${O.state}`,xe+=` ${me}kb`,function(oe,fe){oe.initDebugOverlayCanvas();const Re=oe.debugOverlayCanvas,ue=oe.context.gl,_e=oe.debugOverlayCanvas.getContext("2d");_e.clearRect(0,0,Re.width,Re.height),_e.shadowColor="white",_e.shadowBlur=2,_e.lineWidth=1.5,_e.strokeStyle="white",_e.textBaseline="top",_e.font="bold 36px Open Sans, sans-serif",_e.fillText(fe,5,5),_e.strokeText(fe,5,5),oe.debugOverlayTexture.update(Re),oe.debugOverlayTexture.bind(ue.LINEAR,ue.CLAMP_TO_EDGE)}(c,xe)}const $=i.getTile(o).tileSize,ie=512/Math.min($,512)*(o.overscaledZ/b.zoom)*.5,te=O._tileDebugTextBuffer||c.debugBuffer,ae=O._tileDebugTextIndexBuffer||c.quadTriangleIndexBuffer,ge=O._tileDebugTextSegments||c.debugSegments;k.draw(c,T.TRIANGLES,B,F,Gt.alphaBlended,Mt.disabled,Vu(C,s.aA.transparent,ie),Q,te,ae,ge,null,null,null,[O._globeTileDebugTextBuffer])}function U1(c,i,o,u){mc(c,0,i+o/2,c.transform.width,o,u)}function j1(c,i,o,u){mc(c,i-o/2,0,o,c.transform.height,u)}function mc(c,i,o,u,d,p){const _=c.context,y=_.gl;y.enable(y.SCISSOR_TEST),y.scissor(i*s.f.devicePixelRatio,o*s.f.devicePixelRatio,u*s.f.devicePixelRatio,d*s.f.devicePixelRatio),_.clear({color:p}),y.disable(y.SCISSOR_TEST)}const G1=s.aB([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:af}=G1;function Ln(c,i,o,u){c.emplaceBack(i,o,u)}class $1{constructor(i){this.vertexArray=new s.cV,this.indices=new s.az,Ln(this.vertexArray,-1,-1,1),Ln(this.vertexArray,1,-1,1),Ln(this.vertexArray,-1,1,1),Ln(this.vertexArray,1,1,1),Ln(this.vertexArray,-1,-1,-1),Ln(this.vertexArray,1,-1,-1),Ln(this.vertexArray,-1,1,-1),Ln(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=i.createVertexBuffer(this.vertexArray,af),this.indexBuffer=i.createIndexBuffer(this.indices),this.segment=s.aE.simpleSegment(0,0,36,12)}}function rs(c,i,o,u,d,p){const _=c.context.gl,y=i.paint.get("sky-atmosphere-color"),b=i.paint.get("sky-atmosphere-halo-color"),T=i.paint.get("sky-atmosphere-sun-intensity"),E=((I,C,D,k,O)=>({u_matrix_3f:I,u_sun_direction:C,u_sun_intensity:D,u_color_tint_r:[k.r,k.g,k.b,k.a],u_color_tint_m:[O.r,O.g,O.b,O.a],u_luminance:5e-5}))(s.ct.fromMat4(s.ct.create(),u),d,T,y,b);_.framebufferTexture2D(_.FRAMEBUFFER,_.COLOR_ATTACHMENT0,_.TEXTURE_CUBE_MAP_POSITIVE_X+p,i.skyboxTexture,0),o.draw(c,_.TRIANGLES,vt.disabled,Dt.disabled,Gt.unblended,Mt.frontCW,E,"skyboxCapture",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}const Yu=s.aB([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class _c{constructor(i){const o=new s.cW;o.emplaceBack(-1,1,1,0,0),o.emplaceBack(1,1,1,1,0),o.emplaceBack(1,-1,1,1,1),o.emplaceBack(-1,-1,1,0,1);const u=new s.az;u.emplaceBack(0,1,2),u.emplaceBack(2,3,0),this.vertexBuffer=i.createVertexBuffer(o,Yu.members),this.indexBuffer=i.createIndexBuffer(u),this.segments=s.aE.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Ju=s.aB([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class is{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Ku{constructor(i){this.colorModeAlphaBlendedWriteRGB=new Gt([1,Ol,1,Ol],s.aA.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Gt([1,0,1,0],s.aA.transparent,[!1,!1,!1,!0]),this.params=new is,this.updateNeeded=!0,i.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),i.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),i.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),i.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(i){const o=i.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new _c(o);const u=this.params.sizeRange,d=this.params.intensityRange,p=function(E){const I=s.aC(30),C=[];for(let D=0;D<E;++D){const k=2*Math.PI*I(),O=Math.acos(1-2*I())-.5*Math.PI;C.push(s.Q.fromValues(Math.cos(O)*Math.cos(k),Math.cos(O)*Math.sin(k),Math.sin(O)))}return C}(this.params.starsCount),_=s.aC(300),y=new s.cX,b=new s.az;let T=0;for(let E=0;E<p.length;++E){const I=s.Q.scale([],p[E],200),C=Math.max(0,1+.01*u*(1*_()-.5)),D=Math.max(0,1+.01*d*(1*_()-.5));y.emplaceBack(I[0],I[1],I[2],-1,-1,C,D),y.emplaceBack(I[0],I[1],I[2],1,-1,C,D),y.emplaceBack(I[0],I[1],I[2],1,1,C,D),y.emplaceBack(I[0],I[1],I[2],-1,1,C,D),b.emplaceBack(T+0,T+1,T+2),b.emplaceBack(T+0,T+2,T+3),T+=4}this.starsVx=o.createVertexBuffer(y,Ju.members),this.starsIdx=o.createIndexBuffer(b),this.starsSegments=s.aE.simpleSegment(0,0,y.length,b.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(i,o){const u=i.context,d=u.gl,p=i.transform,_=new vt(d.LEQUAL,vt.ReadOnly,[0,1]),y=s.W(p.zoom),b=o.properties.get("color").toArray01(),T=o.properties.get("high-color").toArray01(),E=o.properties.get("space-color").toArray01PremultipliedAlpha(),I=5e-4,C=s.cY(o.properties.get("horizon-blend"),0,1,I,.25),D=s.ci(i,u,p)&&C===I?p.worldSize/(2*Math.PI*1.025)-1:p.globeRadius,k=i.frameCounter/1e3%1,O=s.Q.length(p.globeCenterInViewSpace),B=Math.sqrt(Math.pow(O,2)-Math.pow(D,2)),F=Math.acos(B/O),j=Q=>{const H=p.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];Q&&H.push("ALPHA_PASS");const Y=i.getOrCreateProgram("globeAtmosphere",{defines:H}),N=((ie,te,ae,ge,se,me,xe,oe,fe,Re,ue,_e)=>({u_frustum_tl:ie,u_frustum_tr:te,u_frustum_br:ae,u_frustum_bl:ge,u_horizon:se,u_transition:me,u_fadeout_range:xe,u_color:oe,u_high_color:fe,u_space_color:Re,u_temporal_offset:ue,u_horizon_angle:_e}))(p.frustumCorners.TL,p.frustumCorners.TR,p.frustumCorners.BR,p.frustumCorners.BL,p.frustumCorners.horizon,y,C,b,T,E,k,F);i.uploadCommonUniforms(u,Y);const $=this.atmosphereBuffer;$&&Y.draw(i,d.TRIANGLES,_,Dt.disabled,Q?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Mt.backCW,N,Q?"atmosphere_glow_alpha":"atmosphere_glow",$.vertexBuffer,$.indexBuffer,$.segments)};j(!1),j(!0)}drawStars(i,o){const u=s.ad(o.properties.get("star-intensity"),0,1);if(u===0)return;const d=i.context,p=d.gl,_=i.transform,y=i.getOrCreateProgram("stars"),b=s.bl.identity([]);s.bl.rotateX(b,b,-_._pitch),s.bl.rotateZ(b,b,-_.angle),s.bl.rotateX(b,b,s.bm(_._center.lat)),s.bl.rotateY(b,b,-s.bm(_._center.lng));const T=s.a9.fromQuat(new Float32Array(16),b),E=s.a9.multiply([],_.starsProjMatrix,T),I=s.ct.fromMat4([],T),C=s.ct.invert([],I),D=[0,1,0];s.Q.transformMat3(D,D,C),s.Q.scale(D,D,this.params.sizeMultiplier);const k=[1,0,0];s.Q.transformMat3(k,k,C),s.Q.scale(k,k,this.params.sizeMultiplier);const O=(B=D,F=k,j=u,{u_matrix:Float32Array.from(E),u_up:B,u_right:F,u_intensity_multiplier:j});var B,F,j;i.uploadCommonUniforms(d,y),this.starsVx&&this.starsIdx&&y.draw(i,p.TRIANGLES,vt.disabled,Dt.disabled,this.colorModeAlphaBlendedWriteRGB,Mt.disabled,O,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function eh(c,i){const o=[...c],u=i.cameraWorldSizeForFog/i.worldSize,d=s.a9.identity([]);return s.a9.scale(d,d,[u,u,1]),s.a9.multiply(o,d,o),s.a9.multiply(o,i.worldToFogMatrix,o),o}function Co(c,i,o,u){const d=o.material,p=u.context,{baseColorTexture:_,metallicRoughnessTexture:y}=d.pbrMetallicRoughness,{normalTexture:b,occlusionTexture:T,emissionTexture:E}=d;function I(C,D,k){if(C&&(c.push(D),p.activeTexture.set(p.gl.TEXTURE0+k),C.gfxTexture)){const{minFilter:O,magFilter:B,wrapS:F,wrapT:j}=C.sampler;C.gfxTexture.bindExtraParam(O,B,F,j)}}I(_,"HAS_TEXTURE_u_baseColorTexture",Xi.BaseColor),I(y,"HAS_TEXTURE_u_metallicRoughnessTexture",Xi.MetallicRoughness),I(b,"HAS_TEXTURE_u_normalTexture",Xi.Normal),I(T,"HAS_TEXTURE_u_occlusionTexture",Xi.Occlusion),I(E,"HAS_TEXTURE_u_emissionTexture",Xi.Emission),o.texcoordBuffer&&(c.push("HAS_ATTRIBUTE_a_uv_2f"),i.push(o.texcoordBuffer)),o.colorBuffer&&(c.push(o.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),i.push(o.colorBuffer)),o.normalBuffer&&(c.push("HAS_ATTRIBUTE_a_normal_3f"),i.push(o.normalBuffer)),o.pbrBuffer&&(c.push("HAS_ATTRIBUTE_a_pbr"),c.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),i.push(o.pbrBuffer)),d.alphaMode!=="OPAQUE"&&d.alphaMode!=="MASK"||c.push("UNPREMULT_TEXTURE_IN_SHADER"),d.defined||c.push("DIFFUSE_SHADED"),c.push("USE_STANDARD_DERIVATIVES")}function Do(c,i,o,u,d,p){const _=o.paint.get("model-opacity"),y=i.context,b=new vt(i.context.gl.LEQUAL,vt.ReadWrite,i.depthRangeFor3D),T=i.transform,E=c.mesh,I=E.material,C=I.pbrMetallicRoughness,D=i.style.fog;let k;k=i.transform.projection.zAxisUnit==="pixels"?[...c.nodeModelMatrix]:s.a9.multiply([],u.zScaleMatrix,c.nodeModelMatrix),s.a9.multiply(k,u.negCameraPosMatrix,k);const O=s.a9.invert([],k);s.a9.transpose(O,O);const B=o.paint.get("model-emissive-strength").constantOr(0),F=cc(new Float32Array(c.worldViewProjection),new Float32Array(k),new Float32Array(O),null,i,_,C.baseColorFactor,I.emissiveFactor,C.metallicFactor,C.roughnessFactor,I,B,o),j={defines:[]},Q=[];Co(j.defines,Q,E,i);const H=i.shadowRenderer;H&&(H.useNormalOffset=!1);let Y=null;if(D){const ie=eh(c.nodeModelMatrix,i.transform);if(Y=new Float32Array(ie),T.projection.name!=="globe"){const te=E.aabb.min,ae=E.aabb.max,[ge,se]=D.getOpacityForBounds(ie,te[0],te[1],ae[0],ae[1]);j.overrideFog=ge>=pr||se>=pr}}const N=Eo(i,o.paint.get("model-cutoff-fade-range"));N.shouldRenderCutoff&&j.defines.push("RENDER_CUTOFF");const $=i.getOrCreateProgram("model",j);i.uploadCommonUniforms(y,$,null,Y,N),i.renderPass!=="shadow"&&H&&H.setupShadowsFromMatrix(c.nodeModelMatrix,$),$.draw(i,y.gl.TRIANGLES,b,d,p,E.material.doubleSided?Mt.disabled:Mt.backCCW,F,o.id,E.vertexBuffer,E.indexBuffer,E.segments,o.paint,i.transform.zoom,void 0,Q)}function Ya(c,i,o,u,d,p,_){let y;y=c.projection.name==="globe"?s.c_(o,c):[...o],s.a9.multiply(y,y,i.matrix);const b=s.a9.multiply([],u,y);if(i.meshes)for(const T of i.meshes){if(T.material.alphaMode!=="BLEND"){_.push({mesh:T,depth:0,modelIndex:d,worldViewProjection:b,nodeModelMatrix:y});continue}const E=s.Q.transformMat4([],T.centroid,b);E[2]>0&&p.push({mesh:T,depth:E[2],modelIndex:d,worldViewProjection:b,nodeModelMatrix:y})}if(i.children)for(const T of i.children)Ya(c,T,o,u,d,p,_)}function Ja(c,i,o,u){const d=o.shadowRenderer;if(!d)return;const p=d.getShadowPassDepthMode(),_=d.getShadowPassColorMode(),y=d.calculateShadowPassMatrixFromMatrix(i),b=k1(y);o.getOrCreateProgram("modelDepth",{defines:o._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(o,o.context.gl.TRIANGLES,p,Dt.disabled,_,Mt.backCCW,b,u.id,c.vertexBuffer,c.indexBuffer,c.segments,u.paint,o.transform.zoom,void 0,void 0)}function Ka(c,i,o){const u=i.updateZoomBasedPaintProperties(),d=function(p,_,y){let b,T,E,I=p.terrain?p.terrain.exaggeration():0;if(p.terrain&&I>0){const C=p.terrain,D=C.findDEMTileFor(y);D&&D.dem?b=s.d0.create(C,y,D):I=0}if(I===0&&(_.terrainElevationMin=0,_.terrainElevationMax=0),I===_.validForExaggeration&&(I===0||b&&b._demTile&&b._demTile.tileID===_.validForDEMTile.id&&b._dem._timestamp===_.validForDEMTile.timestamp))return!1;for(const C in _.instancesPerModel){const D=_.instancesPerModel[C];for(let k=0;k<D.instancedDataArray.length;++k){const O=(b?I*b.getElevationAt(0|D.instancedDataArray.float32[16*k],0|D.instancedDataArray.float32[16*k+1],!0,!0):0)+D.instancesEvaluatedElevation[k];D.instancedDataArray.float32[16*k+6]=O,T=T?Math.min(_.terrainElevationMin,O):O,E=E?Math.max(_.terrainElevationMax,O):O}}return _.terrainElevationMin=T||0,_.terrainElevationMax=E||0,_.validForExaggeration=I,_.validForDEMTile=b&&b._demTile?{id:b._demTile.tileID,timestamp:b._dem._timestamp}:{id:void 0,timestamp:0},!0}(c,i,o);(u||d)&&(i.uploaded=!1,i.upload(c.context))}const dn={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new s.bV([0,0,0],[s.Y,s.Y,0])};function gc(c,i){const o=1<<c.canonical.z,u=i.getFreeCameraOptions().position,d=i.elevation,p=c.canonical.x/o,_=(c.canonical.x+1)/o,y=c.canonical.y/o,b=(c.canonical.y+1)/o;let T=i._centerAltitude;if(d){const D=d.getMinMaxForTile(c);D&&D.max>T&&(T=D.max)}const E=s.ad(u.x,p,_)-u.x,I=s.ad(u.y,y,b)-u.y,C=s.bo(T,i.center.lat)-u.z;return i._zoomFromMercatorZ(Math.sqrt(E*E+I*I+C*C))}function yc(c,i,o,u,d,p,_){const y=c.context,b=c.renderPass==="shadow",T=c.shadowRenderer,E=b&&T?T.getShadowPassDepthMode():new vt(y.gl.LEQUAL,vt.ReadWrite,c.depthRangeFor3D),I=c.isTileAffectedByFog(p);if(o.meshes)for(const C of o.meshes){const D=["MODEL_POSITION_ON_GPU"],k=[];let O,B,F;u.instancedDataArray.length>20&&D.push("INSTANCED_ARRAYS");const j=Eo(c,i.paint.get("model-cutoff-fade-range"));if(j.shouldRenderCutoff&&D.push("RENDER_CUTOFF"),b&&T)O=c.getOrCreateProgram("modelDepth",{defines:D}),B=k1(_.shadowTileMatrix,_.shadowTileMatrix,Float32Array.from(o.matrix)),F=T.getShadowPassColorMode();else{Co(D,k,C,c),O=c.getOrCreateProgram("model",{defines:D,overrideFog:I});const H=C.material,Y=H.pbrMetallicRoughness,N=i.paint.get("model-opacity"),$=i.paint.get("model-emissive-strength").constantOr(0);B=cc(p.expandedProjMatrix,Float32Array.from(o.matrix),new Float32Array(16),null,c,N,Y.baseColorFactor,H.emissiveFactor,Y.metallicFactor,Y.roughnessFactor,H,$,i,d),T&&(_.shadowUniformsInitialized?O.setShadowUniformValues(y,T.getShadowUniformValues()):(T.setupShadows(p.toUnwrapped(),O,"model-tile",p.overscaledZ),_.shadowUniformsInitialized=!0)),F=j.shouldRenderCutoff||N<1||H.alphaMode!=="OPAQUE"?Gt.alphaBlended:Gt.unblended}c.uploadCommonUniforms(y,O,p.toUnwrapped(),null,j);const Q=C.material.doubleSided?Mt.disabled:Mt.backCCW;if(u.instancedDataArray.length>20)k.push(u.instancedDataBuffer),O.draw(c,y.gl.TRIANGLES,E,Dt.disabled,F,Q,B,i.id,C.vertexBuffer,C.indexBuffer,C.segments,i.paint,c.transform.zoom,void 0,k,u.instancedDataArray.length);else{const H=b?"u_instance":"u_normal_matrix";for(let Y=0;Y<u.instancedDataArray.length;++Y)B[H]=new Float32Array(u.instancedDataArray.arrayBuffer,64*Y,16),O.draw(c,y.gl.TRIANGLES,E,Dt.disabled,F,Q,B,i.id,C.vertexBuffer,C.indexBuffer,C.segments,i.paint,c.transform.zoom,void 0,k)}}if(o.children)for(const C of o.children)yc(c,i,C,u,d,p,_)}const xc=[1,-1,1];function el(c,i,o,u){if(!o.modelManager)return!0;const d=o.modelManager;if(!o.shadowRenderer)return!0;const p=o.shadowRenderer,_=i.aabb;let y=!0,b=c.maxHeight;if(b===0){let E=0;for(const I in c.instancesPerModel){const C=d.getModel(I,u);C?E=Math.max(E,Math.max(Math.max(C.aabb.max[0],C.aabb.max[1]),C.aabb.max[2])):y=!1}b=c.maxScale*E*1.41+c.maxVerticalOffset,y&&(c.maxHeight=b)}_.max[2]=b,_.min[2]+=c.terrainElevationMin,_.max[2]+=c.terrainElevationMax,s.Q.transformMat4(_.min,_.min,i.tileMatrix),s.Q.transformMat4(_.max,_.max,i.tileMatrix);const T=_.intersects(p.getCurrentCascadeFrustum());return o.currentShadowCascade===0&&(c.isInsideFirstShadowMapFrustum=T===2),T===0}class q1{}class Z1{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(i,o,u){{const I=this._storage.get(o.id);if(I)return I.lastUsedFrameIdx=i,I.buf}const d=u.gl,p=d.getBufferParameter(d.ELEMENT_ARRAY_BUFFER,d.BUFFER_SIZE),_=new ArrayBuffer(p),y=new Int16Array(_);d.getBufferSubData(d.ELEMENT_ARRAY_BUFFER,0,new Int16Array(_));const b=new s.d2;for(let I=0;I<p/2;I+=3){const C=y[I],D=y[I+1],k=y[I+2];b.emplaceBack(C,D),b.emplaceBack(D,k),b.emplaceBack(k,C)}const T=u.bindVertexArrayOES.current,E=new q1;return E.buf=new zr(u,b),E.lastUsedFrameIdx=i,this._storage.set(o.id,E),u.bindVertexArrayOES.set(T),E.buf}update(i){for(const[o,u]of this._storage)i-u.lastUsedFrameIdx>30&&(u.buf.destroy(),this._storage.delete(o))}destroy(){for(const[i,o]of this._storage)o.buf.destroy(),this._storage.delete(i)}}const vc={symbol:function(c,i,o,u,d){if(c.renderPass!=="translucent")return;const p=Dt.disabled,_=c.colorModeForRenderPass();o.layout.get("text-variable-anchor")&&function(T,E,I,C,D,k,O){const B=E.transform,F=D==="map",j=k==="map";for(const Q of T){const H=C.getTile(Q),Y=H.getBucket(I);if(!Y||!Y.text||!Y.text.segments.get().length)continue;const N=s.b8(Y.textSizeData,B.zoom),$=$l(Q,Y.getProjection(),B),ie=B.calculatePixelsToTileUnitsMatrix(H),te=Ma($,H.tileID.canonical,j,F,B,Y.getProjection(),ie),ae=Y.hasIconTextFit()&&Y.hasIconData();if(N){const ge=Math.pow(2,B.zoom-H.tileID.overscaledZ);B1(Y,F,j,O,s.cE,B,te,Q,ge,N,ae)}}}(u,c,o,i,o.layout.get("text-rotation-alignment"),o.layout.get("text-pitch-alignment"),d);const y=o.paint.get("icon-opacity").constantOr(1)!==0,b=o.paint.get("text-opacity").constantOr(1)!==0;o.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(y||b)?Xa(c,i,o,u,p,_):(y&&Xa(c,i,o,u,p,_,{onlyIcons:!0}),b&&Xa(c,i,o,u,p,_,{onlyText:!0})),i.map.showCollisionBoxes&&(qu(c,i,o,u,o.paint.get("text-translate"),o.paint.get("text-translate-anchor"),!0),qu(c,i,o,u,o.paint.get("icon-translate"),o.paint.get("icon-translate-anchor"),!1))},circle:function(c,i,o,u){if(c.renderPass!=="translucent")return;const d=o.paint.get("circle-opacity"),p=o.paint.get("circle-stroke-width"),_=o.paint.get("circle-stroke-opacity"),y=o.layout.get("circle-sort-key").constantOr(1)!==void 0,b=o.paint.get("circle-emissive-strength");if(d.constantOr(1)===0&&(p.constantOr(1)===0||_.constantOr(1)===0))return;const T=c.context,E=T.gl,I=c.transform,C=c.depthModeForSublayer(0,vt.ReadOnly),D=Dt.disabled,k=c.colorModeForDrapableLayerRenderPass(b),O=I.projection.name==="globe",B=[s.a8(I.center.lng),s.ah(I.center.lat)],F=[];for(let Q=0;Q<u.length;Q++){const H=u[Q],Y=i.getTile(H),N=Y.getBucket(o);if(!N||N.projection.name!==I.projection.name)continue;const $=N.programConfigurations.get(o.id),ie=s.cF(o),te=c.isTileAffectedByFog(H);O&&ie.push("PROJECTION_GLOBE_VIEW");const ae=c.getOrCreateProgram("circle",{config:$,defines:ie,overrideFog:te}),ge=N.layoutVertexBuffer,se=N.globeExtVertexBuffer,me=N.indexBuffer,xe=I.projection.createInversionMatrix(I,H.canonical),oe={programConfiguration:$,program:ae,layoutVertexBuffer:ge,globeExtVertexBuffer:se,indexBuffer:me,uniformValues:s.cG(c,H,Y,xe,B,o),tile:Y};if(y){const fe=N.segments.get();for(const Re of fe)F.push({segments:new s.aE([Re]),sortKey:Re.sortKey,state:oe})}else F.push({segments:N.segments,sortKey:0,state:oe})}y&&F.sort((Q,H)=>Q.sortKey-H.sortKey);const j={useDepthForOcclusion:I.depthOcclusionForSymbolsAndCircles};for(const Q of F){const{programConfiguration:H,program:Y,layoutVertexBuffer:N,globeExtVertexBuffer:$,indexBuffer:ie,uniformValues:te,tile:ae}=Q.state,ge=Q.segments;c.terrain&&c.terrain.setupElevationDraw(ae,Y,j),c.uploadCommonUniforms(T,Y,ae.tileID.toUnwrapped()),Y.draw(c,E.TRIANGLES,C,D,k,Mt.disabled,te,o.id,N,ie,ge,o.paint,I.zoom,H,[$])}},heatmap:function(c,i,o,u){if(o.paint.get("heatmap-opacity")!==0)if(c.renderPass==="offscreen"){const d=c.context,p=d.gl,_=Dt.disabled,y=new Gt([p.ONE,p.ONE,p.ONE,p.ONE],s.aA.transparent,[!0,!0,!0,!0]);(function(D,k,O,B){const F=D.gl,j=k.width*B,Q=k.height*B;D.activeTexture.set(F.TEXTURE1),D.viewport.set([0,0,j,Q]);let H=O.heatmapFbo;if(!H||H&&(H.width!==j||H.height!==Q)){H&&H.destroy();const Y=F.createTexture();F.bindTexture(F.TEXTURE_2D,Y),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_WRAP_S,F.CLAMP_TO_EDGE),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_WRAP_T,F.CLAMP_TO_EDGE),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_MIN_FILTER,F.LINEAR),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_MAG_FILTER,F.LINEAR),H=O.heatmapFbo=D.createFramebuffer(j,Q,!0,null),function(N,$,ie,te,ae,ge){const se=N.gl;se.texImage2D(se.TEXTURE_2D,0,N.extRenderToTextureHalfFloat?se.RGBA16F:se.RGBA,ae,ge,0,se.RGBA,N.extRenderToTextureHalfFloat?se.HALF_FLOAT:se.UNSIGNED_BYTE,null),te.colorAttachment.set(ie)}(D,0,Y,H,j,Q)}else F.bindTexture(F.TEXTURE_2D,H.colorAttachment.get()),D.bindFramebuffer.set(H.framebuffer)})(d,c,o,c.transform.projection.name==="globe"?.5:.25),d.clear({color:s.aA.transparent});const b=c.transform,T=b.projection.name==="globe",E=T?["PROJECTION_GLOBE_VIEW"]:[],I=T?Mt.frontCCW:Mt.disabled,C=[s.a8(b.center.lng),s.ah(b.center.lat)];for(let D=0;D<u.length;D++){const k=u[D];if(i.hasRenderableParent(k))continue;const O=i.getTile(k),B=O.getBucket(o);if(!B||B.projection.name!==b.projection.name)continue;const F=c.isTileAffectedByFog(k),j=B.programConfigurations.get(o.id),Q=c.getOrCreateProgram("heatmap",{config:j,defines:E,overrideFog:F}),{zoom:H}=c.transform;c.terrain&&c.terrain.setupElevationDraw(O,Q),c.uploadCommonUniforms(d,Q,k.toUnwrapped());const Y=b.projection.createInversionMatrix(b,k.canonical);Q.draw(c,p.TRIANGLES,vt.disabled,_,y,I,Jd(c,k,O,Y,C,H,o.paint.get("heatmap-intensity")),o.id,B.layoutVertexBuffer,B.indexBuffer,B.segments,o.paint,c.transform.zoom,j,T?[B.globeExtVertexBuffer]:null)}d.viewport.set([0,0,c.width,c.height])}else c.renderPass==="translucent"&&(c.context.setColorMode(c.colorModeForRenderPass()),function(d,p){const _=d.context,y=_.gl,b=p.heatmapFbo;if(!b)return;_.activeTexture.set(y.TEXTURE0),y.bindTexture(y.TEXTURE_2D,b.colorAttachment.get()),_.activeTexture.set(y.TEXTURE1);let T=p.colorRampTexture;T||(T=p.colorRampTexture=new s.T(_,p.colorRamp,y.RGBA)),T.bind(y.LINEAR,y.CLAMP_TO_EDGE),d.getOrCreateProgram("heatmapTexture").draw(d,y.TRIANGLES,vt.disabled,Dt.disabled,d.colorModeForRenderPass(),Mt.disabled,((E,I,C,D)=>({u_image:0,u_color_ramp:1,u_opacity:I.paint.get("heatmap-opacity")}))(0,p),p.id,d.viewportBuffer,d.quadTriangleIndexBuffer,d.viewportSegments,p.paint,d.transform.zoom)}(c,o))},line:function(c,i,o,u){if(c.renderPass!=="translucent")return;const d=o.paint.get("line-opacity"),p=o.paint.get("line-width");if(d.constantOr(1)===0||p.constantOr(1)===0)return;const _=o.paint.get("line-emissive-strength"),y=c.depthModeForSublayer(0,vt.ReadOnly),b=c.colorModeForDrapableLayerRenderPass(_),T=c.terrain&&c.terrain.renderingToTexture?1:s.f.devicePixelRatio,E=o.paint.get("line-dasharray"),I=E.constantOr(1),C=o.layout.get("line-cap"),D=o.paint.get("line-pattern"),k=D.constantOr(1),O=o.paint.get("line-opacity").constantOr(1)!==1;let B=!k&&O;const F=o.paint.get("line-gradient"),j=k?"linePattern":"line",Q=c.context,H=Q.gl,Y=s.cH(o);c.terrain&&c.terrain.clipOrMaskOverlapStencilType()&&(B=!1);for(const N of u){const $=i.getTile(N);if(k&&!$.patternsLoaded())continue;const ie=$.getBucket(o);if(!ie)continue;c.prepareDrawTile();const te=ie.programConfigurations.get(o.id),ae=c.isTileAffectedByFog(N),ge=c.getOrCreateProgram(j,{config:te,defines:Y,overrideFog:ae}),se=D.constantOr(null);if(se&&$.imageAtlas){const ye=$.imageAtlas.patternPositions[se.toString()];ye&&te.setConstantPatternPositions(ye)}const me=E.constantOr(null),xe=C.constantOr(null);if(!k&&me&&xe&&$.lineAtlas){const ye=$.lineAtlas.getDash(me,xe);ye&&te.setConstantPatternPositions(ye)}let[oe,fe]=o.paint.get("line-trim-offset");(xe==="round"||xe==="square")&&oe!==fe&&(oe===0&&(oe-=1),fe===1&&(fe+=1));const Re=c.terrain?N.projMatrix:null,ue=k?s.cI(c,$,o,Re,T,[oe,fe]):s.cJ(c,$,o,Re,ie.lineClipsArray.length,T,[oe,fe]);if(F){const ye=ie.gradients[o.id];let X=ye.texture;if(o.gradientVersion!==ye.version){let Ee=256;if(o.stepInterpolant){const Je=i.getSource().maxzoom,st=N.canonical.z===Je?Math.ceil(1<<c.transform.maxZoom-N.canonical.z):1;Ee=s.ad(s.cK(ie.maxLineLength/s.Y*1024*st),256,Q.maxTextureSize)}ye.gradient=s.cL({expression:o.gradientExpression(),evaluationKey:"lineProgress",resolution:Ee,image:ye.gradient||void 0,clips:ie.lineClipsArray}),ye.texture?ye.texture.update(ye.gradient):ye.texture=new s.T(Q,ye.gradient,H.RGBA),ye.version=o.gradientVersion,X=ye.texture}Q.activeTexture.set(H.TEXTURE1),X.bind(o.stepInterpolant?H.NEAREST:H.LINEAR,H.CLAMP_TO_EDGE)}I&&(Q.activeTexture.set(H.TEXTURE0),$.lineAtlasTexture&&$.lineAtlasTexture.bind(H.LINEAR,H.REPEAT),te.updatePaintBuffers()),k&&(Q.activeTexture.set(H.TEXTURE0),$.imageAtlasTexture&&$.imageAtlasTexture.bind(H.LINEAR,H.CLAMP_TO_EDGE),te.updatePaintBuffers()),c.uploadCommonUniforms(Q,ge,N.toUnwrapped());const _e=ye=>{ge.draw(c,H.TRIANGLES,y,ye,b,Mt.disabled,ue,o.id,ie.layoutVertexBuffer,ie.indexBuffer,ie.segments,o.paint,c.transform.zoom,te,[ie.layoutVertexBuffer2,ie.patternVertexBuffer])};if(B){const ye=c.stencilModeForClipping(N).ref;ye===0&&c.terrain&&Q.clear({stencil:0});const X={func:H.EQUAL,mask:255};ue.u_alpha_discard_threshold=.8,_e(new Dt(X,ye,255,H.KEEP,H.KEEP,H.INVERT)),ue.u_alpha_discard_threshold=0,_e(new Dt(X,ye,255,H.KEEP,H.KEEP,H.KEEP))}else _e(c.stencilModeForClipping(N))}B&&(c.resetStencilClippingMasks(),c.terrain&&Q.clear({stencil:0}))},fill:function(c,i,o,u){const d=o.paint.get("fill-color"),p=o.paint.get("fill-opacity");if(p.constantOr(1)===0)return;const _=o.paint.get("fill-emissive-strength"),y=c.colorModeForDrapableLayerRenderPass(_),b=o.paint.get("fill-pattern"),T=c.opaquePassEnabledForLayer()&&!b.constantOr(1)&&d.constantOr(s.aA.transparent).a===1&&p.constantOr(0)===1?"opaque":"translucent";if(c.renderPass===T){const E=c.depthModeForSublayer(1,c.renderPass==="opaque"?vt.ReadWrite:vt.ReadOnly);hc(c,i,o,u,E,y,!1)}if(c.renderPass==="translucent"&&o.paint.get("fill-antialias")){const E=c.depthModeForSublayer(o.getPaintProperty("fill-outline-color")?2:0,vt.ReadOnly);hc(c,i,o,u,E,y,!0)}},"fill-extrusion":function(c,i,o,u){const d=o.paint.get("fill-extrusion-opacity"),p=c.context,_=p.gl,y=c.terrain,b=y&&y.renderingToTexture;if(d===0)return;const T=c.conflationActive&&c.layerUsedInConflation(o,i.getSource());if(T&&function(E,I,C,D){for(const k of D){const O=I.getTile(k).getBucket(C);O&&(O.updateReplacement(k,E.replacementSource),O.uploadCentroid(E.context))}}(c,i,o,u),y||T)for(const E of u){const I=i.getTile(E).getBucket(o);I&&Wu(c.context,i,E,I,o,y,T)}if(c.renderPass==="shadow"&&c.shadowRenderer){const E=c.shadowRenderer;if(y&&d<.65&&o._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof s.Z)return;const I=E.getShadowPassDepthMode(),C=E.getShadowPassColorMode();Qe(c,i,o,u,I,Dt.disabled,C,T)}else if(c.renderPass==="translucent"){const E=!o.paint.get("fill-extrusion-pattern").constantOr(1),I=o.paint.get("fill-extrusion-color").constantOr(s.aA.white);if(!b&&I.a!==0){const C=new vt(c.context.gl.LEQUAL,vt.ReadWrite,c.depthRangeFor3D);d===1&&E?Qe(c,i,o,u,C,Dt.disabled,Gt.unblended,T):(Qe(c,i,o,u,C,Dt.disabled,Gt.disabled,T),Qe(c,i,o,u,C,c.stencilModeFor3D(),c.colorModeForRenderPass(),T),c.resetStencilClippingMasks())}if(c.style.enable3dLights()&&E&&(!y&&c.transform.projection.name!=="globe"||b)){const C=o.paint.get("fill-extrusion-opacity"),D=o.paint.get("fill-extrusion-ambient-occlusion-intensity"),k=o.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),O=o.paint.get("fill-extrusion-flood-light-intensity"),B=o.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),F=D>0&&k>0,j=O>0,Q=(Y,N,$)=>(1-$)*Y+$*N,H=Y=>{const N=c.depthModeForSublayer(1,vt.ReadOnly,_.LEQUAL,!0),$=o.paint.get(Y?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),ie=Q(.1,3,$),te=c._showOverdrawInspector;if(!te){const ae=new Dt({func:_.ALWAYS,mask:255},255,255,_.KEEP,_.KEEP,_.REPLACE),ge=new Gt([_.ONE,_.ONE,_.ONE,_.ONE],s.aA.transparent,[!1,!1,!1,!0],_.MIN);ts(c,i,o,u,N,ae,ge,Mt.disabled,Y,"sdf",C,D,k,O,B,ie,T,!1)}{const ae=te?Dt.disabled:new Dt({func:_.EQUAL,mask:255},255,255,_.KEEP,_.DECR,_.DECR),ge=te?c.colorModeForRenderPass():new Gt([_.ONE_MINUS_DST_ALPHA,_.DST_ALPHA,_.ONE,_.ONE],s.aA.transparent,[!0,!0,!0,!0]);ts(c,i,o,u,N,ae,ge,Mt.disabled,Y,"color",C,D,k,O,B,ie,T,!1)}};if(b){const Y=(N,$,ie)=>{const te=c.depthModeForSublayer(1,vt.ReadOnly,_.LEQUAL,!1),ae=o.paint.get(N?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),ge=Q(.1,3,ae);{const se=new Gt([_.ONE,_.ONE,_.ONE,_.ONE],s.aA.transparent,[!1,!1,!1,!0]);ts(c,i,o,u,te,Dt.disabled,se,Mt.disabled,N,"clear",C,D,k,O,B,ge,T,$)}{const se=new Dt({func:_.ALWAYS,mask:255},255,255,_.KEEP,_.KEEP,_.REPLACE),me=new Gt([_.ONE,_.ONE,_.ONE,_.ONE],s.aA.transparent,[!1,!1,!1,!0],_.MIN);ts(c,i,o,u,te,se,me,Mt.disabled,N,"sdf",C,D,k,O,B,ge,T,$)}{const se=N?_.ZERO:_.ONE_MINUS_DST_ALPHA,me=new Dt({func:_.EQUAL,mask:255},255,255,_.KEEP,_.DECR,_.DECR),xe=new Gt([se,_.DST_ALPHA,_.ONE_MINUS_DST_ALPHA,_.ZERO],s.aA.transparent,[!0,!0,!0,!0]);ts(c,i,o,u,te,me,xe,Mt.disabled,N,"color",C,D,k,O,B,ge,T,$)}{const se=new Gt([_.ONE,_.ONE,_.ONE,N?_.ZERO:_.ONE],s.aA.transparent,[!1,!1,!1,!0],N?_.FUNC_ADD:_.MAX);ts(c,i,o,u,te,Dt.disabled,se,Mt.disabled,N,"clear",C,D,k,O,B,ge,T,$,ie)}};if(F||j){let N;if(c.prepareDrawTile(),y){const $=y.drapeBufferSize[0],ie=y.drapeBufferSize[1];N=y.framebufferCopyTexture,N&&(!N||N.size[0]===$&&N.size[1]===ie)||(N&&N.destroy(),N=y.framebufferCopyTexture=new s.T(p,new s.h({width:$,height:ie}),_.RGBA)),N.bind(_.LINEAR,_.CLAMP_TO_EDGE),_.copyTexImage2D(_.TEXTURE_2D,0,_.RGBA,0,0,$,ie,0)}F&&Y(!0,!1,N),j&&Y(!1,!0,N)}}else F&&H(!0),j&&H(!1)}}},hillshade:function(c,i,o,u){if(c.renderPass!=="offscreen"&&c.renderPass!=="translucent"||c.style.disableElevatedTerrain)return;const d=c.context,p=c.terrain&&c.terrain.renderingToTexture,[_,y]=c.renderPass!=="translucent"||p?[{},u]:c.stencilConfigForOverlap(u);for(const b of y){const T=i.getTile(b);if(T.needsHillshadePrepare&&c.renderPass==="offscreen")zs(c,T,o);else if(c.renderPass==="translucent"){const E=c.depthModeForSublayer(0,vt.ReadOnly),I=o.paint.get("hillshade-emissive-strength"),C=c.colorModeForDrapableLayerRenderPass(I),D=p&&c.terrain?c.terrain.stencilModeForRTTOverlap(b):_[b.overscaledZ];cr(c,b,T,o,E,D,C)}}d.viewport.set([0,0,c.width,c.height]),c.resetStencilClippingMasks()},raster:function(c,i,o,u,d,p){if(c.renderPass!=="translucent"||o.paint.get("raster-opacity")===0)return;const _=c.transform.projection.name==="globe",y=o.paint.get("raster-elevation")!==0,b=y&&_;if(c.renderElevatedRasterBackface&&!b)return;const T=c.context,E=T.gl,I=i.getSource(),C=function(N,$,ie,te){const ae=$.paint.get("raster-color"),ge=N.type==="raster-array",se=[],me=$.paint.get("raster-resampling"),xe=$.paint.get("raster-color-mix");let oe=$.paint.get("raster-color-range");const fe=[xe[0],xe[1],xe[2],0],Re=xe[3];let ue=me==="nearest"?te.NEAREST:te.LINEAR;if(ge&&(se.push("RASTER_ARRAY"),ae||se.push("RASTER_COLOR"),me==="linear"&&se.push("RASTER_ARRAY_LINEAR"),ue=te.NEAREST,!oe&&N.rasterLayers)){const _e=N.rasterLayers.find(({id:ye})=>ye===$.sourceLayer);_e&&_e.fields&&_e.fields.range&&(oe=_e.fields.range)}if(oe=oe||[0,1],ae){se.push("RASTER_COLOR"),ie.activeTexture.set(te.TEXTURE2),$.updateColorRamp(oe);let _e=$.colorRampTexture;_e||(_e=$.colorRampTexture=new s.T(ie,$.colorRamp,te.RGBA)),_e.bind(te.LINEAR,te.CLAMP_TO_EDGE)}return{mix:fe,range:oe,offset:Re,defines:se,resampling:ue}}(I,o,T,E);if(I instanceof s.as&&!u.length&&!_)return;const D=o.paint.get("raster-emissive-strength"),k=c.colorModeForDrapableLayerRenderPass(D),O=c.terrain&&c.terrain.renderingToTexture,B=!c.options.moving,F=o.paint.get("raster-resampling")==="nearest"?E.NEAREST:E.LINEAR;if(I instanceof s.as&&!u.length&&(I.onNorthPole||I.onSouthPole)){const N=y?c.stencilModeFor3D():Dt.disabled;return void so(!!I.onNorthPole,null,c,i,o,D,C,Mt.disabled,N)}if(!u.length)return;const[j,Q]=I instanceof s.as||O?[{},u]:c.stencilConfigForOverlap(u),H=Q[Q.length-1].overscaledZ;b&&C.defines.push("PROJECTION_GLOBE_VIEW"),y&&C.defines.push("RENDER_CUTOFF");const Y=(N,$,ie)=>{for(const te of N){const ae=te.toUnwrapped(),ge=i.getTile(te);if(O&&(!ge||!ge.hasData()))continue;T.activeTexture.set(E.TEXTURE0);const se=Fs(ge,I,o,C);if(!se||!se.texture)continue;const{texture:me,mix:xe,offset:oe,tileSize:fe,buffer:Re}=se;let ue,_e;O?(ue=vt.disabled,_e=te.projMatrix):y?(ue=new vt(E.LEQUAL,vt.ReadWrite,c.depthRangeFor3D),_e=_?Float32Array.from(c.transform.expandedFarZProjMatrix):c.transform.calculateProjMatrix(ae,B)):(ue=c.depthModeForSublayer(te.overscaledZ-H,o.paint.get("raster-opacity")===1?vt.ReadWrite:vt.ReadOnly,E.LESS),_e=c.transform.calculateProjMatrix(ae,B));const ye=c.terrain&&O?c.terrain.stencilModeForRTTOverlap(te):j[te.overscaledZ],X=p?0:o.paint.get("raster-fade-duration");ge.registerFadeDuration(X);const Ee=i.findLoadedParent(te,0),Je=Jo(ge,Ee,i,c.transform,X);let st,_t;c.terrain&&c.terrain.prepareDrawTile(),T.activeTexture.set(E.TEXTURE0),me.bind(F,E.CLAMP_TO_EDGE),T.activeTexture.set(E.TEXTURE1),Ee?(Ee.texture&&Ee.texture.bind(F,E.CLAMP_TO_EDGE),st=Math.pow(2,Ee.tileID.overscaledZ-ge.tileID.overscaledZ),_t=[ge.tileID.canonical.x*st%1,ge.tileID.canonical.y*st%1]):me.bind(F,E.CLAMP_TO_EDGE),me.useMipmap&&T.extTextureFilterAnisotropic&&c.transform.pitch>20&&E.texParameterf(E.TEXTURE_2D,T.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,T.extTextureFilterAnisotropicMax);const ht=c.transform;let xt;const Qt=y?pc(ht):[0,0,0,0];let Ct,Jt,Xt,Ur,yr,hi=0;if(b&&I instanceof s.as&&I.coordinates.length>3)Ct=Float32Array.from(s.aW(s.cn(new s.bv(0,0,0)))),Jt=Float32Array.from(ht.globeMatrix),Xt=Float32Array.from(s.cj(ht)),Ur=[s.a8(ht.center.lng),s.ah(ht.center.lat)],xt=I.elevatedGlobePerspectiveTransform,yr=I.elevatedGlobeGridMatrix||new Float32Array(9);else if(b){const Bt=s.ck(te.canonical);hi=s.cl(Bt.getCenter().lat),Ct=Float32Array.from(s.aW(s.cn(te.canonical))),Jt=Float32Array.from(ht.globeMatrix),Xt=Float32Array.from(s.cj(ht)),Ur=[s.a8(ht.center.lng),s.ah(ht.center.lat)],xt=[0,0],yr=Float32Array.from(s.cm(te.canonical,Bt,hi,ht.worldSize/ht._pixelsPerMercatorPixel))}else xt=I instanceof s.as?I.perspectiveTransform:[0,0],Ct=new Float32Array(16),Jt=new Float32Array(9),Xt=new Float32Array(16),Ur=[0,0],yr=new Float32Array(9);const ii=O1(_e,Ct,Jt,Xt,yr,_t||[0,0],s.W(c.transform.zoom),Ur,Qt,st||1,Je,o,xt,y?o.paint.get("raster-elevation"):0,2,xe,oe,C.range,fe,Re,D),Mr=c.isTileAffectedByFog(te),xr=c.getOrCreateProgram("raster",{defines:C.defines,overrideFog:Mr});if(c.uploadCommonUniforms(T,xr,ae),I instanceof s.as){const Bt=I.elevatedGlobeVertexBuffer,Nt=I.elevatedGlobeIndexBuffer;if(O||!_)I.boundsBuffer&&I.boundsSegments&&xr.draw(c,E.TRIANGLES,ue,Dt.disabled,k,Mt.disabled,ii,o.id,I.boundsBuffer,c.quadTriangleIndexBuffer,I.boundsSegments);else if(Bt&&Nt){const Or=ht.zoom<=s.bJ?I.elevatedGlobeSegments:I.getSegmentsForLongitude(ht.center.lng);Or&&xr.draw(c,E.TRIANGLES,ue,Dt.disabled,k,$,ii,o.id,Bt,Nt,Or)}}else if(b){ue=new vt(E.LEQUAL,vt.ReadOnly,c.depthRangeFor3D);const Bt=c.globeSharedBuffers;if(Bt){const[Nt,Or,Ir]=Bt.getGridBuffers(hi,!1);xr.draw(c,E.TRIANGLES,ue,ie||ye,c.colorModeForRenderPass(),$,ii,o.id,Nt,Or,Ir)}}else{const{tileBoundsBuffer:Bt,tileBoundsIndexBuffer:Nt,tileBoundsSegments:Or}=c.getTileBoundsBuffers(ge);xr.draw(c,E.TRIANGLES,ue,ye,k,Mt.disabled,ii,o.id,Bt,Nt,Or)}}if(!(I instanceof s.as)&&b)for(const te of N){const ae=te.canonical.y===(1<<te.canonical.z)-1;te.canonical.y===0&&so(!0,te,c,i,o,D,C,$,ie||Dt.disabled),ae&&so(!1,te,c,i,o,D,C,$===Mt.frontCW?Mt.backCW:Mt.frontCW,ie||Dt.disabled)}};b?Y(Q,c.renderElevatedRasterBackface?Mt.backCW:Mt.frontCW,c.stencilModeFor3D()):Y(Q,Mt.disabled,void 0),c.resetStencilClippingMasks()},"raster-particle":function(c,i,o,u,d,p){c.renderPass==="offscreen"&&function(_,y,b,T){if(!T.length)return;const E=_.context,I=E.gl,C=y.getSource();if(!(C instanceof $e))return;const D=Math.ceil(Math.sqrt(b.paint.get("raster-particle-count")));let k=b.particleFramebuffer;k?k.width!==D&&(k.destroy(),k=b.particleFramebuffer=E.createFramebuffer(D,D,!0,null)):k=b.particleFramebuffer=E.createFramebuffer(D,D,!0,null);const O=[];for(const j of T){const Q=y.getTile(j);if(!(Q instanceof Bl))continue;const H=nf(Q,C,b);if(!H)continue;const Y=[Q.tileSize,Q.tileSize];let N=b.tileFramebuffer;N||(N=b.tileFramebuffer=E.createFramebuffer(Y[0],Y[1],!0,null));let $=Q.rasterParticleState;$||($=Q.rasterParticleState=new x1(E,j,Y,D));const ie=$.update(b.lastInvalidatedAt);$.particleTextureDimension!==D&&$.setParticleTextureDimension(j,D);const te=$.targetColorTexture;$.targetColorTexture=$.backgroundColorTexture,$.backgroundColorTexture=te;const ae=$.particleTexture0;$.particleTexture0=$.particleTexture1,$.particleTexture1=ae,O.push([j,H,$,ie])}if(O.length===0)return;const B=s.f.now(),F=b.previousDrawTimestamp?.001*(B-b.previousDrawTimestamp):.0167;if(b.previousDrawTimestamp=B,b.hasColorMap()){E.activeTexture.set(I.TEXTURE0+2);let j=b.colorRampTexture;j||(j=b.colorRampTexture=new s.T(E,b.colorRamp,I.RGBA)),j.bind(I.LINEAR,I.CLAMP_TO_EDGE)}E.bindFramebuffer.set(b.tileFramebuffer.framebuffer),function(j,Q,H){const Y=j.context,N=Y.gl,$=Q.tileFramebuffer;Y.activeTexture.set(N.TEXTURE0);const ie={u_texture:0,u_opacity:1.05*(ae=Q.paint.get("raster-particle-fade-opacity-factor"))/(ae+.05)},te=j.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var ae;for(const ge of H){const[,,se,me]=ge;$.colorAttachment.set(se.targetColorTexture.texture),Y.viewport.set([0,0,$.width,$.height]),Y.clear({color:s.aA.transparent}),me&&(se.backgroundColorTexture.bind(N.NEAREST,N.CLAMP_TO_EDGE),te.draw(j,N.TRIANGLES,vt.disabled,Dt.disabled,Gt.alphaBlended,Mt.disabled,ie,Q.id,j.viewportBuffer,j.quadTriangleIndexBuffer,j.viewportSegments))}}(_,b,O),function(j,Q,H,Y){const N=j.context,$=N.gl,ie=H.tileFramebuffer,te=j.transform.projection.name==="globe",ae=H.paint.get("raster-particle-max-speed");for(const ge of Y){const[se,me,xe]=ge;N.activeTexture.set($.TEXTURE0+0),me.texture.bind($.LINEAR,$.CLAMP_TO_EDGE),ie.colorAttachment.set(xe.targetColorTexture.texture);const oe=j.getOrCreateProgram("rasterParticleDraw",{defines:me.defines,overrideFog:!1});N.activeTexture.set($.TEXTURE0+1);const fe=me.scalarData?[]:[0,1,2,3].map(_e=>s.cN[_e](se));fe.push(se);const Re=se.canonical.x,ue=se.canonical.y;for(const _e of fe){const ye=Q.getTile(te?_e.wrapped():_e);if(!ye)continue;const X=ye.rasterParticleState;if(!X)continue;const Ee=_e.canonical.x+(1<<_e.canonical.z)*(_e.wrap-se.wrap),Je=_e.canonical.y;X.particleTexture0.bind($.NEAREST,$.CLAMP_TO_EDGE);const st=Wa(1,X.particleTexture0.size[0],[Ee-Re,Je-ue],0,me.texture.size,2,ae,me.textureOffset,me.scale,me.offset);oe.draw(j,$.POINTS,vt.disabled,Dt.disabled,Gt.alphaBlended,Mt.disabled,st,H.id,X.particleIndexBuffer,void 0,X.particleSegment)}}}(_,y,b,O),E.bindFramebuffer.set(b.particleFramebuffer.framebuffer),function(j,Q,H,Y){const N=j.context,$=N.gl,ie=Q.paint.get("raster-particle-max-speed"),te=Y*Q.paint.get("raster-particle-speed-factor")*.3,ae=function(se){return Math.pow(se,6)}(.01+1*Q.paint.get("raster-particle-reset-rate-factor")),ge=Q.particleFramebuffer;N.viewport.set([0,0,ge.width,ge.height]);for(const se of H){const[,me,xe]=se;N.activeTexture.set($.TEXTURE0+0),me.texture.bind($.LINEAR,$.CLAMP_TO_EDGE),N.activeTexture.set($.TEXTURE0+1);const oe=xe.particleTexture0;oe.bind($.NEAREST,$.CLAMP_TO_EDGE);const fe=ef(1,oe.size[0],0,me.texture.size,ie,te,ae,me.textureOffset,me.scale,me.offset);ge.colorAttachment.set(xe.particleTexture1.texture),N.clear({color:s.aA.transparent}),j.getOrCreateProgram("rasterParticleUpdate",{defines:me.defines}).draw(j,$.TRIANGLES,vt.disabled,Dt.disabled,Gt.unblended,Mt.disabled,fe,Q.id,j.viewportBuffer,j.quadTriangleIndexBuffer,j.viewportSegments)}}(_,b,O,F)}(c,i,o,u),c.renderPass==="translucent"&&(function(_,y,b,T,E){const I=_.context,C=I.gl,D=!_.options.moving,k=_.transform.projection.name==="globe";if(!T.length)return;const[O,B]=_.stencilConfigForOverlap(T),F=[];k&&F.push("PROJECTION_GLOBE_VIEW");const j=_.stencilModeFor3D();for(const Q of B){const H=Q.toUnwrapped(),Y=y.getTile(Q);if(!Y.rasterParticleState)continue;const N=Y.rasterParticleState,$=100;Y.registerFadeDuration($);const ie=y.findLoadedParent(Q,0),te=Jo(Y,ie,y,_.transform,$);let ae,ge;_.terrain&&_.terrain.prepareDrawTile(),I.activeTexture.set(C.TEXTURE0),N.targetColorTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),I.activeTexture.set(C.TEXTURE1),ie&&ie.rasterParticleState?(ie.rasterParticleState.targetColorTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),ae=Math.pow(2,ie.tileID.overscaledZ-Y.tileID.overscaledZ),ge=[Y.tileID.canonical.x*ae%1,Y.tileID.canonical.y*ae%1]):N.targetColorTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE);const se=k?Float32Array.from(_.transform.expandedFarZProjMatrix):_.transform.calculateProjMatrix(H,D),me=_.transform,xe=of(me),oe=s.ck(Q.canonical),fe=s.cl(oe.getCenter().lat);let Re,ue,_e,ye,X;k?(Re=Float32Array.from(s.aW(s.cn(Q.canonical))),ue=Float32Array.from(me.globeMatrix),_e=Float32Array.from(s.cj(me)),ye=[s.a8(me.center.lng),s.ah(me.center.lat)],X=Float32Array.from(s.cm(Q.canonical,oe,fe,me.worldSize/me._pixelsPerMercatorPixel))):(Re=new Float32Array(16),ue=new Float32Array(9),_e=new Float32Array(16),ye=[0,0],X=new Float32Array(9));const Ee=Za(se,Re,ue,_e,X,ge||[0,0],s.W(_.transform.zoom),ye,xe,ae||1,te,250),Je=_.isTileAffectedByFog(Q),st=_.getOrCreateProgram("rasterParticle",{defines:F,overrideFog:Je});if(_.uploadCommonUniforms(I,st,H),k){const _t=new vt(C.LEQUAL,vt.ReadWrite,_.depthRangeFor3D),ht=0,xt=_.globeSharedBuffers;if(xt){const[Qt,Ct,Jt]=xt.getGridBuffers(fe,ht!==0);st.draw(_,C.TRIANGLES,_t,j,Gt.alphaBlended,Mt.backCCW,Ee,b.id,Qt,Ct,Jt)}}else{const _t=_.depthModeForSublayer(0,vt.ReadOnly),ht=O[Q.overscaledZ],{tileBoundsBuffer:xt,tileBoundsIndexBuffer:Qt,tileBoundsSegments:Ct}=_.getTileBoundsBuffers(Y);st.draw(_,C.TRIANGLES,_t,ht,Gt.alphaBlended,Mt.disabled,Ee,b.id,xt,Qt,Ct)}}_.resetStencilClippingMasks()}(c,i,o,u),c.style.map.triggerRepaint())},background:function(c,i,o,u){const d=o.paint.get("background-color"),p=o.paint.get("background-opacity"),_=o.paint.get("background-emissive-strength");if(p===0)return;const y=c.context,b=y.gl,T=c.transform,E=T.tileSize,I=o.paint.get("background-pattern");if(c.isPatternMissing(I,o.scope))return;const C=!I&&d.a===1&&p===1&&c.opaquePassEnabledForLayer()?"opaque":"translucent";if(c.renderPass!==C)return;const D=Dt.disabled,k=c.depthModeForSublayer(0,C==="opaque"?vt.ReadWrite:vt.ReadOnly),O=c.colorModeForDrapableLayerRenderPass(_),B=I?"backgroundPattern":"background";let F,j=u;j||(F=c.getBackgroundTiles(),j=Object.values(F).map(Q=>Q.tileID)),I&&(y.activeTexture.set(b.TEXTURE0),c.imageManager.bind(c.context,o.scope));for(const Q of j){const H=c.isTileAffectedByFog(Q),Y=c.getOrCreateProgram(B,{overrideFog:H}),N=Q.toUnwrapped(),$=u?Q.projMatrix:c.transform.calculateProjMatrix(N);c.prepareDrawTile();const ie=i?i.getTile(Q):F?F[Q.key]:new Mn(Q,E,T.zoom,c),te=I?rf($,_,p,c,I,o.scope,{tileID:Q,tileSize:E}):tf($,_,p,d);c.uploadCommonUniforms(y,Y,N);const{tileBoundsBuffer:ae,tileBoundsIndexBuffer:ge,tileBoundsSegments:se}=c.getTileBoundsBuffers(ie);Y.draw(c,b.TRIANGLES,k,D,O,Mt.disabled,te,o.id,ae,ge,se)}},sky:function(c,i,o){const u=c._atmosphere?s.W(c.transform.zoom):1,d=o.paint.get("sky-opacity")*u;if(d===0)return;const p=c.context,_=o.paint.get("sky-type"),y=new vt(p.gl.LEQUAL,vt.ReadOnly,[0,1]),b=c.frameCounter/1e3%1;_==="atmosphere"?c.renderPass==="offscreen"?o.needsSkyboxCapture(c)&&(function(T,E,I,C){const D=T.context,k=D.gl;let O=E.skyboxFbo;if(!O){O=E.skyboxFbo=D.createFramebuffer(32,32,!0,null),E.skyboxGeometry=new $1(D),E.skyboxTexture=D.gl.createTexture(),k.bindTexture(k.TEXTURE_CUBE_MAP,E.skyboxTexture),k.texParameteri(k.TEXTURE_CUBE_MAP,k.TEXTURE_WRAP_S,k.CLAMP_TO_EDGE),k.texParameteri(k.TEXTURE_CUBE_MAP,k.TEXTURE_WRAP_T,k.CLAMP_TO_EDGE),k.texParameteri(k.TEXTURE_CUBE_MAP,k.TEXTURE_MIN_FILTER,k.LINEAR),k.texParameteri(k.TEXTURE_CUBE_MAP,k.TEXTURE_MAG_FILTER,k.LINEAR);for(let Q=0;Q<6;++Q)k.texImage2D(k.TEXTURE_CUBE_MAP_POSITIVE_X+Q,0,k.RGBA,32,32,0,k.RGBA,k.UNSIGNED_BYTE,null)}D.bindFramebuffer.set(O.framebuffer),D.viewport.set([0,0,32,32]);const B=E.getCenter(T,!0),F=T.getOrCreateProgram("skyboxCapture"),j=new Float64Array(16);s.a9.identity(j),s.a9.rotateY(j,j,.5*-Math.PI),rs(T,E,F,j,B,0),s.a9.identity(j),s.a9.rotateY(j,j,.5*Math.PI),rs(T,E,F,j,B,1),s.a9.identity(j),s.a9.rotateX(j,j,.5*-Math.PI),rs(T,E,F,j,B,2),s.a9.identity(j),s.a9.rotateX(j,j,.5*Math.PI),rs(T,E,F,j,B,3),s.a9.identity(j),rs(T,E,F,j,B,4),s.a9.identity(j),s.a9.rotateY(j,j,Math.PI),rs(T,E,F,j,B,5),D.viewport.set([0,0,T.width,T.height])}(c,o),o.markSkyboxValid(c)):c.renderPass==="sky"&&function(T,E,I,C,D){const k=T.context,O=k.gl,B=T.transform,F=T.getOrCreateProgram("skybox");k.activeTexture.set(O.TEXTURE0),O.bindTexture(O.TEXTURE_CUBE_MAP,E.skyboxTexture);const j=((Q,H,Y,N,$)=>({u_matrix:Q,u_sun_direction:H,u_cubemap:0,u_opacity:N,u_temporal_offset:$}))(B.skyboxMatrix,E.getCenter(T,!1),0,C,D);T.uploadCommonUniforms(k,F),F.draw(T,O.TRIANGLES,I,Dt.disabled,T.colorModeForRenderPass(),Mt.backCW,j,"skybox",E.skyboxGeometry.vertexBuffer,E.skyboxGeometry.indexBuffer,E.skyboxGeometry.segment)}(c,o,y,d,b):_==="gradient"&&c.renderPass==="sky"&&function(T,E,I,C,D){const k=T.context,O=k.gl,B=T.transform,F=T.getOrCreateProgram("skyboxGradient");E.skyboxGeometry||(E.skyboxGeometry=new $1(k)),k.activeTexture.set(O.TEXTURE0);let j=E.colorRampTexture;j||(j=E.colorRampTexture=new s.T(k,E.colorRamp,O.RGBA)),j.bind(O.LINEAR,O.CLAMP_TO_EDGE);const Q=((H,Y,N,$,ie)=>({u_matrix:H,u_color_ramp:0,u_center_direction:Y,u_radius:s.bm(N),u_opacity:$,u_temporal_offset:ie}))(B.skyboxMatrix,E.getCenter(T,!1),E.paint.get("sky-gradient-radius"),C,D);T.uploadCommonUniforms(k,F),F.draw(T,O.TRIANGLES,I,Dt.disabled,T.colorModeForRenderPass(),Mt.backCW,Q,"skyboxGradient",E.skyboxGeometry.vertexBuffer,E.skyboxGeometry.indexBuffer,E.skyboxGeometry.segment)}(c,o,y,d,b)},debug:function(c,i,o,u,d,p){for(let _=0;_<o.length;_++)if(d){const T=new s.aA(u.r*.8,u.g*.8,u.b*.8,1);Ns(c,i,o[_],u,-1,-1,p),Ns(c,i,o[_],u,-1,1,p),Ns(c,i,o[_],u,1,1,p),Ns(c,i,o[_],u,1,-1,p),Ns(c,i,o[_],T,0,0,p)}else Ns(c,i,o[_],u,0,0,p)},custom:function(c,i,o,u){const d=c.context,p=o.implementation;if(!c.transform.projection.unsupportedLayers||!c.transform.projection.unsupportedLayers.includes("custom")||c.terrain&&(c.terrain.renderingToTexture||c.renderPass==="offscreen")&&o.isDraped(i)){if(c.renderPass==="offscreen"){const _=p.prerender;if(_){if(c.setCustomLayerDefaults(),d.setColorMode(c.colorModeForRenderPass()),c.transform.projection.name==="globe"){const y=c.transform.pointMerc;_.call(p,d.gl,c.transform.customLayerMatrix(),c.transform.getProjection(),c.transform.globeToMercatorMatrix(),s.W(c.transform.zoom),[y.x,y.y],c.transform.pixelsPerMeterRatio)}else _.call(p,d.gl,c.transform.customLayerMatrix());d.setDirty(),c.setBaseState()}}else if(c.renderPass==="translucent"){if(c.terrain&&c.terrain.renderingToTexture){const y=p.renderToTile;if(y){const b=u[0].canonical,T=new s.O(b.x+u[0].wrap*(1<<b.z),b.y,b.z);d.setDepthMode(vt.disabled),d.setStencilMode(Dt.disabled),d.setColorMode(c.colorModeForRenderPass()),c.setCustomLayerDefaults(),y.call(p,d.gl,T),d.setDirty(),c.setBaseState()}return}c.setCustomLayerDefaults(),d.setColorMode(c.colorModeForRenderPass()),d.setStencilMode(Dt.disabled);const _=p.renderingMode==="3d"?new vt(c.context.gl.LEQUAL,vt.ReadWrite,c.depthRangeFor3D):c.depthModeForSublayer(0,vt.ReadOnly);if(d.setDepthMode(_),c.transform.projection.name==="globe"){const y=c.transform.pointMerc;p.render(d.gl,c.transform.customLayerMatrix(),c.transform.getProjection(),c.transform.globeToMercatorMatrix(),s.W(c.transform.zoom),[y.x,y.y],c.transform.pixelsPerMeterRatio)}else p.render(d.gl,c.transform.customLayerMatrix());d.setDirty(),c.setBaseState(),d.bindFramebuffer.set(null)}}else s.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(c,i,o,u){if(c.renderPass==="opaque")return;const d=o.paint.get("model-opacity");if(d===0)return;const p=o.paint.get("model-cast-shadows");if(c.renderPass==="shadow"&&(!p||c.terrain&&d<.65&&o._transitionablePaint._values["model-opacity"].value.expression instanceof s.Z))return;const _=c.shadowRenderer,y=o.paint.get("model-receive-shadows");_&&(_.useNormalOffset=!0,y||(_.enabled=!1));const b=()=>{_&&(_.useNormalOffset=!0,y||(_.enabled=!0))},T=i.getSource();if(c.renderPass==="light-beam"&&T.type!=="batched-model")return;if(T.type==="vector"||T.type==="geojson")return function(F,j,Q,H,Y){const N=F.transform;if(N.projection.name!=="mercator")return void s.w(`Drawing 3D models for ${N.projection.name} projection is not yet implemented`);const $=N.getFreeCameraOptions().position;if(!F.modelManager)return;const ie=F.modelManager;Q.modelManager=ie;const te=F.shadowRenderer;if(!Q._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const ae=Q._unevaluatedLayout._values["model-id"],ge={...Q.layout.get("model-id").parameters};for(const se of H){const me=j.getTile(se).getBucket(Q);if(!me||me.projection.name!==N.projection.name)continue;const xe=me.getModelUris();xe&&!me.modelsRequested&&(ie.addModelsFromBucket(xe,Y),me.modelsRequested=!0);const oe=gc(se,N);ge.zoom=oe;const fe=ae.possiblyEvaluate(ge);if(Ka(F,me,se),dn.shadowUniformsInitialized=!1,dn.useSingleShadowCascade=!!te&&te.getMaxCascadeForTile(se.toUnwrapped())===0,F.renderPass==="shadow"&&te){if(F.currentShadowCascade===1&&me.isInsideFirstShadowMapFrustum)continue;const _e=N.calculatePosMatrix(se.toUnwrapped(),N.worldSize);if(dn.tileMatrix.set(_e),dn.shadowTileMatrix=Float32Array.from(te.calculateShadowPassMatrixFromMatrix(_e)),dn.aabb.min.fill(0),dn.aabb.max[0]=dn.aabb.max[1]=s.Y,dn.aabb.max[2]=0,el(me,dn,F,Q.scope))continue}const Re=1<<se.canonical.z,ue=[(($.x-se.wrap)*Re-se.canonical.x)*s.Y,($.y*Re-se.canonical.y)*s.Y,$.z*Re*s.Y];for(let _e in me.instancesPerModel){const ye=me.instancesPerModel[_e];ye.features.length>0&&(_e=fe.evaluate(ye.features[0].feature,{}));const X=ie.getModel(_e,Y);if(X&&X.uploaded)for(const Ee of X.nodes)yc(F,Q,Ee,ye,ue,se,dn)}}}(c,i,o,u,T.type==="vector"?o.scope:""),void b();if(!T.loaded())return;if(T.type==="batched-model")return function(F,j,Q,H){Q.resetLayerRenderingStats(F);const Y=F.context,N=F.transform,$=F.style.fog,ie=F.shadowRenderer;if(N.projection.name!=="mercator")return void s.w(`Drawing 3D landmark models for ${N.projection.name} projection is not yet implemented`);const te=F.transform.getFreeCameraOptions().position,ae=s.Q.scale([],[te.x,te.y,te.z],F.transform.worldSize);s.Q.negate(ae,ae);const ge=s.a9.identity([]),se=s.cZ(N.center.lat,N.zoom),me=s.a9.fromScaling([],[1,1,1/se]);s.a9.translate(ge,ge,ae);const xe=Q.paint.get("model-opacity"),oe=new vt(Y.gl.LEQUAL,vt.ReadWrite,F.depthRangeFor3D),fe=new vt(Y.gl.LEQUAL,vt.ReadOnly,F.depthRangeFor3D),Re=new s.bV([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),ue=F.renderPass==="shadow",_e=ue&&ie?ie.getCurrentCascadeFrustum():N.getFrustum(N.scaleZoom(N.worldSize)),ye=Q.getLayerRenderingStats(),X=function(Ee,Je){for(const st of H){const _t=j.getTile(st).getBucket(Q);if(!_t||!_t.uploaded)continue;let ht=!1;ie&&(ht=ie.getMaxCascadeForTile(st.toUnwrapped())===0);const xt=N.calculatePosMatrix(st.toUnwrapped(),N.worldSize),Qt=_t.modelTraits;for(const Ct of _t.getNodesInfo()){if(Ct.hiddenByReplacement||!Ct.node.meshes)continue;const Jt=Ct.evaluatedScale,Xt=Ct.node;let Ur=0;if(F.terrain&&Xt.elevation&&(Ur=Xt.elevation*F.terrain.exaggeration()),Jt[0]<=1&&Jt[1]<=1&&Jt[2]<=1&&(()=>{const qt=Ct.getLocalBounds();return Re.min=[...qt.min],Re.max=[...qt.max],Re.min[2]+=Ur,Re.max[2]+=Ur,s.Q.transformMat4(Re.min,Re.min,xt),s.Q.transformMat4(Re.max,Re.max,xt),Re})().intersects(_e)===0)continue;const yr=[...xt];s.a9.translate(yr,yr,[(Xt.anchor?Xt.anchor[0]:0)*(Jt[0]-1),(Xt.anchor?Xt.anchor[1]:0)*(Jt[1]-1),Ur]),s.Q.exactEquals(Jt,s.c$)||s.a9.scale(yr,yr,Jt);const hi=s.a9.multiply([],yr,Xt.matrix);let ii=s.a9.multiply([],me,yr);s.a9.multiply(ii,ge,ii);const Mr=s.a9.invert([],ii);s.a9.transpose(Mr,Mr),s.a9.scale(Mr,Mr,xc),ii=s.a9.multiply(ii,ii,Xt.matrix);const xr=F.renderPass==="light-beam",Bt=s.a9.multiply([],N.expandedFarZProjMatrix,hi),Nt=s.a9.multiply([],N.expandedFarZProjMatrix,yr),Or=Qt&s.d1.HasMapboxMeshFeatures,Ir=Or?0:Ct.evaluatedRMEA[0][2];for(let qt=0;qt<Xt.meshes.length;++qt){const Rt=Xt.meshes[qt],Wi=qt===Xt.lightMeshIndex;let Ci=Bt;if(Wi){if(!xr&&!F.terrain&&F.shadowRenderer){F.currentLayer<F.firstLightBeamLayer&&(F.firstLightBeamLayer=F.currentLayer);continue}Ci=Nt}else if(xr)continue;const mi={defines:[]},Di=[];if(Co(mi.defines,Di,Rt,F),Or||mi.defines.push("DIFFUSE_SHADED"),ht&&mi.defines.push("SHADOWS_SINGLE_CASCADE"),ye&&(ue?ye.numRenderedVerticesInShadowPass+=Rt.vertexArray.length:ye.numRenderedVerticesInTransparentPass+=Rt.vertexArray.length),ue){Ja(Rt,hi,F,Q);continue}let Hi=null;if($){const On=eh(hi,F.transform);if(Hi=new Float32Array(On),N.projection.name!=="globe"){const Wn=Rt.aabb.min,Hn=Rt.aabb.max,[Lo,xn]=$.getOpacityForBounds(On,Wn[0],Wn[1],Hn[0],Hn[1]);mi.overrideFog=Lo>=pr||xn>=pr}}const Fi=Rt.material;let _i;Fi.occlusionTexture&&Fi.occlusionTexture.offsetScale&&(_i=Fi.occlusionTexture.offsetScale,mi.defines.push("OCCLUSION_TEXTURE_TRANSFORM")),!ue&&ie&&(ie.useNormalOffset=!!Rt.normalBuffer);const Ti=F.getOrCreateProgram("model",mi);!ue&&ie&&ie.setupShadowsFromMatrix(yr,Ti,ie.useNormalOffset),F.uploadCommonUniforms(Y,Ti,null,Hi);const Si=Fi.pbrMetallicRoughness;Si.metallicFactor=.9,Si.roughnessFactor=.5;const Zn=cc(new Float32Array(Ci),new Float32Array(ii),new Float32Array(Mr),new Float32Array(Xt.matrix),F,xe,Si.baseColorFactor,Fi.emissiveFactor,Si.metallicFactor,Si.roughnessFactor,Fi,Ir,Q,[0,0,0],_i);Ti.draw(F,Y.gl.TRIANGLES,Je&&!Wi?oe:fe,Dt.disabled,Ee?Wi||xe<1||Ct.hasTranslucentParts?Gt.alphaBlended:Gt.unblended:Gt.disabled,Mt.backCCW,Zn,Q.id,Rt.vertexBuffer,Rt.indexBuffer,Rt.segments,Q.paint,F.transform.zoom,void 0,Di)}}}};(function(Ee,Je,st,_t){const ht=Ee.terrain?Ee.terrain.exaggeration():0,xt=Ee.transform.zoom;for(const Qt of _t){const Ct=Je.getTile(Qt).getBucket(st);Ct&&(Ee.conflationActive&&Ct.updateReplacement(Qt,Ee.replacementSource),Ct.evaluateScale(Ee,st),Ee.terrain&&ht>0&&Ct.elevationUpdate(Ee.terrain,ht,Qt,st.source),Ct.needsReEvaluation(Ee,xt,st)&&Ct.evaluate(st))}})(F,j,Q,H),xe===1?X(!0,!0):(X(!1,!0),X(!0,!1))}(c,i,o,u),void b();const E=T.getModels(),I=[],C=c.transform.getFreeCameraOptions().position,D=s.Q.scale([],[C.x,C.y,C.z],c.transform.worldSize);s.Q.negate(D,D);const k=[],O=[];let B=0;for(const F of E){const j=o.paint.get("model-rotation").constantOr(null),Q=o.paint.get("model-scale").constantOr(null),H=o.paint.get("model-translation").constantOr(null);F.computeModelMatrix(c,j,Q,H,!0,!0,!1);const Y=s.a9.identity([]),N=s.cZ(F.position.lat,c.transform.zoom),$=s.a9.fromScaling([],[1,1,1/N]);s.a9.translate(Y,Y,D),I.push({zScaleMatrix:$,negCameraPosMatrix:Y});for(const ie of F.nodes)Ya(c.transform,ie,F.matrix,c.transform.expandedFarZProjMatrix,B,k,O);B++}if(k.sort((F,j)=>j.depth-F.depth),c.renderPass!=="shadow"){if(d===1)for(const F of O)Do(F,c,o,I[F.modelIndex],Dt.disabled,c.colorModeForRenderPass());else{for(const F of O)Do(F,c,o,I[F.modelIndex],Dt.disabled,Gt.disabled);for(const F of O)Do(F,c,o,I[F.modelIndex],c.stencilModeFor3D(),c.colorModeForRenderPass());c.resetStencilClippingMasks()}for(const F of k)Do(F,c,o,I[F.modelIndex],Dt.disabled,c.colorModeForRenderPass());b()}else{for(const F of O)Ja(F.mesh,F.nodeModelMatrix,c,o);for(const F of k)Ja(F.mesh,F.nodeModelMatrix,c,o);b()}}},ns={model:function(c,i,o){const u=i.getSource();if(!u.loaded())return;if(u.type==="vector"||u.type==="geojson")return void(o.modelManager&&o.modelManager.upload(o,u.type==="vector"?c.scope:""));if(u.type==="batched-model")return;const d=u.getModels();for(const p of d)p.upload(o.context)},raster:function(c,i,o){const u=i.getSource();if(!(u instanceof $e&&u.loaded()))return;const d=c.sourceLayer||u.rasterLayerIds&&u.rasterLayerIds[0];if(!d)return;const p=c.paint.get("raster-array-band")||u.getInitialBand(d);if(p==null)return;const _=i.getIds().map(y=>i.getTileByID(y));for(const y of _)y.updateNeeded(d,p)&&u.prepareTile(y,d,p)},"raster-particle":function(c,i,o){const u=i.getSource();if(!(u instanceof $e&&u.loaded()))return;const d=c.sourceLayer||u.rasterLayerIds&&u.rasterLayerIds[0];if(!d)return;const p=c.paint.get("raster-particle-array-band")||u.getInitialBand(d);if(p==null)return;const _=i.getIds().map(y=>i.getTileByID(y));for(const y of _)y.updateNeeded(d,p)&&u.prepareTile(y,d,p)}};class W1{constructor(i,o,u,d){this.context=new Un(i,o),this.transform=u,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=d,this._timeStamp=new Date().getTime(),this._averageFPS=0,this._fpsHistory=[],this._debugParams={showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const p=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(const _ of p)this._debugParams.enabledLayers[_]=!0;d.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),d.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),d.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),d.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),d.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const _ of p)d.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],_);this.setup(),this.numSublayers=In.maxUnderzooming+In.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new s.d3,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new D1(this),this._wireframeDebugCache=new Z1,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0}updateTerrain(i,o){const u=!!i&&!!i.terrain&&this.transform.projection.supportsTerrain;if(!(u||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new hn(this,i));const d=this._terrain;this.transform.elevation=u?d:null,d.update(i,this.transform,o),this.transform.elevation&&!d.enabled&&(this.transform.elevation=null)}_updateFog(i){const o=i.fog;if(!o||this.transform.projection.name==="globe"||o.getOpacity(this.transform.pitch)<1||o.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[u,d]=o.getFovAdjustedRange(this.transform._fov);if(u>d)return void(this.transform.fogCullDistSq=null);const p=u+.78*(d-u);this.transform.fogCullDistSq=p*p}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(i,o){if(this.width=i*s.f.devicePixelRatio,this.height=o*s.f.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const u of this.style.order)this.style._mergedLayers[u].resize()}setup(){const i=this.context,o=new s.aQ;o.emplaceBack(0,0),o.emplaceBack(s.Y,0),o.emplaceBack(0,s.Y),o.emplaceBack(s.Y,s.Y),this.tileExtentBuffer=i.createVertexBuffer(o,s.aS.members),this.tileExtentSegments=s.aE.simpleSegment(0,0,4,2);const u=new s.aQ;u.emplaceBack(0,0),u.emplaceBack(s.Y,0),u.emplaceBack(0,s.Y),u.emplaceBack(s.Y,s.Y),this.debugBuffer=i.createVertexBuffer(u,s.aS.members),this.debugSegments=s.aE.simpleSegment(0,0,4,5);const d=new s.aQ;d.emplaceBack(-1,-1),d.emplaceBack(1,-1),d.emplaceBack(-1,1),d.emplaceBack(1,1),this.viewportBuffer=i.createVertexBuffer(d,s.aS.members),this.viewportSegments=s.aE.simpleSegment(0,0,4,2);const p=new s.ay;p.emplaceBack(0,0,0,0),p.emplaceBack(s.Y,0,s.Y,0),p.emplaceBack(0,s.Y,0,s.Y),p.emplaceBack(s.Y,s.Y,s.Y,s.Y),this.mercatorBoundsBuffer=i.createVertexBuffer(p,s.aU.members),this.mercatorBoundsSegments=s.aE.simpleSegment(0,0,4,2);const _=new s.az;_.emplaceBack(0,1,2),_.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=i.createIndexBuffer(_);const y=new s.aR;for(const T of[0,1,3,2,0])y.emplaceBack(T);this.debugIndexBuffer=i.createIndexBuffer(y),this.emptyTexture=new s.T(i,new s.h({width:1,height:1},Uint8Array.of(0,0,0,0)),i.gl.RGBA),this.identityMat=s.a9.create();const b=this.context.gl;this.stencilClearMode=new Dt({func:b.ALWAYS,mask:0},0,255,b.ZERO,b.ZERO,b.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(i){return i._makeTileBoundsBuffers(this.context,this.transform.projection),i._tileBoundsBuffer?{tileBoundsBuffer:i._tileBoundsBuffer,tileBoundsIndexBuffer:i._tileBoundsIndexBuffer,tileBoundsSegments:i._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const i=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,i.TRIANGLES,vt.disabled,this.stencilClearMode,Gt.disabled,Mt.disabled,Ga(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(i,o,u){if(!o||this.currentStencilSource===o.id||!i.isTileClipped()||!u||u.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let y=!1;for(const b of u)if(this._tileClippingMaskIDs[b.key]===void 0){y=!0;break}if(!y)return}this.currentStencilSource=o.id;const d=this.context,p=d.gl;this.nextStencilID+u.length>256&&this.clearStencil(),d.setColorMode(Gt.disabled),d.setDepthMode(vt.disabled);const _=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const y of u){const b=o.getTile(y),T=this._tileClippingMaskIDs[y.key]=this.nextStencilID++,{tileBoundsBuffer:E,tileBoundsIndexBuffer:I,tileBoundsSegments:C}=this.getTileBoundsBuffers(b);_.draw(this,p.TRIANGLES,vt.disabled,new Dt({func:p.ALWAYS,mask:0},T,255,p.KEEP,p.KEEP,p.REPLACE),Gt.disabled,Mt.disabled,Ga(y.projMatrix),"$clipping",E,I,C)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const i=this.nextStencilID++,o=this.context.gl;return new Dt({func:o.NOTEQUAL,mask:255},i,255,o.KEEP,o.KEEP,o.REPLACE)}stencilModeForClipping(i){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(i);const o=this.context.gl;return new Dt({func:o.EQUAL,mask:255},this._tileClippingMaskIDs[i.key],0,o.KEEP,o.KEEP,o.REPLACE)}stencilConfigForOverlap(i){const o=this.context.gl,u=i.sort((_,y)=>y.overscaledZ-_.overscaledZ),d=u[u.length-1].overscaledZ,p=u[0].overscaledZ-d+1;if(p>1){this.currentStencilSource=void 0,this.nextStencilID+p>256&&this.clearStencil();const _={};for(let y=0;y<p;y++)_[y+d]=new Dt({func:o.GEQUAL,mask:255},y+this.nextStencilID,255,o.KEEP,o.KEEP,o.REPLACE);return this.nextStencilID+=p,[_,u]}return[{[d]:Dt.disabled},u]}colorModeForRenderPass(){const i=this.context.gl;return this._showOverdrawInspector?new Gt([i.CONSTANT_COLOR,i.ONE,i.CONSTANT_COLOR,i.ONE],new s.aA(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Gt.unblended:Gt.alphaBlended}colorModeForDrapableLayerRenderPass(i){const o=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new Gt([o.ONE,o.ONE_MINUS_SRC_ALPHA,o.CONSTANT_ALPHA,o.ONE_MINUS_SRC_ALPHA],new s.aA(0,0,0,i===void 0?0:i),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(i,o,u,d=!1){if(!this.opaquePassEnabledForLayer()&&!d)return vt.disabled;const p=1-((1+this.currentLayer)*this.numSublayers+i)*this.depthEpsilon;return new vt(u||this.context.gl.LEQUAL,o,[p,p])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}updateAverageFPS(){const i=new Date().getTime(),o=i-this._timeStamp;this._timeStamp=i,this._fpsHistory.push(o===0?0:1e3/o),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((u,d)=>u+d/this._fpsHistory.length,0))}render(i,o){this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=i.map.repaint,this.style=i,this.options=o;const u=this.style._mergedLayers,d=this.style.order.filter(N=>{const $=u[N];return!($.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[$.type]}),p=d.map(N=>u[N]),_=this.style._mergedSourceCaches;this.imageManager=i.imageManager,this.modelManager=i.modelManager,this.symbolFadeChange=i.placement.symbolFadeChange(s.f.now()),this.imageManager.beginFrame();let y=0,b=!1;for(const N in _){const $=_[N];$.used&&($.prepare(this.context),$.getSource().usedInConflation&&++y)}for(const N of p)N.isHidden(this.transform.zoom)||this.prepareLayer(N);const T={},E={},I={},C={},D={};for(const N in _){const $=_[N];T[N]=$.getVisibleCoordinates(),E[N]=T[N].slice().reverse(),I[N]=$.getVisibleCoordinates(!0).reverse(),C[N]=$.getShadowCasterCoordinates(),D[N]=$.sortCoordinatesByDistance(T[N])}const k=N=>{const $=this.style.getLayerSourceCache(N);return $&&$.used?$.getSource():null};if(y){const N=[];for(const $ of p)this.layerUsedInConflation($,k($))&&N.push($);if(N&&N.length>1){const $=[];for(const ie of N){const te=this.style.getLayerSourceCache(ie);te&&te.used&&te.getSource().usedInConflation&&$.push({layer:ie.fqid,cache:te})}this.replacementSource.setSources($),b=!0}}b||this.replacementSource.clear(),this.conflationActive=b,this.minCutoffZoom=0,this.longestCutoffRange=0;for(const N of p){const $=N.cutoffRange();if(this.longestCutoffRange=Math.max($,this.longestCutoffRange),$>0){const ie=k(N);ie&&(this.minCutoffZoom=Math.max(ie.minzoom,this.minCutoffZoom)),N.minzoom&&(this.minCutoffZoom=Math.max(N.minzoom,this.minCutoffZoom))}}this.opaquePassCutoff=1/0;for(let N=0;N<p.length;N++)if(p[N].is3D()){this.opaquePassCutoff=N;break}const O=this.style&&this.style.fog;O?(this._fogVisible=O.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=O.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(I),this.opaquePassCutoff=0);const B=this._shadowRenderer;if(B){B.updateShadowParameters(this.transform,this.style.directionalLight);for(const N in _)for(const $ of T[N]){let ie={min:0,max:0};this.terrain&&(ie=this.terrain.getMinMaxForTile($)||ie),B.addShadowReceiver($.toUnwrapped(),ie.min,ie.max)}}if(this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new s.d4(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Ku(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!s.d5(this.context.gl))return;this.renderPass="offscreen";for(const N of p){const $=i.getLayerSourceCache(N);if(!N.hasOffscreenPass()||N.isHidden(this.transform.zoom))continue;const ie=$?E[$.id]:void 0;(N.type==="custom"||N.type==="raster"||N.type==="raster-particle"||N.isSky()||ie&&ie.length)&&this.renderLayer(this,$,N,ie)}this.depthRangeFor3D=[0,1-(p.length+2)*this.numSublayers*this.depthEpsilon];const F=this.terrain;F&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&!this.transform.isOrthographic&&F.drawDepth(),this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,C)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const j=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),Q=(()=>{if(o.showOverdrawInspector)return s.aA.black;if(this.style.fog&&this.transform.projection.supportsFog&&!j){const N=this.style.fog.properties.get("color").toArray01();return new s.aA(...N)}if(this.style.fog&&this.transform.projection.supportsFog&&j){const N=this.style.fog.properties.get("space-color").toArray01();return new s.aA(...N)}return s.aA.transparent})();if(this.context.clear({color:Q,depth:1}),this.clearStencil(),this._showOverdrawInspector=o.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&j&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=d.length-1;this.currentLayer>=0;this.currentLayer--){const N=p[this.currentLayer],$=i.getLayerSourceCache(N);if(N.isSky())continue;const ie=$?(N.is3D()?D:E)[$.id]:void 0;this._renderTileClippingMasks(N,$,ie),this.renderLayer(this,$,N,ie)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&j&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||s.W(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<d.length;this.currentLayer++){const N=p[this.currentLayer],$=i.getLayerSourceCache(N);N.isSky()&&this.renderLayer(this,$,N,$?E[$.id]:void 0)}function H(N,$){let ie;return $&&(ie=(N.type==="symbol"?I:N.is3D()?D:E)[$.id]),ie}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<d.length;){const N=p[this.currentLayer];if(N.type==="raster"){const $=i.getLayerSourceCache(N);this.renderLayer(this,$,N,H(N,$))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let Y=0;for(B&&(Y=B.getShadowCastingLayerCount());this.currentLayer<d.length;){const N=p[this.currentLayer],$=i.getLayerSourceCache(N);if(N.isSky())++this.currentLayer;else if(F&&this.style.isLayerDraped(N)){if(N.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=F.renderBatch(this.currentLayer)}else{if(this._renderTileClippingMasks(N,$,$?T[$.id]:void 0),this.renderLayer(this,$,N,H(N,$)),!F&&B&&Y>0&&N.hasShadowPass()&&--Y==0&&(B.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const ie=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=ie;this.currentLayer++){const te=p[this.currentLayer];if(!te.hasLightBeamPass())continue;const ae=i.getLayerSourceCache(te);this.renderLayer(this,ae,te,ae?E[ae.id]:void 0)}this.currentLayer=ie,this.renderPass="translucent"}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let N=null;p.forEach($=>{const ie=i.getLayerSourceCache($);ie&&!$.isHidden(this.transform.zoom)&&ie.getVisibleCoordinates().length&&(!N||N.getSource().maxzoom<ie.getSource().maxzoom)&&(N=ie)}),N&&this.options.showTileBoundaries&&vc.debug(this,N,N.getVisibleCoordinates(),s.aA.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&vc.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new s.aA(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(N){const $=N.transform.padding;U1(N,N.transform.height-($.top||0),3,Qu),U1(N,$.bottom||0,3,sf),j1(N,$.left||0,3,N1),j1(N,N.transform.width-($.right||0),3,V1);const ie=N.transform.centerPoint;(function(te,ae,ge,se){mc(te,ae-1,ge-10,2,20,se),mc(te,ae-10,ge-1,20,2,se)})(N,ie.x,N.transform.height-ie.y,Xu)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),b||(this.conflationActive=!1)}prepareLayer(i){this.gpuTimingStart(i);const{unsupportedLayers:o}=this.transform.projection,u=!o||!o.includes(i.type);if(ns[i.type]&&(u||this.terrain&&i.type==="custom")){const d=this.style.getLayerSourceCache(i);ns[i.type](i,d,this)}this.gpuTimingEnd()}renderLayer(i,o,u,d){u.isHidden(this.transform.zoom)||(u.type==="background"||u.type==="sky"||u.type==="custom"||u.type==="model"||u.type==="raster"||u.type==="raster-particle"||d&&d.length)&&(this.id=u.id,this.gpuTimingStart(u),(!i.transform.projection.unsupportedLayers||!i.transform.projection.unsupportedLayers.includes(u.type)||i.terrain&&u.type==="custom")&&vc[u.type](i,o,u,d,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(i){if(!this.options.gpuTiming)return;const o=this.context.extTimerQuery,u=this.context.gl;let d=this.gpuTimers[i.id];d||(d=this.gpuTimers[i.id]={calls:0,cpuTime:0,query:u.createQuery()}),d.calls++,u.beginQuery(o.TIME_ELAPSED_EXT,d.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const i=this.context.extTimerQuery,o=this.context.gl,u=o.createQuery();this.deferredRenderGpuTimeQueries.push(u),o.beginQuery(i.TIME_ELAPSED_EXT,u)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const i=this.gpuTimers;return this.gpuTimers={},i}collectDeferredRenderGpuQueries(){const i=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],i}queryGpuTimers(i){const o={};for(const u in i){const d=i[u],p=this.context.extTimerQuery,_=p.getQueryParameter(d.query,this.context.gl.QUERY_RESULT)/1e6;p.deleteQueryEXT(d.query),o[u]=_}return o}queryGpuTimeDeferredRender(i){if(!this.options.gpuTimingDeferredRender)return 0;const o=this.context.extTimerQuery,u=this.context.gl;let d=0;for(const p of i)d+=o.getQueryParameter(p,u.QUERY_RESULT)/1e6,o.deleteQueryEXT(p);return d}translatePosMatrix(i,o,u,d,p){if(!u[0]&&!u[1])return i;const _=p?d==="map"?this.transform.angle:0:d==="viewport"?-this.transform.angle:0;if(_){const T=Math.sin(_),E=Math.cos(_);u=[u[0]*E-u[1]*T,u[0]*T+u[1]*E]}const y=[p?u[0]:s.a6(o,u[0],this.transform.zoom),p?u[1]:s.a6(o,u[1],this.transform.zoom),0],b=new Float32Array(16);return s.a9.translate(b,i,y),b}saveTileTexture(i){const o=i.size[0],u=this._tileTextures[o];u?u.push(i):this._tileTextures[o]=[i]}getTileTexture(i){const o=this._tileTextures[i];return o&&o.length>0?o.pop():null}isPatternMissing(i,o){return i===null||i!==void 0&&!this.imageManager.getPattern(i.toString(),o)}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(i,o,u){const d=u===void 0?this.terrain&&this.terrain.renderingToTexture:u,p=this.terrain&&this.terrain.exaggeration()===0,_=[];return this.style&&this.style.enable3dLights()&&(i==="globeRaster"||i==="terrainRaster"?(_.push("LIGHTING_3D_MODE"),_.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):d||_.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"?this._shadowMapDebug||_.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?_.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):_.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(_.push("TERRAIN"),this.linearFloatFilteringSupported()&&_.push("TERRAIN_DEM_FLOAT_FORMAT"),p&&_.push("ZERO_EXAGGERATION")),this.transform.projection.name==="globe"&&_.push("GLOBE"),!this._fogVisible||d||o!==void 0&&!o||_.push("FOG","FOG_DITHERING"),d&&_.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&_.push("OVERDRAW_INSPECTOR"),_}getOrCreateProgram(i,o){this.cache=this.cache||{};const u=o&&o.defines||[],d=o&&o.config,p=this.currentGlobalDefines(i,o&&o.overrideFog,o&&o.overrideRtt).concat(u),_=yn.cacheKey(zn[i],i,p,d);return this.cache[_]||(this.cache[_]=new yn(this.context,i,zn[i],d,$u[i],p)),this.cache[_]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const i=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(i.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(i,o){if(this.style.enable3dLights()){const u=this.style.directionalLight,d=this.style.ambientLight;if(u&&d){const p=((_,y)=>{const b=_.properties.get("direction"),T=_.properties.get("color").toArray01(),E=_.properties.get("intensity"),I=y.properties.get("color").toArray01(),C=y.properties.get("intensity"),D=[b.x,b.y,b.z],k=s.cs(I,C),O=s.cs(T,E);return{u_lighting_ambient_color:k,u_lighting_directional_dir:D,u_lighting_directional_color:O,u_ground_radiance:L1(D,O,k)}})(u,d);o.setLightsUniformValues(i,p)}}}uploadCommonUniforms(i,o,u,d,p){if(this.uploadCommonLightUniforms(i,o),this.terrain&&this.terrain.renderingToTexture)return;const _=this.style.fog;if(_){const y=_.getOpacity(this.transform.pitch),b=((T,E,I,C,D,k,O,B,F,j,Q,H)=>{const Y=T.transform,N=E.properties.get("color").toArray01();N[3]=C;const $=T.frameCounter/1e3%1,[ie,te]=E.properties.get("vertical-range");return{u_fog_matrix:I?Y.calculateFogTileMatrix(I):H||T.identityMat,u_fog_range:E.getFovAdjustedRange(Y._fov),u_fog_color:N,u_fog_horizon_blend:E.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(ie,te),te],u_fog_temporal_offset:$,u_frustum_tl:D,u_frustum_tr:k,u_frustum_br:O,u_frustum_bl:B,u_globe_pos:F,u_globe_radius:j,u_viewport:Q,u_globe_transition:s.W(Y.zoom),u_is_globe:+(Y.projection.name==="globe")}})(this,_,u,y,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*s.f.devicePixelRatio,this.transform.height*s.f.devicePixelRatio],d);o.setFogUniformValues(i,b)}p&&o.setCutoffUniformValues(i,p.uniformValues)}setTileLoadedFlag(i){this.tileLoaded=i}saveCanvasCopy(){const i=this.canvasCopy();i&&(this.frameCopies.push(i),this.tileLoaded=!1)}canvasCopy(){const i=this.context.gl,o=i.createTexture();return i.bindTexture(i.TEXTURE_2D,o),i.copyTexImage2D(i.TEXTURE_2D,0,i.RGBA,0,0,i.drawingBufferWidth,i.drawingBufferHeight,0),o}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const i=this.style&&this.style.fog;return!!i&&i.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const i=this._backgroundTiles,o=this._backgroundTiles={},u=this.transform.coveringTiles({tileSize:512});for(const d of u)o[d.key]=i[d.key]||new Mn(d,512,this.transform.tileZoom,this);return o}clearBackgroundTiles(){this._backgroundTiles={}}layerUsedInConflation(i,o){return!(!i.is3D()||i.minzoom&&i.minzoom>this.transform.zoom||i.sourceLayer!=="building"&&(!o||o.type!=="batched-model"))}isTileAffectedByFog(i){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let o=this._cachedTileFogOpacities[i.key];return o||(this._cachedTileFogOpacities[i.key]=o=this.style.fog.getOpacityForTile(i)),o[0]>=pr||o[1]>=pr}}function H1(c,i){let o=!1,u=null;const d=()=>{u=null,o&&(c(),u=setTimeout(d,i),o=!1)};return()=>(o=!0,u||d(),u)}class lf{constructor(i){this._hashName=i&&encodeURIComponent(i),s.a$(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=H1(this._updateHashUnthrottled.bind(this),300)}addTo(i){return this._map=i,window.addEventListener("hashchange",this._onHashChange,!1),i.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const i=this._map;if(!i)return"";const o=Q1(i);if(this._hashName){const u=this._hashName;let d=!1;const p=location.hash.slice(1).split("&").map(_=>{const y=_.split("=")[0];return y===u?(d=!0,`${y}=${o}`):_}).filter(_=>_);return d||p.push(`${u}=${o}`),`#${p.join("&")}`}return`#${o}`}_getCurrentHash(){const i=location.hash.replace("#","");if(this._hashName){let o;return i.split("&").map(u=>u.split("=")).forEach(u=>{u[0]===this._hashName&&(o=u)}),(o&&o[1]||"").split("/")}return i.split("/")}_onHashChange(){const i=this._map;if(!i)return!1;const o=this._getCurrentHash();if(o.length>=3&&!o.some(u=>isNaN(u))){const u=i.dragRotate.isEnabled()&&i.touchZoomRotate.isEnabled()?+(o[3]||0):i.getBearing();return i.jumpTo({center:[+o[2],+o[1]],zoom:+o[0],bearing:u,pitch:+(o[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Q1(c,i){const o=c.getCenter(),u=Math.round(100*c.getZoom())/100,d=Math.ceil((u*Math.LN2+Math.log(512/360/.5))/Math.LN10),p=Math.pow(10,d),_=Math.round(o.lng*p)/p,y=Math.round(o.lat*p)/p,b=c.getBearing(),T=c.getPitch();let E=i?`/${_}/${y}/${u}`:`${u}/${y}/${_}`;return(b||T)&&(E+="/"+Math.round(10*b)/10),T&&(E+=`/${Math.round(T)}`),E}const Vs={linearity:.3,easing:s.d6(0,0,.3,1)},th=s.e({deceleration:2500,maxSpeed:1400},Vs),rh=s.e({deceleration:20,maxSpeed:1400},Vs),ih=s.e({deceleration:1e3,maxSpeed:360},Vs),X1=s.e({deceleration:1e3,maxSpeed:90},Vs);class Y1{constructor(i){this._map=i,this.clear()}clear(){this._inertiaBuffer=[]}record(i){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.f.now(),settings:i})}_drainInertiaBuffer(){const i=this._inertiaBuffer,o=s.f.now();for(;i.length>0&&o-i[0].time>160;)i.shift()}_onMoveEnd(i){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const o={zoom:0,bearing:0,pitch:0,pan:new s.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:p}of this._inertiaBuffer)o.zoom+=p.zoomDelta||0,o.bearing+=p.bearingDelta||0,o.pitch+=p.pitchDelta||0,p.panDelta&&o.pan._add(p.panDelta),p.around&&(o.around=p.around),p.pinchAround&&(o.pinchAround=p.pinchAround);const u=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,d={};if(o.pan.mag()){const p=zo(o.pan.mag(),u,s.e({},th,i||{}));d.offset=o.pan.mult(p.amount/o.pan.mag()),d.center=this._map.transform.center,bc(d,p)}if(o.zoom){const p=zo(o.zoom,u,rh);d.zoom=this._map.transform.zoom+p.amount,bc(d,p)}if(o.bearing){const p=zo(o.bearing,u,ih);d.bearing=this._map.transform.bearing+s.ad(p.amount,-179,179),bc(d,p)}if(o.pitch){const p=zo(o.pitch,u,X1);d.pitch=this._map.transform.pitch+p.amount,bc(d,p)}if(d.zoom||d.bearing){const p=o.pinchAround===void 0?o.around:o.pinchAround;d.around=p?this._map.unproject(p):this._map.getCenter()}return this.clear(),d.noMoveStart=!0,d}}function bc(c,i){(!c.duration||c.duration<i.duration)&&(c.duration=i.duration,c.easing=i.easing)}function zo(c,i,o){const{maxSpeed:u,linearity:d,deceleration:p}=o,_=s.ad(c*d/(i/1e3),-u,u),y=Math.abs(_)/(p*d);return{easing:o.easing,duration:1e3*y,amount:_*(y/2)}}class Pi extends s.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,o,u,d={}){const p=Fr(o.getCanvasContainer(),u),_=o.unproject(p);super(i,s.e({point:p,lngLat:_,originalEvent:u},d)),this._defaultPrevented=!1,this.target=o}}class tl extends s.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,o,u){const d=i==="touchend"?u.changedTouches:u.touches,p=ti(o.getCanvasContainer(),d),_=p.map(b=>o.unproject(b)),y=p.reduce((b,T,E,I)=>b.add(T.div(I.length)),new s.P(0,0));super(i,{points:p,point:y,lngLats:_,lngLat:o.unproject(y),originalEvent:u}),this._defaultPrevented=!1}}class fn extends s.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,o,u){super(i,{originalEvent:u}),this._defaultPrevented=!1}}class nh{constructor(i,o){this._map=i,this._clickTolerance=o.clickTolerance}reset(){this._mousedownPos=void 0}wheel(i){return this._firePreventable(new fn(i.type,this._map,i))}mousedown(i,o){return this._mousedownPos=o,this._firePreventable(new Pi(i.type,this._map,i))}mouseup(i){this._map.fire(new Pi(i.type,this._map,i))}preclick(i){const o=s.e({},i);o.type="preclick",this._map.fire(new Pi(o.type,this._map,o))}click(i,o){this._mousedownPos&&this._mousedownPos.dist(o)>=this._clickTolerance||(this.preclick(i),this._map.fire(new Pi(i.type,this._map,i)))}dblclick(i){return this._firePreventable(new Pi(i.type,this._map,i))}mouseover(i){this._map.fire(new Pi(i.type,this._map,i))}mouseout(i){this._map.fire(new Pi(i.type,this._map,i))}touchstart(i){return this._firePreventable(new tl(i.type,this._map,i))}touchmove(i){this._map.fire(new tl(i.type,this._map,i))}touchend(i){this._map.fire(new tl(i.type,this._map,i))}touchcancel(i){this._map.fire(new tl(i.type,this._map,i))}_firePreventable(i){if(this._map.fire(i),i.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class wc{constructor(i){this._map=i}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(i){this._map.fire(new Pi(i.type,this._map,i))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Pi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(i){this._delayContextMenu?this._contextMenuEvent=i:this._map.fire(new Pi(i.type,this._map,i)),this._map.listens("contextmenu")&&i.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Tc{constructor(i,o){this._map=i,this._el=i.getCanvasContainer(),this._container=i.getContainer(),this._clickTolerance=o.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(i,o){this.isEnabled()&&i.shiftKey&&i.button===0&&(Dr(),this._startPos=this._lastPos=o,this._active=!0)}mousemoveWindow(i,o){if(!this._active)return;const u=o,d=this._startPos,p=this._lastPos;if(!d||!p||p.equals(u)||!this._box&&u.dist(d)<this._clickTolerance)return;this._lastPos=u,this._box||(this._box=ct("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",i));const _=Math.min(d.x,u.x),y=Math.max(d.x,u.x),b=Math.min(d.y,u.y),T=Math.max(d.y,u.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${_}px,${b}px)`,this._box.style.width=y-_+"px",this._box.style.height=T-b+"px")})}mouseupWindow(i,o){if(!this._active)return;const u=this._startPos,d=o;if(u&&i.button===0){if(this.reset(),Ut(),u.x!==d.x||u.y!==d.y)return this._map.fire(new s.b("boxzoomend",{originalEvent:i})),{cameraAnimation:p=>p.fitScreenCoordinates(u,d,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",i)}}keydown(i){this._active&&i.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",i))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Br(),delete this._startPos,delete this._lastPos}_fireEvent(i,o){return this._map.fire(new s.b(i,{originalEvent:o}))}}function rl(c,i){const o={};for(let u=0;u<c.length;u++)o[c[u].identifier]=i[u];return o}class oh{constructor(i){this.reset(),this.numTouches=i.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(i,o,u){(this.centroid||u.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=i.timeStamp),u.length===this.numTouches&&(this.centroid=function(d){const p=new s.P(0,0);for(const _ of d)p._add(_);return p.div(d.length)}(o),this.touches=rl(u,o)))}touchmove(i,o,u){if(this.aborted||!this.centroid)return;const d=rl(u,o);for(const p in this.touches){const _=d[p];(!_||_.dist(this.touches[p])>30)&&(this.aborted=!0)}}touchend(i,o,u){if((!this.centroid||i.timeStamp-this.startTime>500)&&(this.aborted=!0),u.length===0){const d=!this.aborted&&this.centroid;if(this.reset(),d)return d}}}class Us{constructor(i){this.singleTap=new oh(i),this.numTaps=i.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(i,o,u){this.singleTap.touchstart(i,o,u)}touchmove(i,o,u){this.singleTap.touchmove(i,o,u)}touchend(i,o,u){const d=this.singleTap.touchend(i,o,u);if(d){const p=i.timeStamp-this.lastTime<500,_=!this.lastTap||this.lastTap.dist(d)<30;if(p&&_||this.reset(),this.count++,this.lastTime=i.timeStamp,this.lastTap=d,this.count===this.numTaps)return this.reset(),d}}}class sh{constructor(){this._zoomIn=new Us({numTouches:1,numTaps:2}),this._zoomOut=new Us({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(i,o,u){this._zoomIn.touchstart(i,o,u),this._zoomOut.touchstart(i,o,u)}touchmove(i,o,u){this._zoomIn.touchmove(i,o,u),this._zoomOut.touchmove(i,o,u)}touchend(i,o,u){const d=this._zoomIn.touchend(i,o,u),p=this._zoomOut.touchend(i,o,u);return d?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:_=>_.easeTo({duration:300,zoom:_.getZoom()+1,around:_.unproject(d)},{originalEvent:i})}):p?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:_=>_.easeTo({duration:300,zoom:_.getZoom()-1,around:_.unproject(p)},{originalEvent:i})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const ah={0:1,2:2};class js{constructor(i){this.reset(),this._clickTolerance=i.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(i,o){return!1}_move(i,o){return{}}mousedown(i,o){if(this._lastPoint)return;const u=ai(i);this._correctButton(i,u)&&(this._lastPoint=o,this._eventButton=u)}mousemoveWindow(i,o){const u=this._lastPoint;if(u){if(i.preventDefault(),this._eventButton!=null&&function(d,p){const _=ah[p];return d.buttons===void 0||(d.buttons&_)!==_}(i,this._eventButton))this.reset();else if(this._moved||!(o.dist(u)<this._clickTolerance))return this._moved=!0,this._lastPoint=o,this._move(u,o)}}mouseupWindow(i){this._lastPoint&&ai(i)===this._eventButton&&(this._moved&&Ut(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class J1 extends js{mousedown(i,o){super.mousedown(i,o),this._lastPoint&&(this._active=!0)}_correctButton(i,o){return o===0&&!i.ctrlKey}_move(i,o){return{around:o,panDelta:o.sub(i)}}}class lh extends js{_correctButton(i,o){return o===0&&i.ctrlKey||o===2}_move(i,o){const u=.8*(o.x-i.x);if(u)return this._active=!0,{bearingDelta:u}}contextmenu(i){i.preventDefault()}}class os extends js{_correctButton(i,o){return o===0&&i.ctrlKey||o===2}_move(i,o){const u=-.5*(o.y-i.y);if(u)return this._active=!0,{pitchDelta:u}}contextmenu(i){i.preventDefault()}}class cf{constructor(i,o){this._map=i,this._el=i.getCanvasContainer(),this._minTouches=1,this._clickTolerance=o.clickTolerance||1,this.reset(),s.a$(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new s.P(0,0)}touchstart(i,o,u){return this._calculateTransform(i,o,u)}touchmove(i,o,u){if(this._active&&!(u.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(u.length===1&&!s.d7())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return i.cancelable&&i.preventDefault(),this._calculateTransform(i,o,u)}}touchend(i,o,u){this._calculateTransform(i,o,u),this._active&&u.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(i,o,u){u.length>0&&(this._active=!0);const d=rl(u,o),p=new s.P(0,0),_=new s.P(0,0);let y=0;for(const T in d){const E=d[T],I=this._touches[T];I&&(p._add(E),_._add(E.sub(I)),y++,d[T]=E)}if(this._touches=d,y<this._minTouches||!_.mag())return;const b=_.div(y);return this._sum._add(b),this._sum.mag()<this._clickTolerance?void 0:{around:p.div(y),panDelta:b}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ct("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class ch{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(i){}_move(i,o,u){return{}}touchstart(i,o,u){this._firstTwoTouches||u.length<2||(this._firstTwoTouches=[u[0].identifier,u[1].identifier],this._start([o[0],o[1]]))}touchmove(i,o,u){const d=this._firstTwoTouches;if(!d)return;i.preventDefault();const[p,_]=d,y=Sc(u,o,p),b=Sc(u,o,_);if(!y||!b)return;const T=this._aroundCenter?null:y.add(b).div(2);return this._move([y,b],T,i)}touchend(i,o,u){if(!this._firstTwoTouches)return;const[d,p]=this._firstTwoTouches,_=Sc(u,o,d),y=Sc(u,o,p);_&&y||(this._active&&Ut(),this.reset())}touchcancel(){this.reset()}enable(i){this._enabled=!0,this._aroundCenter=!!i&&i.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Sc(c,i,o){for(let u=0;u<c.length;u++)if(c[u].identifier===o)return i[u]}function K1(c,i){return Math.log(c/i)/Math.LN2}class uf extends ch{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(i){this._startDistance=this._distance=i[0].dist(i[1])}_move(i,o){const u=this._distance;if(this._distance=i[0].dist(i[1]),this._active||!(Math.abs(K1(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:K1(this._distance,u),pinchAround:o}}}function e0(c,i){return 180*c.angleWith(i)/Math.PI}class uh extends ch{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(i){this._startVector=this._vector=i[0].sub(i[1]),this._minDiameter=i[0].dist(i[1])}_move(i,o){const u=this._vector;if(this._vector=i[0].sub(i[1]),u&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:e0(this._vector,u),pinchAround:o}}_isBelowThreshold(i){this._minDiameter=Math.min(this._minDiameter,i.mag());const o=25/(Math.PI*this._minDiameter)*360,u=this._startVector;if(!u)return!1;const d=e0(i,u);return Math.abs(d)<o}}function il(c){return Math.abs(c.y)>Math.abs(c.x)}class t0 extends ch{constructor(i){super(),this._map=i}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(i){this._lastPoints=i,il(i[0].sub(i[1]))&&(this._valid=!1)}_move(i,o,u){const d=this._lastPoints;if(!d)return;const p=i[0].sub(d[0]),_=i[1].sub(d[1]);return this._map._cooperativeGestures&&!s.d7()&&u.touches.length<3||(this._valid=this.gestureBeginsVertically(p,_,u.timeStamp),!this._valid)?void 0:(this._lastPoints=i,this._active=!0,{pitchDelta:(p.y+_.y)/2*-.5})}gestureBeginsVertically(i,o,u){if(this._valid!==void 0)return this._valid;const d=i.mag()>=2,p=o.mag()>=2;if(!d&&!p)return;if(!d||!p)return this._firstMove==null&&(this._firstMove=u),u-this._firstMove<100&&void 0;const _=i.y>0==o.y>0;return il(i)&&il(o)&&_}}const Gs={panStep:100,bearingStep:15,pitchStep:10};class r0{constructor(){const i=Gs;this._panStep=i.panStep,this._bearingStep=i.bearingStep,this._pitchStep=i.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(i){if(i.altKey||i.ctrlKey||i.metaKey)return;let o=0,u=0,d=0,p=0,_=0;switch(i.keyCode){case 61:case 107:case 171:case 187:o=1;break;case 189:case 109:case 173:o=-1;break;case 37:i.shiftKey?u=-1:(i.preventDefault(),p=-1);break;case 39:i.shiftKey?u=1:(i.preventDefault(),p=1);break;case 38:i.shiftKey?d=1:(i.preventDefault(),_=-1);break;case 40:i.shiftKey?d=-1:(i.preventDefault(),_=1);break;default:return}return this._rotationDisabled&&(u=0,d=0),{cameraAnimation:y=>{const b=y.getZoom();y.easeTo({duration:300,easeId:"keyboardHandler",easing:i0,zoom:o?Math.round(b)+o*(i.shiftKey?2:1):b,bearing:y.getBearing()+u*this._bearingStep,pitch:y.getPitch()+d*this._pitchStep,offset:[-p*this._panStep,-_*this._panStep],center:y.getCenter()},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function i0(c){return c*(2-c)}const hh=4.000244140625,dh=1/450;class ss{constructor(i,o){this._map=i,this._el=i.getCanvasContainer(),this._handler=o,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=dh,s.a$(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(i){this._defaultZoomRate=i}setWheelZoomRate(i){this._wheelZoomRate=i}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(i){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!i&&i.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(i){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(i.ctrlKey||i.metaKey||this.isZooming()||s.d7()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let o=i.deltaMode===WheelEvent.DOM_DELTA_LINE?40*i.deltaY:i.deltaY;const u=s.f.now(),d=u-(this._lastWheelEventTime||0);this._lastWheelEventTime=u,o!==0&&o%hh==0?this._type="wheel":o!==0&&Math.abs(o)<4?this._type="trackpad":d>400?(this._type=null,this._lastValue=o,this._timeout=setTimeout(this._onTimeout,40,i)):this._type||(this._type=Math.abs(d*o)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,o+=this._lastValue)),i.shiftKey&&o&&(o/=4),this._type&&(this._lastWheelEvent=i,this._delta-=o,this._active||this._start(i)),i.preventDefault()}_onTimeout(i){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(i)}_start(i){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const o=Fr(this._el,i);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:o,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const i=this._map.transform;this._type==="wheel"&&i.projection.wrap&&(i._center.lng>=180||i._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const o=()=>i._terrainEnabled()&&this._aroundCoord?i.computeZoomRelativeTo(this._aroundCoord):i.zoom;if(this._delta!==0){const T=this._type==="wheel"&&Math.abs(this._delta)>hh?this._wheelZoomRate:this._defaultZoomRate;let E=2/(1+Math.exp(-Math.abs(this._delta*T)));this._delta<0&&E!==0&&(E=1/E);const I=o(),C=Math.pow(2,I),D=typeof this._targetZoom=="number"?i.zoomScale(this._targetZoom):C;this._targetZoom=Math.min(i.maxZoom,Math.max(i.minZoom,i.scaleZoom(D*E))),this._type==="wheel"&&(this._startZoom=I,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const u=typeof this._targetZoom=="number"?this._targetZoom:o(),d=this._startZoom,p=this._easing;let _,y=!1;if(this._type==="wheel"&&d&&p){const T=Math.min((s.f.now()-this._lastWheelEventTime)/200,1),E=p(T);_=s.X(d,u,E),T<1?this._frameId||(this._frameId=!0):y=!0}else _=u,y=!0;this._active=!0,y&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let b=_-o();return b*this._lastDelta<0&&(b=0),{noInertia:!0,needsRenderFrame:!y,zoomDelta:b,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(i){let o=s.d8;if(this._prevEase){const u=this._prevEase,d=(s.f.now()-u.start)/u.duration,p=u.easing(d+.01)-u.easing(d),_=.27/Math.sqrt(p*p+1e-4)*.01,y=Math.sqrt(.0729-_*_);o=s.d6(_,y,.25,1)}return this._prevEase={start:s.f.now(),duration:i,easing:o},o}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ct("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class n0{constructor(i,o){this._clickZoom=i,this._tapZoom=o}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class as{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(i,o){return i.preventDefault(),{cameraAnimation:u=>{u.easeTo({duration:300,zoom:u.getZoom()+(i.shiftKey?-1:1),around:u.unproject(o)},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class o0{constructor(){this._tap=new Us({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(i,o,u){this._swipePoint||(this._tapTime&&i.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?u.length>0&&(this._swipePoint=o[0],this._swipeTouch=u[0].identifier):this._tap.touchstart(i,o,u))}touchmove(i,o,u){if(this._tapTime){if(this._swipePoint){if(u[0].identifier!==this._swipeTouch)return;const d=o[0],p=d.y-this._swipePoint.y;return this._swipePoint=d,i.preventDefault(),this._active=!0,{zoomDelta:p/128}}}else this._tap.touchmove(i,o,u)}touchend(i,o,u){this._tapTime?this._swipePoint&&u.length===0&&this.reset():this._tap.touchend(i,o,u)&&(this._tapTime=i.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ec{constructor(i,o,u){this._el=i,this._mousePan=o,this._touchPan=u}enable(i){this._inertiaOptions=i||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class s0{constructor(i,o,u){this._pitchWithRotate=i.pitchWithRotate,this._mouseRotate=o,this._mousePitch=u}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class a0{constructor(i,o,u,d){this._el=i,this._touchZoom=o,this._touchRotate=u,this._tapDragZoom=d,this._rotationDisabled=!1,this._enabled=!0}enable(i){this._touchZoom.enable(i),this._rotationDisabled||this._touchRotate.enable(i),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const $s=c=>c.zoom||c.drag||c.pitch||c.rotate;class fh extends s.b{}class hf{constructor(){this.constants=[1,1,.01],this.radius=0}setup(i,o){const u=s.Q.sub([],o,i);this.radius=s.Q.length(u[2]<0?s.Q.div([],u,this.constants):[u[0],u[1],0])}projectRay(i){s.Q.div(i,i,this.constants),s.Q.normalize(i,i),s.Q.mul(i,i,this.constants);const o=s.Q.scale([],i,this.radius);if(o[2]>0){const u=s.Q.scale([],[0,0,1],s.Q.dot(o,[0,0,1])),d=s.Q.scale([],s.Q.normalize([],[o[0],o[1],0]),this.radius),p=s.Q.add([],o,s.Q.scale([],s.Q.sub([],s.Q.add([],d,u),o),2));o[0]=p[0],o[1]=p[1]}return o}}function nl(c){return c.panDelta&&c.panDelta.mag()||c.zoomDelta||c.bearingDelta||c.pitchDelta}class ol{constructor(i,o){this._map=i,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Y1(i),this._bearingSnap=o.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new hf,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(o),s.a$(["handleEvent","handleWindowEvent"],this);const u=this._el;this._listeners=[[u,"touchstart",{passive:!0}],[u,"touchmove",{passive:!1}],[u,"touchend",void 0],[u,"touchcancel",void 0],[u,"mousedown",void 0],[u,"mousemove",void 0],[u,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[u,"mouseover",void 0],[u,"mouseout",void 0],[u,"dblclick",void 0],[u,"click",void 0],[u,"keydown",{capture:!1}],[u,"keyup",void 0],[u,"wheel",{passive:!1}],[u,"contextmenu",void 0],[window,"blur",void 0]];for(const[d,p,_]of this._listeners){const y=d===document?this.handleWindowEvent:this.handleEvent;d.addEventListener(p,y,_)}}destroy(){for(const[i,o,u]of this._listeners){const d=i===document?this.handleWindowEvent:this.handleEvent;i.removeEventListener(o,d,u)}}_addDefaultHandlers(i){const o=this._map,u=o.getCanvasContainer();this._add("mapEvent",new nh(o,i));const d=o.boxZoom=new Tc(o,i);this._add("boxZoom",d);const p=new sh,_=new as;o.doubleClickZoom=new n0(_,p),this._add("tapZoom",p),this._add("clickZoom",_);const y=new o0;this._add("tapDragZoom",y);const b=o.touchPitch=new t0(o);this._add("touchPitch",b);const T=new lh(i),E=new os(i);o.dragRotate=new s0(i,T,E),this._add("mouseRotate",T,["mousePitch"]),this._add("mousePitch",E,["mouseRotate"]);const I=new J1(i),C=new cf(o,i);o.dragPan=new Ec(u,I,C),this._add("mousePan",I),this._add("touchPan",C,["touchZoom","touchRotate"]);const D=new uh,k=new uf;o.touchZoomRotate=new a0(u,k,D,y),this._add("touchRotate",D,["touchPan","touchZoom"]),this._add("touchZoom",k,["touchPan","touchRotate"]),this._add("blockableMapEvent",new wc(o));const O=o.scrollZoom=new ss(o,this);this._add("scrollZoom",O,["mousePan"]);const B=o.keyboard=new r0;this._add("keyboard",B);for(const F of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])i.interactive&&i[F]&&o[F].enable(i[F])}_add(i,o,u){this._handlers.push({handlerName:i,handler:o,allowed:u}),this._handlersById[i]=o}stop(i){if(!this._updatingCamera){for(const{handler:o}of this._handlers)o.reset();this._inertia.clear(),this._fireEvents({},{},i),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:i}of this._handlers)if(i.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!$s(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(i,o,u){for(const d in i)if(d!==u&&(!o||o.indexOf(d)<0))return!0;return!1}handleWindowEvent(i){this.handleEvent(i,`${i.type}Window`)}_getMapTouches(i){const o=[];for(const u of i)this._el.contains(u.target)&&o.push(u);return o}handleEvent(i,o){this._updatingCamera=!0;const u=i.type==="renderFrame",d=u?void 0:i,p={needsRenderFrame:!1},_={},y={},b=i.touches?this._getMapTouches(i.touches):void 0,T=b?ti(this._el,b):u?void 0:Fr(this._el,i);for(const{handlerName:C,handler:D,allowed:k}of this._handlers){if(!D.isEnabled())continue;let O;this._blockedByActive(y,k,C)?D.reset():D[o||i.type]&&(O=D[o||i.type](i,T,b),this.mergeHandlerResult(p,_,O,C,d),O&&O.needsRenderFrame&&this._triggerRenderFrame()),(O||D.isActive())&&(y[C]=D)}const E={};for(const C in this._previousActiveHandlers)y[C]||(E[C]=d);this._previousActiveHandlers=y,(Object.keys(E).length||nl(p))&&(this._changes.push([p,_,E]),this._triggerRenderFrame()),(Object.keys(y).length||nl(p))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:I}=p;I&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],I(this._map))}mergeHandlerResult(i,o,u,d,p){if(!u)return;s.e(i,u);const _={handlerName:d,originalEvent:u.originalEvent||p};u.zoomDelta!==void 0&&(o.zoom=_),u.panDelta!==void 0&&(o.drag=_),u.pitchDelta!==void 0&&(o.pitch=_),u.bearingDelta!==void 0&&(o.rotate=_)}_applyChanges(){const i={},o={},u={};for(const[d,p,_]of this._changes)d.panDelta&&(i.panDelta=(i.panDelta||new s.P(0,0))._add(d.panDelta)),d.zoomDelta&&(i.zoomDelta=(i.zoomDelta||0)+d.zoomDelta),d.bearingDelta&&(i.bearingDelta=(i.bearingDelta||0)+d.bearingDelta),d.pitchDelta&&(i.pitchDelta=(i.pitchDelta||0)+d.pitchDelta),d.around!==void 0&&(i.around=d.around),d.aroundCoord!==void 0&&(i.aroundCoord=d.aroundCoord),d.pinchAround!==void 0&&(i.pinchAround=d.pinchAround),d.noInertia&&(i.noInertia=d.noInertia),s.e(o,p),s.e(u,_);this._updateMapTransform(i,o,u),this._changes=[]}_updateMapTransform(i,o,u){const d=this._map,p=d.transform,_=j=>[j.x,j.y,j.z];if((j=>{const Q=this._eventsInProgress.drag;return Q&&!this._handlersById[Q.handlerName].isActive()})()&&!nl(i)){const j=p.zoom;p.cameraElevationReference="sea",this._originalZoom!=null&&p._orthographicProjectionAtLowPitch&&p.projection.name!=="globe"&&p.pitch===0?(p.cameraElevationReference="ground",p.zoom=this._originalZoom):(p.recenterOnTerrain(),p.cameraElevationReference="ground"),j!==p.zoom&&this._map._update(!0)}if(p._isCameraConstrained&&d._stop(!0),!nl(i))return void this._fireEvents(o,u,!0);let{panDelta:y,zoomDelta:b,bearingDelta:T,pitchDelta:E,around:I,aroundCoord:C,pinchAround:D}=i;p._isCameraConstrained&&(b>0&&(b=0),p._isCameraConstrained=!1),D!==void 0&&(I=D),(b||(j=>o[j]&&!this._eventsInProgress[j])("drag"))&&I&&(this._dragOrigin=_(p.pointCoordinate3D(I)),this._originalZoom=p.zoom,this._trackingEllipsoid.setup(p._camera.position,this._dragOrigin)),p.cameraElevationReference="sea",d._stop(!0),I=I||d.transform.centerPoint,T&&(p.bearing+=T),E&&(p.pitch+=E),p._updateCameraState();const k=[0,0,0];if(y)if(p.projection.name==="mercator"){const j=this._trackingEllipsoid.projectRay(p.screenPointToMercatorRay(I).dir),Q=this._trackingEllipsoid.projectRay(p.screenPointToMercatorRay(I.sub(y)).dir);k[0]=Q[0]-j[0],k[1]=Q[1]-j[1]}else{const j=p.pointCoordinate(I);if(p.projection.name==="globe"){y=y.rotate(-p.angle);const Q=p._pixelsPerMercatorPixel/p.worldSize;k[0]=-y.x*s.d9(s.ax(j.y))*Q,k[1]=-y.y*s.d9(p.center.lat)*Q}else{const Q=p.pointCoordinate(I.sub(y));j&&Q&&(k[0]=Q.x-j.x,k[1]=Q.y-j.y)}}const O=p.zoom,B=[0,0,0];if(b){const j=_(C||p.pointCoordinate3D(I)),Q={dir:s.Q.normalize([],s.Q.sub([],j,p._camera.position))};if(Q.dir[2]<0){const H=p.zoomDeltaToMovement(j,b);s.Q.scale(B,Q.dir,H)}}const F=s.Q.add(k,k,B);p._translateCameraConstrained(F),b&&Math.abs(p.zoom-O)>1e-4&&p.recenterOnTerrain(),p.cameraElevationReference="ground",this._map._update(),i.noInertia||this._inertia.record(i),this._fireEvents(o,u,!0)}_fireEvents(i,o,u){const d=$s(this._eventsInProgress),p=$s(i),_={};for(const E in i){const{originalEvent:I}=i[E];this._eventsInProgress[E]||(_[`${E}start`]=I),this._eventsInProgress[E]=i[E]}!d&&p&&this._fireEvent("movestart",p.originalEvent);for(const E in _)this._fireEvent(E,_[E]);p&&this._fireEvent("move",p.originalEvent);for(const E in i){const{originalEvent:I}=i[E];this._fireEvent(E,I)}const y={};let b;for(const E in this._eventsInProgress){const{handlerName:I,originalEvent:C}=this._eventsInProgress[E];this._handlersById[I].isActive()||(delete this._eventsInProgress[E],b=o[I]||C,y[`${E}end`]=b)}for(const E in y)this._fireEvent(E,y[E]);const T=$s(this._eventsInProgress);if(u&&(d||p)&&!T){this._updatingCamera=!0;const E=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),I=C=>C!==0&&-this._bearingSnap<C&&C<this._bearingSnap;E?(I(E.bearing||this._map.getBearing())&&(E.bearing=0),this._map.easeTo(E,{originalEvent:b})):(this._map.fire(new s.b("moveend",{originalEvent:b})),I(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(i,o){this._map.fire(new s.b(i,o?{originalEvent:o}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(i=>{this._frameId=void 0,this.handleEvent(new fh("renderFrame",{timeStamp:i})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const l0="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class df extends s.E{constructor(i,o){super(),this._moving=!1,this._zooming=!1,this.transform=i,this._bearingSnap=o.bearingSnap,this._respectPrefersReducedMotion=o.respectPrefersReducedMotion!==!1,s.a$(["_renderFrameCallback"],this)}getCenter(){return new s.bq(this.transform.center.lng,this.transform.center.lat)}setCenter(i,o){return this.jumpTo({center:i},o)}panBy(i,o,u){return i=s.P.convert(i).mult(-1),this.panTo(this.transform.center,s.e({offset:i},o),u)}panTo(i,o,u){return this.easeTo(s.e({center:i},o),u)}getZoom(){return this.transform.zoom}setZoom(i,o){return this.jumpTo({zoom:i},o),this}zoomTo(i,o,u){return this.easeTo(s.e({zoom:i},o),u)}zoomIn(i,o){return this.zoomTo(this.getZoom()+1,i,o),this}zoomOut(i,o){return this.zoomTo(this.getZoom()-1,i,o),this}getBearing(){return this.transform.bearing}setBearing(i,o){return this.jumpTo({bearing:i},o),this}getPadding(){return this.transform.padding}setPadding(i,o){return this.jumpTo({padding:i},o),this}rotateTo(i,o,u){return this.easeTo(s.e({bearing:i},o),u)}resetNorth(i,o){return this.rotateTo(0,s.e({duration:1e3},i),o),this}resetNorthPitch(i,o){return this.easeTo(s.e({bearing:0,pitch:0,duration:1e3},i),o),this}snapToNorth(i,o){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(i,o):this}getPitch(){return this.transform.pitch}setPitch(i,o){return this.jumpTo({pitch:i},o),this}cameraForBounds(i,o){i=s.ag.convert(i);const u=o&&o.bearing||0,d=o&&o.pitch||0,p=i.getNorthWest(),_=i.getSouthEast();return this._cameraForBounds(this.transform,p,_,u,d,o)}_extendPadding(i){const o={top:0,right:0,bottom:0,left:0};return i==null?s.e({},o,this.transform.padding):typeof i=="number"?{top:i,bottom:i,right:i,left:i}:s.e({},o,i)}_extendCameraOptions(i){return(i=s.e({offset:[0,0],maxZoom:this.transform.maxZoom},i)).padding=this._extendPadding(i.padding),i}_minimumAABBFrustumDistance(i,o){const u=o.max[0]-o.min[0],d=o.max[1]-o.min[1];return u/d>i.aspect?u/(2*Math.tan(.5*i.fovX)*i.aspect):d/(2*Math.tan(.5*i.fovY)*i.aspect)}_cameraForBoundsOnGlobe(i,o,u,d,p,_){const y=i.clone(),b=this._extendCameraOptions(_);y.bearing=d,y.pitch=p;const T=s.bq.convert(o),E=s.bq.convert(u),I=.5*(T.lat+E.lat),C=.5*(T.lng+E.lng),D=s.da(I,C),k=s.Q.normalize([],D),O=s.Q.normalize([],s.Q.cross([],k,[0,1,0])),B=s.Q.cross([],O,k),F=[O[0],O[1],O[2],0,B[0],B[1],B[2],0,k[0],k[1],k[2],0,0,0,0,1],j=[D,s.da(T.lat,T.lng),s.da(E.lat,T.lng),s.da(E.lat,E.lng),s.da(T.lat,E.lng),s.da(I,T.lng),s.da(I,E.lng),s.da(T.lat,C),s.da(E.lat,C)];let Q=s.bV.fromPoints(j.map(ye=>[s.Q.dot(O,ye),s.Q.dot(B,ye),s.Q.dot(k,ye)]));const H=s.Q.transformMat4([],Q.center,F);s.Q.squaredLength(H)===0&&s.Q.set(H,0,0,1),s.Q.normalize(H,H),s.Q.scale(H,H,s.ae),y.center=s.db(H);const Y=y.getWorldToCameraMatrix(),N=s.a9.invert(new Float64Array(16),Y);Q=s.bV.applyTransform(Q,s.a9.multiply([],Y,F));const $=this._extendAABB(Q,y,b,d);if(!$)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");Q=$,s.Q.transformMat4(H,H,Y);const ie=.5*(Q.max[2]-Q.min[2]),te=this._minimumAABBFrustumDistance(y,Q),ae=s.Q.scale([],[0,0,1],ie),ge=s.Q.add(ae,H,ae),se=te+(y.pitch===0?0:s.Q.distance(H,ge)),me=y.globeCenterInViewSpace,xe=s.Q.sub([],H,[me[0],me[1],me[2]]);s.Q.normalize(xe,xe),s.Q.scale(xe,xe,se);const oe=s.Q.add([],H,xe);s.Q.transformMat4(oe,oe,N);const fe=s.dc/s.ae,Re=s.Q.length(oe),ue=s.bo(Math.max(Re*fe-s.dc,Number.EPSILON),0),_e=Math.min(y.zoomFromMercatorZAdjusted(ue),b.maxZoom);return _e>.5*(s.bJ+s.bA)?(y.setProjection({name:"mercator"}),y.zoom=_e,this._cameraForBounds(y,o,u,d,p,_)):{center:y.center,zoom:_e,bearing:d,pitch:p}}_extendAABB(i,o,u,d){const p=.5*((u.padding.left||0)+(u.padding.right||0)),_=.5*((u.padding.top||0)+(u.padding.bottom||0)),y=_,b=p,T=p,E=_,I=o.width-(b+T),C=o.height-(y+E),D=s.Q.sub([],i.max,i.min),k=Math.min(I/D[0],C/D[1]),O=Math.min(o.scaleZoom(o.scale*k),u.maxZoom);if(isNaN(O))return null;const B=o.scale/o.zoomScale(O),F=new s.bV([i.min[0]-b*B,i.min[1]-E*B,i.min[2]],[i.max[0]+T*B,i.max[1]+y*B,i.max[2]]),j=(typeof u.offset.x=="number"&&typeof u.offset.y=="number"?new s.P(u.offset.x,u.offset.y):s.P.convert(u.offset)).rotate(-s.bm(d));return F.center[0]-=j.x*B,F.center[1]+=j.y*B,F}queryTerrainElevation(i,o){const u=this.transform.elevation;return u?(o=s.e({},{exaggerated:!0},o),u.getAtPoint(s.O.fromLngLat(i),null,o.exaggerated)):null}_cameraForBounds(i,o,u,d,p,_){if(i.projection.name==="globe")return this._cameraForBoundsOnGlobe(i,o,u,d,p,_);const y=i.clone(),b=this._extendCameraOptions(_);y.bearing=d,y.pitch=p;const T=s.bq.convert(o),E=s.bq.convert(u),I=new s.bq(T.lng,E.lat),C=new s.bq(E.lng,T.lat),D=y.project(T),k=y.project(E),O=this.queryTerrainElevation(T),B=this.queryTerrainElevation(E),F=this.queryTerrainElevation(I),j=this.queryTerrainElevation(C),Q=[[D.x,D.y,Math.min(O||0,B||0,F||0,j||0)],[k.x,k.y,Math.max(O||0,B||0,F||0,j||0)]];let H=s.bV.fromPoints(Q);const Y=y.getWorldToCameraMatrix(),N=s.a9.invert(new Float64Array(16),Y);H=s.bV.applyTransform(H,Y);const $=this._extendAABB(H,y,b,d);if(!$)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");H=$;const ie=.5*s.Q.sub([],H.max,H.min)[2],te=this._minimumAABBFrustumDistance(y,H),ae=[0,0,1,0];s.aa.transformMat4(ae,ae,Y),s.aa.normalize(ae,ae);const ge=s.Q.scale([],ae,te+ie),se=s.Q.add([],H.center,ge);s.Q.transformMat4(H.center,H.center,N),s.Q.transformMat4(se,se,N);const me=[H.center[0],H.center[1],se[2]*y.pixelsPerMeter];s.Q.scale(me,me,1/y.worldSize);const xe=s.aw(me[0]),oe=s.ax(me[1]),fe=Math.min(y._zoomFromMercatorZ(me[2]),b.maxZoom),Re=new s.bq(xe,oe);return y.mercatorFromTransition&&fe<.5*(s.bJ+s.bA)?(y.setProjection({name:"globe"}),y.zoom=fe,this._cameraForBounds(y,o,u,d,p,_)):{center:Re,zoom:fe,bearing:d,pitch:p}}fitBounds(i,o,u){const d=this.cameraForBounds(i,o);return this._fitInternal(d,o,u)}fitScreenCoordinates(i,o,u,d,p){const _=s.P.convert(i),y=s.P.convert(o),b=new s.P(Math.min(_.x,y.x),Math.min(_.y,y.y)),T=new s.P(Math.max(_.x,y.x),Math.max(_.y,y.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(_,y))return this;const E=this.transform.pointLocation3D(b),I=this.transform.pointLocation3D(T),C=this.transform.pointLocation3D(new s.P(b.x,T.y)),D=this.transform.pointLocation3D(new s.P(T.x,b.y)),k=[Math.min(E.lng,I.lng,C.lng,D.lng),Math.min(E.lat,I.lat,C.lat,D.lat)],O=[Math.max(E.lng,I.lng,C.lng,D.lng),Math.max(E.lat,I.lat,C.lat,D.lat)],B=d&&d.pitch?d.pitch:this.getPitch(),F=this._cameraForBounds(this.transform,k,O,u,B,d);return this._fitInternal(F,d,p)}_fitInternal(i,o,u){return i?(o=s.e(i,o)).linear?this.easeTo(o,u):this.flyTo(o,u):this}jumpTo(i,o){this.stop();const u=i.preloadOnly?this.transform.clone():this.transform;let d=!1,p=!1,_=!1;return"zoom"in i&&u.zoom!==+i.zoom&&(d=!0,u.zoom=+i.zoom),i.center!==void 0&&(u.center=s.bq.convert(i.center)),"bearing"in i&&u.bearing!==+i.bearing&&(p=!0,u.bearing=+i.bearing),"pitch"in i&&u.pitch!==+i.pitch&&(_=!0,u.pitch=+i.pitch),i.padding==null||u.isPaddingEqual(i.padding)||(u.padding=i.padding),i.preloadOnly?(this._preloadTiles(u),this):(this.fire(new s.b("movestart",o)).fire(new s.b("move",o)),d&&this.fire(new s.b("zoomstart",o)).fire(new s.b("zoom",o)).fire(new s.b("zoomend",o)),p&&this.fire(new s.b("rotatestart",o)).fire(new s.b("rotate",o)).fire(new s.b("rotateend",o)),_&&this.fire(new s.b("pitchstart",o)).fire(new s.b("pitch",o)).fire(new s.b("pitchend",o)),this.fire(new s.b("moveend",o)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||s.w(l0),this.transform.getFreeCameraOptions()}setFreeCameraOptions(i,o){const u=this.transform;if(!u.projection.supportsFreeCamera)return s.w(l0),this;this.stop();const d=u.zoom,p=u.pitch,_=u.bearing;u.setFreeCameraOptions(i);const y=d!==u.zoom,b=p!==u.pitch,T=_!==u.bearing;return this.fire(new s.b("movestart",o)).fire(new s.b("move",o)),y&&this.fire(new s.b("zoomstart",o)).fire(new s.b("zoom",o)).fire(new s.b("zoomend",o)),T&&this.fire(new s.b("rotatestart",o)).fire(new s.b("rotate",o)).fire(new s.b("rotateend",o)),b&&this.fire(new s.b("pitchstart",o)).fire(new s.b("pitch",o)).fire(new s.b("pitchend",o)),this.fire(new s.b("moveend",o)),this}easeTo(i,o){this._stop(!1,i.easeId),((i=s.e({offset:[0,0],duration:500,easing:s.d8},i)).animate===!1||this._prefersReducedMotion(i))&&(i.duration=0);const u=this.transform,d=this.getZoom(),p=this.getBearing(),_=this.getPitch(),y=this.getPadding(),b="zoom"in i?+i.zoom:d,T="bearing"in i?this._normalizeBearing(i.bearing,p):p,E="pitch"in i?+i.pitch:_,I=this._extendPadding(i.padding),C=s.P.convert(i.offset);let D,k,O;if(u.projection.name==="globe"){const te=s.O.fromLngLat(u.center),ae=C.rotate(-u.angle);te.x+=ae.x/u.worldSize,te.y+=ae.y/u.worldSize;const ge=te.toLngLat(),se=s.bq.convert(i.center||ge);this._normalizeCenter(se),D=u.centerPoint.add(ae),k=new s.P(te.x,te.y).mult(u.worldSize),O=new s.P(s.a8(se.lng),s.ah(se.lat)).mult(u.worldSize).sub(k)}else{D=u.centerPoint.add(C);const te=u.pointLocation(D),ae=s.bq.convert(i.center||te);this._normalizeCenter(ae),k=u.project(te),O=u.project(ae).sub(k)}const B=u.zoomScale(b-d);let F,j;i.around&&(F=s.bq.convert(i.around),j=u.locationPoint(F));const Q=this._zooming||b!==d,H=this._rotating||p!==T,Y=this._pitching||E!==_,N=!u.isPaddingEqual(I),$=te=>ae=>{if(Q&&(te.zoom=s.X(d,b,ae)),H&&(te.bearing=s.X(p,T,ae)),Y&&(te.pitch=s.X(_,E,ae)),N&&(te.interpolatePadding(y,I,ae),D=te.centerPoint.add(C)),F)te.setLocationAtPoint(F,j);else{const ge=te.zoomScale(te.zoom-d),se=b>d?Math.min(2,B):Math.max(.5,B),me=Math.pow(se,1-ae),xe=te.unproject(k.add(O.mult(ae*me)).mult(ge));te.setLocationAtPoint(te.renderWorldCopies?xe.wrap():xe,D)}return i.preloadOnly||this._fireMoveEvents(o),te};if(i.preloadOnly){const te=this._emulate($,i.duration,u);return this._preloadTiles(te),this}const ie={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=Q,this._rotating=H,this._pitching=Y,this._padding=N,this._easeId=i.easeId,this._prepareEase(o,i.noMoveStart,ie),this._ease($(u),te=>{u.cameraElevationReference==="sea"&&u.recenterOnTerrain(),this._afterEase(o,te)},i),this}_prepareEase(i,o,u={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),o||u.moving||this.fire(new s.b("movestart",i)),this._zooming&&!u.zooming&&this.fire(new s.b("zoomstart",i)),this._rotating&&!u.rotating&&this.fire(new s.b("rotatestart",i)),this._pitching&&!u.pitching&&this.fire(new s.b("pitchstart",i))}_fireMoveEvents(i){this.fire(new s.b("move",i)),this._zooming&&this.fire(new s.b("zoom",i)),this._rotating&&this.fire(new s.b("rotate",i)),this._pitching&&this.fire(new s.b("pitch",i))}_afterEase(i,o){if(this._easeId&&o&&this._easeId===o)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const u=this._zooming,d=this._rotating,p=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,u&&this.fire(new s.b("zoomend",i)),d&&this.fire(new s.b("rotateend",i)),p&&this.fire(new s.b("pitchend",i)),this.fire(new s.b("moveend",i))}flyTo(i,o){if(this._prefersReducedMotion(i)){const _e=s.af(i,["center","zoom","bearing","pitch","around"]);return this.jumpTo(_e,o)}this.stop(),i=s.e({offset:[0,0],speed:1.2,curve:1.42,easing:s.d8},i);const u=this.transform,d=this.getZoom(),p=this.getBearing(),_=this.getPitch(),y=this.getPadding(),b="zoom"in i?s.ad(+i.zoom,u.minZoom,u.maxZoom):d,T="bearing"in i?this._normalizeBearing(i.bearing,p):p,E="pitch"in i?+i.pitch:_,I=this._extendPadding(i.padding),C=u.zoomScale(b-d),D=s.P.convert(i.offset);let k=u.centerPoint.add(D);const O=u.pointLocation(k),B=s.bq.convert(i.center||O);this._normalizeCenter(B);const F=u.project(O),j=u.project(B).sub(F);let Q=i.curve;const H=Math.max(u.width,u.height),Y=H/C,N=j.mag();if("minZoom"in i){const _e=s.ad(Math.min(i.minZoom,d,b),u.minZoom,u.maxZoom),ye=H/u.zoomScale(_e-d);Q=Math.sqrt(ye/N*2)}const $=Q*Q;function ie(_e){const ye=(Y*Y-H*H+(_e?-1:1)*$*$*N*N)/(2*(_e?Y:H)*$*N);return Math.log(Math.sqrt(ye*ye+1)-ye)}function te(_e){return(Math.exp(_e)-Math.exp(-_e))/2}function ae(_e){return(Math.exp(_e)+Math.exp(-_e))/2}const ge=ie(0);let se=function(_e){return ae(ge)/ae(ge+Q*_e)},me=function(_e){return H*((ae(ge)*(te(ye=ge+Q*_e)/ae(ye))-te(ge))/$)/N;var ye},xe=(ie(1)-ge)/Q;if(Math.abs(N)<1e-6||!isFinite(xe)){if(Math.abs(H-Y)<1e-6)return this.easeTo(i,o);const _e=Y<H?-1:1;xe=Math.abs(Math.log(Y/H))/Q,me=function(){return 0},se=function(ye){return Math.exp(_e*Q*ye)}}i.duration="duration"in i?+i.duration:1e3*xe/("screenSpeed"in i?+i.screenSpeed/Q:+i.speed),i.maxDuration&&i.duration>i.maxDuration&&(i.duration=0);const oe=p!==T,fe=E!==_,Re=!u.isPaddingEqual(I),ue=_e=>ye=>{const X=ye*xe,Ee=1/se(X);_e.zoom=ye===1?b:d+_e.scaleZoom(Ee),oe&&(_e.bearing=s.X(p,T,ye)),fe&&(_e.pitch=s.X(_,E,ye)),Re&&(_e.interpolatePadding(y,I,ye),k=_e.centerPoint.add(D));const Je=ye===1?B:_e.unproject(F.add(j.mult(me(X))).mult(Ee));return _e.setLocationAtPoint(_e.renderWorldCopies?Je.wrap():Je,k),_e._updateCameraOnTerrain(),i.preloadOnly||this._fireMoveEvents(o),_e};if(i.preloadOnly){const _e=this._emulate(ue,i.duration,u);return this._preloadTiles(_e),this}return this._zooming=!0,this._rotating=oe,this._pitching=fe,this._padding=Re,this._prepareEase(o,!1),this._ease(ue(u),()=>this._afterEase(o),i),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(i){}_cancelRenderFrame(i){}_stop(i,o){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const u=this._onEaseEnd;this._onEaseEnd=void 0,u.call(this,o)}if(!i){const u=this.handlers;u&&u.stop(!1)}return this}_ease(i,o,u){u.animate===!1||u.duration===0?(i(1),o()):(this._easeStart=s.f.now(),this._easeOptions=u,this._onEaseFrame=i,this._onEaseEnd=o,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const i=Math.min((s.f.now()-this._easeStart)/this._easeOptions.duration,1),o=this._onEaseFrame;o&&o(this._easeOptions.easing(i)),i<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(i,o){i=s.bk(i,-180,180);const u=Math.abs(i-o);return Math.abs(i-360-o)<u&&(i-=360),Math.abs(i+360-o)<u&&(i+=360),i}_normalizeCenter(i){const o=this.transform;if(o.maxBounds||o.projection.name!=="globe"&&!o.renderWorldCopies)return;const u=i.lng-o.center.lng;i.lng+=u>180?-360:u<-180?360:0}_prefersReducedMotion(i){return this._respectPrefersReducedMotion&&s.f.prefersReducedMotion&&!(i&&i.essential)}_emulate(i,o,u){const d=Math.ceil(15*o/1e3),p=[],_=i(u.clone());for(let y=0;y<=d;y++){const b=_(y/d);p.push(b.clone())}return p}_preloadTiles(i,o){}}class ph{constructor(i={}){this.options=i,s.a$(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(i){const o=this.options&&this.options.compact;return this._map=i,this._container=ct("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=ct("button","mapboxgl-ctrl-attrib-button",this._container),ct("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=ct("div","mapboxgl-ctrl-attrib-inner",this._container),o&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),o===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(i,o){const u=this._map._getUIString(`AttributionControl.${o}`);i.removeAttribute("title"),i.firstElementChild&&i.firstElementChild.setAttribute("title",u)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let i=this._editLink;i||(i=this._editLink=this._container.querySelector(".mapbox-improve-map"));const o=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||s.dd.ACCESS_TOKEN}];if(i){const u=o.reduce((d,p,_)=>(p.value&&(d+=`${p.key}=${p.value}${_<o.length-1?"&":""}`),d),"?");i.href=`${s.dd.FEEDBACK_URL}/${u}#${Q1(this._map,!0)}`,i.rel="noopener nofollow",this._setElementTitle(i,"MapFeedback")}}_updateData(i){!i||i.sourceDataType!=="metadata"&&i.sourceDataType!=="visibility"&&i.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let i=[];if(this._map.style.stylesheet){const d=this._map.style.stylesheet;this.styleOwner=d.owner,this.styleId=d.id}const o=this._map.style._mergedSourceCaches;for(const d in o){const p=o[d];if(p.used){const _=p.getSource();_.attribution&&i.indexOf(_.attribution)<0&&i.push(_.attribution)}}i.sort((d,p)=>d.length-p.length),i=i.filter((d,p)=>{for(let _=p+1;_<i.length;_++)if(i[_].indexOf(d)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?i=[...this.options.customAttribution,...i]:i.unshift(this.options.customAttribution));const u=i.join(" | ");u!==this._attribHTML&&(this._attribHTML=u,i.length?(this._innerContainer.innerHTML=u,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class c0{constructor(){s.a$(["_updateLogo","_updateCompact"],this)}onAdd(i){this._map=i,this._container=ct("div","mapboxgl-ctrl");const o=ct("a","mapboxgl-ctrl-logo");return o.target="_blank",o.rel="noopener nofollow",o.href="https://www.mapbox.com/",o.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),o.setAttribute("rel","noopener nofollow"),this._container.appendChild(o),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(i){i&&i.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const i=this._map.style._sourceCaches;if(Object.entries(i).length===0)return!0;for(const o in i){const u=i[o].getSource();if(u.hasOwnProperty("mapbox_logo")&&!u.mapbox_logo)return!1}return!0}_updateCompact(){const i=this._container.children;if(i.length){const o=i[0];this._map.getCanvasContainer().offsetWidth<250?o.classList.add("mapboxgl-compact"):o.classList.remove("mapboxgl-compact")}}}class Ac{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(i){const o=++this._id;return this._queue.push({callback:i,id:o,cancelled:!1}),o}remove(i){const o=this._currentlyRunning,u=o?this._queue.concat(o):this._queue;for(const d of u)if(d.id===i)return void(d.cancelled=!0)}run(i=0){const o=this._currentlyRunning=this._queue;this._queue=[];for(const u of o)if(!u.cancelled&&(u.callback(i),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Mc(c,i,o){if(c=new s.bq(c.lng,c.lat),i){const u=new s.bq(c.lng-360,c.lat),d=new s.bq(c.lng+360,c.lat),p=360*Math.ceil(Math.abs(c.lng-o.center.lng)/360),_=o.locationPoint(c).distSqr(i),y=i.x<0||i.y<0||i.x>o.width||i.y>o.height;o.locationPoint(u).distSqr(i)<_&&(y||Math.abs(u.lng-o.center.lng)<p)?c=u:o.locationPoint(d).distSqr(i)<_&&(y||Math.abs(d.lng-o.center.lng)<p)&&(c=d)}for(;Math.abs(c.lng-o.center.lng)>180;){const u=o.locationPoint(c);if(u.x>=0&&u.y>=0&&u.x<=o.width&&u.y<=o.height)break;c.lng>o.center.lng?c.lng-=360:c.lng+=360}return c}const qs={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class sl extends s.E{constructor(i,o){if(super(),(i instanceof HTMLElement||o)&&(i=s.e({element:i},o)),s.a$(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=i&&i.anchor||"center",this._color=i&&i.color||"#3FB1CE",this._scale=i&&i.scale||1,this._draggable=i&&i.draggable||!1,this._clickTolerance=i&&i.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=i&&i.rotation||0,this._rotationAlignment=i&&i.rotationAlignment||"auto",this._pitchAlignment=i&&i.pitchAlignment&&i.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=i&&i.occludedOpacity||.2,i&&i.element)this._element=i.element,this._offset=s.P.convert(i&&i.offset||[0,0]);else{this._defaultMarker=!0,this._element=ct("div");const p=41,_=27,y=dr("svg",{display:"block",height:p*this._scale+"px",width:_*this._scale+"px",viewBox:`0 0 ${_} ${p}`},this._element),b=dr("radialGradient",{id:"shadowGradient"},dr("defs",{},y));dr("stop",{offset:"10%","stop-opacity":.4},b),dr("stop",{offset:"100%","stop-opacity":.05},b),dr("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},y),dr("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},y),dr("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},y),dr("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},y),this._offset=s.P.convert(i&&i.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",p=>{p.preventDefault()}),this._element.addEventListener("mousedown",p=>{p.preventDefault()});const u=this._element.classList;for(const p in qs)u.remove(`mapboxgl-marker-anchor-${p}`);u.add(`mapboxgl-marker-anchor-${this._anchor}`);const d=i&&i.className?i.className.trim().split(/\s+/):[];u.add(...d),this._popup=null}addTo(i){return i===this._map||(this.remove(),this._map=i,i.getCanvasContainer().appendChild(this._element),i.on("move",this._updateMoving),i.on("moveend",this._update),i.on("remove",this._clearFadeTimer),i._addMarker(this),this.setDraggable(this._draggable),this._update(),i.on("click",this._onMapClick)),this}remove(){const i=this._map;return i&&(i.off("click",this._onMapClick),i.off("move",this._updateMoving),i.off("moveend",this._update),i.off("mousedown",this._addDragHandler),i.off("touchstart",this._addDragHandler),i.off("mouseup",this._onUp),i.off("touchend",this._onUp),i.off("mousemove",this._onMove),i.off("touchmove",this._onMove),i.off("remove",this._clearFadeTimer),i._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(i){return this._lngLat=s.bq.convert(i),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(i){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),i){if(!("offset"in i.options)){const d=Math.sqrt(Math.pow(13.5,2)/2);i.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[d,-1*(38.1-13.5+d)],"bottom-right":[-d,-1*(38.1-13.5+d)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=i,i._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(i){const o=i.code,u=i.charCode||i.keyCode;o!=="Space"&&o!=="Enter"&&u!==32&&u!==13||this.togglePopup()}_onMapClick(i){const o=i.originalEvent.target,u=this._element;this._popup&&(o===u||u.contains(o))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const i=this._popup;return i?(i.isOpen()?(i.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(i.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const i=this._map,o=this._pos;if(!i||!o)return!1;const u=i.unproject(o),d=i.getFreeCameraOptions();if(!d.position)return!1;const p=d.position.toLngLat();return p.distanceTo(u)<.9*p.distanceTo(this._lngLat)}_evaluateOpacity(){const i=this._map;if(!i)return;const o=this._pos;if(!o||o.x<0||o.x>i.transform.width||o.y<0||o.y>i.transform.height)return void this._clearFadeTimer();const u=i.unproject(o);let d;i._showingGlobe()&&s.de(i.transform,this._lngLat)?d=0:(d=1-i._queryFogOpacity(u),i.transform._terrainEnabled()&&i.getTerrain()&&this._behindTerrain()&&(d*=this._occludedOpacity)),this._element.style.opacity=`${d}`,this._element.style.pointerEvents=d>0?"auto":"none",this._popup&&this._popup._setOpacity(d),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const i=this._pos;if(!i||!this._map)return;const o=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${i.x}px,${i.y}px)
            ${qs[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${o.x}px,${o.y}px)
        `}_calculateXYTransform(){const i=this._pos,o=this._map,u=this.getPitchAlignment();if(!o||!i||u!=="map")return"";if(!o._showingGlobe()){const b=o.getPitch();return b?`rotateX(${b}deg)`:""}const d=s.bI(s.df(o.transform,this._lngLat)),p=i.sub(s.dg(o.transform)),_=Math.abs(p.x)+Math.abs(p.y);if(_===0)return"";const y=d/_;return`rotateX(${-p.y*y}deg) rotateY(${p.x*y}deg)`}_calculateZTransform(){const i=this._pos,o=this._map;if(!o||!i)return"";let u=0;const d=this.getRotationAlignment();if(d==="map")if(o._showingGlobe()){const p=o.project(new s.bq(this._lngLat.lng,this._lngLat.lat+.001)),_=o.project(new s.bq(this._lngLat.lng,this._lngLat.lat-.001)).sub(p);u=s.bI(Math.atan2(_.y,_.x))-90}else u=-o.getBearing();else if(d==="horizon"){const p=s.S(4,6,o.getZoom()),_=s.dg(o.transform);_.y+=p*o.transform.height;const y=i.sub(_),b=s.bI(Math.atan2(y.y,y.x));u=(b>90?b-270:b+90)*(1-p)}return u+=this._rotation,u?`rotateZ(${u}deg)`:""}_update(i){cancelAnimationFrame(this._updateFrameId);const o=this._map;o&&(o.transform.renderWorldCopies&&(this._lngLat=Mc(this._lngLat,this._pos,o.transform)),this._pos=o.project(this._lngLat),i===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),o._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(o._showingGlobe()||o.getTerrain()||o.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(i){return this._offset=s.P.convert(i),this._update(),this}addClassName(i){return this._element.classList.add(i),this}removeClassName(i){return this._element.classList.remove(i),this}toggleClassName(i){return this._element.classList.toggle(i)}_onMove(i){const o=this._map;if(!o)return;const u=this._pointerdownPos,d=this._positionDelta;if(u&&d){if(!this._isDragging){const p=this._clickTolerance||o._clickTolerance;if(i.point.dist(u)<p)return;this._isDragging=!0}this._pos=i.point.sub(d),this._lngLat=o.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.b("dragstart"))),this.fire(new s.b("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const i=this._map;i&&(i.off("mousemove",this._onMove),i.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new s.b("dragend")),this._state="inactive"}_addDragHandler(i){const o=this._map,u=this._pos;o&&u&&this._element.contains(i.originalEvent.target)&&(i.preventDefault(),this._positionDelta=i.point.sub(u),this._pointerdownPos=i.point,this._state="pending",o.on("mousemove",this._onMove),o.on("touchmove",this._onMove),o.once("mouseup",this._onUp),o.once("touchend",this._onUp))}setDraggable(i){this._draggable=!!i;const o=this._map;return o&&(i?(o.on("mousedown",this._addDragHandler),o.on("touchstart",this._addDragHandler)):(o.off("mousedown",this._addDragHandler),o.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(i){return this._rotation=i||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(i){return this._rotationAlignment=i||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(i){return this._pitchAlignment=i||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(i){return this._occludedOpacity=i||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const al={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},u0=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function ll(c=new s.P(0,0),i="bottom"){if(typeof c=="number"){const o=Math.round(Math.sqrt(.5*Math.pow(c,2)));switch(i){case"top":return new s.P(0,c);case"top-left":return new s.P(o,o);case"top-right":return new s.P(-o,o);case"bottom":return new s.P(0,-c);case"bottom-left":return new s.P(o,-o);case"bottom-right":return new s.P(-o,-o);case"left":return new s.P(c,0);case"right":return new s.P(-c,0)}return new s.P(0,0)}return c instanceof s.P||Array.isArray(c)?s.P.convert(c):s.P.convert(c[i]||[0,0])}class Ic{constructor(i){this.jumpTo(i)}getValue(i){if(i<=this._startTime)return this._start;if(i>=this._endTime)return this._end;const o=s.ch((i-this._startTime)/(this._endTime-this._startTime));return this._start*(1-o)+this._end*o}isEasing(i){return i>=this._startTime&&i<=this._endTime}jumpTo(i){this._startTime=-1/0,this._endTime=-1/0,this._start=i,this._end=i}easeTo(i,o,u){this._start=this.getValue(o),this._end=i,this._startTime=o,this._endTime=o+u}}class h0{registerParameter(i,o,u,d,p){}registerButton(i,o,u){}registerBinding(i,o,u,d){}refreshUI(){}}const Ro={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},qn={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1},Zs={showCompass:!0,showZoom:!0,visualizePitch:!1};class Pc{constructor(i,o,u=!1){this._clickTolerance=10,this.element=o,this.mouseRotate=new lh({clickTolerance:i.dragRotate._mouseRotate._clickTolerance}),this.map=i,u&&(this.mousePitch=new os({clickTolerance:i.dragRotate._mousePitch._clickTolerance})),s.a$(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),o.addEventListener("mousedown",this.mousedown),o.addEventListener("touchstart",this.touchstart,{passive:!1}),o.addEventListener("touchmove",this.touchmove),o.addEventListener("touchend",this.touchend),o.addEventListener("touchcancel",this.reset)}down(i,o){this.mouseRotate.mousedown(i,o),this.mousePitch&&this.mousePitch.mousedown(i,o),Dr()}move(i,o){const u=this.map,d=this.mouseRotate.mousemoveWindow(i,o),p=d&&d.bearingDelta;if(p&&u.setBearing(u.getBearing()+p),this.mousePitch){const _=this.mousePitch.mousemoveWindow(i,o),y=_&&_.pitchDelta;y&&u.setPitch(u.getPitch()+y)}}off(){const i=this.element;i.removeEventListener("mousedown",this.mousedown),i.removeEventListener("touchstart",this.touchstart,{passive:!1}),i.removeEventListener("touchmove",this.touchmove),i.removeEventListener("touchend",this.touchend),i.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Br(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(i){this.down(s.e({},i,{ctrlKey:!0,preventDefault:()=>i.preventDefault()}),Fr(this.element,i)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(i){this.move(i,Fr(this.element,i))}mouseup(i){this.mouseRotate.mouseupWindow(i),this.mousePitch&&this.mousePitch.mouseupWindow(i),this.offTemp()}touchstart(i){i.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=ti(this.element,i.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>i.preventDefault()},this._startPos))}touchmove(i){i.targetTouches.length!==1?this.reset():(this._lastPos=ti(this.element,i.targetTouches)[0],this.move({preventDefault:()=>i.preventDefault()},this._lastPos))}touchend(i){i.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const nt={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},d0={maxWidth:100,unit:"metric"},f0={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"};return{version:s.du,supported:pt,setRTLTextPlugin:s.dw,getRTLTextPluginStatus:s.dx,Map:class extends df{constructor(c){const i=c;if((c=s.e({},qn,c)).minZoom!=null&&c.maxZoom!=null&&c.minZoom>c.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(c.minPitch!=null&&c.maxPitch!=null&&c.minPitch>c.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(c.minPitch!=null&&c.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(c.maxPitch!=null&&c.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(c.antialias&&s.dh(window)&&(c.antialias=!1,s.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Jl(c.minZoom,c.maxZoom,c.minPitch,c.maxPitch,c.renderWorldCopies),c),this._repaint=!!c.repaint,this._interactive=c.interactive,this._minTileCacheSize=c.minTileCacheSize,this._maxTileCacheSize=c.maxTileCacheSize,this._failIfMajorPerformanceCaveat=c.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=c.preserveDrawingBuffer,this._antialias=c.antialias,this._trackResize=c.trackResize,this._bearingSnap=c.bearingSnap,this._refreshExpiredTiles=c.refreshExpiredTiles,this._fadeDuration=c.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=c.crossSourceCollisions,this._collectResourceTiming=c.collectResourceTiming,this._language=this._parseLanguage(c.language),this._worldview=c.worldview,this._renderTaskQueue=new Ac,this._domRenderTaskQueue=new Ac,this._controls=[],this._markers=[],this._popups=[],this._mapId=s.aF(),this._locale=s.e({},Ro,c.locale),this._clickTolerance=c.clickTolerance,this._cooperativeGestures=c.cooperativeGestures,this._performanceMetricsCollection=c.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Ic(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new s.di(c.transformRequest,c.accessToken,c.testMode),this._silenceAuthErrors=!!c.testMode,this._contextCreateOptions=c.contextCreateOptions?{...c.contextCreateOptions}:{},typeof c.container=="string"){const o=document.getElementById(c.container);if(!o)throw new Error(`Container '${c.container.toString()}' not found.`);this._container=o}else{if(!(c.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=c.container}if(this._container.childNodes.length>0&&s.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),c.maxBounds&&this.setMaxBounds(c.maxBounds),s.a$(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp=c.devtools?new h0(this):new h0,this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new ol(this,c),this._localFontFamily=c.localFontFamily,this._localIdeographFontFamily=c.localIdeographFontFamily,(c.style||!c.testMode)&&this.setStyle(c.style||s.dd.DEFAULT_STYLE,{config:c.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),c.projection&&this.setProjection(c.projection),c.hash&&(this._hash=new lf(typeof c.hash=="string"&&c.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){i.center==null&&i.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:c.center,zoom:c.zoom,bearing:c.bearing,pitch:c.pitch});const o=c.bounds;o&&(this.resize(),this.fitBounds(o,s.e({},c.fitBoundsOptions,{duration:0})))}this.resize(),c.attributionControl&&this.addControl(new ph({customAttribution:c.customAttribution})),this._logoControl=new c0,this.addControl(this._logoControl,c.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",o=>{this._update(o.dataType==="style"),this.fire(new s.b(`${o.dataType}data`,o))}),this.on("dataloading",o=>{this.fire(new s.b(`${o.dataType}dataloading`,o))})}_getMapId(){return this._mapId}addControl(c,i){if(i===void 0&&(i=c.getDefaultPosition?c.getDefaultPosition():"top-right"),!c||!c.onAdd)return this.fire(new s.a(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const o=c.onAdd(this);this._controls.push(c);const u=this._controlPositions[i];return i.indexOf("bottom")!==-1?u.insertBefore(o,u.firstChild):u.appendChild(o),this}removeControl(c){if(!c||!c.onRemove)return this.fire(new s.a(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(c);return i>-1&&this._controls.splice(i,1),c.onRemove(this),this}hasControl(c){return this._controls.indexOf(c)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(c){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const i=!this._moving;return i&&this.fire(new s.b("movestart",c)).fire(new s.b("move",c)),this.fire(new s.b("resize",c)),i&&this.fire(new s.b("moveend",c)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(c){return this.transform.setMaxBounds(s.ag.convert(c)),this._update()}setMinZoom(c){if((c=c??-2)>=-2&&c<=this.transform.maxZoom)return this.transform.minZoom=c,this._update(),this.getZoom()<c?this.setZoom(c):this.fire(new s.b("zoomstart")).fire(new s.b("zoom")).fire(new s.b("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(c){if((c=c??22)>=this.transform.minZoom)return this.transform.maxZoom=c,this._update(),this.getZoom()>c?this.setZoom(c):this.fire(new s.b("zoomstart")).fire(new s.b("zoom")).fire(new s.b("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(c){if((c=c??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(c>=0&&c<=this.transform.maxPitch)return this.transform.minPitch=c,this._update(),this.getPitch()<c?this.setPitch(c):this.fire(new s.b("pitchstart")).fire(new s.b("pitch")).fire(new s.b("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(c){if((c=c??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(c>=this.transform.minPitch)return this.transform.maxPitch=c,this._update(),this.getPitch()>c?this.setPitch(c):this.fire(new s.b("pitchstart")).fire(new s.b("pitch")).fire(new s.b("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(c){return this.transform.renderWorldCopies=c,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(c){return c==="auto"?navigator.language:Array.isArray(c)?c.length===0?void 0:c.map(i=>i==="auto"?navigator.language:i):c}setLanguage(c){const i=this._parseLanguage(c);if(!this.style||i===this._language)return this;this._language=i,this.style.reloadSources();for(const o of this._controls)o._setLanguage&&o._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(c){return this.style&&c!==this._worldview?(this._worldview=c,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(c){return this._lazyInitEmptyStyle(),c?typeof c=="string"&&(c={name:c}):c=null,this._useExplicitProjection=!!c,this._prioritizeAndUpdateProjection(c,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const c=this.transform,i=c.projection.name;let o;i==="globe"&&c.zoom>=s.bA?(c.setMercatorFromTransition(),o=!0):i==="mercator"&&c.zoom<s.bA&&(c.setProjection({name:"globe"}),o=!0),o&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(c,i){return this._updateProjection(c||i||{name:"mercator"})}_updateProjection(c){let i;return i=c.name==="globe"&&this.transform.zoom>=s.bA?this.transform.setMercatorFromTransition():this.transform.setProjection(c),this.style.applyProjectionUpdate(),i&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(c){return this.transform.locationPoint3D(s.bq.convert(c))}unproject(c){return this.transform.pointLocation3D(s.P.convert(c))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(c,i,o){if(c==="mouseenter"||c==="mouseover"){let u=!1;const d=_=>{const y=i.filter(T=>this.getLayer(T)),b=y.length?this.queryRenderedFeatures(_.point,{layers:y}):[];b.length?u||(u=!0,o.call(this,new Pi(c,this,_.originalEvent,{features:b}))):u=!1},p=()=>{u=!1};return{layers:new Set(i),listener:o,delegates:{mousemove:d,mouseout:p}}}if(c==="mouseleave"||c==="mouseout"){let u=!1;const d=_=>{const y=i.filter(b=>this.getLayer(b));(y.length?this.queryRenderedFeatures(_.point,{layers:y}):[]).length?u=!0:u&&(u=!1,o.call(this,new Pi(c,this,_.originalEvent)))},p=_=>{u&&(u=!1,o.call(this,new Pi(c,this,_.originalEvent)))};return{layers:new Set(i),listener:o,delegates:{mousemove:d,mouseout:p}}}{const u=d=>{const p=i.filter(y=>this.getLayer(y)),_=p.length?this.queryRenderedFeatures(d.point,{layers:p}):[];_.length&&(d.features=_,o.call(this,d),delete d.features)};return{layers:new Set(i),listener:o,delegates:{[c]:u}}}}on(c,i,o){if(o===void 0)return super.on(c,i);if(Array.isArray(i)||(i=[i]),i){for(const d of i)if(!this._isValidId(d))return this}const u=this._createDelegatedListener(c,i,o);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[c]=this._delegatedListeners[c]||[],this._delegatedListeners[c].push(u);for(const d in u.delegates)this.on(d,u.delegates[d]);return this}once(c,i,o){if(o===void 0)return super.once(c,i);if(Array.isArray(i)||(i=[i]),i){for(const d of i)if(!this._isValidId(d))return this}const u=this._createDelegatedListener(c,i,o);for(const d in u.delegates)this.once(d,u.delegates[d]);return this}off(c,i,o){if(o===void 0)return super.off(c,i);i=new Set(Array.isArray(i)?i:[i]);for(const p of i)if(!this._isValidId(p))return this;const u=(p,_)=>{if(p.size!==_.size)return!1;for(const y of p)if(!_.has(y))return!1;return!0},d=this._delegatedListeners?this._delegatedListeners[c]:void 0;return d&&(p=>{for(let _=0;_<p.length;_++){const y=p[_];if(y.listener===o&&u(y.layers,i)){for(const b in y.delegates)this.off(b,y.delegates[b]);return p.splice(_,1),this}}})(d),this}queryRenderedFeatures(c,i){if(!this.style)return[];if(i!==void 0||c===void 0||c instanceof s.P||Array.isArray(c)||(i=c,c=void 0),c=c||[[0,0],[this.transform.width,this.transform.height]],(i=i||{}).layers&&Array.isArray(i.layers)){for(const o of i.layers)if(!this._isValidId(o))return[]}return this.style.queryRenderedFeatures(c,i,this.transform)}querySourceFeatures(c,i){return this._isValidId(c)?this.style.querySourceFeatures(c,i):[]}isPointOnSurface(c){const{name:i}=this.transform.projection;return i!=="globe"&&i!=="mercator"&&s.w(`${i} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(s.P.convert(c))}setStyle(c,i){return i=s.e({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},i),this.style&&c&&i.diff!==!1&&i.localFontFamily===this._localFontFamily&&i.localIdeographFontFamily===this._localIdeographFontFamily&&!i.config?(this.style._diffStyle(c,(o,u)=>{o?(s.w(`Unable to perform style diff: ${String(o.message||o.error||o)}. Rebuilding the style from scratch.`),this._updateStyle(c,i)):u&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._localFontFamily=i.localFontFamily,this._updateStyle(c,i))}_getUIString(c){const i=this._locale[c];if(i==null)throw new Error(`Missing UI string '${c}'`);return i}_updateStyle(c,i){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),c){const o=s.e({},i);i&&i.config&&(o.initialConfig=i.config,delete o.config),this.style=new Dn(this,o).setEventedParent(this,{style:this.style}).load(c)}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Dn(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(s.w("There is no style added to the map."),!1)}_isValidId(c){return c==null?(this.fire(new s.a(new Error("IDs can't be empty."))),!1):!s.c9(c)||(this.fire(new s.a(new Error(`IDs can't contain special symbols: "${c}".`))),!1)}addSource(c,i){return this._isValidId(c)?(this._lazyInitEmptyStyle(),this.style.addSource(c,i),this._update(!0)):this}isSourceLoaded(c){return!!this._isValidId(c)&&!!this.style&&this.style._isSourceCacheLoaded(c)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(c,i,o){this._lazyInitEmptyStyle(),this.style.addSourceType(c,i,o)}removeSource(c){return this._isValidId(c)?(this.style.removeSource(c),this._updateTerrain(),this._update(!0)):this}getSource(c){return this._isValidId(c)?this.style.getOwnSource(c):null}addImage(c,i,{pixelRatio:o=1,sdf:u=!1,stretchX:d,stretchY:p,content:_}={}){if(this._lazyInitEmptyStyle(),i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap){const{width:y,height:b,data:T}=s.f.getImageData(i);this.style.addImage(c,{data:new s.h({width:y,height:b},T),pixelRatio:o,stretchX:d,stretchY:p,content:_,sdf:u,version:0})}else if(i.width===void 0||i.height===void 0)this.fire(new s.a(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:y,height:b}=i,T=i;this.style.addImage(c,{data:new s.h({width:y,height:b},new Uint8Array(T.data)),pixelRatio:o,stretchX:d,stretchY:p,content:_,sdf:u,version:0,userImage:T}),T.onAdd&&T.onAdd(this,c)}}updateImage(c,i){this._lazyInitEmptyStyle();const o=this.style.getImage(c);if(!o)return void this.fire(new s.a(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const u=i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap?s.f.getImageData(i):i,{width:d,height:p}=u,_=u.data;if(d===void 0||p===void 0)return void this.fire(new s.a(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(d!==o.data.width||p!==o.data.height)return void this.fire(new s.a(new Error(`The width and height of the updated image (${d}, ${p})
                must be that same as the previous version of the image
                (${o.data.width}, ${o.data.height})`)));const y=!(i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap);o.data.replace(_,y),this.style.updateImage(c,o)}hasImage(c){return c?!!this.style&&!!this.style.getImage(c):(this.fire(new s.a(new Error("Missing required image id"))),!1)}removeImage(c){this.style.removeImage(c)}loadImage(c,i){s.d(this._requestManager.transformRequest(c,s.R.Image),(o,u)=>{i(o,u instanceof HTMLImageElement?s.f.getImageData(u):u)})}listImages(){return this.style.listImages()}addModel(c,i){this._lazyInitEmptyStyle(),this.style.addModel(c,i)}hasModel(c){return c?this.style.hasModel(c):(this.fire(new s.a(new Error("Missing required model id"))),!1)}removeModel(c){this.style.removeModel(c)}listModels(){return this.style.listModels()}addLayer(c,i){return this._isValidId(c.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(c,i),this._update(!0)):this}getSlot(c){const i=this.getLayer(c);return i&&i.slot||null}setSlot(c,i){return this.style.setSlot(c,i),this.style.mergeLayers(),this._update(!0)}addImport(c,i){return this.style.addImport(c,i),this}updateImport(c,i){return typeof i!="string"&&i.id!==c?(this.removeImport(c),this.addImport(i)):(this.style.updateImport(c,i),this._update(!0))}removeImport(c){return this.style.removeImport(c),this}moveImport(c,i){return this.style.moveImport(c,i),this._update(!0)}moveLayer(c,i){return this._isValidId(c)?(this.style.moveLayer(c,i),this._update(!0)):this}removeLayer(c){return this._isValidId(c)?(this.style.removeLayer(c),this._update(!0)):this}getLayer(c){return this._isValidId(c)?this.style.getOwnLayer(c):null}setLayerZoomRange(c,i,o){return this._isValidId(c)?(this.style.setLayerZoomRange(c,i,o),this._update(!0)):this}setFilter(c,i,o={}){return this._isValidId(c)?(this.style.setFilter(c,i,o),this._update(!0)):this}getFilter(c){return this._isValidId(c)?this.style.getFilter(c):null}setPaintProperty(c,i,o,u={}){return this._isValidId(c)?(this.style.setPaintProperty(c,i,o,u),this._update(!0)):this}getPaintProperty(c,i){return this._isValidId(c)?this.style.getPaintProperty(c,i):null}setLayoutProperty(c,i,o,u={}){return this._isValidId(c)?(this.style.setLayoutProperty(c,i,o,u),this._update(!0)):this}getLayoutProperty(c,i){return this._isValidId(c)?this.style.getLayoutProperty(c,i):null}getSchema(c){return this.style.getSchema(c)}setSchema(c,i){return this.style.setSchema(c,i),this._update(!0)}getConfig(c){return this.style.getConfig(c)}setConfig(c,i){return this.style.setConfig(c,i),this._update(!0)}getConfigProperty(c,i){return this.style.getConfigProperty(c,i)}setConfigProperty(c,i,o){return this.style.setConfigProperty(c,i,o),this._update(!0)}setLights(c){if(this._lazyInitEmptyStyle(),c&&c.length===1&&c[0].type==="flat"){const i=c[0];i.properties?this.style.setFlatLight(i.properties,i.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(c),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const c=this.style.getLights()||[];return c.length===0&&c.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),c}setLight(c,i={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:c}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(c){return this._lazyInitEmptyStyle(),!c&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(c),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(c){return this._lazyInitEmptyStyle(),this.style.setFog(c),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setCamera(c){return this.style.setCamera(c),this._triggerCameraUpdate(c)}_triggerCameraUpdate(c){return this._update(this.transform.setOrthographicProjectionAtLowPitch(c["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(c){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(s.bq.convert(c),this.transform):0}setFeatureState(c,i){return this._isValidId(c.source)?(this.style.setFeatureState(c,i),this._update()):this}removeFeatureState(c,i){return this._isValidId(c.source)?(this.style.removeFeatureState(c,i),this._update()):this}getFeatureState(c){return this._isValidId(c.source)?this.style.getFeatureState(c):null}_updateContainerDimensions(){if(!this._container)return;const c=this._container.getBoundingClientRect().width||400,i=this._container.getBoundingClientRect().height||300;let o,u,d,p=this._container;for(;p&&(!u||!d);){const _=window.getComputedStyle(p).transform;_&&_!=="none"&&(o=_.match(/matrix.*\((.+)\)/)[1].split(", "),o[0]&&o[0]!=="0"&&o[0]!=="1"&&(u=o[0]),o[3]&&o[3]!=="0"&&o[3]!=="1"&&(d=o[3])),p=p.parentElement}this._containerWidth=u?Math.abs(c/u):c,this._containerHeight=d?Math.abs(i/d):i}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&s.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const c=this._container;c.classList.add("mapboxgl-map"),(this._missingCSSCanary=ct("div","mapboxgl-canary",c)).style.visibility="hidden",this._detectMissingCSS();const i=this._canvasContainer=ct("div","mapboxgl-canvas-container",c);this._canvas=ct("canvas","mapboxgl-canvas",i),this._interactive&&(i.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const o=this._controlContainer=ct("div","mapboxgl-control-container",c),u=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(d=>{u[d]=ct("div",`mapboxgl-ctrl-${d}`,o)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(c,i){const o=s.f.devicePixelRatio||1;this._canvas.width=o*Math.ceil(c),this._canvas.height=o*Math.ceil(i),this._canvas.style.width=`${c}px`,this._canvas.style.height=`${i}px`}_addMarker(c){this._markers.push(c)}_removeMarker(c){const i=this._markers.indexOf(c);i!==-1&&this._markers.splice(i,1)}_addPopup(c){this._popups.push(c)}_removePopup(c){const i=this._popups.indexOf(c);i!==-1&&this._popups.splice(i,1)}_setupPainter(){const c=s.e({},pt.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),i=this._canvas.getContext("webgl2",c);i?(s.dj(i,!0),this.painter=new W1(i,this._contextCreateOptions,this.transform,this._tp),this.on("data",o=>{o.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),s.dk.testSupport(i)):this.fire(new s.a(new Error("Failed to initialize WebGL")))}_contextLost(c){c.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.b("webglcontextlost",{originalEvent:c}))}_contextRestored(c){this._setupPainter(),this.resize(),this._update(),this.fire(new s.b("webglcontextrestored",{originalEvent:c}))}_onMapScroll(c){if(c.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(c){return this.style?(this._styleDirty=this._styleDirty||c,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(c){return this._update(),this._renderTaskQueue.add(c)}_cancelRenderFrame(c){this._renderTaskQueue.remove(c)}_requestDomTask(c){!this.loaded()||this.loaded()&&!this.isMoving()?c():this._domRenderTaskQueue.add(c)}_render(c){let i;this.fire(new s.b("renderstart"));const o=this.painter.context.extTimerQuery,u=s.f.now(),d=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(i=d.createQuery(),d.beginQuery(o.TIME_ELAPSED_EXT,i)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(c),this._domRenderTaskQueue.run(c),this._removed)return;this._updateProjectionTransition();const p=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const b=this.transform.zoom,T=this.transform.pitch,E=s.f.now(),I=new s.N(b,{now:E,fadeDuration:p,pitch:T,transition:this.style.transition});this.style.update(I)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let _=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),_=this._updateAverageElevation(u),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):_=this._updateAverageElevation(u),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,p,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:p,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new s.b("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new s.b("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),i){const b=s.f.now()-u;d.endQuery(o.TIME_ELAPSED_EXT),setTimeout(()=>{const T=d.getQueryParameter(i,d.QUERY_RESULT)/1e6;d.deleteQuery(i),this.fire(new s.b("gpu-timing-frame",{cpuTime:b,gpuTime:T}))},50)}if(this.listens("gpu-timing-layer")){const b=this.painter.collectGpuTimers();setTimeout(()=>{const T=this.painter.queryGpuTimers(b);this.fire(new s.b("gpu-timing-layer",{layerTimes:T}))},50)}if(this.listens("gpu-timing-deferred-render")){const b=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const T=this.painter.queryGpuTimeDeferredRender(b);this.fire(new s.b("gpu-timing-deferred-render",{gpuTime:T}))},50)}const y=this._sourcesDirty||this._styleDirty||this._placementDirty||_;if(y||this._repaint)this.triggerRepaint();else{const b=!this.isMoving()&&this.loaded();if(b&&(_=this._updateAverageElevation(u,!0)),_)this.triggerRepaint();else if(this._triggerFrame(!1),b&&(this.fire(new s.b("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const T=this._calculateSpeedIndex();this.fire(new s.b("speedindexcompleted",{speedIndex:T})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||y||(this._fullyLoaded=!0,this._performanceMetricsCollection&&s.dl(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(c){for(const i of this._markers)c&&!this.getRenderWorldCopies()&&(i._lngLat=i._lngLat.wrap()),i._update();for(const i of this._popups)!c||this.getRenderWorldCopies()||i._trackPointer||(i._lngLat=i._lngLat.wrap()),i._update()}_updateAverageElevation(c,i=!1){const o=d=>(this.transform.averageElevation=d,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&o(0);const u=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(u||(i||c-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(c)){const d=this.transform.averageElevation;let p=this.transform.sampleAverageElevation();this.transform.elevation&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(p)?p=0:this._averageElevationLastSampledAt=c;const _=Math.abs(d-p);if(_>1){if(this._isInitialLoad||u)return this._averageElevation.jumpTo(p),o(p);this._averageElevation.easeTo(p,c,300)}else if(_>1e-4)return this._averageElevation.jumpTo(p),o(p)}return!!this._averageElevation.isEasing(c)&&o(this._averageElevation.getValue(c))}_authenticate(){s.dm(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,c=>{if(c&&(c.message===s.dn||c.status===401)){const i=this.painter.context.gl;s.dj(i,!1),this._logoControl instanceof c0&&this._logoControl._updateLogo(),i&&i.clear(i.DEPTH_BUFFER_BIT|i.COLOR_BUFFER_BIT|i.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new s.a(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),s.dp(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&s.dq(this._requestManager._customAccessToken,{map:this,skuToken:this._requestManager._skuToken,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const c=this._isDragging();this.painter.updateTerrain(this.style,c)}_calculateSpeedIndex(){const c=this.painter.canvasCopy(),i=this.painter.getCanvasCopiesAndTimestamps();i.timeStamps.push(performance.now());const o=this.painter.context.gl,u=o.createFramebuffer();function d(p){o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,p,0);const _=new Uint8Array(o.drawingBufferWidth*o.drawingBufferHeight*4);return o.readPixels(0,0,o.drawingBufferWidth,o.drawingBufferHeight,o.RGBA,o.UNSIGNED_BYTE,_),_}return o.bindFramebuffer(o.FRAMEBUFFER,u),this._canvasPixelComparison(d(c),i.canvasCopies.map(d),i.timeStamps)}_canvasPixelComparison(c,i,o){let u=o[1]-o[0];const d=c.length/4;for(let p=0;p<i.length;p++){const _=i[p];let y=0;for(let b=0;b<_.length;b+=4)_[b]===c[b]&&_[b+1]===c[b+1]&&_[b+2]===c[b+2]&&_[b+3]===c[b+3]&&(y+=1);u+=(o[p+2]-o[p+1])*(1-y/d)}return u}remove(){this._hash&&this._hash.remove();for(const i of this._controls)i.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const c=this.painter.context.gl.getExtension("WEBGL_lose_context");c&&c.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),s.dr(this.painter.context.gl),s.ds.remove(),s.dt.remove(),this._removed=!0,this.fire(new s.b("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(c){this._renderNextFrame=this._renderNextFrame||c,this.style&&!this._frame&&(this._frame=s.f.frame(i=>{const o=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,o&&this._render(i)}))}_preloadTiles(c){const i=this.style?this.style.getSourceCaches():[];return s.b4(i,(o,u)=>o._preloadTiles(c,u),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(c){this._trackResize&&this.resize({originalEvent:c})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(c){this._showTileBoundaries!==c&&(this._showTileBoundaries=c,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(c){this._showParseStatus!==c&&(this._showParseStatus=c,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(c){this._showTerrainWireframe!==c&&(this._showTerrainWireframe=c,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(c){this._showLayers2DWireframe!==c&&(this._showLayers2DWireframe=c,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(c){this._showLayers3DWireframe!==c&&(this._showLayers3DWireframe=c,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(c){this._speedIndexTiming!==c&&(this._speedIndexTiming=c,this._update())}get showPadding(){return!!this._showPadding}set showPadding(c){this._showPadding!==c&&(this._showPadding=c,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(c){this._showCollisionBoxes!==c&&(this._showCollisionBoxes=c,this._tp.refreshUI(),c?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(c){this._showOverdrawInspector!==c&&(this._showOverdrawInspector=c,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(c){this._repaint!==c&&(this._repaint=c,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(c){this._vertices=c,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(c){this._showTileAABBs!==c&&(this._showTileAABBs=c,this._tp.refreshUI(),c&&this._update())}_setCacheLimits(c,i){s.dv(c,i)}get version(){return s.du}},NavigationControl:class{constructor(c){this.options=s.e({},Zs,c),this._container=ct("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",i=>i.preventDefault()),this.options.showZoom&&(s.a$(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",i=>{this._map&&this._map.zoomIn({},{originalEvent:i})}),ct("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",i=>{this._map&&this._map.zoomOut({},{originalEvent:i})}),ct("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(s.a$(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",i=>{const o=this._map;o&&(this.options.visualizePitch?o.resetNorthPitch({},{originalEvent:i}):o.resetNorth({},{originalEvent:i}))}),this._compassIcon=ct("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const c=this._map;if(!c)return;const i=c.getZoom(),o=i===c.getMaxZoom(),u=i===c.getMinZoom();this._zoomInButton.disabled=o,this._zoomOutButton.disabled=u,this._zoomInButton.setAttribute("aria-disabled",o.toString()),this._zoomOutButton.setAttribute("aria-disabled",u.toString())}_rotateCompassArrow(){const c=this._map;if(!c)return;const i=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(c.transform.pitch*(Math.PI/180)),.5)}) rotateX(${c.transform.pitch}deg) rotateZ(${c.transform.angle*(180/Math.PI)}deg)`:`rotate(${c.transform.angle*(180/Math.PI)}deg)`;c._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=i)})}onAdd(c){return this._map=c,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),c.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&c.on("pitch",this._rotateCompassArrow),c.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Pc(c,this._compass,this.options.visualizePitch)),this._container}onRemove(){const c=this._map;c&&(this._container.remove(),this.options.showZoom&&c.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&c.off("pitch",this._rotateCompassArrow),c.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(c,i){const o=ct("button",c,this._container);return o.type="button",o.addEventListener("click",i),o}_setButtonTitle(c,i){if(!this._map)return;const o=this._map._getUIString(`NavigationControl.${i}`);c.setAttribute("aria-label",o),c.firstElementChild&&c.firstElementChild.setAttribute("title",o)}},GeolocateControl:class extends s.E{constructor(c){super();const i=navigator.geolocation;this.options=s.e({geolocation:i},nt,c),s.a$(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=H1(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(c){return this._map=c,this._container=ct("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(c){const i=(o=!!this.options.geolocation)=>{this._supportsGeolocation=o,c(o)};this._supportsGeolocation!==void 0?c(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(o=>i(o.state!=="denied")).catch(()=>i()):i()}_isOutOfMapMaxBounds(c){const i=this._map.getMaxBounds(),o=c.coords;return!!i&&(o.longitude<i.getWest()||o.longitude>i.getEast()||o.latitude<i.getSouth()||o.latitude>i.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(c){if(this._map){if(this._isOutOfMapMaxBounds(c))return this._setErrorState(),this.fire(new s.b("outofmaxbounds",c)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=c,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(c),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(c),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.b("geolocate",c)),this._finish()}}_updateCamera(c){const i=new s.bq(c.coords.longitude,c.coords.latitude),o=c.coords.accuracy,u=this._map.getBearing(),d=s.e({bearing:u},this.options.fitBoundsOptions);this._map.fitBounds(i.toBounds(o),d,{geolocateSource:!0})}_updateMarker(c){if(c){const i=new s.bq(c.coords.longitude,c.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=c.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const c=this._map.transform,i=s.bo(1,c._center.lat)*c.worldSize,o=Math.ceil(2*this._accuracy*i);this._circleElement.style.width=`${o}px`,this._circleElement.style.height=`${o}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(c){if(this._map){if(this.options.trackUserLocation)if(c.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(c.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.b("error",c)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(c){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",i=>i.preventDefault()),this._geolocateButton=ct("button","mapboxgl-ctrl-geolocate",this._container),ct("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",c===!1){s.w("Geolocation support is not available so the GeolocateControl will be disabled.");const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}else{const i=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=ct("div","mapboxgl-user-location"),this._dotElement.appendChild(ct("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(ct("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new sl({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=ct("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new sl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",i=>{i.geolocateSource||this._watchState!=="ACTIVE_LOCK"||i.originalEvent&&i.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new s.b("trackuserlocationend")))})}}_onDeviceOrientation(c){this._userLocationDotMarker&&(c.webkitCompassHeading?this._heading=c.webkitCompassHeading:c.absolute===!0&&(this._heading=-1*c.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return s.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.b("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new s.b("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.b("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let c;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(c={maximumAge:6e5,timeout:0},this._noTimeout=!0):(c=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,c),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const c=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(i=>{i==="granted"&&c()}).catch(console.error):c()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:ph,ScaleControl:class{constructor(c){this.options=s.e({},d0,c),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),s.a$(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const c=this.options.maxWidth||100,i=this._map,o=i._containerHeight/2,u=i._containerWidth/2-c/2,d=i.unproject([u,o]),p=i.unproject([u+c,o]),_=d.distanceTo(p);if(this.options.unit==="imperial"){const y=3.2808*_;y>5280?this._setScale(c,y/5280,"mile"):this._setScale(c,y,"foot")}else this.options.unit==="nautical"?this._setScale(c,_/1852,"nautical-mile"):_>=1e3?this._setScale(c,_/1e3,"kilometer"):this._setScale(c,_,"meter")}_setScale(c,i,o){this._map._requestDomTask(()=>{const u=function(p){const _=Math.pow(10,`${Math.floor(p)}`.length-1);let y=p/_;return y=y>=10?10:y>=5?5:y>=3?3:y>=2?2:y>=1?1:function(b){const T=Math.pow(10,Math.ceil(-Math.log(b)/Math.LN10));return Math.round(b*T)/T}(y),_*y}(i),d=u/i;this._container.innerHTML=this._isNumberFormatSupported&&o!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:o}).format(u):`${u}&nbsp;${f0[o]}`,this._container.style.width=c*d+"px"})}onAdd(c){return this._map=c,this._language=c.getLanguage(),this._container=ct("div","mapboxgl-ctrl mapboxgl-ctrl-scale",c.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(c){this._language=c,this._update()}setUnit(c){this.options.unit=c,this._update()}},FullscreenControl:class{constructor(c){this._fullscreen=!1,c&&c.container&&(c.container instanceof HTMLElement?this._container=c.container:s.w("Full screen control 'container' must be a DOM element.")),s.a$(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(c){return this._map=c,this._container||(this._container=this._map.getContainer()),this._controlContainer=ct("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",s.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const c=this._fullscreenButton=ct("button","mapboxgl-ctrl-fullscreen",this._controlContainer);ct("span","mapboxgl-ctrl-icon",c).setAttribute("aria-hidden","true"),c.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const c=this._getTitle();this._fullscreenButton.setAttribute("aria-label",c),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",c)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends s.E{constructor(c){super(),this.options=s.e(Object.create(al),c),s.a$(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(c&&c.className?c.className.trim().split(/\s+/):[])}addTo(c){return this._map&&this.remove(),this._map=c,this.options.closeOnClick&&c.on("preclick",this._onClose),this.options.closeOnMove&&c.on("move",this._onClose),c.on("remove",this.remove),this._update(),c._addPopup(this),this._focusFirstElement(),this._trackPointer?(c.on("mousemove",this._onMouseEvent),c.on("mouseup",this._onMouseEvent),c._canvasContainer.classList.add("mapboxgl-track-pointer")):c.on("move",this._update),this.fire(new s.b("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const c=this._map;return c&&(c.off("move",this._update),c.off("move",this._onClose),c.off("preclick",this._onClose),c.off("click",this._onClose),c.off("remove",this.remove),c.off("mousemove",this._onMouseEvent),c.off("mouseup",this._onMouseEvent),c.off("drag",this._onMouseEvent),c._canvasContainer&&c._canvasContainer.classList.remove("mapboxgl-track-pointer"),c._removePopup(this),this._map=void 0),this.fire(new s.b("close")),this}getLngLat(){return this._lngLat}setLngLat(c){this._lngLat=s.bq.convert(c),this._pos=null,this._trackPointer=!1,this._update();const i=this._map;return i&&(i.on("move",this._update),i.off("mousemove",this._onMouseEvent),i._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const c=this._map;return c&&(c.off("move",this._update),c.on("mousemove",this._onMouseEvent),c.on("drag",this._onMouseEvent),c._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(c){return this.setDOMContent(document.createTextNode(c))}setHTML(c){const i=document.createDocumentFragment(),o=document.createElement("body");let u;for(o.innerHTML=c;u=o.firstChild,u;)i.appendChild(u);return this.setDOMContent(i)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(c){return this.options.maxWidth=c,this._update(),this}setDOMContent(c){let i=this._content;if(i)for(;i.hasChildNodes();)i.firstChild&&i.removeChild(i.firstChild);else i=this._content=ct("div","mapboxgl-popup-content",this._container||void 0);if(i.appendChild(c),this.options.closeButton){const o=this._closeButton=ct("button","mapboxgl-popup-close-button",i);o.type="button",o.setAttribute("aria-label","Close popup"),o.setAttribute("aria-hidden","true"),o.innerHTML="&#215;",o.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(c){return this._classList.add(c),this._updateClassList(),this}removeClassName(c){return this._classList.delete(c),this._updateClassList(),this}setOffset(c){return this.options.offset=c,this._update(),this}toggleClassName(c){let i;return this._classList.delete(c)?i=!1:(this._classList.add(c),i=!0),this._updateClassList(),i}_onMouseEvent(c){this._update(c.point)}_getAnchor(c){if(this.options.anchor)return this.options.anchor;const i=this._map,o=this._container,u=this._pos;if(!i||!o||!u)return"bottom";const d=o.offsetWidth,p=o.offsetHeight,_=u.x<d/2,y=u.x>i.transform.width-d/2;if(u.y+c<p)return _?"top-left":y?"top-right":"top";if(u.y>i.transform.height-p){if(_)return"bottom-left";if(y)return"bottom-right"}return _?"left":y?"right":"bottom"}_updateClassList(){const c=this._container;if(!c)return;const i=[...this._classList];i.push("mapboxgl-popup"),this._anchor&&i.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&i.push("mapboxgl-popup-track-pointer"),c.className=i.join(" ")}_update(c){const i=this._map,o=this._content;if(!i||!this._lngLat&&!this._trackPointer||!o)return;let u=this._container;if(u||(u=this._container=ct("div","mapboxgl-popup",i.getContainer()),this._tip=ct("div","mapboxgl-popup-tip",u),u.appendChild(o)),this.options.maxWidth&&u.style.maxWidth!==this.options.maxWidth&&(u.style.maxWidth=this.options.maxWidth),i.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Mc(this._lngLat,this._pos,i.transform)),!this._trackPointer||c){const d=this._pos=this._trackPointer&&c?c:i.project(this._lngLat),p=ll(this.options.offset),_=this._anchor=this._getAnchor(p.y),y=ll(this.options.offset,_),b=d.add(y).round();i._requestDomTask(()=>{this._container&&_&&(this._container.style.transform=`${qs[_]} translate(${b.x}px,${b.y}px)`)})}if(!this._marker&&i._showingGlobe()){const d=s.de(i.transform,this._lngLat)?0:1;this._setOpacity(d)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const c=this._container.querySelector(u0);c&&c.focus()}_onClose(){this.remove()}_setOpacity(c){this._container&&(this._container.style.opacity=`${c}`),this._content&&(this._content.style.pointerEvents=c?"auto":"none")}},Marker:sl,Style:Dn,LngLat:s.bq,LngLatBounds:s.ag,Point:s.P,MercatorCoordinate:s.O,FreeCameraOptions:Cs,Evented:s.E,config:s.dd,prewarm:s.dy,clearPrewarmedResources:s.dz,get accessToken(){return s.dd.ACCESS_TOKEN},set accessToken(c){s.dd.ACCESS_TOKEN=c},get baseApiUrl(){return s.dd.API_URL},set baseApiUrl(c){s.dd.API_URL=c},get workerCount(){return s.dA.workerCount},set workerCount(c){s.dA.workerCount=c},get maxParallelImageRequests(){return s.dd.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(c){s.dd.MAX_PARALLEL_IMAGE_REQUESTS=c},clearStorage(c){s.dB(c)},get workerUrl(){return s.dC.workerUrl},set workerUrl(c){s.dC.workerUrl=c},get workerClass(){return s.dC.workerClass},set workerClass(c){s.dC.workerClass=c},get workerParams(){return s.dC.workerParams},set workerParams(c){s.dC.workerParams=c},get dracoUrl(){return s.dD()},set dracoUrl(c){s.dE(c)},get meshoptUrl(){return s.dF()},set meshoptUrl(c){s.dG(c)},setNow:s.f.setNow,restoreNow:s.f.restoreNow}});var et=he;return et})})(V6);var U8=V6.exports;const Up=N6(U8);var g3=Object.prototype.toString,j6=function(M){var U=g3.call(M),J=U==="[object Arguments]";return J||(J=U!=="[object Array]"&&M!==null&&typeof M=="object"&&typeof M.length=="number"&&M.length>=0&&g3.call(M.callee)==="[object Function]"),J},jp,y3;function j8(){if(y3)return jp;y3=1;var z;if(!Object.keys){var M=Object.prototype.hasOwnProperty,U=Object.prototype.toString,J=j6,le=Object.prototype.propertyIsEnumerable,he=!le.call({toString:null},"toString"),qe=le.call(function(){},"prototype"),et=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],s=function(St){var ct=St.constructor;return ct&&ct.prototype===St},ze={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},pt=function(){if(typeof window>"u")return!1;for(var St in window)try{if(!ze["$"+St]&&M.call(window,St)&&window[St]!==null&&typeof window[St]=="object")try{s(window[St])}catch{return!0}}catch{return!0}return!1}(),Ze=function(St){if(typeof window>"u"||!pt)return s(St);try{return s(St)}catch{return!1}};z=function(ct){var dr=ct!==null&&typeof ct=="object",_r=U.call(ct)==="[object Function]",ur=J(ct),Lr=dr&&U.call(ct)==="[object String]",Dr=[];if(!dr&&!_r&&!ur)throw new TypeError("Object.keys called on a non-object");var Br=qe&&_r;if(Lr&&ct.length>0&&!M.call(ct,0))for(var Vt=0;Vt<ct.length;++Vt)Dr.push(String(Vt));if(ur&&ct.length>0)for(var Ut=0;Ut<ct.length;++Ut)Dr.push(String(Ut));else for(var Fr in ct)!(Br&&Fr==="prototype")&&M.call(ct,Fr)&&Dr.push(String(Fr));if(he)for(var ti=Ze(ct),ai=0;ai<et.length;++ai)!(ti&&et[ai]==="constructor")&&M.call(ct,et[ai])&&Dr.push(et[ai]);return Dr}}return jp=z,jp}var G8=Array.prototype.slice,$8=j6,x3=Object.keys,md=x3?function(M){return x3(M)}:j8(),v3=Object.keys;md.shim=function(){if(Object.keys){var M=function(){var U=Object.keys(arguments);return U&&U.length===arguments.length}(1,2);M||(Object.keys=function(J){return $8(J)?v3(G8.call(J)):v3(J)})}else Object.keys=md;return Object.keys||md};var Pm=md,q8=Error,Z8=EvalError,W8=RangeError,H8=ReferenceError,G6=SyntaxError,ga=TypeError,Q8=URIError,Fd=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var M={},U=Symbol("test"),J=Object(U);if(typeof U=="string"||Object.prototype.toString.call(U)!=="[object Symbol]"||Object.prototype.toString.call(J)!=="[object Symbol]")return!1;var le=42;M[U]=le;for(U in M)return!1;if(typeof Object.keys=="function"&&Object.keys(M).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(M).length!==0)return!1;var he=Object.getOwnPropertySymbols(M);if(he.length!==1||he[0]!==U||!Object.prototype.propertyIsEnumerable.call(M,U))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var qe=Object.getOwnPropertyDescriptor(M,U);if(qe.value!==le||qe.enumerable!==!0)return!1}return!0},b3=typeof Symbol<"u"&&Symbol,X8=Fd,Cm=function(){return typeof b3!="function"||typeof Symbol!="function"||typeof b3("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:X8()},Gp={__proto__:null,foo:{}},Y8=Object,J8=function(){return{__proto__:Gp}.foo===Gp.foo&&!(Gp instanceof Y8)},K8="Function.prototype.bind called on incompatible ",ex=Object.prototype.toString,tx=Math.max,rx="[object Function]",w3=function(M,U){for(var J=[],le=0;le<M.length;le+=1)J[le]=M[le];for(var he=0;he<U.length;he+=1)J[he+M.length]=U[he];return J},ix=function(M,U){for(var J=[],le=U,he=0;le<M.length;le+=1,he+=1)J[he]=M[le];return J},nx=function(z,M){for(var U="",J=0;J<z.length;J+=1)U+=z[J],J+1<z.length&&(U+=M);return U},ox=function(M){var U=this;if(typeof U!="function"||ex.apply(U)!==rx)throw new TypeError(K8+U);for(var J=ix(arguments,1),le,he=function(){if(this instanceof le){var pt=U.apply(this,w3(J,arguments));return Object(pt)===pt?pt:this}return U.apply(M,w3(J,arguments))},qe=tx(0,U.length-J.length),et=[],s=0;s<qe;s++)et[s]="$"+s;if(le=Function("binder","return function ("+nx(et,",")+"){ return binder.apply(this,arguments); }")(he),U.prototype){var ze=function(){};ze.prototype=U.prototype,le.prototype=new ze,ze.prototype=null}return le},sx=ox,Dm=Function.prototype.bind||sx,ax=Function.prototype.call,lx=Object.prototype.hasOwnProperty,cx=Dm,$6=cx.call(ax,lx),Cr,ux=q8,hx=Z8,dx=W8,fx=H8,au=G6,su=ga,px=Q8,q6=Function,$p=function(z){try{return q6('"use strict"; return ('+z+").constructor;")()}catch{}},Ml=Object.getOwnPropertyDescriptor;if(Ml)try{Ml({},"")}catch{Ml=null}var qp=function(){throw new su},mx=Ml?function(){try{return arguments.callee,qp}catch{try{return Ml(arguments,"callee").get}catch{return qp}}}():qp,eu=Cm(),_x=J8(),ji=Object.getPrototypeOf||(_x?function(z){return z.__proto__}:null),ru={},gx=typeof Uint8Array>"u"||!ji?Cr:ji(Uint8Array),Il={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?Cr:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?Cr:ArrayBuffer,"%ArrayIteratorPrototype%":eu&&ji?ji([][Symbol.iterator]()):Cr,"%AsyncFromSyncIteratorPrototype%":Cr,"%AsyncFunction%":ru,"%AsyncGenerator%":ru,"%AsyncGeneratorFunction%":ru,"%AsyncIteratorPrototype%":ru,"%Atomics%":typeof Atomics>"u"?Cr:Atomics,"%BigInt%":typeof BigInt>"u"?Cr:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?Cr:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?Cr:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?Cr:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":ux,"%eval%":eval,"%EvalError%":hx,"%Float32Array%":typeof Float32Array>"u"?Cr:Float32Array,"%Float64Array%":typeof Float64Array>"u"?Cr:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?Cr:FinalizationRegistry,"%Function%":q6,"%GeneratorFunction%":ru,"%Int8Array%":typeof Int8Array>"u"?Cr:Int8Array,"%Int16Array%":typeof Int16Array>"u"?Cr:Int16Array,"%Int32Array%":typeof Int32Array>"u"?Cr:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":eu&&ji?ji(ji([][Symbol.iterator]())):Cr,"%JSON%":typeof JSON=="object"?JSON:Cr,"%Map%":typeof Map>"u"?Cr:Map,"%MapIteratorPrototype%":typeof Map>"u"||!eu||!ji?Cr:ji(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?Cr:Promise,"%Proxy%":typeof Proxy>"u"?Cr:Proxy,"%RangeError%":dx,"%ReferenceError%":fx,"%Reflect%":typeof Reflect>"u"?Cr:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?Cr:Set,"%SetIteratorPrototype%":typeof Set>"u"||!eu||!ji?Cr:ji(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?Cr:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":eu&&ji?ji(""[Symbol.iterator]()):Cr,"%Symbol%":eu?Symbol:Cr,"%SyntaxError%":au,"%ThrowTypeError%":mx,"%TypedArray%":gx,"%TypeError%":su,"%Uint8Array%":typeof Uint8Array>"u"?Cr:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?Cr:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?Cr:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?Cr:Uint32Array,"%URIError%":px,"%WeakMap%":typeof WeakMap>"u"?Cr:WeakMap,"%WeakRef%":typeof WeakRef>"u"?Cr:WeakRef,"%WeakSet%":typeof WeakSet>"u"?Cr:WeakSet};if(ji)try{null.error}catch(z){var yx=ji(ji(z));Il["%Error.prototype%"]=yx}var xx=function z(M){var U;if(M==="%AsyncFunction%")U=$p("async function () {}");else if(M==="%GeneratorFunction%")U=$p("function* () {}");else if(M==="%AsyncGeneratorFunction%")U=$p("async function* () {}");else if(M==="%AsyncGenerator%"){var J=z("%AsyncGeneratorFunction%");J&&(U=J.prototype)}else if(M==="%AsyncIteratorPrototype%"){var le=z("%AsyncGenerator%");le&&ji&&(U=ji(le.prototype))}return Il[M]=U,U},T3={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},i1=Dm,Sd=$6,vx=i1.call(Function.call,Array.prototype.concat),bx=i1.call(Function.apply,Array.prototype.splice),S3=i1.call(Function.call,String.prototype.replace),Ed=i1.call(Function.call,String.prototype.slice),wx=i1.call(Function.call,RegExp.prototype.exec),Tx=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,Sx=/\\(\\)?/g,Ex=function(M){var U=Ed(M,0,1),J=Ed(M,-1);if(U==="%"&&J!=="%")throw new au("invalid intrinsic syntax, expected closing `%`");if(J==="%"&&U!=="%")throw new au("invalid intrinsic syntax, expected opening `%`");var le=[];return S3(M,Tx,function(he,qe,et,s){le[le.length]=et?S3(s,Sx,"$1"):qe||he}),le},Ax=function(M,U){var J=M,le;if(Sd(T3,J)&&(le=T3[J],J="%"+le[0]+"%"),Sd(Il,J)){var he=Il[J];if(he===ru&&(he=xx(J)),typeof he>"u"&&!U)throw new su("intrinsic "+M+" exists, but is not available. Please file an issue!");return{alias:le,name:J,value:he}}throw new au("intrinsic "+M+" does not exist!")},No=function(M,U){if(typeof M!="string"||M.length===0)throw new su("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof U!="boolean")throw new su('"allowMissing" argument must be a boolean');if(wx(/^%?[^%]*%?$/,M)===null)throw new au("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var J=Ex(M),le=J.length>0?J[0]:"",he=Ax("%"+le+"%",U),qe=he.name,et=he.value,s=!1,ze=he.alias;ze&&(le=ze[0],bx(J,vx([0,1],ze)));for(var pt=1,Ze=!0;pt<J.length;pt+=1){var St=J[pt],ct=Ed(St,0,1),dr=Ed(St,-1);if((ct==='"'||ct==="'"||ct==="`"||dr==='"'||dr==="'"||dr==="`")&&ct!==dr)throw new au("property names with quotes must have matching quotes");if((St==="constructor"||!Ze)&&(s=!0),le+="."+St,qe="%"+le+"%",Sd(Il,qe))et=Il[qe];else if(et!=null){if(!(St in et)){if(!U)throw new su("base intrinsic for "+M+" exists, but the property is not available.");return}if(Ml&&pt+1>=J.length){var _r=Ml(et,St);Ze=!!_r,Ze&&"get"in _r&&!("originalValue"in _r.get)?et=_r.get:et=et[St]}else Ze=Sd(et,St),et=et[St];Ze&&!s&&(Il[qe]=et)}}return et},Mx=No,_d=Mx("%Object.defineProperty%",!0)||!1;if(_d)try{_d({},"a",{value:1})}catch{_d=!1}var zm=_d,Ix=No,gd=Ix("%Object.getOwnPropertyDescriptor%",!0);if(gd)try{gd([],"length")}catch{gd=null}var Rm=gd,E3=zm,Px=G6,tu=ga,A3=Rm,Lm=function(M,U,J){if(!M||typeof M!="object"&&typeof M!="function")throw new tu("`obj` must be an object or a function`");if(typeof U!="string"&&typeof U!="symbol")throw new tu("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new tu("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new tu("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new tu("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new tu("`loose`, if provided, must be a boolean");var le=arguments.length>3?arguments[3]:null,he=arguments.length>4?arguments[4]:null,qe=arguments.length>5?arguments[5]:null,et=arguments.length>6?arguments[6]:!1,s=!!A3&&A3(M,U);if(E3)E3(M,U,{configurable:qe===null&&s?s.configurable:!qe,enumerable:le===null&&s?s.enumerable:!le,value:J,writable:he===null&&s?s.writable:!he});else if(et||!le&&!he&&!qe)M[U]=J;else throw new Px("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},lm=zm,Z6=function(){return!!lm};Z6.hasArrayLengthDefineBug=function(){if(!lm)return null;try{return lm([],"length",{value:1}).length!==1}catch{return!0}};var Om=Z6,Cx=Pm,Dx=typeof Symbol=="function"&&typeof Symbol("foo")=="symbol",zx=Object.prototype.toString,Rx=Array.prototype.concat,M3=Lm,Lx=function(z){return typeof z=="function"&&zx.call(z)==="[object Function]"},W6=Om(),Ox=function(z,M,U,J){if(M in z){if(J===!0){if(z[M]===U)return}else if(!Lx(J)||!J())return}W6?M3(z,M,U,!0):M3(z,M,U)},H6=function(z,M){var U=arguments.length>2?arguments[2]:{},J=Cx(M);Dx&&(J=Rx.call(J,Object.getOwnPropertySymbols(M)));for(var le=0;le<J.length;le+=1)Ox(z,J[le],M[J[le]],U[J[le]])};H6.supportsDescriptors=!!W6;var Pl=H6,Q6={exports:{}},kx=No,I3=Lm,Bx=Om(),P3=Rm,C3=ga,Fx=kx("%Math.floor%"),Nx=function(M,U){if(typeof M!="function")throw new C3("`fn` is not a function");if(typeof U!="number"||U<0||U>4294967295||Fx(U)!==U)throw new C3("`length` must be a positive 32-bit integer");var J=arguments.length>2&&!!arguments[2],le=!0,he=!0;if("length"in M&&P3){var qe=P3(M,"length");qe&&!qe.configurable&&(le=!1),qe&&!qe.writable&&(he=!1)}return(le||he||!J)&&(Bx?I3(M,"length",U,!0,!0):I3(M,"length",U)),M};(function(z){var M=Dm,U=No,J=Nx,le=ga,he=U("%Function.prototype.apply%"),qe=U("%Function.prototype.call%"),et=U("%Reflect.apply%",!0)||M.call(qe,he),s=zm,ze=U("%Math.max%");z.exports=function(St){if(typeof St!="function")throw new le("a function is required");var ct=et(M,qe,arguments);return J(ct,1+ze(0,St.length-(arguments.length-1)),!0)};var pt=function(){return et(M,he,arguments)};s?s(z.exports,"apply",{value:pt}):z.exports.apply=pt})(Q6);var hu=Q6.exports,X6=No,Y6=hu,Vx=Y6(X6("String.prototype.indexOf")),Jn=function(M,U){var J=X6(M,!!U);return typeof J=="function"&&Vx(M,".prototype.")>-1?Y6(J):J},Ux=Pm,J6=Fd(),K6=Jn,D3=Object,jx=K6("Array.prototype.push"),z3=K6("Object.prototype.propertyIsEnumerable"),Gx=J6?Object.getOwnPropertySymbols:null,eg=function(M,U){if(M==null)throw new TypeError("target must be an object");var J=D3(M);if(arguments.length===1)return J;for(var le=1;le<arguments.length;++le){var he=D3(arguments[le]),qe=Ux(he),et=J6&&(Object.getOwnPropertySymbols||Gx);if(et)for(var s=et(he),ze=0;ze<s.length;++ze){var pt=s[ze];z3(he,pt)&&jx(qe,pt)}for(var Ze=0;Ze<qe.length;++Ze){var St=qe[Ze];if(z3(he,St)){var ct=he[St];J[St]=ct}}}return J},Zp=eg,$x=function(){if(!Object.assign)return!1;for(var z="abcdefghijklmnopqrst",M=z.split(""),U={},J=0;J<M.length;++J)U[M[J]]=M[J];var le=Object.assign({},U),he="";for(var qe in le)he+=qe;return z!==he},qx=function(){if(!Object.assign||!Object.preventExtensions)return!1;var z=Object.preventExtensions({1:2});try{Object.assign(z,"xy")}catch{return z[1]==="y"}return!1},tg=function(){return!Object.assign||$x()||qx()?Zp:Object.assign},Zx=Pl,Wx=tg,Hx=function(){var M=Wx();return Zx(Object,{assign:M},{assign:function(){return Object.assign!==M}}),M},Qx=Pl,Xx=hu,Yx=eg,rg=tg,Jx=Hx,Kx=Xx.apply(rg()),ig=function(M,U){return Kx(Object,arguments)};Qx(ig,{getPolyfill:rg,implementation:Yx,shim:Jx});var ev=ig,r1=function(){return typeof(function(){}).name=="string"},Jh=Object.getOwnPropertyDescriptor;if(Jh)try{Jh([],"length")}catch{Jh=null}r1.functionsHaveConfigurableNames=function(){if(!r1()||!Jh)return!1;var M=Jh(function(){},"name");return!!M&&!!M.configurable};var tv=Function.prototype.bind;r1.boundFunctionsHaveNames=function(){return r1()&&typeof tv=="function"&&(function(){}).bind().name!==""};var rv=r1,R3=Lm,iv=Om(),nv=rv.functionsHaveConfigurableNames(),ov=ga,sv=function(M,U){if(typeof M!="function")throw new ov("`fn` is not a function");var J=arguments.length>2&&!!arguments[2];return(!J||nv)&&(iv?R3(M,"name",U,!0,!0):R3(M,"name",U)),M},av=sv,lv=ga,cv=Object,ng=av(function(){if(this==null||this!==cv(this))throw new lv("RegExp.prototype.flags getter called on non-object");var M="";return this.hasIndices&&(M+="d"),this.global&&(M+="g"),this.ignoreCase&&(M+="i"),this.multiline&&(M+="m"),this.dotAll&&(M+="s"),this.unicode&&(M+="u"),this.unicodeSets&&(M+="v"),this.sticky&&(M+="y"),M},"get flags",!0),uv=ng,hv=Pl.supportsDescriptors,dv=Object.getOwnPropertyDescriptor,og=function(){if(hv&&/a/mig.flags==="gim"){var M=dv(RegExp.prototype,"flags");if(M&&typeof M.get=="function"&&typeof RegExp.prototype.dotAll=="boolean"&&typeof RegExp.prototype.hasIndices=="boolean"){var U="",J={};if(Object.defineProperty(J,"hasIndices",{get:function(){U+="d"}}),Object.defineProperty(J,"sticky",{get:function(){U+="y"}}),U==="dy")return M.get}}return uv},fv=Pl.supportsDescriptors,pv=og,mv=Object.getOwnPropertyDescriptor,_v=Object.defineProperty,gv=TypeError,L3=Object.getPrototypeOf,yv=/a/,xv=function(){if(!fv||!L3)throw new gv("RegExp.prototype.flags requires a true ES5 environment that supports property descriptors");var M=pv(),U=L3(yv),J=mv(U,"flags");return(!J||J.get!==M)&&_v(U,"flags",{configurable:!0,enumerable:!1,get:M}),M},vv=Pl,bv=hu,wv=ng,sg=og,Tv=xv,ag=bv(sg());vv(ag,{getPolyfill:sg,implementation:wv,shim:Tv});var Sv=ag,yd={exports:{}},Ev=Fd,Cl=function(){return Ev()&&!!Symbol.toStringTag},Av=Cl(),Mv=Jn,cm=Mv("Object.prototype.toString"),Nd=function(M){return Av&&M&&typeof M=="object"&&Symbol.toStringTag in M?!1:cm(M)==="[object Arguments]"},lg=function(M){return Nd(M)?!0:M!==null&&typeof M=="object"&&typeof M.length=="number"&&M.length>=0&&cm(M)!=="[object Array]"&&cm(M.callee)==="[object Function]"},Iv=function(){return Nd(arguments)}();Nd.isLegacyArguments=lg;var cg=Iv?Nd:lg;const Pv={},Cv=Object.freeze(Object.defineProperty({__proto__:null,default:Pv},Symbol.toStringTag,{value:"Module"})),Dv=V8(Cv);var km=typeof Map=="function"&&Map.prototype,Wp=Object.getOwnPropertyDescriptor&&km?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,Ad=km&&Wp&&typeof Wp.get=="function"?Wp.get:null,O3=km&&Map.prototype.forEach,Bm=typeof Set=="function"&&Set.prototype,Hp=Object.getOwnPropertyDescriptor&&Bm?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,Md=Bm&&Hp&&typeof Hp.get=="function"?Hp.get:null,k3=Bm&&Set.prototype.forEach,zv=typeof WeakMap=="function"&&WeakMap.prototype,Kh=zv?WeakMap.prototype.has:null,Rv=typeof WeakSet=="function"&&WeakSet.prototype,e1=Rv?WeakSet.prototype.has:null,Lv=typeof WeakRef=="function"&&WeakRef.prototype,B3=Lv?WeakRef.prototype.deref:null,Ov=Boolean.prototype.valueOf,kv=Object.prototype.toString,Bv=Function.prototype.toString,Fv=String.prototype.match,Fm=String.prototype.slice,_a=String.prototype.replace,Nv=String.prototype.toUpperCase,F3=String.prototype.toLowerCase,ug=RegExp.prototype.test,N3=Array.prototype.concat,Fo=Array.prototype.join,Vv=Array.prototype.slice,V3=Math.floor,um=typeof BigInt=="function"?BigInt.prototype.valueOf:null,Qp=Object.getOwnPropertySymbols,hm=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,lu=typeof Symbol=="function"&&typeof Symbol.iterator=="object",sn=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===lu||!0)?Symbol.toStringTag:null,hg=Object.prototype.propertyIsEnumerable,U3=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(z){return z.__proto__}:null);function j3(z,M){if(z===1/0||z===-1/0||z!==z||z&&z>-1e3&&z<1e3||ug.call(/e/,M))return M;var U=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof z=="number"){var J=z<0?-V3(-z):V3(z);if(J!==z){var le=String(J),he=Fm.call(M,le.length+1);return _a.call(le,U,"$&_")+"."+_a.call(_a.call(he,/([0-9]{3})/g,"$&_"),/_$/,"")}}return _a.call(M,U,"$&_")}var dm=Dv,G3=dm.custom,$3=fg(G3)?G3:null,Uv=function z(M,U,J,le){var he=U||{};if(fa(he,"quoteStyle")&&he.quoteStyle!=="single"&&he.quoteStyle!=="double")throw new TypeError('option "quoteStyle" must be "single" or "double"');if(fa(he,"maxStringLength")&&(typeof he.maxStringLength=="number"?he.maxStringLength<0&&he.maxStringLength!==1/0:he.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var qe=fa(he,"customInspect")?he.customInspect:!0;if(typeof qe!="boolean"&&qe!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(fa(he,"indent")&&he.indent!==null&&he.indent!=="	"&&!(parseInt(he.indent,10)===he.indent&&he.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(fa(he,"numericSeparator")&&typeof he.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var et=he.numericSeparator;if(typeof M>"u")return"undefined";if(M===null)return"null";if(typeof M=="boolean")return M?"true":"false";if(typeof M=="string")return mg(M,he);if(typeof M=="number"){if(M===0)return 1/0/M>0?"0":"-0";var s=String(M);return et?j3(M,s):s}if(typeof M=="bigint"){var ze=String(M)+"n";return et?j3(M,ze):ze}var pt=typeof he.depth>"u"?5:he.depth;if(typeof J>"u"&&(J=0),J>=pt&&pt>0&&typeof M=="object")return fm(M)?"[Array]":"[Object]";var Ze=ob(he,J);if(typeof le>"u")le=[];else if(pg(le,M)>=0)return"[Circular]";function St(Sn,Vn,yi){if(Vn&&(le=Vv.call(le),le.push(Vn)),yi){var Tr={depth:he.depth};return fa(he,"quoteStyle")&&(Tr.quoteStyle=he.quoteStyle),z(Sn,Tr,J+1,le)}return z(Sn,he,J+1,le)}if(typeof M=="function"&&!q3(M)){var ct=Xv(M),dr=dd(M,St);return"[Function"+(ct?": "+ct:" (anonymous)")+"]"+(dr.length>0?" { "+Fo.call(dr,", ")+" }":"")}if(fg(M)){var _r=lu?_a.call(String(M),/^(Symbol\(.*\))_[^)]*$/,"$1"):hm.call(M);return typeof M=="object"&&!lu?Hh(_r):_r}if(rb(M)){for(var ur="<"+F3.call(String(M.nodeName)),Lr=M.attributes||[],Dr=0;Dr<Lr.length;Dr++)ur+=" "+Lr[Dr].name+"="+dg(jv(Lr[Dr].value),"double",he);return ur+=">",M.childNodes&&M.childNodes.length&&(ur+="..."),ur+="</"+F3.call(String(M.nodeName))+">",ur}if(fm(M)){if(M.length===0)return"[]";var Br=dd(M,St);return Ze&&!nb(Br)?"["+pm(Br,Ze)+"]":"[ "+Fo.call(Br,", ")+" ]"}if($v(M)){var Vt=dd(M,St);return!("cause"in Error.prototype)&&"cause"in M&&!hg.call(M,"cause")?"{ ["+String(M)+"] "+Fo.call(N3.call("[cause]: "+St(M.cause),Vt),", ")+" }":Vt.length===0?"["+String(M)+"]":"{ ["+String(M)+"] "+Fo.call(Vt,", ")+" }"}if(typeof M=="object"&&qe){if($3&&typeof M[$3]=="function"&&dm)return dm(M,{depth:pt-J});if(qe!=="symbol"&&typeof M.inspect=="function")return M.inspect()}if(Yv(M)){var Ut=[];return O3&&O3.call(M,function(Sn,Vn){Ut.push(St(Vn,M,!0)+" => "+St(Sn,M))}),Z3("Map",Ad.call(M),Ut,Ze)}if(eb(M)){var Fr=[];return k3&&k3.call(M,function(Sn){Fr.push(St(Sn,M))}),Z3("Set",Md.call(M),Fr,Ze)}if(Jv(M))return Xp("WeakMap");if(tb(M))return Xp("WeakSet");if(Kv(M))return Xp("WeakRef");if(Zv(M))return Hh(St(Number(M)));if(Hv(M))return Hh(St(um.call(M)));if(Wv(M))return Hh(Ov.call(M));if(qv(M))return Hh(St(String(M)));if(typeof window<"u"&&M===window)return"{ [object Window] }";if(typeof globalThis<"u"&&M===globalThis||typeof t1<"u"&&M===t1)return"{ [object globalThis] }";if(!Gv(M)&&!q3(M)){var ti=dd(M,St),ai=U3?U3(M)===Object.prototype:M instanceof Object||M.constructor===Object,Oi=M instanceof Object?"":"null prototype",sr=!ai&&sn&&Object(M)===M&&sn in M?Fm.call(ya(M),8,-1):Oi?"Object":"",vo=ai||typeof M.constructor!="function"?"":M.constructor.name?M.constructor.name+" ":"",Mi=vo+(sr||Oi?"["+Fo.call(N3.call([],sr||[],Oi||[]),": ")+"] ":"");return ti.length===0?Mi+"{}":Ze?Mi+"{"+pm(ti,Ze)+"}":Mi+"{ "+Fo.call(ti,", ")+" }"}return String(M)};function dg(z,M,U){var J=(U.quoteStyle||M)==="double"?'"':"'";return J+z+J}function jv(z){return _a.call(String(z),/"/g,"&quot;")}function fm(z){return ya(z)==="[object Array]"&&(!sn||!(typeof z=="object"&&sn in z))}function Gv(z){return ya(z)==="[object Date]"&&(!sn||!(typeof z=="object"&&sn in z))}function q3(z){return ya(z)==="[object RegExp]"&&(!sn||!(typeof z=="object"&&sn in z))}function $v(z){return ya(z)==="[object Error]"&&(!sn||!(typeof z=="object"&&sn in z))}function qv(z){return ya(z)==="[object String]"&&(!sn||!(typeof z=="object"&&sn in z))}function Zv(z){return ya(z)==="[object Number]"&&(!sn||!(typeof z=="object"&&sn in z))}function Wv(z){return ya(z)==="[object Boolean]"&&(!sn||!(typeof z=="object"&&sn in z))}function fg(z){if(lu)return z&&typeof z=="object"&&z instanceof Symbol;if(typeof z=="symbol")return!0;if(!z||typeof z!="object"||!hm)return!1;try{return hm.call(z),!0}catch{}return!1}function Hv(z){if(!z||typeof z!="object"||!um)return!1;try{return um.call(z),!0}catch{}return!1}var Qv=Object.prototype.hasOwnProperty||function(z){return z in this};function fa(z,M){return Qv.call(z,M)}function ya(z){return kv.call(z)}function Xv(z){if(z.name)return z.name;var M=Fv.call(Bv.call(z),/^function\s*([\w$]+)/);return M?M[1]:null}function pg(z,M){if(z.indexOf)return z.indexOf(M);for(var U=0,J=z.length;U<J;U++)if(z[U]===M)return U;return-1}function Yv(z){if(!Ad||!z||typeof z!="object")return!1;try{Ad.call(z);try{Md.call(z)}catch{return!0}return z instanceof Map}catch{}return!1}function Jv(z){if(!Kh||!z||typeof z!="object")return!1;try{Kh.call(z,Kh);try{e1.call(z,e1)}catch{return!0}return z instanceof WeakMap}catch{}return!1}function Kv(z){if(!B3||!z||typeof z!="object")return!1;try{return B3.call(z),!0}catch{}return!1}function eb(z){if(!Md||!z||typeof z!="object")return!1;try{Md.call(z);try{Ad.call(z)}catch{return!0}return z instanceof Set}catch{}return!1}function tb(z){if(!e1||!z||typeof z!="object")return!1;try{e1.call(z,e1);try{Kh.call(z,Kh)}catch{return!0}return z instanceof WeakSet}catch{}return!1}function rb(z){return!z||typeof z!="object"?!1:typeof HTMLElement<"u"&&z instanceof HTMLElement?!0:typeof z.nodeName=="string"&&typeof z.getAttribute=="function"}function mg(z,M){if(z.length>M.maxStringLength){var U=z.length-M.maxStringLength,J="... "+U+" more character"+(U>1?"s":"");return mg(Fm.call(z,0,M.maxStringLength),M)+J}var le=_a.call(_a.call(z,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,ib);return dg(le,"single",M)}function ib(z){var M=z.charCodeAt(0),U={8:"b",9:"t",10:"n",12:"f",13:"r"}[M];return U?"\\"+U:"\\x"+(M<16?"0":"")+Nv.call(M.toString(16))}function Hh(z){return"Object("+z+")"}function Xp(z){return z+" { ? }"}function Z3(z,M,U,J){var le=J?pm(U,J):Fo.call(U,", ");return z+" ("+M+") {"+le+"}"}function nb(z){for(var M=0;M<z.length;M++)if(pg(z[M],`
`)>=0)return!1;return!0}function ob(z,M){var U;if(z.indent==="	")U="	";else if(typeof z.indent=="number"&&z.indent>0)U=Fo.call(Array(z.indent+1)," ");else return null;return{base:U,prev:Fo.call(Array(M+1),U)}}function pm(z,M){if(z.length===0)return"";var U=`
`+M.prev+M.base;return U+Fo.call(z,","+U)+`
`+M.prev}function dd(z,M){var U=fm(z),J=[];if(U){J.length=z.length;for(var le=0;le<z.length;le++)J[le]=fa(z,le)?M(z[le],z):""}var he=typeof Qp=="function"?Qp(z):[],qe;if(lu){qe={};for(var et=0;et<he.length;et++)qe["$"+he[et]]=he[et]}for(var s in z)fa(z,s)&&(U&&String(Number(s))===s&&s<z.length||lu&&qe["$"+s]instanceof Symbol||(ug.call(/[^\w$]/,s)?J.push(M(s,z)+": "+M(z[s],z)):J.push(s+": "+M(z[s],z))));if(typeof Qp=="function")for(var ze=0;ze<he.length;ze++)hg.call(z,he[ze])&&J.push("["+M(he[ze])+"]: "+M(z[he[ze]],z));return J}var _g=No,du=Jn,sb=Uv,ab=ga,fd=_g("%WeakMap%",!0),pd=_g("%Map%",!0),lb=du("WeakMap.prototype.get",!0),cb=du("WeakMap.prototype.set",!0),ub=du("WeakMap.prototype.has",!0),hb=du("Map.prototype.get",!0),db=du("Map.prototype.set",!0),fb=du("Map.prototype.has",!0),Nm=function(z,M){for(var U=z,J;(J=U.next)!==null;U=J)if(J.key===M)return U.next=J.next,J.next=z.next,z.next=J,J},pb=function(z,M){var U=Nm(z,M);return U&&U.value},mb=function(z,M,U){var J=Nm(z,M);J?J.value=U:z.next={key:M,next:z.next,value:U}},_b=function(z,M){return!!Nm(z,M)},gg=function(){var M,U,J,le={assert:function(he){if(!le.has(he))throw new ab("Side channel does not contain "+sb(he))},get:function(he){if(fd&&he&&(typeof he=="object"||typeof he=="function")){if(M)return lb(M,he)}else if(pd){if(U)return hb(U,he)}else if(J)return pb(J,he)},has:function(he){if(fd&&he&&(typeof he=="object"||typeof he=="function")){if(M)return ub(M,he)}else if(pd){if(U)return fb(U,he)}else if(J)return _b(J,he);return!1},set:function(he,qe){fd&&he&&(typeof he=="object"||typeof he=="function")?(M||(M=new fd),cb(M,he,qe)):pd?(U||(U=new pd),db(U,he,qe)):(J||(J={key:{},next:null}),mb(J,he,qe))}};return le},gb=$6,Qh=gg(),_s=ga,Vm={assert:function(z,M){if(!z||typeof z!="object"&&typeof z!="function")throw new _s("`O` is not an object");if(typeof M!="string")throw new _s("`slot` must be a string");if(Qh.assert(z),!Vm.has(z,M))throw new _s("`"+M+"` is not present on `O`")},get:function(z,M){if(!z||typeof z!="object"&&typeof z!="function")throw new _s("`O` is not an object");if(typeof M!="string")throw new _s("`slot` must be a string");var U=Qh.get(z);return U&&U["$"+M]},has:function(z,M){if(!z||typeof z!="object"&&typeof z!="function")throw new _s("`O` is not an object");if(typeof M!="string")throw new _s("`slot` must be a string");var U=Qh.get(z);return!!U&&gb(U,"$"+M)},set:function(z,M,U){if(!z||typeof z!="object"&&typeof z!="function")throw new _s("`O` is not an object");if(typeof M!="string")throw new _s("`slot` must be a string");var J=Qh.get(z);J||(J={},Qh.set(z,J)),J["$"+M]=U}};Object.freeze&&Object.freeze(Vm);var yb=Vm,Xh=yb,xb=SyntaxError,W3=typeof StopIteration=="object"?StopIteration:null,vb=function(M){if(!W3)throw new xb("this environment lacks StopIteration");Xh.set(M,"[[Done]]",!1);var U={next:function(){var le=Xh.get(this,"[[Iterator]]"),he=Xh.get(le,"[[Done]]");try{return{done:he,value:he?void 0:le.next()}}catch(qe){if(Xh.set(le,"[[Done]]",!0),qe!==W3)throw qe;return{done:!0,value:void 0}}}};return Xh.set(U,"[[Iterator]]",M),U},bb={}.toString,yg=Array.isArray||function(z){return bb.call(z)=="[object Array]"},wb=String.prototype.valueOf,Tb=function(M){try{return wb.call(M),!0}catch{return!1}},Sb=Object.prototype.toString,Eb="[object String]",Ab=Cl(),xg=function(M){return typeof M=="string"?!0:typeof M!="object"?!1:Ab?Tb(M):Sb.call(M)===Eb},Um=typeof Map=="function"&&Map.prototype?Map:null,Mb=typeof Set=="function"&&Set.prototype?Set:null,Id;Um||(Id=function(M){return!1});var vg=Um?Map.prototype.has:null,H3=Mb?Set.prototype.has:null;!Id&&!vg&&(Id=function(M){return!1});var bg=Id||function(M){if(!M||typeof M!="object")return!1;try{if(vg.call(M),H3)try{H3.call(M)}catch{return!0}return M instanceof Um}catch{}return!1},Ib=typeof Map=="function"&&Map.prototype?Map:null,jm=typeof Set=="function"&&Set.prototype?Set:null,Pd;jm||(Pd=function(M){return!1});var Q3=Ib?Map.prototype.has:null,wg=jm?Set.prototype.has:null;!Pd&&!wg&&(Pd=function(M){return!1});var Tg=Pd||function(M){if(!M||typeof M!="object")return!1;try{if(wg.call(M),Q3)try{Q3.call(M)}catch{return!0}return M instanceof jm}catch{}return!1},X3=cg,Y3=vb;if(Cm()||Fd()){var Yp=Symbol.iterator;yd.exports=function(M){if(M!=null&&typeof M[Yp]<"u")return M[Yp]();if(X3(M))return Array.prototype[Yp].call(M)}}else{var Pb=yg,Cb=xg,J3=No,Db=J3("%Map%",!0),zb=J3("%Set%",!0),yo=Jn,K3=yo("Array.prototype.push"),e6=yo("String.prototype.charCodeAt"),Rb=yo("String.prototype.slice"),Lb=function(M,U){var J=M.length;if(U+1>=J)return U+1;var le=e6(M,U);if(le<55296||le>56319)return U+1;var he=e6(M,U+1);return he<56320||he>57343?U+1:U+2},Jp=function(M){var U=0;return{next:function(){var le=U>=M.length,he;return le||(he=M[U],U+=1),{done:le,value:he}}}},t6=function(M,U){if(Pb(M)||X3(M))return Jp(M);if(Cb(M)){var J=0;return{next:function(){var he=Lb(M,J),qe=Rb(M,J,he);return J=he,{done:he>M.length,value:qe}}}}if(U&&typeof M["_es6-shim iterator_"]<"u")return M["_es6-shim iterator_"]()};if(!Db&&!zb)yd.exports=function(M){if(M!=null)return t6(M,!0)};else{var Ob=bg,kb=Tg,r6=yo("Map.prototype.forEach",!0),i6=yo("Set.prototype.forEach",!0);if(typeof process>"u"||!process.versions||!process.versions.node)var n6=yo("Map.prototype.iterator",!0),o6=yo("Set.prototype.iterator",!0);var s6=yo("Map.prototype.@@iterator",!0)||yo("Map.prototype._es6-shim iterator_",!0),a6=yo("Set.prototype.@@iterator",!0)||yo("Set.prototype._es6-shim iterator_",!0),Bb=function(M){if(Ob(M)){if(n6)return Y3(n6(M));if(s6)return s6(M);if(r6){var U=[];return r6(M,function(le,he){K3(U,[he,le])}),Jp(U)}}if(kb(M)){if(o6)return Y3(o6(M));if(a6)return a6(M);if(i6){var J=[];return i6(M,function(le){K3(J,le)}),Jp(J)}}};yd.exports=function(M){return Bb(M)||t6(M)}}}var Fb=yd.exports,l6=function(z){return z!==z},Sg=function(M,U){return M===0&&U===0?1/M===1/U:!!(M===U||l6(M)&&l6(U))},Nb=Sg,Eg=function(){return typeof Object.is=="function"?Object.is:Nb},Vb=Eg,Ub=Pl,jb=function(){var M=Vb();return Ub(Object,{is:M},{is:function(){return Object.is!==M}}),M},Gb=Pl,$b=hu,qb=Sg,Ag=Eg,Zb=jb,Mg=$b(Ag(),Object);Gb(Mg,{getPolyfill:Ag,implementation:qb,shim:Zb});var Wb=Mg,Hb=hu,Ig=Jn,Qb=No,mm=Qb("%ArrayBuffer%",!0),xd=Ig("ArrayBuffer.prototype.byteLength",!0),Xb=Ig("Object.prototype.toString"),c6=!!mm&&!xd&&new mm(0).slice,u6=!!c6&&Hb(c6),Pg=xd||u6?function(M){if(!M||typeof M!="object")return!1;try{return xd?xd(M):u6(M,0),!0}catch{return!1}}:mm?function(M){return Xb(M)==="[object ArrayBuffer]"}:function(M){return!1},Yb=Date.prototype.getDay,Jb=function(M){try{return Yb.call(M),!0}catch{return!1}},Kb=Object.prototype.toString,e2="[object Date]",t2=Cl(),r2=function(M){return typeof M!="object"||M===null?!1:t2?Jb(M):Kb.call(M)===e2},_m=Jn,Cg=Cl(),Dg,zg,gm,ym;if(Cg){Dg=_m("Object.prototype.hasOwnProperty"),zg=_m("RegExp.prototype.exec"),gm={};var Kp=function(){throw gm};ym={toString:Kp,valueOf:Kp},typeof Symbol.toPrimitive=="symbol"&&(ym[Symbol.toPrimitive]=Kp)}var i2=_m("Object.prototype.toString"),n2=Object.getOwnPropertyDescriptor,o2="[object RegExp]",s2=Cg?function(M){if(!M||typeof M!="object")return!1;var U=n2(M,"lastIndex"),J=U&&Dg(U,"value");if(!J)return!1;try{zg(M,ym)}catch(le){return le===gm}}:function(M){return!M||typeof M!="object"&&typeof M!="function"?!1:i2(M)===o2},a2=Jn,h6=a2("SharedArrayBuffer.prototype.byteLength",!0),l2=h6?function(M){if(!M||typeof M!="object")return!1;try{return h6(M),!0}catch{return!1}}:function(M){return!1},c2=Number.prototype.toString,u2=function(M){try{return c2.call(M),!0}catch{return!1}},h2=Object.prototype.toString,d2="[object Number]",f2=Cl(),p2=function(M){return typeof M=="number"?!0:typeof M!="object"?!1:f2?u2(M):h2.call(M)===d2},Rg=Jn,m2=Rg("Boolean.prototype.toString"),_2=Rg("Object.prototype.toString"),g2=function(M){try{return m2(M),!0}catch{return!1}},y2="[object Boolean]",x2=Cl(),v2=function(M){return typeof M=="boolean"?!0:M===null||typeof M!="object"?!1:x2&&Symbol.toStringTag in M?g2(M):_2(M)===y2},xm={exports:{}},b2=Object.prototype.toString,w2=Cm();if(w2){var T2=Symbol.prototype.toString,S2=/^Symbol\(.*\)$/,E2=function(M){return typeof M.valueOf()!="symbol"?!1:S2.test(T2.call(M))};xm.exports=function(M){if(typeof M=="symbol")return!0;if(b2.call(M)!=="[object Symbol]")return!1;try{return E2(M)}catch{return!1}}}else xm.exports=function(M){return!1};var A2=xm.exports,vm={exports:{}},d6=typeof BigInt<"u"&&BigInt,M2=function(){return typeof d6=="function"&&typeof BigInt=="function"&&typeof d6(42)=="bigint"&&typeof BigInt(42)=="bigint"},I2=M2();if(I2){var P2=BigInt.prototype.valueOf,C2=function(M){try{return P2.call(M),!0}catch{}return!1};vm.exports=function(M){return M===null||typeof M>"u"||typeof M=="boolean"||typeof M=="string"||typeof M=="number"||typeof M=="symbol"||typeof M=="function"?!1:typeof M=="bigint"?!0:C2(M)}}else vm.exports=function(M){return!1};var D2=vm.exports,z2=xg,R2=p2,L2=v2,O2=A2,k2=D2,B2=function(M){if(M==null||typeof M!="object"&&typeof M!="function")return null;if(z2(M))return"String";if(R2(M))return"Number";if(L2(M))return"Boolean";if(O2(M))return"Symbol";if(k2(M))return"BigInt"},Cd=typeof WeakMap=="function"&&WeakMap.prototype?WeakMap:null,f6=typeof WeakSet=="function"&&WeakSet.prototype?WeakSet:null,Dd;Cd||(Dd=function(M){return!1});var bm=Cd?Cd.prototype.has:null,em=f6?f6.prototype.has:null;!Dd&&!bm&&(Dd=function(M){return!1});var F2=Dd||function(M){if(!M||typeof M!="object")return!1;try{if(bm.call(M,bm),em)try{em.call(M,em)}catch{return!0}return M instanceof Cd}catch{}return!1},wm={exports:{}},N2=No,Lg=Jn,V2=N2("%WeakSet%",!0),tm=Lg("WeakSet.prototype.has",!0);if(tm){var rm=Lg("WeakMap.prototype.has",!0);wm.exports=function(M){if(!M||typeof M!="object")return!1;try{if(tm(M,tm),rm)try{rm(M,rm)}catch{return!0}return M instanceof V2}catch{}return!1}}else wm.exports=function(M){return!1};var U2=wm.exports,j2=bg,G2=Tg,$2=F2,q2=U2,Z2=function(M){if(M&&typeof M=="object"){if(j2(M))return"Map";if(G2(M))return"Set";if($2(M))return"WeakMap";if(q2(M))return"WeakSet"}return!1},Og=Function.prototype.toString,iu=typeof Reflect=="object"&&Reflect!==null&&Reflect.apply,Tm,vd;if(typeof iu=="function"&&typeof Object.defineProperty=="function")try{Tm=Object.defineProperty({},"length",{get:function(){throw vd}}),vd={},iu(function(){throw 42},null,Tm)}catch(z){z!==vd&&(iu=null)}else iu=null;var W2=/^\s*class\b/,Sm=function(M){try{var U=Og.call(M);return W2.test(U)}catch{return!1}},im=function(M){try{return Sm(M)?!1:(Og.call(M),!0)}catch{return!1}},bd=Object.prototype.toString,H2="[object Object]",Q2="[object Function]",X2="[object GeneratorFunction]",Y2="[object HTMLAllCollection]",J2="[object HTML document.all class]",K2="[object HTMLCollection]",ew=typeof Symbol=="function"&&!!Symbol.toStringTag,tw=!(0 in[,]),Em=function(){return!1};if(typeof document=="object"){var rw=document.all;bd.call(rw)===bd.call(document.all)&&(Em=function(M){if((tw||!M)&&(typeof M>"u"||typeof M=="object"))try{var U=bd.call(M);return(U===Y2||U===J2||U===K2||U===H2)&&M("")==null}catch{}return!1})}var iw=iu?function(M){if(Em(M))return!0;if(!M||typeof M!="function"&&typeof M!="object")return!1;try{iu(M,null,Tm)}catch(U){if(U!==vd)return!1}return!Sm(M)&&im(M)}:function(M){if(Em(M))return!0;if(!M||typeof M!="function"&&typeof M!="object")return!1;if(ew)return im(M);if(Sm(M))return!1;var U=bd.call(M);return U!==Q2&&U!==X2&&!/^\[object HTML/.test(U)?!1:im(M)},nw=iw,ow=Object.prototype.toString,kg=Object.prototype.hasOwnProperty,sw=function(M,U,J){for(var le=0,he=M.length;le<he;le++)kg.call(M,le)&&(J==null?U(M[le],le,M):U.call(J,M[le],le,M))},aw=function(M,U,J){for(var le=0,he=M.length;le<he;le++)J==null?U(M.charAt(le),le,M):U.call(J,M.charAt(le),le,M)},lw=function(M,U,J){for(var le in M)kg.call(M,le)&&(J==null?U(M[le],le,M):U.call(J,M[le],le,M))},cw=function(M,U,J){if(!nw(U))throw new TypeError("iterator must be a function");var le;arguments.length>=3&&(le=J),ow.call(M)==="[object Array]"?sw(M,U,le):typeof M=="string"?aw(M,U,le):lw(M,U,le)},uw=cw,hw=["Float32Array","Float64Array","Int8Array","Int16Array","Int32Array","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","BigInt64Array","BigUint64Array"],nm=hw,dw=typeof globalThis>"u"?t1:globalThis,fw=function(){for(var M=[],U=0;U<nm.length;U++)typeof dw[nm[U]]=="function"&&(M[M.length]=nm[U]);return M},zd=uw,pw=fw,p6=hu,Gm=Jn,wd=Rm,mw=Gm("Object.prototype.toString"),Bg=Cl(),m6=typeof globalThis>"u"?t1:globalThis,Am=pw(),$m=Gm("String.prototype.slice"),om=Object.getPrototypeOf,_w=Gm("Array.prototype.indexOf",!0)||function(M,U){for(var J=0;J<M.length;J+=1)if(M[J]===U)return J;return-1},Rd={__proto__:null};Bg&&wd&&om?zd(Am,function(z){var M=new m6[z];if(Symbol.toStringTag in M){var U=om(M),J=wd(U,Symbol.toStringTag);if(!J){var le=om(U);J=wd(le,Symbol.toStringTag)}Rd["$"+z]=p6(J.get)}}):zd(Am,function(z){var M=new m6[z],U=M.slice||M.set;U&&(Rd["$"+z]=p6(U))});var gw=function(M){var U=!1;return zd(Rd,function(J,le){if(!U)try{"$"+J(M)===le&&(U=$m(le,1))}catch{}}),U},yw=function(M){var U=!1;return zd(Rd,function(J,le){if(!U)try{J(M),U=$m(le,1)}catch{}}),U},xw=function(M){if(!M||typeof M!="object")return!1;if(!Bg){var U=$m(mw(M),8,-1);return _w(Am,U)>-1?U:U!=="Object"?!1:yw(M)}return wd?gw(M):null},vw=Jn,_6=vw("ArrayBuffer.prototype.byteLength",!0),bw=Pg,ww=function(M){return bw(M)?_6?_6(M):M.byteLength:NaN},Fg=ev,Vo=Jn,g6=Sv,Tw=No,cu=Fb,Sw=gg,y6=Wb,x6=cg,v6=yg,b6=Pg,w6=r2,T6=s2,S6=l2,E6=Pm,A6=B2,M6=Z2,I6=xw,P6=ww,C6=Vo("SharedArrayBuffer.prototype.byteLength",!0),D6=Vo("Date.prototype.getTime"),sm=Object.getPrototypeOf,z6=Vo("Object.prototype.toString"),Ld=Tw("%Set%",!0),Mm=Vo("Map.prototype.has",!0),Od=Vo("Map.prototype.get",!0),R6=Vo("Map.prototype.size",!0),kd=Vo("Set.prototype.add",!0),Ng=Vo("Set.prototype.delete",!0),Bd=Vo("Set.prototype.has",!0),Td=Vo("Set.prototype.size",!0);function L6(z,M,U,J){for(var le=cu(z),he;(he=le.next())&&!he.done;)if(xo(M,he.value,U,J))return Ng(z,he.value),!0;return!1}function Vg(z){if(typeof z>"u")return null;if(typeof z!="object")return typeof z=="symbol"?!1:typeof z=="string"||typeof z=="number"?+z==+z:!0}function Ew(z,M,U,J,le,he){var qe=Vg(U);if(qe!=null)return qe;var et=Od(M,qe),s=Fg({},le,{strict:!1});return typeof et>"u"&&!Mm(M,qe)||!xo(J,et,s,he)?!1:!Mm(z,qe)&&xo(J,et,s,he)}function Aw(z,M,U){var J=Vg(U);return J??(Bd(M,J)&&!Bd(z,J))}function O6(z,M,U,J,le,he){for(var qe=cu(z),et,s;(et=qe.next())&&!et.done;)if(s=et.value,xo(U,s,le,he)&&xo(J,Od(M,s),le,he))return Ng(z,s),!0;return!1}function xo(z,M,U,J){var le=U||{};if(le.strict?y6(z,M):z===M)return!0;var he=A6(z),qe=A6(M);if(he!==qe)return!1;if(!z||!M||typeof z!="object"&&typeof M!="object")return le.strict?y6(z,M):z==M;var et=J.has(z),s=J.has(M),ze;if(et&&s){if(J.get(z)===J.get(M))return!0}else ze={};return et||J.set(z,ze),s||J.set(M,ze),Pw(z,M,le,J)}function k6(z){return!z||typeof z!="object"||typeof z.length!="number"||typeof z.copy!="function"||typeof z.slice!="function"||z.length>0&&typeof z[0]!="number"?!1:!!(z.constructor&&z.constructor.isBuffer&&z.constructor.isBuffer(z))}function Mw(z,M,U,J){if(Td(z)!==Td(M))return!1;for(var le=cu(z),he=cu(M),qe,et,s;(qe=le.next())&&!qe.done;)if(qe.value&&typeof qe.value=="object")s||(s=new Ld),kd(s,qe.value);else if(!Bd(M,qe.value)){if(U.strict||!Aw(z,M,qe.value))return!1;s||(s=new Ld),kd(s,qe.value)}if(s){for(;(et=he.next())&&!et.done;)if(et.value&&typeof et.value=="object"){if(!L6(s,et.value,U.strict,J))return!1}else if(!U.strict&&!Bd(z,et.value)&&!L6(s,et.value,U.strict,J))return!1;return Td(s)===0}return!0}function Iw(z,M,U,J){if(R6(z)!==R6(M))return!1;for(var le=cu(z),he=cu(M),qe,et,s,ze,pt,Ze;(qe=le.next())&&!qe.done;)if(ze=qe.value[0],pt=qe.value[1],ze&&typeof ze=="object")s||(s=new Ld),kd(s,ze);else if(Ze=Od(M,ze),typeof Ze>"u"&&!Mm(M,ze)||!xo(pt,Ze,U,J)){if(U.strict||!Ew(z,M,ze,pt,U,J))return!1;s||(s=new Ld),kd(s,ze)}if(s){for(;(et=he.next())&&!et.done;)if(ze=et.value[0],Ze=et.value[1],ze&&typeof ze=="object"){if(!O6(s,z,ze,Ze,U,J))return!1}else if(!U.strict&&(!z.has(ze)||!xo(Od(z,ze),Ze,U,J))&&!O6(s,z,ze,Ze,Fg({},U,{strict:!1}),J))return!1;return Td(s)===0}return!0}function Pw(z,M,U,J){var le,he;if(typeof z!=typeof M||z==null||M==null||z6(z)!==z6(M)||x6(z)!==x6(M))return!1;var qe=v6(z),et=v6(M);if(qe!==et)return!1;var s=z instanceof Error,ze=M instanceof Error;if(s!==ze||(s||ze)&&(z.name!==M.name||z.message!==M.message))return!1;var pt=T6(z),Ze=T6(M);if(pt!==Ze||(pt||Ze)&&(z.source!==M.source||g6(z)!==g6(M)))return!1;var St=w6(z),ct=w6(M);if(St!==ct||(St||ct)&&D6(z)!==D6(M)||U.strict&&sm&&sm(z)!==sm(M))return!1;var dr=I6(z),_r=I6(M);if(dr!==_r)return!1;if(dr||_r){if(z.length!==M.length)return!1;for(le=0;le<z.length;le++)if(z[le]!==M[le])return!1;return!0}var ur=k6(z),Lr=k6(M);if(ur!==Lr)return!1;if(ur||Lr){if(z.length!==M.length)return!1;for(le=0;le<z.length;le++)if(z[le]!==M[le])return!1;return!0}var Dr=b6(z),Br=b6(M);if(Dr!==Br)return!1;if(Dr||Br)return P6(z)!==P6(M)?!1:typeof Uint8Array=="function"&&xo(new Uint8Array(z),new Uint8Array(M),U,J);var Vt=S6(z),Ut=S6(M);if(Vt!==Ut)return!1;if(Vt||Ut)return C6(z)!==C6(M)?!1:typeof Uint8Array=="function"&&xo(new Uint8Array(z),new Uint8Array(M),U,J);if(typeof z!=typeof M)return!1;var Fr=E6(z),ti=E6(M);if(Fr.length!==ti.length)return!1;for(Fr.sort(),ti.sort(),le=Fr.length-1;le>=0;le--)if(Fr[le]!=ti[le])return!1;for(le=Fr.length-1;le>=0;le--)if(he=Fr[le],!xo(z[he],M[he],U,J))return!1;var ai=M6(z),Oi=M6(M);return ai!==Oi?!1:ai==="Set"||Oi==="Set"?Mw(z,M,U,J):ai==="Map"?Iw(z,M,U,J):!0}var Cw=function(M,U,J){return xo(M,U,J,Sw())};const Dw=N6(Cw);var zw=Object.defineProperty,Yr=(z,M)=>zw(z,"name",{value:M,configurable:!0}),Rw=class{constructor(M){this.direction=!1,this.compareProperties=!0;var U,J,le;this.precision=10**-((U=M==null?void 0:M.precision)!=null?U:17),this.direction=(J=M==null?void 0:M.direction)!=null?J:!1,this.compareProperties=(le=M==null?void 0:M.compareProperties)!=null?le:!0}compare(M,U){if(M.type!==U.type||!Yh(M,U))return!1;switch(M.type){case"Point":return this.compareCoord(M.coordinates,U.coordinates);case"LineString":return this.compareLine(M.coordinates,U.coordinates);case"Polygon":return this.comparePolygon(M,U);case"GeometryCollection":return this.compareGeometryCollection(M,U);case"Feature":return this.compareFeature(M,U);case"FeatureCollection":return this.compareFeatureCollection(M,U);default:if(M.type.startsWith("Multi")){const J=Im(M),le=Im(U);return J.every(he=>le.some(qe=>this.compare(he,qe)))}}return!1}compareCoord(M,U){return M.length===U.length&&M.every((J,le)=>Math.abs(J-U[le])<this.precision)}compareLine(M,U,J=0,le=!1){if(!Yh(M,U))return!1;const he=M;let qe=U;if(le&&!this.compareCoord(he[0],qe[0])){const s=this.fixStartIndex(qe,he);if(s)qe=s;else return!1}const et=this.compareCoord(he[J],qe[J]);return this.direction||et?this.comparePath(he,qe):this.compareCoord(he[J],qe[qe.length-(1+J)])?this.comparePath(he.slice().reverse(),qe):!1}fixStartIndex(M,U){let J,le=-1;for(let he=0;he<M.length;he++)if(this.compareCoord(M[he],U[0])){le=he;break}return le>=0&&(J=[].concat(M.slice(le,M.length),M.slice(1,le+1))),J}comparePath(M,U){return M.every((J,le)=>this.compareCoord(J,U[le]))}comparePolygon(M,U){if(this.compareLine(M.coordinates[0],U.coordinates[0],1,!0)){const J=M.coordinates.slice(1,M.coordinates.length),le=U.coordinates.slice(1,U.coordinates.length);return J.every(he=>le.some(qe=>this.compareLine(he,qe,1,!0)))}return!1}compareGeometryCollection(M,U){return Yh(M.geometries,U.geometries)&&this.compareBBox(M,U)&&M.geometries.every((J,le)=>this.compare(J,U.geometries[le]))}compareFeature(M,U){return M.id===U.id&&(this.compareProperties?Dw(M.properties,U.properties):!0)&&this.compareBBox(M,U)&&this.compare(M.geometry,U.geometry)}compareFeatureCollection(M,U){return Yh(M.features,U.features)&&this.compareBBox(M,U)&&M.features.every((J,le)=>this.compare(J,U.features[le]))}compareBBox(M,U){return!M.bbox&&!U.bbox||(M.bbox&&U.bbox?this.compareCoord(M.bbox,U.bbox):!1)}};Yr(Rw,"GeojsonEquality");function Yh(z,M){return z.coordinates?z.coordinates.length===M.coordinates.length:z.length===M.length}Yr(Yh,"sameLength");function Im(z){return z.coordinates.map(M=>({type:z.type.replace("Multi",""),coordinates:M}))}Yr(Im,"explode");var Nn=63710088e-1,Ug={centimeters:Nn*100,centimetres:Nn*100,degrees:360/(2*Math.PI),feet:Nn*3.28084,inches:Nn*39.37,kilometers:Nn/1e3,kilometres:Nn/1e3,meters:Nn,metres:Nn,miles:Nn/1609.344,millimeters:Nn*1e3,millimetres:Nn*1e3,nauticalmiles:Nn/1852,radians:1,yards:Nn*1.0936},B6={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,nauticalmiles:29155334959812285e-23,millimeters:1e6,millimetres:1e6,yards:1.195990046};function xa(z,M,U={}){const J={type:"Feature"};return(U.id===0||U.id)&&(J.id=U.id),U.bbox&&(J.bbox=U.bbox),J.properties=M||{},J.geometry=z,J}Yr(xa,"feature");function Lw(z,M,U={}){switch(z){case"Point":return qm(M).geometry;case"LineString":return Zm(M).geometry;case"Polygon":return Vd(M).geometry;case"MultiPoint":return Gg(M).geometry;case"MultiLineString":return jg(M).geometry;case"MultiPolygon":return $g(M).geometry;default:throw new Error(z+" is invalid")}}Yr(Lw,"geometry");function qm(z,M,U={}){if(!z)throw new Error("coordinates is required");if(!Array.isArray(z))throw new Error("coordinates must be an Array");if(z.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!uu(z[0])||!uu(z[1]))throw new Error("coordinates must contain numbers");return xa({type:"Point",coordinates:z},M,U)}Yr(qm,"point");function Ow(z,M,U={}){return Ud(z.map(J=>qm(J,M)),U)}Yr(Ow,"points");function Vd(z,M,U={}){for(const le of z){if(le.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(le[le.length-1].length!==le[0].length)throw new Error("First and last Position are not equivalent.");for(let he=0;he<le[le.length-1].length;he++)if(le[le.length-1][he]!==le[0][he])throw new Error("First and last Position are not equivalent.")}return xa({type:"Polygon",coordinates:z},M,U)}Yr(Vd,"polygon");function kw(z,M,U={}){return Ud(z.map(J=>Vd(J,M)),U)}Yr(kw,"polygons");function Zm(z,M,U={}){if(z.length<2)throw new Error("coordinates must be an array of two or more positions");return xa({type:"LineString",coordinates:z},M,U)}Yr(Zm,"lineString");function Bw(z,M,U={}){return Ud(z.map(J=>Zm(J,M)),U)}Yr(Bw,"lineStrings");function Ud(z,M={}){const U={type:"FeatureCollection"};return M.id&&(U.id=M.id),M.bbox&&(U.bbox=M.bbox),U.features=z,U}Yr(Ud,"featureCollection");function jg(z,M,U={}){return xa({type:"MultiLineString",coordinates:z},M,U)}Yr(jg,"multiLineString");function Gg(z,M,U={}){return xa({type:"MultiPoint",coordinates:z},M,U)}Yr(Gg,"multiPoint");function $g(z,M,U={}){return xa({type:"MultiPolygon",coordinates:z},M,U)}Yr($g,"multiPolygon");function Fw(z,M,U={}){return xa({type:"GeometryCollection",geometries:z},M,U)}Yr(Fw,"geometryCollection");function Nw(z,M=0){if(M&&!(M>=0))throw new Error("precision must be a positive number");const U=Math.pow(10,M||0);return Math.round(z*U)/U}Yr(Nw,"round");function qg(z,M="kilometers"){const U=Ug[M];if(!U)throw new Error(M+" units is invalid");return z*U}Yr(qg,"radiansToLength");function Wm(z,M="kilometers"){const U=Ug[M];if(!U)throw new Error(M+" units is invalid");return z/U}Yr(Wm,"lengthToRadians");function Vw(z,M){return Zg(Wm(z,M))}Yr(Vw,"lengthToDegrees");function Uw(z){let M=z%360;return M<0&&(M+=360),M}Yr(Uw,"bearingToAzimuth");function Zg(z){return z%(2*Math.PI)*180/Math.PI}Yr(Zg,"radiansToDegrees");function jw(z){return z%360*Math.PI/180}Yr(jw,"degreesToRadians");function Gw(z,M="kilometers",U="kilometers"){if(!(z>=0))throw new Error("length must be a positive number");return qg(Wm(z,M),U)}Yr(Gw,"convertLength");function $w(z,M="meters",U="kilometers"){if(!(z>=0))throw new Error("area must be a positive number");const J=B6[M];if(!J)throw new Error("invalid original units");const le=B6[U];if(!le)throw new Error("invalid final units");return z/J*le}Yr($w,"convertArea");function uu(z){return!isNaN(z)&&z!==null&&!Array.isArray(z)}Yr(uu,"isNumber");function qw(z){return z!==null&&typeof z=="object"&&!Array.isArray(z)}Yr(qw,"isObject");function Zw(z){if(!z)throw new Error("bbox is required");if(!Array.isArray(z))throw new Error("bbox must be an Array");if(z.length!==4&&z.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");z.forEach(M=>{if(!uu(M))throw new Error("bbox must only contain numbers")})}Yr(Zw,"validateBBox");function Ww(z){if(!z)throw new Error("id is required");if(["string","number"].indexOf(typeof z)===-1)throw new Error("id must be a number or a string")}Yr(Ww,"validateId");function Hw(z,M){var U=0,J=0,le=0,he=0,qe=0,et=0,s=0,ze=0,pt=null,Ze=null,St=z[0],ct=z[1],dr=M.length;for(U;U<dr;U++){J=0;var _r=M[U].length-1,ur=M[U];if(pt=ur[0],pt[0]!==ur[_r][0]&&pt[1]!==ur[_r][1])throw new Error("First and last coordinates in a ring must be the same");for(qe=pt[0]-St,et=pt[1]-ct,J;J<_r;J++){if(Ze=ur[J+1],ze=Ze[1]-ct,et<0&&ze<0||et>0&&ze>0){pt=Ze,et=ze,qe=pt[0]-St;continue}if(s=Ze[0]-z[0],ze>0&&et<=0){if(he=qe*ze-s*et,he>0)le=le+1;else if(he===0)return 0}else if(et>0&&ze<=0){if(he=qe*ze-s*et,he<0)le=le+1;else if(he===0)return 0}else if(ze===0&&et<0){if(he=qe*ze-s*et,he===0)return 0}else if(et===0&&ze<0){if(he=qe*ze-s*et,he===0)return 0}else if(et===0&&ze===0){if(s<=0&&qe>=0)return 0;if(qe<=0&&s>=0)return 0}pt=Ze,et=ze,qe=s}}return le%2!==0}var Qw=Object.defineProperty,va=(z,M)=>Qw(z,"name",{value:M,configurable:!0});function Wg(z){if(!z)throw new Error("coord is required");if(!Array.isArray(z)){if(z.type==="Feature"&&z.geometry!==null&&z.geometry.type==="Point")return[...z.geometry.coordinates];if(z.type==="Point")return[...z.coordinates]}if(Array.isArray(z)&&z.length>=2&&!Array.isArray(z[0])&&!Array.isArray(z[1]))return[...z];throw new Error("coord must be GeoJSON Point or an Array of numbers")}va(Wg,"getCoord");function Xw(z){if(Array.isArray(z))return z;if(z.type==="Feature"){if(z.geometry!==null)return z.geometry.coordinates}else if(z.coordinates)return z.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}va(Xw,"getCoords");function Hg(z){if(z.length>1&&uu(z[0])&&uu(z[1]))return!0;if(Array.isArray(z[0])&&z[0].length)return Hg(z[0]);throw new Error("coordinates must only contain numbers")}va(Hg,"containsNumber");function Yw(z,M,U){if(!M||!U)throw new Error("type and name required");if(!z||z.type!==M)throw new Error("Invalid input to "+U+": must be a "+M+", given "+z.type)}va(Yw,"geojsonType");function Jw(z,M,U){if(!z)throw new Error("No feature passed");if(!U)throw new Error(".featureOf() requires a name");if(!z||z.type!=="Feature"||!z.geometry)throw new Error("Invalid input to "+U+", Feature with geometry required");if(!z.geometry||z.geometry.type!==M)throw new Error("Invalid input to "+U+": must be a "+M+", given "+z.geometry.type)}va(Jw,"featureOf");function Kw(z,M,U){if(!z)throw new Error("No featureCollection passed");if(!U)throw new Error(".collectionOf() requires a name");if(!z||z.type!=="FeatureCollection")throw new Error("Invalid input to "+U+", FeatureCollection required");for(const J of z.features){if(!J||J.type!=="Feature"||!J.geometry)throw new Error("Invalid input to "+U+", Feature with geometry required");if(!J.geometry||J.geometry.type!==M)throw new Error("Invalid input to "+U+": must be a "+M+", given "+J.geometry.type)}}va(Kw,"collectionOf");function Qg(z){return z.type==="Feature"?z.geometry:z}va(Qg,"getGeom");function eT(z,M){return z.type==="FeatureCollection"?"FeatureCollection":z.type==="GeometryCollection"?"GeometryCollection":z.type==="Feature"&&z.geometry!==null?z.geometry.type:z.type}va(eT,"getType");var tT=Object.defineProperty,Xg=(z,M)=>tT(z,"name",{value:M,configurable:!0});function Yg(z,M,U={}){if(!z)throw new Error("point is required");if(!M)throw new Error("polygon is required");const J=Wg(z),le=Qg(M),he=le.type,qe=M.bbox;let et=le.coordinates;if(qe&&Jg(J,qe)===!1)return!1;he==="Polygon"&&(et=[et]);let s=!1;for(var ze=0;ze<et.length;++ze){const pt=Hw(J,et[ze]);if(pt===0)return!U.ignoreBoundary;pt&&(s=!0)}return s}Xg(Yg,"booleanPointInPolygon");function Jg(z,M){return M[0]<=z[0]&&M[1]<=z[1]&&M[2]>=z[0]&&M[3]>=z[1]}Xg(Jg,"inBBox");const rT="FeatureCollection",iT=[{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-71.50053948802687,-16.40067057593729,0],[-71.49737975798185,-16.40660062011133,0],[-71.49583419737436,-16.40627979482949,0],[-71.49377898582193,-16.40565998397588,0],[-71.49163321574518,-16.4050115929806,0],[-71.49133974706892,-16.4046261130751,0],[-71.49144986305993,-16.40403799762871,0],[-71.49067379272297,-16.40391628982697,0],[-71.49058949904038,-16.40307454494016,0],[-71.49137445386162,-16.40247278692188,0],[-71.49185055154035,-16.40070227895379,0],[-71.49149452377085,-16.4006577868984,0],[-71.49487467724212,-16.400518228982,0],[-71.49655745119587,-16.40026241941456,0],[-71.49686676995033,-16.3994995079717,0],[-71.49751039919114,-16.39895490211735,0],[-71.49853971392979,-16.39806169241619,0],[-71.50085016723192,-16.39873481374329,0],[-71.50111054679421,-16.39908945793074,0],[-71.50092371131085,-16.39988192493529,0],[-71.50097245725911,-16.40006410741687,0],[-71.50053948802687,-16.40067057593729,0]]]},properties:{nombre:`Av. Argentina
Av. peru
Republica de chile
29 de agosto`,dias:"sabado"}},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-71.50720176577028,-16.4034871866612,0],[-71.50597117259952,-16.40546969745736,0],[-71.50535755557898,-16.40647779013673,0],[-71.50592989504324,-16.40678421618456,0],[-71.50563557979922,-16.40728074834281,0],[-71.50503991740186,-16.40818087649111,0],[-71.50457248962374,-16.40884571681738,0],[-71.50441471282241,-16.40895995378429,0],[-71.50418960943627,-16.40897501126371,0],[-71.5039716472064,-16.40921524624375,0],[-71.50381080163932,-16.40944625978129,0],[-71.50175305929214,-16.40826726976744,0],[-71.50137781307413,-16.40785882781246,0],[-71.5000995447176,-16.40752813609873,0],[-71.49918674250497,-16.4073835129073,0],[-71.49854346038006,-16.40725381152962,0],[-71.49769007114828,-16.40700429455731,0],[-71.49767637944964,-16.40699615942068,0],[-71.49750524779773,-16.40652305599017,0],[-71.49846268296335,-16.40480463810936,0],[-71.50053374249632,-16.40101563526932,0],[-71.5013426300262,-16.40052129190855,0],[-71.50195337425816,-16.40025826614754,0],[-71.50720176577028,-16.4034871866612,0]]]},properties:{dias:"sabado"},id:1},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-71.51454373299431,-16.40756057986437,0],[-71.51326430516684,-16.41066713395258,0],[-71.51165194838117,-16.41065320389306,0],[-71.50961631040077,-16.41077038934003,0],[-71.50814726704448,-16.41065950473821,0],[-71.50674493035844,-16.41058324900053,0],[-71.50455809345152,-16.40959492462565,0],[-71.50391633435643,-16.40922426898734,0],[-71.50430169025798,-16.40892694915943,0],[-71.50463870518124,-16.40880774836614,0],[-71.50601381560249,-16.40680706848101,0],[-71.5053327338913,-16.40643392028821,0],[-71.50715742467585,-16.40346997324086,0],[-71.51135472027988,-16.40612440557624,0],[-71.51076431672469,-16.40649821083597,0],[-71.51454373299431,-16.40756057986437,0]]]},properties:{dias:"sabado"}},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-71.49049909511275,-16.40395581160791,0],[-71.49151494785573,-16.4041005262,0],[-71.49146949814786,-16.40434106058964,0],[-71.49122833142007,-16.40462336120831,0],[-71.49063479704719,-16.40470359741328,0],[-71.49031858170376,-16.40480735144883,0],[-71.49008285344279,-16.40482669236796,0],[-71.4896795411552,-16.40468547175239,0],[-71.48951199167588,-16.40453425668251,0],[-71.48920075732548,-16.40420000058687,0],[-71.48907887020918,-16.40410313423987,0],[-71.48725250858426,-16.40359012069406,0],[-71.48745674414643,-16.40247105971011,0],[-71.48760297529061,-16.40224043640006,0],[-71.48764188057399,-16.40174902358225,0],[-71.48752495240777,-16.40138378125743,0],[-71.48736256105222,-16.39981115553654,0],[-71.48765676312892,-16.39917758280252,0],[-71.48765774325288,-16.39864695495274,0],[-71.48734754070553,-16.39817486014492,0],[-71.48815166742716,-16.3975101440468,0],[-71.4884896672546,-16.39722236218641,0],[-71.48788288058414,-16.39660188691577,0],[-71.48741167249473,-16.39643836314757,0],[-71.4870870939393,-16.39614668287395,0],[-71.48661715266431,-16.39611123815282,0],[-71.4856847981502,-16.39609294837507,0],[-71.48549003025974,-16.39541928193882,0],[-71.48582065921116,-16.39529967892573,0],[-71.48755113088772,-16.39510694624002,0],[-71.48966297079343,-16.39396344297511,0],[-71.48980528945977,-16.39509797492283,0],[-71.49032383563573,-16.39808248677732,0],[-71.49045362689789,-16.3985544239925,0],[-71.49074374897575,-16.39969470704229,0],[-71.49144461782512,-16.40070687268394,0],[-71.49177443094577,-16.40073593730376,0],[-71.49151464961668,-16.40225336323567,0],[-71.49142196459087,-16.40243114379044,0],[-71.49081296026844,-16.40302517490997,0],[-71.49055585831013,-16.40305522799415,0],[-71.49053639649412,-16.40367870504662,0],[-71.49066417107605,-16.40375587524673,0],[-71.49049909511275,-16.40395581160791,0]]]},properties:{nombre:312,dias:"sabado"}},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-71.48742486396401,-16.40225466733939,0],[-71.48626383915969,-16.40195208479874,0],[-71.48592410596515,-16.4037705873124,0],[-71.48502634297773,-16.40413151978421,0],[-71.48365432596187,-16.40367769218745,0],[-71.48341715785476,-16.402415366858,0],[-71.48296203087145,-16.40061886269575,0],[-71.48225599734405,-16.40063738031012,0],[-71.48173022842484,-16.4017584921511,0],[-71.48034054278871,-16.40192463969214,0],[-71.4802497590386,-16.40085017481633,0],[-71.48101436829572,-16.40035494985629,0],[-71.48131459405991,-16.39963558199374,0],[-71.48060937706222,-16.39869212756552,0],[-71.48021931586739,-16.39850573269465,0],[-71.47957380556805,-16.40012116952666,0],[-71.47908580915269,-16.40058677012589,0],[-71.47840346257416,-16.40124977923054,0],[-71.47691776504797,-16.39976951186515,0],[-71.47659807089974,-16.39748685804941,0],[-71.47743597831638,-16.39633930930109,0],[-71.4785738268554,-16.39663014002021,0],[-71.47980674115426,-16.39240020537547,0],[-71.48061095408333,-16.39189215581938,0],[-71.48165988978946,-16.39253468587585,0],[-71.4827811987492,-16.39322366293128,0],[-71.48218134287299,-16.39254456394498,0],[-71.48353099013279,-16.39162677947219,0],[-71.48326845686663,-16.39083023504548,0],[-71.48491566736818,-16.39046296578432,0],[-71.48766018537452,-16.39499744201107,0],[-71.48570703921152,-16.39534216098106,0],[-71.4855212656344,-16.39543192453036,0],[-71.48572810008397,-16.39612020478311,0],[-71.4852469661112,-16.39438753321159,0],[-71.48414822229209,-16.39530941986966,0],[-71.48368130635846,-16.39624493331886,0],[-71.48589885111417,-16.39777721879254,0],[-71.48659094253821,-16.39825219354781,0],[-71.48707691716169,-16.39837232825243,0],[-71.48738150713083,-16.39820445191821,0],[-71.48769323408231,-16.39899954081282,0],[-71.48736233438345,-16.39977419083222,0],[-71.4875692774426,-16.40152438460157,0],[-71.48742486396401,-16.40225466733939,0]]]},properties:{nombre:`mariano melgar
los olivos
señor de Huanca`,dias:"sabado"}},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-71.50873961205814,-16.3998829388633,0],[-71.5105622078919,-16.39969166982847,0],[-71.5116240562193,-16.39964160494866,0],[-71.51185511276839,-16.39967029810079,0],[-71.5138252498826,-16.40132652011241,0],[-71.51584395291337,-16.40271497101282,0],[-71.5164100677651,-16.40304161308523,0],[-71.51535631787665,-16.40608489337716,0],[-71.5146984737825,-16.40718565554726,0],[-71.5146367942697,-16.40754378121682,0],[-71.51071726736718,-16.40655406371723,0],[-71.51147332732809,-16.40608170377961,0],[-71.5103471701534,-16.40536928875393,0],[-71.50833232029089,-16.40414065822516,0],[-71.50728199928857,-16.40351153338796,0],[-71.50658818419059,-16.40311823297324,0],[-71.50873961205814,-16.3998829388633,0]]]},properties:{dias:"sabado"}},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-71.49746019398175,-16.3975276475562,0],[-71.49742592491104,-16.3973803122097,0],[-71.49737403012347,-16.39720557911894,0],[-71.49753519318648,-16.39706125991494,0],[-71.4976888570001,-16.39698785084043,0],[-71.4977694325099,-16.3967692349546,0],[-71.49753911293189,-16.39669324164282,0],[-71.49736657875833,-16.39643803535382,0],[-71.4971411032481,-16.39597255272527,0],[-71.49692393012876,-16.39560472934093,0],[-71.496687733254,-16.39490494396376,0],[-71.49677116931129,-16.39467749169986,0],[-71.49748668700957,-16.3947042214887,0],[-71.49823446842288,-16.39450176900446,0],[-71.49881906934195,-16.39465190402148,0],[-71.49965035741909,-16.39482148975032,0],[-71.50058552201132,-16.39514829259235,0],[-71.50071928524467,-16.39537076088692,0],[-71.50139817727201,-16.39570752977192,0],[-71.50185115795604,-16.39593919520486,0],[-71.50234379957676,-16.39595330882382,0],[-71.50271553248707,-16.39585110442226,0],[-71.50273202539341,-16.39584822295364,0],[-71.50356122401227,-16.39522487803704,0],[-71.50423746044912,-16.39582553014222,0],[-71.50389084784928,-16.39462867820083,0],[-71.50423124859543,-16.39460092445569,0],[-71.50518854119501,-16.3957543830068,0],[-71.50619467773843,-16.39588219284871,0],[-71.50599744307745,-16.39754422635726,0],[-71.50538536133314,-16.3984211595624,0],[-71.50501953327553,-16.39826399445031,0],[-71.50449323501732,-16.39879753277465,0],[-71.50388052265978,-16.3984885192719,0],[-71.50315547924629,-16.39921348230699,0],[-71.50303584496312,-16.39932648068562,0],[-71.5030786581381,-16.39947211230669,0],[-71.50345393839004,-16.3997558359522,0],[-71.50269674455072,-16.39995545743709,0],[-71.50162045860145,-16.40008493354249,0],[-71.5010375610812,-16.40007187080708,0],[-71.50086279361385,-16.39989135402463,0],[-71.50105099280606,-16.39938441617716,0],[-71.50108099907145,-16.39904933072206,0],[-71.50087392689319,-16.3987484041218,0],[-71.50057991266816,-16.39867334986368,0],[-71.50046491769983,-16.39863250498156,0],[-71.49938247581869,-16.39832303985546,0],[-71.49855948029176,-16.39807175673771,0],[-71.49788469488668,-16.39860932014173,0],[-71.49765284279006,-16.39834165948404,0],[-71.49764691799562,-16.39787095100561,0],[-71.49746019398175,-16.3975276475562,0]]]},properties:{nombre:"La Chilca, Atalaya Santo domino",dias:"sabado"}},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-71.4966343790257,-16.39479699519732,0],[-71.49702526245655,-16.39575505030561,0],[-71.49714032613058,-16.39635951767119,0],[-71.4974474348109,-16.39687422258673,0],[-71.49679621535842,-16.3982341378823,0],[-71.4969710608311,-16.39910456929199,0],[-71.49642024804662,-16.40014170130256,0],[-71.49491167639239,-16.40054185199899,0],[-71.49243535354492,-16.40065431087283,0],[-71.49158184762136,-16.40059953729548,0],[-71.49110135233614,-16.39970235270515,0],[-71.49071782594942,-16.39963399449844,0],[-71.48958005158981,-16.39397980698059,0],[-71.49093024257165,-16.39320321449117,0],[-71.48875426896731,-16.3891799825559,0],[-71.48834411836988,-16.3885904565923,0],[-71.48921009575275,-16.38687101334136,0],[-71.48982495275229,-16.38570151973123,0],[-71.49029879497186,-16.38496026265108,0],[-71.49061683504397,-16.38491099210872,0],[-71.49214692550679,-16.38511648914095,0],[-71.49344067857658,-16.38567718145026,0],[-71.49407665930022,-16.38844874276504,0],[-71.4932329917785,-16.38998405884769,0],[-71.49385593247979,-16.39098714512072,0],[-71.49430603128862,-16.39298015397411,0],[-71.49460968616935,-16.39292361960712,0],[-71.49614618714067,-16.39340931793626,0],[-71.49665309995056,-16.39396682247383,0],[-71.49698309503252,-16.39451568381084,0],[-71.4966343790257,-16.39479699519732,0]]]},properties:{nombre:`Los rosales
rinconada 
Maria Arguedas
Buena vista`,dias:"sabado"}},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-71.50441643471852,-16.39449089586838,0],[-71.50480574804729,-16.3943936540911,0],[-71.50520661995857,-16.39424593238735,0],[-71.50580765989879,-16.39436459290431,0],[-71.50630481208556,-16.39445586182607,0],[-71.50848527917657,-16.39655872260152,0],[-71.50897938667833,-16.39696166261279,0],[-71.51004346520261,-16.39797513328935,0],[-71.51170439384767,-16.39960441710827,0],[-71.50873274875536,-16.39980106757702,0],[-71.50665214176017,-16.40307285979993,0],[-71.50193550346651,-16.40024830547088,0],[-71.50131131151853,-16.40051967511452,0],[-71.50079353428603,-16.40027584530929,0],[-71.50100946216105,-16.39994101633218,0],[-71.50273532649952,-16.39998821013237,0],[-71.50345261025224,-16.39976776023769,0],[-71.50302079012049,-16.39935548192382,0],[-71.50383404510342,-16.39848929166428,0],[-71.50426981616519,-16.39868715641251,0],[-71.50451104886446,-16.39879965345307,0],[-71.50496947065072,-16.39832870934706,0],[-71.50533772662453,-16.39844568741585,0],[-71.50598876069076,-16.39754288928587,0],[-71.50599074381711,-16.39684812015245,0],[-71.50621210357178,-16.39590036356082,0],[-71.50517699711347,-16.39573641617911,0],[-71.50472949357636,-16.39517352181208,0],[-71.5041808469552,-16.39462208592197,0],[-71.50441643471852,-16.39449089586838,0]]]},properties:{dias:"sabado"}},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-71.55135251049626,-16.42882491968768,0],[-71.551399041796,-16.42882335155415,0],[-71.55147397750413,-16.42881195591163,0],[-71.55153075561479,-16.42879227563363,0],[-71.55159624177517,-16.42879004635314,0],[-71.55164308638119,-16.42878845193346,0],[-71.55168998790165,-16.4287868554193,0],[-71.5517643418734,-16.4288021397801,0],[-71.55178315123842,-16.42880150369574,0],[-71.55182939074012,-16.42881776321154,0],[-71.55187608225417,-16.42882510914077,0],[-71.55190368664701,-16.428841906535,0],[-71.55195964596517,-16.42887501861809,0],[-71.55198764890795,-16.42889158849711,0],[-71.552024862968,-16.42891667340482,0],[-71.55210766171203,-16.42899326897308,0],[-71.5521348222393,-16.42902774188245,0],[-71.55216244422299,-16.42905329597947,0],[-71.55217993912393,-16.42908817539872,0],[-71.55222459055652,-16.42915752017051,0],[-71.55223192805462,-16.42920165624468,0],[-71.55222912131836,-16.42925501195943,0],[-71.5522277198445,-16.42928166080145,0],[-71.55220654159281,-16.42931787762281,0],[-71.5521753004058,-16.42936323885097,0],[-71.55214588580144,-16.42938177137316,0],[-71.5521067836914,-16.42940927887786,0],[-71.55209651932512,-16.42943574721129,0],[-71.55206686821211,-16.42947155067897,0],[-71.5520369249771,-16.42952463356818,0],[-71.55201678753475,-16.42958579930973,0],[-71.55201566149539,-16.42964636008667,0],[-71.55201453651162,-16.42970688361111,0],[-71.5520134124809,-16.42976737044454,0],[-71.55200280265632,-16.42982805820118,0],[-71.55199252229224,-16.42987143854783,0],[-71.55198240779355,-16.42990616501447,0],[-71.55198113593389,-16.42997511987749,0],[-71.55198997069473,-16.43000936944811,0],[-71.55199864572805,-16.43005222990191,0],[-71.55202627275482,-16.43009469015019,0],[-71.55205375094638,-16.43014578280475,0],[-71.55208140273956,-16.43018828326789,0],[-71.55210890340784,-16.43023941569875,0],[-71.55212714953363,-16.43030779010161,0],[-71.55216458168432,-16.43036725909118,0],[-71.55218355434523,-16.43043550705747,0],[-71.55218409619145,-16.430521065701,0],[-71.55218452965556,-16.43058953013289,0],[-71.55218469260264,-16.43061520796116,0],[-71.55218496346885,-16.4306580097207,0],[-71.55217590525366,-16.43069231767385,0],[-71.55214824977617,-16.43071818205574,0],[-71.5521110885558,-16.43075270261121,0],[-71.55207340858075,-16.43078728612615,0],[-71.55202636331347,-16.43083046503264,0],[-71.55199839583004,-16.43085631117167,0],[-71.55196209930273,-16.43088206015034,0],[-71.55190767654342,-16.43091639199464,0],[-71.55188957406345,-16.43094207589594,0],[-71.5518445071516,-16.43101052149654,0],[-71.55184450757655,-16.43102761649084,0],[-71.55184450771547,-16.43108744875758,0],[-71.55184450764207,-16.43111309125834,0],[-71.55185352066972,-16.43119001247893,0],[-71.55186253368642,-16.43123274634563,0],[-71.55187154776428,-16.43128403077403,0],[-71.55188056183782,-16.4313096726712,0],[-71.55188056191254,-16.43135241483808,0],[-71.55188957688435,-16.43140370573502,0],[-71.55189910917208,-16.43147210839356,0],[-71.55193597282386,-16.43154055669388,0],[-71.55194529196561,-16.43156623420717,0],[-71.55196413630807,-16.4316347311191,0],[-71.55200094741691,-16.43169471576539,0],[-71.5519203192494,-16.43174512957259,0],[-71.55192041644477,-16.43175361316931,0],[-71.55193886011145,-16.43178739947982,0],[-71.55195730915374,-16.43182119639304,0],[-71.55196673437071,-16.43185507967752,0],[-71.55197616151737,-16.43188897244702,0],[-71.55199482512347,-16.43193979279132,0],[-71.55200415989849,-16.4319652110058,0],[-71.55203207554565,-16.43203299738542,0],[-71.552032176107,-16.43204149945493,0],[-71.55205970360738,-16.43207530681464,0],[-71.55209628614378,-16.43210905953271,0],[-71.55210556574924,-16.43214313809047,0],[-71.55213301989866,-16.43219419418115,0],[-71.55213312432574,-16.43221128202589,0],[-71.55215153710783,-16.4322624234088,0],[-71.55216990249264,-16.43230503103615,0],[-71.5521792192871,-16.43234771096999,0],[-71.55219764510896,-16.43239888951068,0],[-71.55221618201142,-16.43246718856566,0],[-71.5530254849131,-16.43282515625264,0],[-71.55299727524998,-16.43286012596661,0],[-71.55304528568473,-16.43292821665229,0],[-71.55304542018698,-16.4329454550193,0],[-71.55304595902639,-16.43301441740126,0],[-71.55304616104783,-16.43304028229343,0],[-71.55303692821035,-16.43307492083995,0],[-71.55303793599776,-16.43320428024317,0],[-71.55303926511364,-16.4333163225353,0],[-71.55303089755867,-16.4333853430171,0],[-71.55302226211535,-16.43343714460059,0],[-71.55301336075041,-16.43347171353587,0],[-71.55300460632778,-16.43350625330051,0],[-71.55290277265613,-16.4335866295074,0],[-71.55285553288908,-16.43357901809206,0],[-71.55277095027321,-16.43358071210524,0],[-71.55271445251113,-16.43357330160035,0],[-71.55264846803199,-16.43355755635296,0],[-71.55261065032606,-16.43354125996953,0],[-71.55257316176416,-16.43353344038059,0],[-71.55254496324599,-16.43350825164897,0],[-71.5524985190408,-16.43349185302671,0],[-71.55247076851668,-16.43345786338827,0],[-71.55246155481679,-16.43341495685621,0],[-71.55245230629238,-16.43335486097665,0],[-71.55244254306845,-16.4333036835428,0],[-71.5524420946395,-16.43326952941094,0],[-71.55242291586617,-16.43319285453913,0],[-71.55240408106263,-16.43314181222353,0],[-71.55240374832124,-16.4331162253517,0],[-71.55237617527095,-16.43309086793698,0],[-71.55233089545769,-16.43309976854243,0],[-71.55229469995837,-16.43310859215325,0],[-71.5522587244305,-16.43313446421274,0],[-71.55221315692253,-16.43315215837733,0],[-71.55215806256662,-16.43315305422309,0],[-71.5521305298276,-16.43315350217335,0],[-71.55212135390124,-16.43315365120045,0],[-71.55215806191909,-16.43320460121383,0],[-71.55215806159615,-16.43323896637971,0],[-71.55215806110316,-16.43329051349686,0],[-71.55215806036891,-16.43333346928838,0],[-71.552158059547,-16.43340219920853,0],[-71.55215805967322,-16.43341938137398,0],[-71.55214888022941,-16.43346246851018,0],[-71.55213086788581,-16.43350547999951,0],[-71.55209495422363,-16.43354848321623,0],[-71.5520497194765,-16.43358310569577,0],[-71.55200426732873,-16.43360926364301,0],[-71.55194016480873,-16.43364443722622,0],[-71.55190372716636,-16.43367913943237,0],[-71.5518683744313,-16.4337132201582,0],[-71.55183333994877,-16.43374712526926,0],[-71.55181590996852,-16.43377261772878,0],[-71.55179866021916,-16.43381519091144,0],[-71.55178131160415,-16.43384924053279,0],[-71.5517818644263,-16.43390048690673,0],[-71.55178223284008,-16.43393466049436,0],[-71.55178250922154,-16.43396029528627,0],[-71.55178306235943,-16.43401157778467,0],[-71.55181870115142,-16.43402886325308,0],[-71.55188101201054,-16.43405483453086,0],[-71.55189907358827,-16.43407195259533,0],[-71.5519733628173,-16.43411376014904,0],[-71.55201059890616,-16.43413896537154,0],[-71.55203862113973,-16.43416430277634,0],[-71.5520665109841,-16.4341811092404,0],[-71.55212222068083,-16.43421479423801,0],[-71.55215009622276,-16.4342316492256,0],[-71.55218735628837,-16.43426559685531,0],[-71.55222469661093,-16.43430816743759,0],[-71.55223424072243,-16.4343510694222,0],[-71.5522344582418,-16.43438547799553,0],[-71.55223484012605,-16.43444570220214,0],[-71.55223522202266,-16.43450593789765,0],[-71.55223527129723,-16.43456628391121,0],[-71.55222593755767,-16.434626742143,0],[-71.55221660479785,-16.43469581145779,0],[-71.55221660528854,-16.43473029776521,0],[-71.55220727426891,-16.43483383495797,0],[-71.55220769561608,-16.43487684675125,0],[-71.55221767926469,-16.43490250174082,0],[-71.55221833300091,-16.43492823916844,0],[-71.55221008788259,-16.43497122104947,0],[-71.55219250344828,-16.43501428179337,0],[-71.5521751321871,-16.4350659433806,0],[-71.55216665924054,-16.4351003754344,0],[-71.55213039797549,-16.43514356925854,0],[-71.55209435303794,-16.43519535643471,0],[-71.552067005759,-16.43522129387602,0],[-71.5520305503806,-16.43525586923225,0],[-71.55199389924991,-16.43528183433161,0],[-71.55192974111132,-16.4353250996131,0],[-71.55188408173316,-16.4353510444796,0],[-71.55185758480314,-16.43538548634983,0],[-71.55181309024341,-16.43542856185687,0],[-71.55175058996409,-16.43548027450554,0],[-71.55173278363426,-16.43549751276463,0],[-71.5516877061177,-16.43551477113979,0],[-71.55162427825881,-16.43552342592535,0],[-71.55156086848186,-16.43553207862887,0],[-71.55152490509292,-16.43554932449474,0],[-71.5514888000817,-16.43555795503435,0],[-71.55146156212773,-16.43555796943512,0],[-71.55140710094462,-16.43555799860856,0],[-71.55135265816024,-16.43555802764342,0],[-71.55129823428767,-16.43555805659146,0],[-71.55126196194917,-16.43555807604864,0],[-71.55119859050401,-16.43555810529595,0],[-71.55082628400206,-16.43534739950417,0],[-71.55079901420991,-16.43532165462054,0],[-71.55076283050154,-16.43529589801751,0],[-71.55071773395296,-16.43527012831403,0],[-71.55069047802344,-16.43524439468135,0],[-71.55065430889303,-16.4352186480871,0],[-71.55060971704782,-16.43521856297565,0],[-71.55056511881492,-16.43521847788056,0],[-71.55052959633218,-16.4352269709057,0],[-71.55049503959575,-16.43526100761986,0],[-71.55046952138342,-16.43530366095142,0],[-71.55048845824638,-16.43538094590102,0],[-71.55048986202881,-16.43545816088945,0],[-71.55048197732994,-16.43550962851139,0],[-71.55046410456472,-16.43554409876618,0],[-71.55046429859401,-16.43557855250116,0],[-71.55044658158457,-16.43560436879807,0],[-71.55043790579145,-16.43564742931903,0],[-71.55041129677224,-16.43568185987279,0],[-71.55040256468936,-16.43571631689413,0],[-71.55035837162613,-16.43580245773845,0],[-71.55034079154142,-16.43585416722434,0],[-71.55033200045916,-16.43588002645398,0],[-71.55030546802884,-16.43593174578959,0],[-71.55027882874133,-16.4359662255272,0],[-71.55025142855531,-16.43600943369365,0],[-71.55022340445697,-16.43606995743917,0],[-71.55020459636039,-16.43612180293945,0],[-71.5501856960949,-16.43618225762463,0],[-71.55016706422929,-16.43625991449104,0],[-71.55014922212331,-16.43632027297867,0],[-71.55014042409027,-16.43637201100668,0],[-71.55012253053847,-16.43642375516799,0],[-71.55011363286161,-16.43645825296095,0],[-71.55011377993577,-16.43648412818993,0],[-71.5501139393871,-16.43653588189114,0],[-71.55013101809175,-16.43795314929372,0],[-71.55013073839177,-16.43796186827002,0],[-71.5501204879016,-16.43799678296904,0],[-71.55010111370402,-16.43803172869749,0],[-71.55010000314586,-16.43806655996299,0],[-71.55008064454547,-16.43810146855335,0],[-71.55006129551585,-16.43813635772979,0],[-71.55004223305384,-16.43816253364353,0],[-71.55000521963305,-16.43818009577958,0],[-71.54994973198944,-16.43820642336066,0],[-71.54991302802053,-16.43821528164698,0],[-71.54989375049733,-16.43825009523071,0],[-71.54988358609485,-16.43828484825142,0],[-71.54985329307551,-16.43835459084767,0],[-71.54980691624377,-16.4384237522445,0],[-71.54978828252422,-16.43845829723071,0],[-71.54975134049351,-16.43851869283353,0],[-71.5497243348794,-16.43854448545298,0],[-71.54967842041705,-16.43861343766385,0],[-71.54965082221223,-16.43865652230604,0],[-71.5496229339334,-16.43870823788578,0],[-71.54958616380414,-16.43875991910035,0],[-71.54949294137835,-16.43889784474779,0],[-71.54946528502637,-16.43893227269285,0],[-71.54946388879883,-16.4389667794568,0],[-71.54945502922152,-16.43904385441686,0],[-71.5494466223574,-16.43909517255888,0],[-71.54941200694687,-16.43915499589652,0],[-71.54941234894561,-16.43920636754281,0],[-71.54939496813816,-16.43924059169938,0],[-71.54937733444926,-16.4392834193501,0],[-71.54934206007323,-16.4393519452231,0],[-71.54933323983705,-16.43942051009787,0],[-71.54930677766312,-16.43948049428159,0],[-71.54929795480878,-16.43955764295459,0],[-71.54929795431578,-16.43961765216177,0],[-71.54927148631235,-16.43966051269028,0],[-71.54926278909207,-16.43968623219061,0],[-71.54923658982575,-16.43972910653169,0],[-71.54921904619721,-16.43974626053529,0],[-71.5491748491865,-16.43973768933907,0],[-71.54913899884806,-16.43972053493155,0],[-71.54911118420489,-16.43970337982429,0],[-71.54906498615624,-16.43969480645448,0],[-71.54901882295492,-16.43968623937571,0],[-71.5489911741517,-16.43968624217434,0],[-71.54891739720186,-16.43966912725804,0],[-71.54888085208853,-16.43965201506176,0],[-71.54882615161642,-16.43962635980899,0],[-71.54874393656999,-16.43960074157601,0],[-71.5486619575512,-16.43956659733291,0],[-71.54857104348794,-16.43952394794628,0],[-71.54848050526628,-16.43946424528964,0],[-71.54835306552344,-16.43939618678284,0],[-71.54823478020721,-16.43933676541666,0],[-71.5481351120091,-16.43926883300048,0],[-71.54802668113471,-16.43918395848033,0],[-71.54795439069183,-16.43913312456967,0],[-71.54789139336259,-16.43907374847078,0],[-71.54783719856738,-16.43903995125255,0],[-71.54780105150064,-16.43901460883025,0],[-71.54777393340053,-16.43899774070764,0],[-71.5469784921883,-16.43909257795193,0],[-71.5469170139791,-16.43909251711902,0],[-71.54688187780106,-16.43909248233679,0],[-71.54684673822183,-16.43909244756707,0],[-71.546811594432,-16.43909241305351,0],[-71.5467593275225,-16.43908380883062,0],[-71.54670658980697,-16.43908375578073,0],[-71.54665473333934,-16.43906659015006,0],[-71.5465768903636,-16.43904082235955,0],[-71.54649811894593,-16.4390321705809,0],[-71.5464633340278,-16.43902356285567,0],[-71.54643692136924,-16.43902353414512,0],[-71.54638364017497,-16.43902355481284,0],[-71.54634712063732,-16.43903224177232,0],[-71.5462827418356,-16.43905813364751,0],[-71.54618203019751,-16.43909264843321,0],[-71.54614563525558,-16.43910129949359,0],[-71.54610066344429,-16.43910142863551,0],[-71.54605571100016,-16.43910155771791,0],[-71.54601976285782,-16.43910166109676,0],[-71.54596586452251,-16.43910181573214,0],[-71.5459123672424,-16.4390934339573,0],[-71.54589441447798,-16.4390934860954,0],[-71.54581511419917,-16.4390595728691,0],[-71.54577133269922,-16.43903408543764,0],[-71.54568429140005,-16.43895754332014,0],[-71.54563122650438,-16.43891518439454,0],[-71.54560471564562,-16.43888976286951,0],[-71.54559592019943,-16.43887280372378,0],[-71.5455606546938,-16.4388219360362,0],[-71.54556077834681,-16.43879647532551,0],[-71.54554322651379,-16.43875406354328,0],[-71.54550795551339,-16.4387031869568,0],[-71.54547264301786,-16.43866079795632,0],[-71.54544616824177,-16.43862688258847,0],[-71.54541969248304,-16.43859296698578,0],[-71.54535782393576,-16.43853364077967,0],[-71.54532247086827,-16.43849974026785,0],[-71.54527831678482,-16.43844887263166,0],[-71.545251838907,-16.43841495378752,0],[-71.54520772004022,-16.43835558994089,0],[-71.54519891777878,-16.43833861972609,0],[-71.54514585002738,-16.43829626250722,0],[-71.54511074145518,-16.4382706998598,0],[-71.54506678553008,-16.43824513341456,0],[-71.54502275094436,-16.43821960442351,0],[-71.54496887509286,-16.43822011779228,0],[-71.54493284674386,-16.43822901452873,0],[-71.54488774209568,-16.43824654147658,0],[-71.54481567583714,-16.43827284644664,0],[-71.5447527686524,-16.43829049981798,0],[-71.54470795874353,-16.43830787617593,0],[-71.54467214503315,-16.43832514241673,0],[-71.54463634910407,-16.43834240005487,0],[-71.5445469684614,-16.43837703935216,0],[-71.5445291006078,-16.43838565487578,0],[-71.54451118286238,-16.43841119357674,0],[-71.54446652556364,-16.43842850309435,0],[-71.5444127576373,-16.43845446890159,0],[-71.54437699392656,-16.4384632957181,0],[-71.54434124809778,-16.43847212041924,0],[-71.54429640844013,-16.43847274041062,0],[-71.544251566907,-16.43848181752821,0],[-71.54419782929192,-16.43849100651243,0],[-71.54412634392335,-16.43849198121803,0],[-71.54410849035042,-16.43849222473186,0],[-71.54406401474188,-16.43846751433221,0],[-71.54401058799147,-16.43845982356703,0],[-71.54394832832544,-16.43845226721061,0],[-71.54387723578861,-16.43845327058643,0],[-71.54384176840799,-16.4384453516315,0],[-71.54379749742674,-16.43842914858504,0],[-71.54374441186208,-16.43841308981986,0],[-71.54370022862501,-16.4383969175671,0],[-71.54366489208306,-16.43838903426116,0],[-71.54362964325095,-16.43838944826124,0],[-71.54356812266708,-16.43837330234861,0],[-71.54352417463087,-16.43837377486718,0],[-71.5434978209959,-16.4383740582347,0],[-71.54346275040542,-16.43835764883839,0],[-71.54342769610368,-16.43834124707757,0],[-71.54341022265544,-16.4383162642239,0],[-71.54340158996979,-16.43828271605409,0],[-71.54340188324412,-16.43824043470962,0],[-71.54336707264703,-16.43819855526398,0],[-71.5433408667751,-16.43818195486668,0],[-71.54327965185541,-16.43815733513683,0],[-71.54326222465875,-16.43814063226111,0],[-71.54322737086268,-16.43810722656595,0],[-71.54319238510648,-16.43809921997253,0],[-71.54314862284053,-16.43809979388971,0],[-71.54310489221393,-16.43810036701012,0],[-71.5430174930165,-16.43810996372832,0],[-71.54293893329512,-16.43813616430857,0],[-71.5428953625563,-16.43815337727071,0],[-71.54285180148241,-16.43817901173401,0],[-71.54282564135744,-16.43821292500366,0],[-71.54279084839445,-16.43823002827304,0],[-71.54278214585271,-16.43823851352153,0],[-71.54274739446463,-16.43824718269879,0],[-71.54268662674725,-16.43825603301124,0],[-71.54266058551937,-16.43827304463681,0],[-71.5426085491336,-16.43829861053662,0],[-71.54257388277306,-16.43833230895098,0],[-71.54256521774397,-16.43836581506396,0],[-71.54258253334656,-16.43840750056872,0],[-71.54261717166877,-16.43843235687528,0],[-71.54267779799913,-16.43847377186707,0],[-71.54270379151649,-16.43848197318704,0],[-71.54275576654088,-16.43852345006104,0],[-71.54276442809423,-16.43853175584636,0],[-71.54279041316235,-16.43855667347106,0],[-71.5428250939521,-16.43856483512964,0],[-71.54285977112724,-16.43858135439697,0],[-71.54289444037227,-16.43860623122534,0],[-71.54292906612186,-16.43865616925318,0],[-71.54296366947767,-16.4387144486363,0],[-71.54298094989913,-16.43876439173312,0],[-71.54298953974862,-16.43881437825587,0],[-71.54298946769924,-16.43884774204176,0],[-71.5429980532183,-16.43889769886374,0],[-71.54299794270383,-16.43894770353628,0],[-71.54299787145543,-16.43898102298035,0],[-71.54299787937762,-16.4390225078351,0],[-71.54299791326576,-16.43907225769674,0],[-71.54299793593034,-16.43910542863096,0],[-71.54299796439894,-16.43914689736688,0],[-71.54298930585615,-16.43918840757671,0],[-71.54297195700627,-16.43922165585365,0],[-71.54296329406523,-16.43925486702448,0],[-71.54295463655852,-16.43929637254534,0],[-71.5429372973825,-16.43933790321437,0],[-71.54291996549085,-16.43938772301952,0],[-71.54289396729186,-16.43945414583306,0],[-71.54288530371839,-16.43947904887297,0],[-71.54285063308508,-16.43952887417639,0],[-71.54278997982213,-16.43957870382684,0],[-71.54273802686542,-16.43960361912912,0],[-71.54266017019695,-16.43962852933309,0],[-71.54256513785529,-16.43967825303619,0],[-71.54242714570344,-16.43974443893441,0],[-71.54227215465423,-16.43981050861549,0],[-71.54212557747543,-16.43987665555616,0],[-71.54198752522599,-16.43995938129398,0],[-71.54195302547988,-16.4399676555422,0],[-71.54191845344663,-16.44000903872571,0],[-71.54187526729443,-16.44004215290554,0],[-71.54180622048628,-16.44006699169703,0],[-71.5417717253614,-16.44006699017011,0],[-71.54173720764452,-16.44007527015867,0],[-71.54165089262268,-16.44010011373188,0],[-71.5415904929729,-16.44010839432638,0],[-71.54157316179804,-16.44013324603021,0],[-71.54154722937935,-16.44014981544908,0],[-71.54150398280535,-16.44018296015295,0],[-71.54147807175997,-16.44019124666524,0],[-71.54144353195603,-16.44019953352961,0],[-71.54140036243058,-16.44020782048258,0],[-71.54135712446335,-16.44023268723912,0],[-71.54131384564573,-16.44026584982398,0],[-71.54126189113403,-16.44030731332582,0],[-71.54124448594347,-16.44034049321496,0],[-71.54121855455908,-16.44034878834252,0],[-71.54118359724029,-16.44039867805704,0],[-71.54116617599117,-16.44041531831801,0],[-71.54113988199227,-16.44045693524536,0],[-71.54108765321834,-16.44049857389173,0],[-71.54104401334826,-16.4405319603994,0],[-71.54100924825465,-16.44054035372395,0],[-71.54095691957279,-16.44056547445621,0],[-71.54088686498353,-16.44060741511343,0],[-71.54075506795796,-16.4406665806534,0],[-71.54072859700406,-16.44068345535357,0],[-71.5406669942104,-16.44070889257834,0],[-71.54060532859076,-16.44073435548857,0],[-71.54054454929039,-16.44074270987415,0],[-71.54048378781593,-16.44075105336181,0],[-71.54041435035165,-16.44075939688353,0],[-71.54033623620931,-16.44076774048061,0],[-71.54027546384467,-16.44077608524317,0],[-71.54018860312425,-16.44077614055536,0],[-71.54014506361477,-16.44077621528832,0],[-71.54009280821494,-16.4407763051233,0],[-71.54004054337392,-16.44077639491066,0],[-71.53999698281172,-16.44077646976376,0],[-71.53996220105601,-16.44076817844631,0],[-71.53991876718185,-16.44076819726233,0],[-71.5398840601156,-16.44076819581704,0],[-71.53984078827293,-16.44074318566132,0],[-71.539806158563,-16.44072651305417,0],[-71.53977156871773,-16.44070150667366,0],[-71.53970231904154,-16.4406681671015,0],[-71.53968500791657,-16.44065983277753,0],[-71.53964175180384,-16.44063483146813,0],[-71.53959849948954,-16.44060983211706,0],[-71.53954665914418,-16.44056817196078,0],[-71.53949506974371,-16.44051813372592,0],[-71.5394434664008,-16.4404847507431,0],[-71.53938333886474,-16.4404347149923,0],[-71.53933176734776,-16.44040135400809,0],[-71.53927158898283,-16.44036799249314,0],[-71.53920281014474,-16.44033463176121,0],[-71.53912557798796,-16.44027631968707,0],[-71.53903976701277,-16.44021802558436,0],[-71.53897972818076,-16.44017640475726,0],[-71.5388939857618,-16.44011815736839,0],[-71.53885991131175,-16.4400599703624,0],[-71.53884290336285,-16.44002673003321,0],[-71.53882594872994,-16.43998518935124,0],[-71.53882610090083,-16.43996027374648,0],[-71.5388091503724,-16.43991874490703,0],[-71.53878360219198,-16.43987722138825,0],[-71.53877525871263,-16.43983571147212,0],[-71.53877546441856,-16.43980250983824,0],[-71.53877572167033,-16.43976101304281,0],[-71.53877608154995,-16.43970292697493,0],[-71.53877647342101,-16.43965314854979,0],[-71.5387854789443,-16.43961997107736,0],[-71.53878645197824,-16.43956193723767,0],[-71.53878814087201,-16.43947081163122,0],[-71.53878921484994,-16.43941286480966,0],[-71.53879831477022,-16.43938804099217,0],[-71.53884211842428,-16.43935495401203,0],[-71.53890347907628,-16.43930534329322,0],[-71.53899934630914,-16.43925575848121,0],[-71.53911215042852,-16.43922271832378,0],[-71.53923354879625,-16.43918968916011,0],[-71.53933725539743,-16.439181437842,0],[-71.53943219536812,-16.43918144307279,0],[-71.53952713546681,-16.43918144834159,0],[-71.53959647688802,-16.43918150364278,0],[-71.53967451439961,-16.439181573653,0],[-71.53975246081967,-16.43918163075164,0],[-71.53979560074646,-16.43918163301842,0],[-71.53984736906945,-16.4391816355246,0],[-71.53989913702314,-16.43918163828883,0],[-71.53999404477348,-16.43918164329265,0],[-71.5400286944411,-16.4391651235027,0],[-71.54002924471702,-16.43909905556034,0],[-71.5400294509921,-16.4390742872597,0],[-71.54002979470947,-16.43903301598583,0],[-71.54000433994936,-16.43898350389553,0],[-71.53996158092345,-16.43894225482825,0],[-71.53993600218517,-16.43890926385663,0],[-71.53991057274419,-16.43885979167446,0],[-71.53990224220652,-16.43882681958298,0],[-71.53988536892899,-16.43878561409209,0],[-71.5398855865646,-16.43876089684924,0],[-71.53986857350185,-16.43873618231641,0],[-71.53986047052092,-16.43867853279031,0],[-71.53985215068242,-16.43864559991949,0],[-71.53984413893008,-16.43855498344638,0],[-71.53984432343007,-16.43851376908951,0],[-71.53984447107585,-16.43848080140778,0],[-71.53984472940536,-16.43842311621636,0],[-71.5398449138383,-16.43838191949889,0],[-71.53984509828759,-16.43834072813066,0],[-71.53988805947925,-16.43831592145949,0],[-71.53993101339148,-16.43829110751499,0],[-71.5399738746973,-16.43827449649274,0],[-71.54001674262167,-16.43824962567356,0],[-71.54008534312867,-16.43821643212939,0],[-71.54010249696206,-16.43818335582641,0],[-71.54014466731279,-16.43812496785071,0],[-71.54016143733793,-16.43809161263298,0],[-71.54016124497308,-16.43806669071086,0],[-71.54016092424854,-16.4380251444019,0],[-71.54016060341378,-16.43798358710432,0],[-71.54014305215686,-16.43791722141232,0],[-71.54011730483927,-16.43789249970365,0],[-71.54005723677209,-16.4378348246309,0],[-71.54003156492844,-16.43781842718971,0],[-71.53999738717955,-16.43780211110854,0],[-71.53992260597327,-16.43774226047244,0],[-71.53986776892745,-16.43770137426008,0],[-71.53981297087452,-16.43766051616548,0],[-71.5397309499074,-16.43759251357679,0],[-71.53971711226998,-16.43759246820465,0],[-71.53966220351046,-16.4375652188012,0],[-71.53960754505152,-16.43752445954427,0],[-71.53955292469882,-16.43748372853085,0],[-71.53951215076107,-16.43744306367598,0],[-71.53947162404997,-16.43738891602278,0],[-71.53941733078229,-16.43733477343548,0],[-71.53939088106513,-16.4372672406773,0],[-71.53936399317973,-16.43722672168272,0],[-71.53931002582561,-16.43715921901605,0],[-71.53928270777206,-16.43710533595981,0],[-71.539282450423,-16.43705153426464,0],[-71.5393230061186,-16.43698433750794,0],[-71.53936365042672,-16.43693056016463,0],[-71.53941847700847,-16.43690368161875,0],[-71.53948647672917,-16.43691723713297,0],[-71.5395547868735,-16.43691731546771,0],[-71.53965051597498,-16.43691742537841,0],[-71.53978746548621,-16.43693108073172,0],[-71.53984236655577,-16.43694464751529,0],[-71.53993848498517,-16.43695828019665,0],[-71.53997974336315,-16.43697184758104,0],[-71.54004851404021,-16.43698546392194,0],[-71.54010368886635,-16.43702610666975,0],[-71.5401451843474,-16.43708026514854,0],[-71.54017292782841,-16.43713441126243,0],[-71.54022809669986,-16.43716159908808,0],[-71.54031052855493,-16.43717538165566,0],[-71.54044808939618,-16.43718935691839,0],[-71.54055833599894,-16.4372032673566,0],[-71.54069778438608,-16.43723066872014,0],[-71.54079580843977,-16.43723081801459,0],[-71.54085184811788,-16.43723090333597,0],[-71.5409359422796,-16.43723103128945,0],[-71.54102050773531,-16.43725825316423,0],[-71.54113357757072,-16.43729903514904,0],[-71.5412468414004,-16.43732620457308,0],[-71.54128919692509,-16.43732623122277,0],[-71.5413597974087,-16.43732627556501,0],[-71.54144453124799,-16.437326328733,0],[-71.5415575318631,-16.43732639957229,0],[-71.54165642822059,-16.43732646167818,0],[-71.54171281361906,-16.43731294089911,0],[-71.54176907933453,-16.43728585710398,0],[-71.54181084117921,-16.43724524573668,0],[-71.54183866761733,-16.43721816303995,0],[-71.5419089082478,-16.43720469798063,0],[-71.54197933923984,-16.43720479920738,0],[-71.54203570510946,-16.43720488038882,0],[-71.5421061891581,-16.43720498153564,0],[-71.5421767028931,-16.43720508286644,0],[-71.542233001478,-16.43719158015895,0],[-71.5423174347019,-16.43716451873298,0],[-71.54238768043659,-16.43712381965484,0],[-71.54245798443955,-16.43708308671971,0],[-71.54251396961104,-16.43701507113405,0],[-71.54252788897874,-16.43698783916166,0],[-71.54259843729359,-16.43696063700763,0],[-71.54265508026128,-16.43696067720057,0],[-71.54269736912724,-16.43693343392468,0],[-71.54279657829267,-16.43693349612489,0],[-71.5428815715745,-16.4369199024463,0],[-71.54296665260794,-16.43690629562923,0],[-71.54300918722795,-16.43690632525653,0],[-71.54308010594914,-16.43690637605425,0],[-71.54315106465282,-16.4369064265915,0],[-71.5432788907473,-16.43690651719779,0],[-71.54332152811037,-16.43690654756684,0],[-71.5433359960074,-16.43697490980441,0],[-71.54337884646446,-16.43702960995058,0],[-71.54343595460097,-16.43709797886317,0],[-71.54350740335946,-16.43720730927504,0],[-71.54353625961834,-16.43734376197288,0],[-71.54356488704187,-16.43741197641375,0],[-71.54360778839184,-16.43750744140119,0],[-71.54360790088197,-16.4375482807484,0],[-71.54363660393389,-16.43765721751058,0],[-71.54365094760263,-16.43771165540332,0],[-71.54366528532898,-16.43776607339966,0],[-71.54366538757469,-16.43780682790396,0],[-71.54367978384883,-16.43788835778685,0],[-71.5437084250604,-16.43799703383042,0],[-71.54373695559862,-16.43806497171373,0],[-71.54377960423248,-16.43813314468722,0],[-71.54383648515983,-16.43828305613839,0],[-71.54385068476348,-16.43832401967419,0],[-71.54392163082296,-16.43839290209654,0],[-71.5439358273984,-16.43840668574726,0],[-71.54403525421925,-16.43840784203836,0],[-71.54410635763715,-16.438408668948,0],[-71.54419177605612,-16.43839597299351,0],[-71.54424877317655,-16.43843745826921,0],[-71.544291544582,-16.43845155438565,0],[-71.5443628812411,-16.43843862171499,0],[-71.54446280800072,-16.43843929608446,0],[-71.54449137269614,-16.43843948920607,0],[-71.54457712571605,-16.4384127768405,0],[-71.54462003773114,-16.43838576280423,0],[-71.54469163523085,-16.43830429314312,0],[-71.54473465126102,-16.43824997641015,0],[-71.54473471320343,-16.43820903994731,0],[-71.54473483758895,-16.43812713715206,0],[-71.5447349199736,-16.43807251295067,0],[-71.54469202797837,-16.43801765314391,0],[-71.54462053212603,-16.43793533081049,0],[-71.54457764307045,-16.43788047414741,0],[-71.54452044207657,-16.43782555665075,0],[-71.54447756684081,-16.43775703542506,0],[-71.54443467184984,-16.43771585375074,0],[-71.54440609228635,-16.43766105585695,0],[-71.54440612186109,-16.43760635184442,0],[-71.54443477456485,-16.43755172286768,0],[-71.54449202894972,-16.43756559553349,0],[-71.54454927887139,-16.43760684732649,0],[-71.54459218272211,-16.43767542353579,0],[-71.54462078913812,-16.43771657811892,0],[-71.54466367115397,-16.43779882473082,0],[-71.54472091782915,-16.43785377612255,0],[-71.54474952251668,-16.4378949282086,0],[-71.54474950124796,-16.43790860100416,0],[-71.5446922937961,-16.43782629946261,0],[-71.54464939516261,-16.43775773205412,0],[-71.54463510076476,-16.43773031495295,0],[-71.54462085366026,-16.43766184554006,0],[-71.54462090185646,-16.43762078448571,0],[-71.54464961929602,-16.43757980966983,0],[-71.5447212808636,-16.43760744266368,0],[-71.54476425169047,-16.43764867910311,0],[-71.54482155292233,-16.43770366725769,0],[-71.54489318989553,-16.43777241187089,0],[-71.54496489848816,-16.43781378655176,0],[-71.54508287835581,-16.4379649169044,0],[-71.54512527337192,-16.43797881037039,0],[-71.54519566152796,-16.43797915545539,0],[-71.54525269697464,-16.43803420274655,0],[-71.54532428475981,-16.43806170465916,0],[-71.54541125686437,-16.43811634755631,0],[-71.54552605649928,-16.43814375866503,0],[-71.54561263349561,-16.43818474760358,0],[-71.54571344772904,-16.43822574438978,0],[-71.54584103667693,-16.43829494676066,0],[-71.54599607359465,-16.43835102895386,0],[-71.54612340175116,-16.43842057976903,0],[-71.54620829505667,-16.43846242783352,0],[-71.54625067384876,-16.43847652731129,0],[-71.54630714609421,-16.43849077708422,0],[-71.54637876797331,-16.43858722195203,0],[-71.54648000049994,-16.4386831228359,0],[-71.54656659596014,-16.43872409357515,0],[-71.54665332388159,-16.4387787005186,0],[-71.54672567266608,-16.43883328354857,0],[-71.54678334557569,-16.43886056658592,0],[-71.54686968364261,-16.43888784390961,0],[-71.54688416972822,-16.43890148012124,0],[-71.54694152122524,-16.43890148060193,0],[-71.54699887257198,-16.43890148117277,0],[-71.54707083705512,-16.43892874947043,0],[-71.54712831675197,-16.43894238176244,0],[-71.54718565881811,-16.43894238223033,0],[-71.54732876666007,-16.43891511848566,0],[-71.5473861149616,-16.43891511893939,0],[-71.54744346310854,-16.43891511938685,0],[-71.54752948532895,-16.43891511997886,0],[-71.54762966971204,-16.43890155918132,0],[-71.54770050747665,-16.43887499856649,0],[-71.54778553338687,-16.4388349063573,0],[-71.54782835844034,-16.4388489442368,0],[-71.54788540681997,-16.4388631613084,0],[-71.54794227845633,-16.43886386274228,0],[-71.54801361303414,-16.43887826725919,0],[-71.54807074807461,-16.43889250203194,0],[-71.54815623242911,-16.43889356985524,0],[-71.548256071179,-16.43889481707921,0],[-71.54831317378992,-16.43889553035687,0],[-71.548370314005,-16.43889624397899,0],[-71.54842794222904,-16.43893756880998,0],[-71.54845693564268,-16.43897859294571,0],[-71.54850018460026,-16.43903365234355,0],[-71.54852908114368,-16.43908861350794,0],[-71.54857237130715,-16.43915733283368,0],[-71.5486155698046,-16.43919863960151,0],[-71.548687484034,-16.43924008350745,0],[-71.54875943633681,-16.43929522536223,0],[-71.54887429145347,-16.43936503283643,0],[-71.54891732574364,-16.43937934470861,0],[-71.54901779517556,-16.43936676086936,0],[-71.54906088020829,-16.43935347689399,0],[-71.54911835321631,-16.43932655211188,0],[-71.54916151313097,-16.43928542960902,0],[-71.54923360666325,-16.43928512971768,0],[-71.5493056799559,-16.4392572186146,0],[-71.54934891551036,-16.43922943069482,0],[-71.54940655808433,-16.43918774427035,0],[-71.54947859859607,-16.43911833361441,0],[-71.5495362165014,-16.43906281906143,0],[-71.54959382165335,-16.4389797011391,0],[-71.5496370167414,-16.43889735782467,0],[-71.54965142273315,-16.43881509175593,0],[-71.54968023963015,-16.43877385465276,0],[-71.5497234872924,-16.43867769247702,0],[-71.54978116471074,-16.43859514815568,0],[-71.54983891004933,-16.43845762614325,0],[-71.54988223097784,-16.43837502935838,0],[-71.54992568963851,-16.43827918144066,0],[-71.54995479768688,-16.43810024773873,0],[-71.54995490051887,-16.43801753835161,0],[-71.54995502075424,-16.43792097611229,0],[-71.54995514130334,-16.43782434111031,0],[-71.54995522731633,-16.43775527113392,0],[-71.5499553305615,-16.43767233833881,0],[-71.54995540122056,-16.43758926406441,0],[-71.54995535784599,-16.43751975579222,0],[-71.54994080565471,-16.43739467006545,0],[-71.54994077251506,-16.43733910593493,0],[-71.54994073163066,-16.43726966758784,0],[-71.54994064962098,-16.43713084776399,0],[-71.54994061660862,-16.437075340762,0],[-71.549940583957,-16.43701984599215,0],[-71.54994053313472,-16.43688117679513,0],[-71.54994050105282,-16.43668711192168,0],[-71.5499405297918,-16.43659007353362,0],[-71.54994055883913,-16.43649301660796,0],[-71.54994059233886,-16.43638207203721,0],[-71.5499406127549,-16.43631271938745,0],[-71.54994064199819,-16.43621560983843,0],[-71.54994066267668,-16.43614623494768,0],[-71.54998406691956,-16.43602136579227,0],[-71.55002749975283,-16.43584094792087,0],[-71.55005645163828,-16.43574378531212,0],[-71.55007094401014,-16.43566048156814,0],[-71.55009978934055,-16.43548035717059,0],[-71.5501140917751,-16.43538371584858,0],[-71.5501284831691,-16.43531457547173,0],[-71.55014287034261,-16.43524545391648,0],[-71.5501428395617,-16.43520396104567,0],[-71.55015720143192,-16.43510721444551,0],[-71.55017161190027,-16.43507961614478,0],[-71.55022918612781,-16.4349139952802,0],[-71.55025798241104,-16.43485885470651,0],[-71.55025795733869,-16.43483123027987,0],[-71.55041631676671,-16.43464486713922,0],[-71.55044506169227,-16.43458907107656,0],[-71.55045941373953,-16.43454728083739,0],[-71.55048815644776,-16.43449154823261,0],[-71.55053137653474,-16.43438068125546,0],[-71.55056018735853,-16.43435289488318,0],[-71.55060339837912,-16.43428355124174,0],[-71.55066100478932,-16.43421416199079,0],[-71.5506898041359,-16.43420022046982,0],[-71.55074745840102,-16.43414481933437,0],[-71.55079071102335,-16.43411713224731,0],[-71.55084842314507,-16.43406186179379,0],[-71.55092046355108,-16.43403407401508,0],[-71.55099249667833,-16.4340062888066,0],[-71.55103574284429,-16.43397860544047,0],[-71.55110772601518,-16.43396459216929,0],[-71.55116531234043,-16.43395062995241,0],[-71.55125185278676,-16.4339506794014,0],[-71.55132422669065,-16.4339372375935,0],[-71.55139667239409,-16.43391001897388,0],[-71.55145466923611,-16.43388272653542,0],[-71.55149825477156,-16.43384158336805,0],[-71.5515273156374,-16.43378646210411,0],[-71.55157033818287,-16.43368929852454,0],[-71.55157028584411,-16.43366156704109,0],[-71.55161332181814,-16.43357829828875,0],[-71.55165634816704,-16.43349505082484,0],[-71.55168499726742,-16.43342570661497,0],[-71.55169927855786,-16.43337025536009,0],[-71.55172791992126,-16.43330093426426,0],[-71.55175652629947,-16.43321777558086,0],[-71.55177079848625,-16.43316235379282,0],[-71.55179939517784,-16.43307922502754,0],[-71.5518137208422,-16.43305151302491,0],[-71.55181354309937,-16.43296844669304,0],[-71.55181342469388,-16.43291307679405,0],[-71.5518563585125,-16.43281614349192,0],[-71.55192819637243,-16.43267781899328,0],[-71.55195699579404,-16.43260870472938,0],[-71.55195690067168,-16.43255338279047,0],[-71.55194232416007,-16.43248421887604,0],[-71.55191327106974,-16.43240122228563,0],[-71.5518408227274,-16.4322905546954,0],[-71.55182630476008,-16.43224907669798,0],[-71.5517683800499,-16.43216611064332,0],[-71.55175386855679,-16.43212464706309,0],[-71.55168150308026,-16.43202789360879,0],[-71.55166702122925,-16.43200025886653,0],[-71.55163795706807,-16.43187594583328,0],[-71.55163791602563,-16.43184832758087,0],[-71.55160892134997,-16.43176547311676,0],[-71.55159442637434,-16.43172405212446,0],[-71.55153651946762,-16.43159981651227,0],[-71.55152201167941,-16.43154461296349,0],[-71.55149291783796,-16.43140663777239,0],[-71.55146391790036,-16.43136527440633,0],[-71.5514202616156,-16.43125500232047,0],[-71.5514056986971,-16.43121366525448,0],[-71.55134757132885,-16.43107594385821,0],[-71.55131852297852,-16.43100711999014,0],[-71.55126050184415,-16.4308833051824,0],[-71.55123152726145,-16.43082830643827,0],[-71.55121691452861,-16.43075955329104,0],[-71.55121661929539,-16.43070462334405,0],[-71.55118750680586,-16.43063601011314,0],[-71.55110070432526,-16.43049882815961,0],[-71.55108606245952,-16.43044401336871,0],[-71.55099928969935,-16.43029332643633,0],[-71.55095582969577,-16.43019753068177,0],[-71.55094137284026,-16.43017016893563,0],[-71.55091219322871,-16.43006081871137,0],[-71.55088353876167,-16.42997836377057,0],[-71.5508692285589,-16.42990962695804,0],[-71.5508692286206,-16.42984091352657,0],[-71.5508549181106,-16.42978591702456,0],[-71.5508549141082,-16.42971720890534,0],[-71.55085483195964,-16.42964862893197,0],[-71.55084042384276,-16.42958005822445,0],[-71.55082601760988,-16.42951149701634,0],[-71.55081162909383,-16.42945665464646,0],[-71.55081153416127,-16.42937440199644,0],[-71.55079731192058,-16.4293192474676,0],[-71.55078314403617,-16.42925022582636,0],[-71.55072601723326,-16.4291673750458,0],[-71.5506688156322,-16.42911212637485,0],[-71.55064028698833,-16.4290705559693,0],[-71.5505975263407,-16.42901492738872,0],[-71.55058347690337,-16.42895911765636,0],[-71.55054097841524,-16.42884747752833,0],[-71.54964105118877,-16.42837371210044,0],[-71.5474038440226,-16.42808434088073,0],[-71.54751418973905,-16.42786210178163,0],[-71.54746003717261,-16.42780434325447,0],[-71.54747662881653,-16.42769278415723,0],[-71.5492400986443,-16.42799710143805,0],[-71.55135251049626,-16.42882491968768,0]]]},properties:{nombre:"bellavista",dias:"sabado"}},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-71.53286381657719,-16.43046304854088,0],[-71.53278978901163,-16.43044264420996,0],[-71.53266135335025,-16.43043571459128,0],[-71.53269064931021,-16.43040582909244,0],[-71.5332117482385,-16.42686781430119,0],[-71.53332183179243,-16.42689918270697,0],[-71.53345669773908,-16.42694696344523,0],[-71.53364928642843,-16.42693642275227,0],[-71.53380506040762,-16.42691545914488,0],[-71.53402796457658,-16.42664326177572,0],[-71.53476573875129,-16.42624090645333,0],[-71.5349151666145,-16.42610760589567,0],[-71.53491798380958,-16.4259044400829,0],[-71.53804050858687,-16.42766199414649,0],[-71.53844295191702,-16.42784174589716,0],[-71.53782936264064,-16.42850730977497,0],[-71.53774154454938,-16.42863981744536,0],[-71.53738112905623,-16.42900161719111,0],[-71.53719535524844,-16.42920015427288,0],[-71.53685350847276,-16.42949505181,0],[-71.53689025956879,-16.42976648391091,0],[-71.53702490503859,-16.42997213421018,0],[-71.53715306180459,-16.43016662404083,0],[-71.53730338702914,-16.43045131359931,0],[-71.53740286613922,-16.43054440279752,0],[-71.53752451355633,-16.43072769538861,0],[-71.53760221560803,-16.43086139450219,0],[-71.53768778661671,-16.43103465529964,0],[-71.53775901699588,-16.43115721817151,0],[-71.53787557598868,-16.43135777532154,0],[-71.53793385558669,-16.43145805378995,0],[-71.53797186053008,-16.43162755927644,0],[-71.53798171401625,-16.43182680112513,0],[-71.53812342731699,-16.43217485536472,0],[-71.5382192083654,-16.43231360116702,0],[-71.53827752618405,-16.43241394395578,0],[-71.53841436846123,-16.43254518943173,0],[-71.53853746203374,-16.43275698535068,0],[-71.5386166427878,-16.43291927249338,0],[-71.53870734811282,-16.43307533996296,0],[-71.53878509575489,-16.43320911210885,0],[-71.5389125500852,-16.43350656692189,0],[-71.53894494970633,-16.43356231317927,0],[-71.53906742250146,-16.43387728215848,0],[-71.53916045612422,-16.43419379202287,0],[-71.5391836739215,-16.43441636106991,0],[-71.53925672313062,-16.43480313918508,0],[-71.53942098689306,-16.4350074103044,0],[-71.53959411061996,-16.43538363118225,0],[-71.53974035791003,-16.4355830184612,0],[-71.53982768953517,-16.43578551284162,0],[-71.53995295124032,-16.43592267778204,0],[-71.54000287617505,-16.43608692655826,0],[-71.54009069833349,-16.43618578932846,0],[-71.53971616050009,-16.43648313436195,0],[-71.53943563474408,-16.43678766219416,0],[-71.53896534976035,-16.43676788038266,0],[-71.53868226262323,-16.43670270283779,0],[-71.53846622032137,-16.43667423447875,0],[-71.53827460179026,-16.43666175140931,0],[-71.5381111541905,-16.43661866610825,0],[-71.53799927174377,-16.4365320653767,0],[-71.53784726782122,-16.43648245400309,0],[-71.53768116743605,-16.43651484704708,0],[-71.5375770237988,-16.43646833805065,0],[-71.53741439420368,-16.43645406484992,0],[-71.5371738202704,-16.43657197053847,0],[-71.53680609948546,-16.43668550361858,0],[-71.53663364021982,-16.43673589686215,0],[-71.53646097198582,-16.43678635121553,0],[-71.53624227103496,-16.43689197100635,0],[-71.53586677245879,-16.43688969694629,0],[-71.53561815059523,-16.43675747164498,0],[-71.53547466788493,-16.43653746693667,0],[-71.53531131437323,-16.43655229601895,0],[-71.53502106936445,-16.43659166512556,0],[-71.53477792738177,-16.43660505416464,0],[-71.53460598041646,-16.43657936556178,0],[-71.53441939978208,-16.43650169494362,0],[-71.53433609866795,-16.43641246950586,0],[-71.53419995349988,-16.43623232912169,0],[-71.53389666645701,-16.43600830888021,0],[-71.533683139363,-16.43588481752568,0],[-71.53346037109681,-16.43569136116805,0],[-71.53325972661062,-16.43559040851777,0],[-71.53272910484846,-16.43524818189477,0],[-71.53237092558001,-16.43523107464191,0],[-71.53215956638131,-16.43519475713817,0],[-71.53199325655318,-16.43520900084822,0],[-71.53179818260108,-16.43528349666618,0],[-71.53160168661124,-16.43532873333985,0],[-71.53133745264535,-16.43539512259068,0],[-71.53146392754182,-16.4346536118559,0],[-71.53286381657719,-16.43046304854088,0]]]},properties:{nombre:`puerta verde
cerro salverry
fecia`,dias:"sabado"}},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-71.5506779175363,-16.41639438824104,0],[-71.55070297276235,-16.4164060223508,0],[-71.55073876443365,-16.41642022840124,0],[-71.55086660062773,-16.41649679470579,0],[-71.55141102580468,-16.41690659332342,0],[-71.55163927210701,-16.41708384110304,0],[-71.5515944633146,-16.41800339212459,0],[-71.5517020138004,-16.418297645254,0],[-71.55118538616262,-16.41884561051225,0],[-71.55152829270968,-16.41926502434167,0],[-71.55204121684615,-16.4198153925591,0],[-71.55259363727374,-16.42044509396245,0],[-71.55323643611216,-16.42127779310512,0],[-71.55329753646353,-16.42152411366867,0],[-71.55250455824545,-16.42195397069117,0],[-71.55178560678435,-16.42287992082213,0],[-71.5515929083256,-16.42336543833544,0],[-71.5509895700499,-16.42405597337546,0],[-71.55123557834311,-16.42551463421571,0],[-71.55094078415998,-16.42625806614386,0],[-71.550355539244,-16.42666042154454,0],[-71.54923589687557,-16.42545566198208,0],[-71.54904789879616,-16.42511238290109,0],[-71.54830662417446,-16.42470233881089,0],[-71.54733874757481,-16.42394787798916,0],[-71.54626121350618,-16.42321464979463,0],[-71.54465558644122,-16.42251827983131,0],[-71.5443810366899,-16.42220832898827,0],[-71.54253705524665,-16.42164622863719,0],[-71.54164534937871,-16.42140368293942,0],[-71.54159307248622,-16.42130767487268,0],[-71.54372110743206,-16.41938032895853,0],[-71.54467354224978,-16.41843685248629,0],[-71.54514764177199,-16.41806449012471,0],[-71.54607694262937,-16.41785613616361,0],[-71.54650230393969,-16.41800128759534,0],[-71.54862359081069,-16.4161862726861,0],[-71.54860079486023,-16.41603747700507,0],[-71.54876634200198,-16.4159270876946,0],[-71.54897243315476,-16.41590829105483,0],[-71.5494020136168,-16.41586829925717,0],[-71.54961799983666,-16.41585738297957,0],[-71.54996924969232,-16.41589040878541,0],[-71.5502987809174,-16.41605311748659,0],[-71.5506779175363,-16.41639438824104,0]]]},properties:{nombre:`parque industrial de arequipa
casa lao san jose`,dias:"sabado"}},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-71.54735660040177,-16.42814927442191,0],[-71.5462264303149,-16.42954489569122,0],[-71.54604336418485,-16.42963262978588,0],[-71.5448019444982,-16.43102164510717,0],[-71.5443562265325,-16.43085967596506,0],[-71.5436390450609,-16.43076768932582,0],[-71.54345582575588,-16.4308745778222,0],[-71.54237054720487,-16.43040378233941,0],[-71.54202386784962,-16.43016124814992,0],[-71.54162363007633,-16.42989777541601,0],[-71.5411263636756,-16.4299853669025,0],[-71.54072744978538,-16.43012322364718,0],[-71.54043937578248,-16.43009859757175,0],[-71.54019175108144,-16.42988877655117,0],[-71.53975909125886,-16.43010516737277,0],[-71.53947873573073,-16.42987489485638,0],[-71.53947273857162,-16.42956253799435,0],[-71.54085470243835,-16.42809555044277,0],[-71.54166052640527,-16.42824813225447,0],[-71.54184636055675,-16.42809051274249,0],[-71.54198832784748,-16.42775372238099,0],[-71.54212700614484,-16.42748897987876,0],[-71.5421711663365,-16.4273861793405,0],[-71.54204232493896,-16.42724703969624,0],[-71.54193835662618,-16.42715353023036,0],[-71.5419577129275,-16.42689296755253,0],[-71.54189400043225,-16.42673043874838,0],[-71.54133697454054,-16.42656085430575,0],[-71.54103654738233,-16.42678177259979,0],[-71.54080340763208,-16.42668038759195,0],[-71.540630023774,-16.42651184712522,0],[-71.54072956042921,-16.42607442603204,0],[-71.54076810277182,-16.42577762462911,0],[-71.54097433757718,-16.42543673292683,0],[-71.54087220389425,-16.4252698159627,0],[-71.5408206457826,-16.42519522099337,0],[-71.54080405283138,-16.42515843701026,0],[-71.54062558724148,-16.42485225409553,0],[-71.54089087572557,-16.42508276360278,0],[-71.54137893690609,-16.42512137299024,0],[-71.54155059650752,-16.42553354616071,0],[-71.54196762070939,-16.42568504182773,0],[-71.54232742817084,-16.42553060093524,0],[-71.54248394954556,-16.42553125553813,0],[-71.54264336856642,-16.42530778399138,0],[-71.54273059704931,-16.42504052710391,0],[-71.54273833382398,-16.42487505745995,0],[-71.54271263564267,-16.42463288238164,0],[-71.54270008022084,-16.42450177262769,0],[-71.54250675389129,-16.42448191653936,0],[-71.54221264390125,-16.42442742088135,0],[-71.54205479198417,-16.42421388588535,0],[-71.54192219491044,-16.42389577874499,0],[-71.5417727846646,-16.42373287634855,0],[-71.54170577147883,-16.42358247515159,0],[-71.54162653547243,-16.42349606294818,0],[-71.54133875630923,-16.42327706291232,0],[-71.54141796711086,-16.42317036929565,0],[-71.54162741742934,-16.42309132127279,0],[-71.5421051980762,-16.42335928667349,0],[-71.54226864285879,-16.42361518117962,0],[-71.54245928014754,-16.42388172660901,0],[-71.54275340392776,-16.42393110524637,0],[-71.54309581171127,-16.42395546462012,0],[-71.54339347210522,-16.42412651153511,0],[-71.54377781850114,-16.42438207355921,0],[-71.54395733047355,-16.42465337419997,0],[-71.54426140905787,-16.42517344487423,0],[-71.54458585686395,-16.42551872330584,0],[-71.54503312383804,-16.42587584138429,0],[-71.54570409024852,-16.426494134311,0],[-71.5461515864369,-16.42684059424552,0],[-71.54662523889165,-16.42719951616072,0],[-71.54698438413048,-16.42747002507777,0],[-71.54745334430018,-16.42783550423548,0],[-71.54735660040177,-16.42814927442191,0]]]},properties:{nombre:`cerro juli
velodromo`,dias:"sabado"}},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-71.52263605601406,-16.44351426650992,0],[-71.52248835198286,-16.44439846936275,0],[-71.52249324211643,-16.44519050699773,0],[-71.52209690530465,-16.44674121760038,0],[-71.52155239522338,-16.44795014829773,0],[-71.52078722619872,-16.44936151125081,0],[-71.52007869061616,-16.44853903384222,0],[-71.51913224281567,-16.44785366229858,0],[-71.51893584200971,-16.44770216413467,0],[-71.51798084025145,-16.44781218564512,0],[-71.51758498396467,-16.44805721959236,0],[-71.51731079611234,-16.4485330749247,0],[-71.51648576571677,-16.45002945050823,0],[-71.51609352931749,-16.45097796678482,0],[-71.51551426141987,-16.45113324186269,0],[-71.51499078510864,-16.45106613820602,0],[-71.5145884019155,-16.45084156849289,0],[-71.51457169785084,-16.45082480621324,0],[-71.51434078960833,-16.45040542492115,0],[-71.51373730345013,-16.45037196649017,0],[-71.51335411857292,-16.45035124091332,0],[-71.51245825747739,-16.45052219438784,0],[-71.51129445591704,-16.45064014370441,0],[-71.51129568595779,-16.45052563470074,0],[-71.51165509739737,-16.44950422199196,0],[-71.51272843464847,-16.4477164432903,0],[-71.51308188381753,-16.44778994116177,0],[-71.51310029242043,-16.44811090149709,0],[-71.51327424668742,-16.4478458271894,0],[-71.51387287729567,-16.44763659046176,0],[-71.51301793906057,-16.44735409268676,0],[-71.51297763432876,-16.44726452156459,0],[-71.51298521675425,-16.44717138993056,0],[-71.51326560392575,-16.44613255003581,0],[-71.51330670608645,-16.44595198435284,0],[-71.51244024195994,-16.44589437248993,0],[-71.5119360275838,-16.44573969089623,0],[-71.51165660499078,-16.44559417530503,0],[-71.51124870925865,-16.44550503969142,0],[-71.51084740176904,-16.44544736975831,0],[-71.51050246640891,-16.44544570633566,0],[-71.50987926916129,-16.44531470196397,0],[-71.50951106346089,-16.44512918311673,0],[-71.5090909304748,-16.44525651224711,0],[-71.50890483437773,-16.44546615790173,0],[-71.50877368637144,-16.44553973584388,0],[-71.5086736115301,-16.44566234143662,0],[-71.50831602417459,-16.44566285595803,0],[-71.50784775687008,-16.44554129166851,0],[-71.50789951764789,-16.44508806739131,0],[-71.50698726486681,-16.44477267728439,0],[-71.5066122962464,-16.44468497957854,0],[-71.50565432825627,-16.44479538570898,0],[-71.50506249094938,-16.44472909121847,0],[-71.50443653270034,-16.44464608957837,0],[-71.5035079581714,-16.44423032418137,0],[-71.50301135632147,-16.44387082589449,0],[-71.50464197702847,-16.44400392723268,0],[-71.50565544578606,-16.44383476101148,0],[-71.50667719456966,-16.44300177719131,0],[-71.5082977615306,-16.44274418852555,0],[-71.50946424300247,-16.44269891411722,0],[-71.51048215115571,-16.44253350152586,0],[-71.51118213433836,-16.44267526488947,0],[-71.51296656026791,-16.44264028898533,0],[-71.51421862044101,-16.44221607893656,0],[-71.5151438907475,-16.44225508861441,0],[-71.51548980731705,-16.44242646912075,0],[-71.51551079942215,-16.44280440543336,0],[-71.51610548759956,-16.44297166106891,0],[-71.5164101148115,-16.44249408081146,0],[-71.51663021802268,-16.44223400080563,0],[-71.5170430275038,-16.44208811283516,0],[-71.51760492780927,-16.44220277830335,0],[-71.51855097403852,-16.44204521391883,0],[-71.51849316941536,-16.44341782431309,0],[-71.51896532718114,-16.44324609314246,0],[-71.52046960823421,-16.44325097472439,0],[-71.52166458755056,-16.44337310729096,0],[-71.52263605601406,-16.44351426650992,0]]]},properties:{nombre:"3 de octubre simon bolivar",dias:"sabado"}},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-71.51541984968077,-16.45228160305072,0],[-71.51644381461696,-16.45328662457626,0],[-71.517943667488,-16.45331724023451,0],[-71.51880700921559,-16.45413806003111,0],[-71.52079721918942,-16.45527226553729,0],[-71.52182303553553,-16.45610689586276,0],[-71.52260026267037,-16.45706437158625,0],[-71.52383853469641,-16.45732931838082,0],[-71.5238565847846,-16.45800054152787,0],[-71.52496656440198,-16.45857917261235,0],[-71.52539294121445,-16.45915613451998,0],[-71.52594177872996,-16.46023647068304,0],[-71.52608375241664,-16.4607602752411,0],[-71.52710713108532,-16.46139721853702,0],[-71.52683085680857,-16.46233566161536,0],[-71.5251066227637,-16.46303871878778,0],[-71.52379531508946,-16.46297659089966,0],[-71.52279616830614,-16.46297527489568,0],[-71.52157418333407,-16.46302529313733,0],[-71.52094540015776,-16.46245845035152,0],[-71.52024888207599,-16.4622699587686,0],[-71.51957572737703,-16.46151456341287,0],[-71.51893028566442,-16.4611108299028,0],[-71.51816126005525,-16.46051369875319,0],[-71.51734214183834,-16.45999054146688,0],[-71.51722650620609,-16.4592906719928,0],[-71.51743348040503,-16.45878363156646,0],[-71.51734657428649,-16.45781105009614,0],[-71.51670998666874,-16.45855416554914,0],[-71.51538204199912,-16.45744025881839,0],[-71.51447685009462,-16.45647119697814,0],[-71.51319901397285,-16.45543268425037,0],[-71.51148392513002,-16.4545615028389,0],[-71.51131351649576,-16.45446768058894,0],[-71.50968401106603,-16.45322464876113,0],[-71.50946168132994,-16.45301223991777,0],[-71.50938942400678,-16.45287155843899,0],[-71.50936534213653,-16.45282467312773,0],[-71.50936316575464,-16.45189450743867,0],[-71.5108620972642,-16.45097623737713,0],[-71.51183555463967,-16.45050363345752,0],[-71.51228417243458,-16.45051339226336,0],[-71.51277817591709,-16.45082388236266,0],[-71.51285194023134,-16.45122027520183,0],[-71.51357185341853,-16.45170187932913,0],[-71.51371933303467,-16.45235552122319,0],[-71.51422662152837,-16.45377440063562,0],[-71.51475807751487,-16.45353929993182,0],[-71.51434477234923,-16.45265333463438,0],[-71.5142437828952,-16.4519736159893,0],[-71.5141157078227,-16.45112657902618,0],[-71.51459493878485,-16.45128079136489,0],[-71.51541984968077,-16.45228160305072,0]]]},properties:{nombre:"La campiña",dias:"sabado"}},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-71.5272903348107,-16.45344555620046,0],[-71.52467163566904,-16.45250601996408,0],[-71.52331613062367,-16.45236758889556,0],[-71.5221920814944,-16.45182197342809,0],[-71.52192300230901,-16.45120639423182,0],[-71.5219248407738,-16.45119857021209,0],[-71.5219321915625,-16.45116728480529,0],[-71.52192475687322,-16.45109137104735,0],[-71.52190998681273,-16.45104676021906,0],[-71.52190504418711,-16.45099624524255,0],[-71.5218792277847,-16.4508916378424,0],[-71.52186879623186,-16.45086458850524,0],[-71.52184187009804,-16.45080103266676,0],[-71.52180145125268,-16.45075887533821,0],[-71.52175731777864,-16.45073210771604,0],[-71.52072038290977,-16.44966721046102,0],[-71.52097456862451,-16.44897788647713,0],[-71.5211572598181,-16.44877334008037,0],[-71.52184815406268,-16.44760866654179,0],[-71.5220771667616,-16.44689259492955,0],[-71.52205941679075,-16.44682711654696,0],[-71.52241234748355,-16.44610885771061,0],[-71.52247533008301,-16.44581204867611,0],[-71.52252994309107,-16.44513390812007,0],[-71.52261985610876,-16.44438101911121,0],[-71.52269167292945,-16.44363701871848,0],[-71.52274139949779,-16.44346616244062,0],[-71.52321059704934,-16.4432910062557,0],[-71.5249520179505,-16.4424839091232,0],[-71.52538814156458,-16.44343789828105,0],[-71.52606410017084,-16.44376715968335,0],[-71.52721974550045,-16.44411447356149,0],[-71.52810457275685,-16.44435826669302,0],[-71.52882971438956,-16.44458485336264,0],[-71.52957516797241,-16.44499000817536,0],[-71.53038213327423,-16.44571009248406,0],[-71.53048087556822,-16.44608558838476,0],[-71.53064103902221,-16.44638555759162,0],[-71.5309703084019,-16.44685040079688,0],[-71.5311635667767,-16.44706330253006,0],[-71.53138324500264,-16.44744224844647,0],[-71.53182499277993,-16.44806755714027,0],[-71.5321524090695,-16.44850980227738,0],[-71.53241538593916,-16.44895326384235,0],[-71.53264099297675,-16.44927206152373,0],[-71.5327305840116,-16.44958490930907,0],[-71.53270731115077,-16.44998317981985,0],[-71.5321567882224,-16.45091137802493,0],[-71.5311567206169,-16.45247089988601,0],[-71.53048704994404,-16.45351651489018,0],[-71.52965947661097,-16.4546938097715,0],[-71.52897704822355,-16.45574626136651,0],[-71.52901015168348,-16.45575389880754,0],[-71.52905153510842,-16.45576344651264,0],[-71.52909739733957,-16.45582402647175,0],[-71.52910164796843,-16.45584167208025,0],[-71.52914885905535,-16.45579423467262,0],[-71.52923057640942,-16.45564634149718,0],[-71.52905163774156,-16.45521284354963,0],[-71.5290418061986,-16.45525241678606,0],[-71.52895702751374,-16.45524128566917,0],[-71.52891136255023,-16.45521408760118,0],[-71.52885741982458,-16.45518498656342,0],[-71.52870791257094,-16.45508383276907,0],[-71.52863316857092,-16.45503326196639,0],[-71.52856244154236,-16.45496692370541,0],[-71.52840817591779,-16.45484777998385,0],[-71.52835180415141,-16.45479301614549,0],[-71.52831011931183,-16.45475003254365,0],[-71.52829134979845,-16.4547206997425,0],[-71.52826632139939,-16.45468158608619,0],[-71.52823925672884,-16.45465033663896,0],[-71.52822251706493,-16.45461312831137,0],[-71.52821000001433,-16.45459356689646,0],[-71.5282017075729,-16.45459165634845,0],[-71.52816870380994,-16.45461740040341,0],[-71.52912960435528,-16.45600639740021,0],[-71.5272903348107,-16.45344555620046,0]]]},properties:{nombre:`lara tradicional
villa el olf
corredor el olf
4 de octubre
trabada por eddy 14/9 y con marko ahasta la mitad 
5 pedidos`,dias:"sabado"}},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-71.51852020312394,-16.44339321186209,0],[-71.51861942757608,-16.44196369681188,0],[-71.5195356707786,-16.44195762417523,0],[-71.5204299299404,-16.44029560131834,0],[-71.5203522629077,-16.43990175048607,0],[-71.52052269589781,-16.43942871298625,0],[-71.52060614058422,-16.4385722838491,0],[-71.5205719753244,-16.43815582092603,0],[-71.52098485262823,-16.43686333075037,0],[-71.52557036722253,-16.4378262497152,0],[-71.52745132469548,-16.43769873326797,0],[-71.52741736769308,-16.43738129178608,0],[-71.5282033158828,-16.43712025083704,0],[-71.52823825038037,-16.43691167253119,0],[-71.52818264145107,-16.4367974317425,0],[-71.52850101043603,-16.43613416906323,0],[-71.52843494860724,-16.43497473592758,0],[-71.52880620653183,-16.43390532361257,0],[-71.52842343256329,-16.43367005754833,0],[-71.52904694230423,-16.43004484845548,0],[-71.53278508786548,-16.43055340912812,0],[-71.5327751214985,-16.43072627412326,0],[-71.5305585193174,-16.43734982109905,0],[-71.52900673017429,-16.44117910214705,0],[-71.52888354708129,-16.44185367241498,0],[-71.52890140424411,-16.44268054933339,0],[-71.52901458994944,-16.44308206142343,0],[-71.52946351057284,-16.44370514606307,0],[-71.53013421913563,-16.44436528192716,0],[-71.53039453949634,-16.44504686420105,0],[-71.53040562255934,-16.44557663351655,0],[-71.5301438294407,-16.4455325615213,0],[-71.52961289389593,-16.44510301682467,0],[-71.52917977486955,-16.44464990939954,0],[-71.52869761593738,-16.44449707588997,0],[-71.52802556328251,-16.44430534471067,0],[-71.52766165856413,-16.44411342942955,0],[-71.5272248426349,-16.44399678430691,0],[-71.52622684727619,-16.443745655141,0],[-71.525967118207,-16.44364753399023,0],[-71.52576248402231,-16.4435707245269,0],[-71.52530429490707,-16.44343316599233,0],[-71.5249879152834,-16.44251310709493,0],[-71.52427440785472,-16.44274926180315,0],[-71.52322185369069,-16.44326365782154,0],[-71.52277407416013,-16.443443491743,0],[-71.521575076976,-16.44334358530861,0],[-71.52004523538635,-16.44325411835311,0],[-71.51935125252216,-16.44327562105362,0],[-71.51893368988131,-16.44323645558648,0],[-71.51852020312394,-16.44339321186209,0]]]},properties:{nombre:`Bartolome errera
tasauayo
13 de enero`,dias:"sabado"}},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-71.53180000433142,-16.44759778048942,0],[-71.53254205527936,-16.44716826058939,0],[-71.53369738111432,-16.44669007685286,0],[-71.53420823351087,-16.44623049847493,0],[-71.53461266475524,-16.44565768268829,0],[-71.53510419129377,-16.44573560082146,0],[-71.53559914187458,-16.44613061007828,0],[-71.53662487345449,-16.44670517719401,0],[-71.53731053951367,-16.44667271030991,0],[-71.5380436953829,-16.44665591553569,0],[-71.53877622133271,-16.44674534388487,0],[-71.53904186660603,-16.44683436147977,0],[-71.53930998346911,-16.44787926260742,0],[-71.54002934772197,-16.44801329702623,0],[-71.5401305322733,-16.44892548229474,0],[-71.54013467648501,-16.44964553138318,0],[-71.54035524259615,-16.45009609000432,0],[-71.54081218019822,-16.45021667893501,0],[-71.5411592029525,-16.45063793183173,0],[-71.54068789226122,-16.45108852378628,0],[-71.5407368301945,-16.45148010430577,0],[-71.54070651770107,-16.45200804858407,0],[-71.5407700358221,-16.45226330489824,0],[-71.54111703710149,-16.45242788839887,0],[-71.54143418138625,-16.45290830564056,0],[-71.54143589454748,-16.45357043618892,0],[-71.54142491726381,-16.45426291277781,0],[-71.54120664774528,-16.45466992841511,0],[-71.54113001431026,-16.45495655865126,0],[-71.54134148533674,-16.45560648754194,0],[-71.5412835045373,-16.45610635431982,0],[-71.54046649435287,-16.45648550784598,0],[-71.54020850912887,-16.45595424429708,0],[-71.54012786527154,-16.45565161561438,0],[-71.53978309861799,-16.45575783488288,0],[-71.53957924886129,-16.45606037354855,0],[-71.53983036496373,-16.45636087942364,0],[-71.54056540525787,-16.45662303990229,0],[-71.5409437390519,-16.45732538237326,0],[-71.54058917045181,-16.45816753593008,0],[-71.54072411661038,-16.45959941371612,0],[-71.54025785002693,-16.45993451439525,0],[-71.5397298608774,-16.45940748787566,0],[-71.53952007242876,-16.45852525059681,0],[-71.53943449202313,-16.4581229116413,0],[-71.53895130746767,-16.45813993689208,0],[-71.5385939446894,-16.45785713586223,0],[-71.53846783272321,-16.45727653870604,0],[-71.53790439558783,-16.45715583074115,0],[-71.53759245495718,-16.45659693993977,0],[-71.53661153660082,-16.45669447146968,0],[-71.53611154071918,-16.4566936417557,0],[-71.53554938665397,-16.45569513416553,0],[-71.53554935382428,-16.45555543015056,0],[-71.53554934496972,-16.45551551701498,0],[-71.53554932657957,-16.45543569377053,0],[-71.53548688229476,-16.45529597927293,0],[-71.53544525318412,-16.45517624661056,0],[-71.53540366226791,-16.45505658751939,0],[-71.53542447131191,-16.45501672188788,0],[-71.53554924245775,-16.4550765426435,0],[-71.53563245800001,-16.45507657974066,0],[-71.53575731240792,-16.45513649427842,0],[-71.53586136956696,-16.45517645279548,0],[-71.53584057925995,-16.45523630763266,0],[-71.53577815676513,-16.45525623002246,0],[-71.53571575554412,-16.455336016837,0],[-71.53563254117698,-16.45539583439082,0],[-71.53554932139625,-16.45541573910099,0],[-71.53548690750777,-16.45541570083821,0],[-71.5352373197124,-16.4556549890937,0],[-71.53486297796204,-16.45561476940061,0],[-71.53438491371841,-16.45573391862149,0],[-71.53419792453049,-16.45547460980637,0],[-71.53417686388744,-16.45469747802399,0],[-71.53409390617597,-16.45437838461738,0],[-71.53374079088186,-16.4546573603978,0],[-71.53372027550583,-16.45503583094908,0],[-71.53363727002753,-16.45537447046063,0],[-71.5332850198441,-16.45537376263532,0],[-71.53318909613623,-16.45531362626177,0],[-71.53295610676861,-16.45510629156947,0],[-71.53276374345452,-16.45477517768697,0],[-71.5324700310718,-16.45495965148269,0],[-71.53221827082366,-16.45514822423658,0],[-71.53196258735147,-16.45540143472851,0],[-71.53193193659966,-16.45559866118113,0],[-71.5318657517182,-16.45585108254846,0],[-71.53136092854233,-16.45589634193346,0],[-71.53126599925038,-16.45579356094726,0],[-71.53105129947913,-16.45532583916219,0],[-71.53071826379832,-16.45532436834267,0],[-71.53059623339423,-16.45543538020361,0],[-71.53052585769271,-16.45621941076907,0],[-71.52919184896037,-16.45599476356079,0],[-71.52949019047055,-16.45497798520614,0],[-71.53000787669616,-16.45422941780289,0],[-71.5309959439868,-16.45269784183892,0],[-71.5323337031999,-16.45062427724386,0],[-71.53270976025836,-16.45000487577777,0],[-71.53268963419919,-16.44933252943784,0],[-71.53234074034192,-16.4488731780365,0],[-71.53168635358021,-16.44779958042205,0],[-71.53180000433142,-16.44759778048942,0]]]},properties:{nombre:`Bellapampa
Lara
Ciudad mi trabajo

trabajadada el mismo dia por edward 15/9 no se vendio.

el dia siguinte trabajamos junto con robert y se vendio como 140`,dias:"sabado"}},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-71.53207430299368,-16.43545989676206,0],[-71.53274546696434,-16.43557849695619,0],[-71.53281033372858,-16.43611997146069,0],[-71.53278850648545,-16.43664129389566,0],[-71.53313521770502,-16.43692938926544,0],[-71.53348226999056,-16.4372177657709,0],[-71.53402535786518,-16.43754637080337,0],[-71.53443870717054,-16.43752263169163,0],[-71.53474292069639,-16.43791729008,0],[-71.53500521726805,-16.43841425787598,0],[-71.53544307367747,-16.43884798530812,0],[-71.53577220038815,-16.43919993478909,0],[-71.53562466509896,-16.4400944479479,0],[-71.53551509026182,-16.44034561674363,0],[-71.53569194747125,-16.44088801231833,0],[-71.53569419033708,-16.44124295093406,0],[-71.53530035394685,-16.44166167828704,0],[-71.53508100000404,-16.44228920367349,0],[-71.53508220592151,-16.4426449023534,0],[-71.53545551632472,-16.44256156501254,0],[-71.5357423514807,-16.44306486626532,0],[-71.53589612631758,-16.44337947955202,0],[-71.53615967521208,-16.44329603330846,0],[-71.53695342694924,-16.44344470251147,0],[-71.53669587684016,-16.44460249668589,0],[-71.53650091683411,-16.44496144847415,0],[-71.53656922918547,-16.44561556594253,0],[-71.53608618824867,-16.44626771297386,0],[-71.53557709268347,-16.4459468646943,0],[-71.53511361470402,-16.44573243118893,0],[-71.5346268363075,-16.44559853189812,0],[-71.53430183418159,-16.44616923153864,0],[-71.53379886854749,-16.4466094090012,0],[-71.53316438786955,-16.44685866143144,0],[-71.53277085071568,-16.44704528909205,0],[-71.53218112639624,-16.44739894459143,0],[-71.53187487891879,-16.44778289526611,0],[-71.53169996426128,-16.44790892501533,0],[-71.53150379559055,-16.44767434875649,0],[-71.53100466320072,-16.44680358057845,0],[-71.53083324277688,-16.44637734069592,0],[-71.5304853087842,-16.44589745200583,0],[-71.53048755879954,-16.44543453590482,0],[-71.53040514753357,-16.4445539060055,0],[-71.5298890913998,-16.44394809812442,0],[-71.52941688291519,-16.44340691489238,0],[-71.52905358879686,-16.44305346383903,0],[-71.52901374648782,-16.44251491389851,0],[-71.5292969802613,-16.4410478166314,0],[-71.52968308482647,-16.43991026954647,0],[-71.5309089705922,-16.43624081789486,0],[-71.53127492070391,-16.43567500161401,0],[-71.53207430299368,-16.43545989676206,0]]]},properties:{nombre:"San Martin de socabaya",dias:"sabado"}},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-71.50101085495209,-16.41433812715588,0],[-71.50106859610099,-16.41293997203916,0],[-71.50118965020718,-16.40952907265299,0],[-71.50105565549066,-16.40941236074885,0],[-71.50121495208488,-16.40801605384472,0],[-71.50164457470048,-16.4082745199903,0],[-71.50220547983056,-16.40854554973023,0],[-71.50356189920325,-16.40931537686943,0],[-71.50530461128331,-16.41018316989659,0],[-71.50556905136484,-16.4103063536547,0],[-71.50629940092689,-16.41067501269277,0],[-71.50713618476645,-16.41079738987111,0],[-71.50823376187086,-16.41089724957949,0],[-71.50957130695002,-16.41080325348046,0],[-71.51144686983974,-16.41076632172653,0],[-71.51190731731565,-16.41061950032087,0],[-71.51318235026599,-16.41075785319572,0],[-71.51270038770589,-16.41183169888006,0],[-71.51189538977447,-16.41276851781341,0],[-71.51008275974223,-16.41394133906389,0],[-71.50616330003152,-16.41383169227551,0],[-71.50617175986943,-16.41454730070427,0],[-71.50215171796779,-16.41445009275403,0],[-71.50101085495209,-16.41433812715588,0]]]},properties:{dias:"sabado"}},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-71.49366420640135,-16.41685524459799,0],[-71.49408799548051,-16.41649119041241,0],[-71.49663324650628,-16.41682003080421,0],[-71.49677640945899,-16.41661243110663,0],[-71.50102038969358,-16.41675506158666,0],[-71.50108999550162,-16.41552837412955,0],[-71.5021232474989,-16.41552263883087,0],[-71.50217662840676,-16.41444494813871,0],[-71.50614295681628,-16.41456395334962,0],[-71.50621097372633,-16.41380974038019,0],[-71.5101045079399,-16.41399340854555,0],[-71.50568527637137,-16.41696909946611,0],[-71.49908915338702,-16.4212316888527,0],[-71.49363405486217,-16.41713947831301,0],[-71.49366420640135,-16.41685524459799,0]]]},properties:{dias:"sabado"}},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-71.50479230224015,-16.42566566193263,0],[-71.5038417837103,-16.42501236049633,0],[-71.502845118609,-16.42388897933571,0],[-71.50229414130526,-16.42353461867936,0],[-71.50085073686691,-16.42258025993953,0],[-71.49958261815586,-16.42170310592065,0],[-71.49917051948354,-16.42138927060819,0],[-71.49922600352205,-16.42126730247386,0],[-71.50522885259193,-16.41732648276869,0],[-71.51194503832619,-16.41274333932593,0],[-71.51263521753283,-16.41186228103292,0],[-71.5116998027774,-16.41407881184709,0],[-71.51055913275947,-16.41653358096765,0],[-71.50973847084126,-16.41825606601195,0],[-71.50856359063101,-16.42046453492042,0],[-71.50607746723422,-16.42429996998192,0],[-71.50479230224015,-16.42566566193263,0]]]},properties:{dias:"sabado"}},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-71.51208616429635,-16.41914043724913,0],[-71.51224058531801,-16.41927829619928,0],[-71.51311329081015,-16.41948825575136,0],[-71.51386467545703,-16.41985820429114,0],[-71.51411335476139,-16.41993385422189,0],[-71.51467789955109,-16.42012073663963,0],[-71.51544099124855,-16.42021654565784,0],[-71.51572443749744,-16.42028257114996,0],[-71.51604264713103,-16.42033897472502,0],[-71.51637556392342,-16.42031906860633,0],[-71.51645345258709,-16.42064064247522,0],[-71.51648888970433,-16.42088366723751,0],[-71.51652432751212,-16.42112669147969,0],[-71.51656210367959,-16.42131488961264,0],[-71.51656511779119,-16.42151270860884,0],[-71.5164839023179,-16.42180607632219,0],[-71.51654407503823,-16.42200613419818,0],[-71.51652001844035,-16.42230174025395,0],[-71.51644883337464,-16.42262844806257,0],[-71.51627569985178,-16.42292919236729,0],[-71.51617676673933,-16.42310104558223,0],[-71.51606546725985,-16.42329437988819,0],[-71.51593712618094,-16.42361884303223,0],[-71.51586292693187,-16.42374773170607,0],[-71.51563867163713,-16.42444185709548,0],[-71.51545619124771,-16.42496188851195,0],[-71.51515939901704,-16.42547743486748,0],[-71.51492210123125,-16.42594039742008,0],[-71.51471187384936,-16.42630557362421,0],[-71.5146005771411,-16.42649890186006,0],[-71.51431615255554,-16.42699296201615,0],[-71.51425432117226,-16.42710036625527,0],[-71.51400699574019,-16.42752998282687,0],[-71.51394516439622,-16.427637386893,0],[-71.51368547273795,-16.42808848376568,0],[-71.5135494437264,-16.42832477253913,0],[-71.51346287977822,-16.42847513812458,0],[-71.5131366822319,-16.42914328586667,0],[-71.51287231517789,-16.42970403057248,0],[-71.51254075968467,-16.4302291902421,0],[-71.51201699364385,-16.43042830038866,0],[-71.51114658876253,-16.43016349824083,0],[-71.50787359889883,-16.42904657809614,0],[-71.50715462899686,-16.42872181858889,0],[-71.50680634283071,-16.42856536816609,0],[-71.50631065104163,-16.42810659302661,0],[-71.5060984034951,-16.42771385827776,0],[-71.50585908218135,-16.42741890688521,0],[-71.50549308107047,-16.42714094742467,0],[-71.50518122826445,-16.42666742040826,0],[-71.50494591905931,-16.42601018774519,0],[-71.50506725082984,-16.42585020801045,0],[-71.50538946398989,-16.42554435528048,0],[-71.50579824400822,-16.42508814085493,0],[-71.50586241672181,-16.42492591639681,0],[-71.50609972589794,-16.42446296839239,0],[-71.50621102674722,-16.42426964566836,0],[-71.50632232727244,-16.42407632278197,0],[-71.50655963313628,-16.42361337304399,0],[-71.50657199976746,-16.42359189265668,0],[-71.50700015193446,-16.42294972353562,0],[-71.50708437863842,-16.42285418326448,0],[-71.50742128471497,-16.42247202085174,0],[-71.50763686465797,-16.42224984064179,0],[-71.50814388640738,-16.42136912918442,0],[-71.50816861910567,-16.42132616739597,0],[-71.50827991618281,-16.42113283902885,0],[-71.50851955336282,-16.42061505036421,0],[-71.5086061175451,-16.42046468232219,0],[-71.50885344361726,-16.42003505725703,0],[-71.50906834791354,-16.41956022262608,0],[-71.50929094126951,-16.4191735538716,0],[-71.50930330756948,-16.41915207218606,0],[-71.50955063367074,-16.41872243644356,0],[-71.5096990294627,-16.41846465307471,0],[-71.51001988100764,-16.41765346342897,0],[-71.51208616429635,-16.41914043724913,0]]]},properties:{dias:"sabado"}},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-71.51032114581263,-16.41742518600623,0],[-71.51018328062109,-16.41724106396596,0],[-71.51244110433717,-16.41238094935187,0],[-71.51251046715495,-16.41210411492574,0],[-71.5127530603106,-16.41183715609181,0],[-71.51264506129506,-16.41185042268025,0],[-71.51280183142804,-16.41150619812289,0],[-71.51325525992225,-16.41070434714503,0],[-71.51510131276608,-16.41082469299435,0],[-71.51826028910351,-16.41108395483948,0],[-71.52129490919094,-16.41147256438286,0],[-71.52020299755571,-16.41316996571861,0],[-71.52203635409897,-16.41432609424333,0],[-71.52164431924909,-16.41504548843749,0],[-71.52311113418439,-16.41596677788724,0],[-71.5229388035216,-16.41683106512896,0],[-71.5209102251356,-16.41605139396248,0],[-71.51976786801595,-16.41960772697495,0],[-71.51902956117199,-16.42076291434109,0],[-71.51032114581263,-16.41742518600623,0]]]},properties:{dias:"sabado"}},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-71.52434538848665,-16.42547033111829,0],[-71.52359889970403,-16.42919263348219,0],[-71.52297196073053,-16.43311971963232,0],[-71.5222131085373,-16.43540241670341,0],[-71.52109807216308,-16.4366481661046,0],[-71.52072523924724,-16.43755340947948,0],[-71.52038505765017,-16.43749346795854,0],[-71.52074773170283,-16.43641449351862,0],[-71.5204061736971,-16.43608318467236,0],[-71.52022622545927,-16.4364720306066,0],[-71.51983148552826,-16.43747655154759,0],[-71.51957208250745,-16.4373051073003,0],[-71.51911089304843,-16.43718485495887,0],[-71.518313838023,-16.43730953989355,0],[-71.51789452587661,-16.43656040597504,0],[-71.51778889775956,-16.43665210407361,0],[-71.51621495932969,-16.43661880636335,0],[-71.51606470906165,-16.43525310742766,0],[-71.51618749744028,-16.43501633069313,0],[-71.51612773589657,-16.43485485397467,0],[-71.51561940557144,-16.43498026005431,0],[-71.51539759619791,-16.43491261031868,0],[-71.51504987007684,-16.43425196747236,0],[-71.51408786060294,-16.43342807842225,0],[-71.51368521462149,-16.43363219010752,0],[-71.51339837003249,-16.43344537894901,0],[-71.5130424117866,-16.43358073567378,0],[-71.51125973395504,-16.43435581561266,0],[-71.51065433388851,-16.43330555069354,0],[-71.5105857530029,-16.43315222448617,0],[-71.51092046156863,-16.43269092815469,0],[-71.51159323329355,-16.43172774962938,0],[-71.5119246332301,-16.43122732665003,0],[-71.51250499867594,-16.43035442579481,0],[-71.51327102800445,-16.42899301577146,0],[-71.51367173703585,-16.42807152835319,0],[-71.51495848988117,-16.42572867516094,0],[-71.5157416689936,-16.4240510825986,0],[-71.51647304656137,-16.42241675095461,0],[-71.5166003898819,-16.42161648428149,0],[-71.51670394994503,-16.42037745792815,0],[-71.5191695619984,-16.42085795419576,0],[-71.52082075416959,-16.42126653971328,0],[-71.5207509073477,-16.42199618358356,0],[-71.52254949040073,-16.4223942102306,0],[-71.52492176886838,-16.42282070594962,0],[-71.52434538848665,-16.42547033111829,0]]]},properties:{dias:"sabado"}},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-71.52901393051908,-16.43000430695096,0],[-71.52870801859785,-16.43167757202004,0],[-71.52836975079869,-16.43367085841406,0],[-71.52886996420605,-16.43383088597019,0],[-71.52845068874537,-16.43494745698254,0],[-71.52846392305375,-16.43563572616443,0],[-71.52846569241494,-16.43613648392503,0],[-71.52825805363709,-16.43661322883419,0],[-71.52817920808467,-16.43680997869405,0],[-71.52823818503242,-16.43706677543423,0],[-71.52733656270642,-16.43727797071992,0],[-71.52741987937942,-16.43746712135536,0],[-71.52744267596746,-16.43765123819867,0],[-71.52550772635271,-16.43788430094313,0],[-71.52499972141877,-16.4377385405525,0],[-71.52108502315022,-16.43668817661424,0],[-71.52114797508084,-16.43653798343883,0],[-71.52154230092776,-16.43614503171852,0],[-71.5222169269155,-16.4354291865932,0],[-71.52246400871985,-16.43468065409171,0],[-71.52299638135817,-16.43314823043281,0],[-71.5234556910392,-16.43072378344308,0],[-71.5237100147395,-16.4291972814295,0],[-71.52901393051908,-16.43000430695096,0]]]},properties:{dias:"sabado"}},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-71.53334866161607,-16.42552033418915,0],[-71.52910654241106,-16.42545278521547,0],[-71.52437792559999,-16.42537644824194,0],[-71.52520201571137,-16.4220282311755,0],[-71.52492098117507,-16.42196827031429,0],[-71.52502384294328,-16.42133700496821,0],[-71.5254822705108,-16.4193188175844,0],[-71.52428902017294,-16.41900440077956,0],[-71.52465350587849,-16.4174942304428,0],[-71.52594974343069,-16.41771321495503,0],[-71.52614167494352,-16.41775957076333,0],[-71.52699211568417,-16.41613419662679,0],[-71.52733270052127,-16.41557589755394,0],[-71.5273510711982,-16.41410365614604,0],[-71.5275160531155,-16.4139780900094,0],[-71.52762653272477,-16.41395249583228,0],[-71.52774561648481,-16.41397751384342,0],[-71.53108935630479,-16.41603110896942,0],[-71.53293089839528,-16.41690583269257,0],[-71.53318524036753,-16.41703341462208,0],[-71.53472015442458,-16.41768885445211,0],[-71.53463969526875,-16.41836802159673,0],[-71.53426695128063,-16.41842634874683,0],[-71.53370778864725,-16.4179823497827,0],[-71.53311632492802,-16.41781649136873,0],[-71.53267590614065,-16.41859308148624,0],[-71.53226189133562,-16.41975899785056,0],[-71.53196026001477,-16.42034353789092,0],[-71.5320037180039,-16.42232755297695,0],[-71.5320002765725,-16.42286543210969,0],[-71.53219223319826,-16.42307617866175,0],[-71.53276785461419,-16.42336491020119,0],[-71.5332685700847,-16.42404120900683,0],[-71.53345414480852,-16.42423240170015,0],[-71.53351801060226,-16.42442795307899,0],[-71.53343093807811,-16.4247440158349,0],[-71.53348166787644,-16.42527636551106,0],[-71.53334866161607,-16.42552033418915,0]]]},properties:{dias:"sabado"}},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-71.52360487490888,-16.42918267944911,0],[-71.52413374933877,-16.42649329342289,0],[-71.52441841737222,-16.42547991452284,0],[-71.5245314439555,-16.42551826197879,0],[-71.5270400907194,-16.42555081830098,0],[-71.53314370236401,-16.42560596245928,0],[-71.53319293848878,-16.42668034126999,0],[-71.53304888050042,-16.42721715458564,0],[-71.53265984454822,-16.43050793753806,0],[-71.52901172172703,-16.43001280643374,0],[-71.52360487490888,-16.42918267944911,0]]]},properties:{nombre:136,dias:"sabado"}},{type:"Feature",properties:{nombre:"centro abajo",dias:"lunes"},geometry:{coordinates:[[[-71.5075500591557,-16.4222872773474],[-71.5136281813623,-16.410714683232],[-71.5167076164201,-16.4029477447487],[-71.5226024594706,-16.4069210904605],[-71.5271244333677,-16.4084693774152],[-71.5303460023599,-16.4093255882633],[-71.5329905478739,-16.4105795856603],[-71.53546817496,-16.4123995360849],[-71.536109804148,-16.4100881361516],[-71.5380080255825,-16.4084245790374],[-71.5399545020289,-16.4056927815055],[-71.540923634024,-16.4032904184133],[-71.5422552679468,-16.4017956186413],[-71.5422266206807,-16.3998619601179],[-71.547560247446,-16.3974746001033],[-71.5492485905306,-16.3937903456739],[-71.5507453520702,-16.3928606711673],[-71.5520222222781,-16.3916447943676],[-71.5584636039691,-16.393139079682],[-71.5592278662972,-16.4014157980919],[-71.5614333005563,-16.4105511714358],[-71.5500384595927,-16.4151523832674],[-71.5476700209763,-16.4159909009754],[-71.541443551026,-16.4201740617955],[-71.5400137175873,-16.4273701594804],[-71.5328117156202,-16.4303983161306],[-71.5236155027083,-16.4292718054372],[-71.5148089453609,-16.4258214356413],[-71.5075500591557,-16.4222872773474]]],type:"Polygon"},id:0},{type:"Feature",properties:{nombre:"Horacio Zevallos",dias:"lunes"},geometry:{coordinates:[[[-71.4934320858923,-16.461382464003],[-71.5077679898101,-16.4549653610269],[-71.5128885542667,-16.4710408566178],[-71.5095152011168,-16.4737990571343],[-71.5101451412027,-16.476359524253],[-71.5112852157842,-16.4808544131681],[-71.514799390965,-16.484395184714],[-71.5194776675443,-16.48520482945],[-71.5206849998911,-16.4848582346231],[-71.5215310907051,-16.4852269413448],[-71.5216248479837,-16.4859087692984],[-71.5214015186555,-16.4862445318021],[-71.5211891164025,-16.4869279842492],[-71.5230684209086,-16.4886742176511],[-71.5192243892302,-16.4904889549751],[-71.5166131124544,-16.4906594880348],[-71.5139197393502,-16.490428285388],[-71.5118538276169,-16.4903855508952],[-71.5111662102289,-16.4904486736194],[-71.5106460358715,-16.4905916952173],[-71.5082894223669,-16.4929384598904],[-71.5077475530093,-16.4936564726777],[-71.507211643642,-16.4957559477497],[-71.5069920298224,-16.4962583977686],[-71.5069881956711,-16.4967685082493],[-71.5069621204211,-16.4973198747919],[-71.5028576622526,-16.4976413501098],[-71.4978628839525,-16.4976930939811],[-71.4972266778392,-16.4955064349329],[-71.4962029576669,-16.4947200217533],[-71.4973591961723,-16.493805175939],[-71.4967765308352,-16.4939759352114],[-71.4985460525918,-16.4930618597371],[-71.4993691834683,-16.4930154562774],[-71.5008177744449,-16.4932788821878],[-71.50284644341,-16.4908258719474],[-71.5027929922959,-16.4905842326974],[-71.5004076716648,-16.4818344677326],[-71.4934320858923,-16.461382464003]]],type:"Polygon"},id:1},{type:"Feature",properties:{nombre:"La Aguada",dias:"lunes"},geometry:{coordinates:[[[-71.4999924973157,-16.4928816229666],[-71.4969797585619,-16.4930900773187],[-71.4955148340898,-16.4938346294289],[-71.494744840708,-16.4934601512879],[-71.4926768252998,-16.4939358056693],[-71.4911417756828,-16.4958028557037],[-71.4891100169333,-16.4952489291376],[-71.4863689978515,-16.493839376898],[-71.4853046039827,-16.4939802660221],[-71.4847217850438,-16.4938135081029],[-71.4827597837973,-16.4932379275273],[-71.4809713925592,-16.4900290203193],[-71.4809566276669,-16.4898317871601],[-71.4817003839146,-16.4869068512466],[-71.4803459399141,-16.4845980813019],[-71.4803361376323,-16.4844585860987],[-71.4818851465022,-16.4788696850063],[-71.4818079628686,-16.4785257465079],[-71.4827466863309,-16.4780517764948],[-71.4831647019006,-16.4779474252257],[-71.4834632753637,-16.4778474328764],[-71.4873910334746,-16.4746941338412],[-71.4873054352235,-16.4721928419963],[-71.4872439360861,-16.4719867564229],[-71.4884764037265,-16.4676027918199],[-71.4918267221992,-16.46658280159],[-71.494243451661,-16.4666520136214],[-71.4962861567888,-16.4704595471038],[-71.5030595089545,-16.4906607105968],[-71.5016111529356,-16.4919140568001],[-71.5010131638826,-16.4925630000742],[-71.4999924973157,-16.4928816229666]]],type:"Polygon"},id:2},{type:"Feature",properties:{nombre:"centro arriba",dias:"lunes"},geometry:{coordinates:[[[-71.5168821865389,-16.4029613069104],[-71.5175551642388,-16.4024997619594],[-71.51934132241439,-16.4011694930414],[-71.52112748059,-16.3998392241234],[-71.5240577168918,-16.3981905573576],[-71.5274606227087,-16.3955276388362],[-71.5271603762329,-16.3953228562477],[-71.5287744787615,-16.3936798947842],[-71.5288094889052,-16.3933564230175],[-71.5282113752077,-16.3925380139625],[-71.5281064943219,-16.3914906168218],[-71.5290642245307,-16.3876811143534],[-71.5327988681166,-16.3862807307361],[-71.5321764243367,-16.3831118730347],[-71.5322371896146,-16.3808493201048],[-71.5412044527899,-16.3685934721077],[-71.5433194257032,-16.3668367417671],[-71.5444896764493,-16.3670093145464],[-71.5495099947484,-16.3675882609641],[-71.5533058516171,-16.366897280589],[-71.554621967563,-16.3635454087173],[-71.5549399752303,-16.3608221242231],[-71.5559336676826,-16.3588429711463],[-71.5623495503509,-16.3601710676908],[-71.560036200194,-16.3706987783055],[-71.5574968790163,-16.3824117284204],[-71.5573416951301,-16.3835255536192],[-71.5600294171143,-16.3839248655343],[-71.560095089993,-16.383640925994],[-71.5624756356526,-16.384228536947],[-71.5624676596384,-16.38527375219],[-71.5626972091914,-16.3867771853057],[-71.5642213013487,-16.3877656619741],[-71.5647083133293,-16.3896765958644],[-71.5649015332423,-16.3918180494103],[-71.5628069985672,-16.3920451377249],[-71.5615005850086,-16.3919202742355],[-71.5613004544987,-16.3923453216681],[-71.5605023988906,-16.3923320906026],[-71.5599560708022,-16.393128140555],[-71.5596282189186,-16.3935817729705],[-71.5558381828532,-16.392507606761],[-71.5547442415461,-16.3922790920973],[-71.5517659973943,-16.3914000151348],[-71.5503299954641,-16.3928756746554],[-71.5490991980125,-16.3936626239119],[-71.547303928122,-16.3971059504862],[-71.5420693710805,-16.3997819758828],[-71.5424822333599,-16.4015134424455],[-71.5405863960114,-16.4033689326556],[-71.5398987019491,-16.4058218363447],[-71.5384010109847,-16.40801673589],[-71.5362805474762,-16.4100487360009],[-71.5353411394337,-16.4124041185499],[-71.5330194239198,-16.410450787852],[-71.5301262194913,-16.4091826998123],[-71.526740350019,-16.4083465004842],[-71.5226148574979,-16.4068942609753],[-71.5168821865389,-16.4029613069104]]],type:"Polygon"},id:3},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-71.51593941992446,-16.38408529786432,0],[-71.51516928095973,-16.38461565358373,0],[-71.51399774872361,-16.38540224359222,0],[-71.5120592081645,-16.38685842653833,0],[-71.51146117868436,-16.38629522185504,0],[-71.51087566022001,-16.38561124463442,0],[-71.51059899928698,-16.38552497692549,0],[-71.5098264361328,-16.38564592083278,0],[-71.50926144160786,-16.38566303983959,0],[-71.50897219184732,-16.38577296506362,0],[-71.50863382509036,-16.38570516119892,0],[-71.50732132478664,-16.38412997636484,0],[-71.50374490390492,-16.38237036872573,0],[-71.50347826357593,-16.38239330922993,0],[-71.50262999564727,-16.38281622717341,0],[-71.50254078473999,-16.38293652241806,0],[-71.50205195446053,-16.38325027488214,0],[-71.50137906250148,-16.3826518382385,0],[-71.5008303243506,-16.38270203012769,0],[-71.50056889268781,-16.38265208134356,0],[-71.50030826160162,-16.38227545183014,0],[-71.49944139842113,-16.38149944658471,0],[-71.49938793522868,-16.38084668763998,0],[-71.49865492380397,-16.37967271070339,0],[-71.49814808923684,-16.37929706092692,0],[-71.49773164220822,-16.37913210185301,0],[-71.49760818882257,-16.37904649039193,0],[-71.49758598460313,-16.37904913592375,0],[-71.49727376210123,-16.38048920527349,0],[-71.49664565066738,-16.38133670055726,0],[-71.49422212669181,-16.38077466820457,0],[-71.4942382642189,-16.38010171411679,0],[-71.4917654410736,-16.37969763109989,0],[-71.49198419486284,-16.38145465549575,0],[-71.48981521360231,-16.38150144958149,0],[-71.48975114389661,-16.3804895961087,0],[-71.48983941422102,-16.37986259436149,0],[-71.48879069558639,-16.37921823834756,0],[-71.48797910758287,-16.37701136409509,0],[-71.48869678337407,-16.37511995152955,0],[-71.4932746840045,-16.37577738991896,0],[-71.49249209319726,-16.3774737292422,0],[-71.49276514297253,-16.37767201398811,0],[-71.49342108836521,-16.37760711601355,0],[-71.4944225770085,-16.37624157298416,0],[-71.49710716669314,-16.37850291450624,0],[-71.49918539415863,-16.37876581676802,0],[-71.49996728427978,-16.37895895924156,0],[-71.4999488256274,-16.3792702474873,0],[-71.50057269312391,-16.37915728814223,0],[-71.50055046304266,-16.37861554003447,0],[-71.50124391195035,-16.37837454821513,0],[-71.50162529332701,-16.37886128230776,0],[-71.50171970186278,-16.37924570465373,0],[-71.50283342291871,-16.37919109536655,0],[-71.50348123591438,-16.37912341253816,0],[-71.503430553546,-16.37950987952262,0],[-71.50364332565523,-16.38082232005526,0],[-71.50388838629051,-16.38086252852243,0],[-71.50545588629817,-16.38060506333948,0],[-71.50546080765149,-16.38008200460081,0],[-71.5062942018575,-16.37925033829312,0],[-71.50695237553005,-16.37955919249125,0],[-71.50757454532024,-16.37900938494508,0],[-71.50795701470676,-16.37909061476885,0],[-71.50854076917368,-16.37849878573768,0],[-71.50906201137084,-16.37797125565194,0],[-71.50919156296385,-16.37787698083454,0],[-71.51058649059122,-16.37666290971376,0],[-71.51058222316841,-16.37643371809363,0],[-71.51124068908481,-16.37679551556243,0],[-71.5117664292793,-16.37743092154342,0],[-71.51170147246826,-16.37793274329206,0],[-71.51247560943939,-16.37885428922793,0],[-71.51285796153842,-16.3789889331935,0],[-71.51320966842972,-16.37905894943444,0],[-71.51378863553103,-16.37944290797783,0],[-71.51402067092512,-16.3801962441533,0],[-71.5137736420022,-16.38055363580535,0],[-71.51365531283821,-16.38085454040921,0],[-71.51373822815444,-16.38117864847872,0],[-71.51386232258409,-16.38152496361106,0],[-71.51418197822254,-16.38176759840393,0],[-71.51449420061294,-16.38222898409329,0],[-71.5145127206675,-16.38227651254501,0],[-71.51454405087985,-16.38232281611659,0],[-71.51510893932466,-16.38257648621655,0],[-71.51622123567905,-16.38386735326194,0],[-71.51593941992446,-16.38408529786432,0]]]},properties:{nombre:`Edificadores misti
Alto Juan XXIII
Prolongacion goyonece
Puente arnao
Galaxia`,dias:"martes"},id:0},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-71.52041381578896,-16.39514517259436,0],[-71.51963200703524,-16.39569585258477,0],[-71.51678476489377,-16.39264313461725,0],[-71.5177859016663,-16.39210153004746,0],[-71.51870388827665,-16.3910644090182,0],[-71.51829597721964,-16.39054118050031,0],[-71.51753525256984,-16.38962363292829,0],[-71.51660525624088,-16.38862206916927,0],[-71.51709398178248,-16.38827843412595,0],[-71.51779610167733,-16.38780560590926,0],[-71.51828894031371,-16.38761128780397,0],[-71.51940964408772,-16.38675629616108,0],[-71.51976746112906,-16.38629641327371,0],[-71.52037889012344,-16.38666245077926,0],[-71.52058287507192,-16.38739001755074,0],[-71.5213514622727,-16.3879678122251,0],[-71.52253568732793,-16.38825843283436,0],[-71.52343522830218,-16.38874320682582,0],[-71.52361347617439,-16.38884862621373,0],[-71.52440177461219,-16.38784741804095,0],[-71.52533342544383,-16.38850093698855,0],[-71.52678363389039,-16.38956850772255,0],[-71.52629353839968,-16.3904154876149,0],[-71.52495350871195,-16.39150113795819,0],[-71.5225688942308,-16.39334997885068,0],[-71.52041381578896,-16.39514517259436,0]]]},properties:{nombre:"Las palmeras, prohogar, Iglesia chapi chico",dias:"martes"}},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-71.52391162559567,-16.3980456863487,0],[-71.51650427752905,-16.4030551410105,0],[-71.51458213801152,-16.40181982768481,0],[-71.51409156766974,-16.40149387723493,0],[-71.51090543146802,-16.39880513250585,0],[-71.5063771591303,-16.39439782994115,0],[-71.5067677325075,-16.3942885771765,0],[-71.50721036569641,-16.3943214135162,0],[-71.5086513456635,-16.39533588898217,0],[-71.50919120490946,-16.39563300712043,0],[-71.5099439411798,-16.39601167188587,0],[-71.5122313784286,-16.39528264742848,0],[-71.51388628483477,-16.39411322535367,0],[-71.51418665946473,-16.39433243884925,0],[-71.5151194291158,-16.39378204959364,0],[-71.51673308682162,-16.39264627037823,0],[-71.51965068086332,-16.39574824977137,0],[-71.52032239513996,-16.39521760064662,0],[-71.52212653505619,-16.39661875943946,0],[-71.52391162559567,-16.3980456863487,0]]]},properties:{nombre:`Proreso
Villa militar`,dias:"martes"}},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-71.50753597460309,-16.37897169364228,0],[-71.50724273732762,-16.37913697800135,0],[-71.50695579131612,-16.37947044789796,0],[-71.5065212083518,-16.37925407120311,0],[-71.50615183825052,-16.37891575424862,0],[-71.50604236115768,-16.37871539342888,0],[-71.50476426475117,-16.37838998058803,0],[-71.5034207852025,-16.37759751441188,0],[-71.50312786591357,-16.37731341597858,0],[-71.50267141197344,-16.37700402402875,0],[-71.50218587654345,-16.37691056237388,0],[-71.50157000129248,-16.37680534354643,0],[-71.50071496989948,-16.37681566190868,0],[-71.49991776262921,-16.37808171256096,0],[-71.4979327518813,-16.37727038919293,0],[-71.4966011277069,-16.37663317229503,0],[-71.4961333831842,-16.37622227782828,0],[-71.49516581810947,-16.37630351035331,0],[-71.49465753457895,-16.37620802526271,0],[-71.4944847936988,-16.3763219069003,0],[-71.49320646533319,-16.37569510114855,0],[-71.49387751750184,-16.37382002300254,0],[-71.49411161206956,-16.3732598409799,0],[-71.49328180040172,-16.37330314038298,0],[-71.492799378768,-16.37278026017835,0],[-71.49071764306659,-16.370244634711,0],[-71.48993965025032,-16.36995836942558,0],[-71.48953308276512,-16.36961827540199,0],[-71.490357564283,-16.36914244896145,0],[-71.49346027269733,-16.36916066375221,0],[-71.49493776580837,-16.36933509258514,0],[-71.49591589984438,-16.36989024844639,0],[-71.49683307018026,-16.37138474423665,0],[-71.49719303618487,-16.37132587860275,0],[-71.4973636786267,-16.37139450480858,0],[-71.4975475095725,-16.37114029614169,0],[-71.4971241740054,-16.37064318325124,0],[-71.49681365313293,-16.3702120296799,0],[-71.4966760793719,-16.36975552804177,0],[-71.49681765176389,-16.3695080055507,0],[-71.49750264569255,-16.36997624965162,0],[-71.49761039069121,-16.37021499326574,0],[-71.4981668908391,-16.37061820650365,0],[-71.49863008689802,-16.37093325812679,0],[-71.49868743486809,-16.37084430623512,0],[-71.49866162441398,-16.37073075246543,0],[-71.49903441387713,-16.37028475728502,0],[-71.49962929945815,-16.37036145319494,0],[-71.50019589978788,-16.36995154620398,0],[-71.50069213688965,-16.37017693871493,0],[-71.50095956863925,-16.3703891568778,0],[-71.50125361978647,-16.37071556353642,0],[-71.5014895395979,-16.3708020080585,0],[-71.5022017582385,-16.37137586046523,0],[-71.5027999228573,-16.3715436672905,0],[-71.50397623511796,-16.37222350990372,0],[-71.50489086314579,-16.37287150093031,0],[-71.50653860946612,-16.37398741387348,0],[-71.5072265193584,-16.37445439908101,0],[-71.50810859608708,-16.37514317110092,0],[-71.5092816959049,-16.3758199043751,0],[-71.51053894350933,-16.37645418894331,0],[-71.51060516814043,-16.37664298588166,0],[-71.51023013035747,-16.37706779068332,0],[-71.50911526948656,-16.37789626361678,0],[-71.5079119229078,-16.37907614898506,0],[-71.50753597460309,-16.37897169364228,0]]]},properties:{nombre:`Miraflores
Estadio del porvenir
Mateo pumacaua`,dias:"martes"}},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-71.52398039928043,-16.39804214879857,0],[-71.52112652121687,-16.39579438570596,0],[-71.52099281739096,-16.39572829165789,0],[-71.52036578171122,-16.3952133805297,0],[-71.52250776052968,-16.39340882347915,0],[-71.52562275673583,-16.39098666649688,0],[-71.52631725535893,-16.39041125449036,0],[-71.52654262584745,-16.39002695637019,0],[-71.52677869390607,-16.38963454630951,0],[-71.52838868177395,-16.39073707308375,0],[-71.52805362946853,-16.39124019167288,0],[-71.52803039781254,-16.39168637924611,0],[-71.52804644079458,-16.39242638303431,0],[-71.52832394348607,-16.39273907905879,0],[-71.5283955563853,-16.39327919118336,0],[-71.52872616959085,-16.39332720978574,0],[-71.52874568381888,-16.39350285667762,0],[-71.52703997055426,-16.39528353360959,0],[-71.52729136477058,-16.39551308259572,0],[-71.52661992954204,-16.39622915671636,0],[-71.52613006535456,-16.39661656200106,0],[-71.5252036732206,-16.39724950874713,0],[-71.52398039928043,-16.39804214879857,0]]]},properties:{nombre:"San antonio, golfo, progreso",dias:"martes"}},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-71.51395465468181,-16.38544803592719,0],[-71.51622981591275,-16.38390001200938,0],[-71.51647485870463,-16.38477320907591,0],[-71.51777517913295,-16.38567754751901,0],[-71.51873367255023,-16.38581730093423,0],[-71.51964593322273,-16.38621221609438,0],[-71.51938263843847,-16.38674981998087,0],[-71.51828893940528,-16.38757242604657,0],[-71.51789061810166,-16.38774731167258,0],[-71.51768808204781,-16.38782503867599,0],[-71.51656999478334,-16.3886019699615,0],[-71.5185490461977,-16.39092970718735,0],[-71.51768254229845,-16.39201266068147,0],[-71.51427893939756,-16.39423523732312,0],[-71.51394349047995,-16.39405133312346,0],[-71.51221239241778,-16.39522841017617,0],[-71.50991865633766,-16.39597358344247,0],[-71.50922393400997,-16.39561918203975,0],[-71.5073915419025,-16.39425316277539,0],[-71.5073786950504,-16.39324426420501,0],[-71.50844643982909,-16.39146996850094,0],[-71.5097899952442,-16.39170105185285,0],[-71.51099629042686,-16.39079406599266,0],[-71.51099434813705,-16.38986833378253,0],[-71.51141292998547,-16.38815394703147,0],[-71.51241142820858,-16.3873339755582,0],[-71.51209401622985,-16.38685950649889,0],[-71.51395465468181,-16.38544803592719,0]]]},properties:{nombre:`Cooperativa 14
goyeneche
Sanchez trujillo`,dias:"martes"}},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-71.51722894326487,-16.37738750165257,0],[-71.51834621500535,-16.3782645846359,0],[-71.51863795235711,-16.37856949184554,0],[-71.51884590400738,-16.37885259825213,0],[-71.51915736259608,-16.37903840062024,0],[-71.51976900114964,-16.37969700116939,0],[-71.52000876361635,-16.37986733475867,0],[-71.52072392981826,-16.38012782294481,0],[-71.52104648096208,-16.38012315856096,0],[-71.52130519518334,-16.3803025920998,0],[-71.52224410732272,-16.38097581856802,0],[-71.52259118102674,-16.38129680179829,0],[-71.52288759120204,-16.3814603382368,0],[-71.52361450182477,-16.38181959229568,0],[-71.52396606770365,-16.38203188522749,0],[-71.52400924670508,-16.38222087811306,0],[-71.52390669517933,-16.38254902434944,0],[-71.5237294114377,-16.38334451568287,0],[-71.52363297848704,-16.38366747460663,0],[-71.52347498940391,-16.38425254565937,0],[-71.52332382876969,-16.38489983475819,0],[-71.52331549121587,-16.38530213895069,0],[-71.52372584090652,-16.38542407026314,0],[-71.52330077334793,-16.38605074300523,0],[-71.52486186330766,-16.38732496899093,0],[-71.52442328970935,-16.38776513455711,0],[-71.5235978377103,-16.38882187964499,0],[-71.5226225360159,-16.38825818101905,0],[-71.52209813975549,-16.38809791342525,0],[-71.52156706100308,-16.3880074880646,0],[-71.52085731204357,-16.38743087811404,0],[-71.52063819216487,-16.3869828690024,0],[-71.52030708659808,-16.38650017724473,0],[-71.52007254749476,-16.38639129784726,0],[-71.51976712620299,-16.38619459408435,0],[-71.51963079827692,-16.3861137441859,0],[-71.51855578180854,-16.38547293919836,0],[-71.51812333844875,-16.38546860894947,0],[-71.51657044669506,-16.38435853831209,0],[-71.51638639890344,-16.38380418057648,0],[-71.5151655349519,-16.38257739803342,0],[-71.51509696206467,-16.38243347796809,0],[-71.51532466792194,-16.38205105547131,0],[-71.51493546075598,-16.38171604605165,0],[-71.51535384223972,-16.38117676859608,0],[-71.51560959581504,-16.38087620561477,0],[-71.51509851710685,-16.38044547874091,0],[-71.51551859135205,-16.37990435384158,0],[-71.51722894326487,-16.37738750165257,0]]]},properties:{nombre:`Av Arequipa
Puente de la amistad
Diamantes
12 de octubre`,dias:"martes"}},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-71.52717876166389,-16.38145634639278,0],[-71.52504003556692,-16.382994960602,0],[-71.52414870493794,-16.38221574163534,0],[-71.52300136390927,-16.38143283602518,0],[-71.52279826781827,-16.38136797437175,0],[-71.52124519280208,-16.38027667625257,0],[-71.52103835874148,-16.38015574427591,0],[-71.5205040900162,-16.38005926585089,0],[-71.52004577638026,-16.37986848753915,0],[-71.5198274703793,-16.37971986150834,0],[-71.51965481818576,-16.37956830644196,0],[-71.51913276417359,-16.37900081495497,0],[-71.51887376833893,-16.37885455363139,0],[-71.51831818663622,-16.37821945251215,0],[-71.5172719744549,-16.37741463995528,0],[-71.51640582381026,-16.37672836090187,0],[-71.51584683606768,-16.37635899190319,0],[-71.51663042681838,-16.37540909888358,0],[-71.51789551883179,-16.3740630541744,0],[-71.51909838899007,-16.37282412228188,0],[-71.52342747568514,-16.37522599117232,0],[-71.52468414605728,-16.37592516778827,0],[-71.52632292625283,-16.37705317121177,0],[-71.52789157196317,-16.37829442726297,0],[-71.52663497946574,-16.37980641413782,0],[-71.52594312435546,-16.38027718047319,0],[-71.52717876166389,-16.38145634639278,0]]]},properties:{nombre:`Av Juan velazco alvarado
Cancha ramiro priale`,dias:"martes"}},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-71.52732725669826,-16.38149532646901,0],[-71.52592297642445,-16.38028118820088,0],[-71.52666216714029,-16.37973531865792,0],[-71.52782283251743,-16.37834579936299,0],[-71.52426531568217,-16.37563570939476,0],[-71.5199058208668,-16.37311061813518,0],[-71.51645550915913,-16.37124160041674,0],[-71.51437663560519,-16.37018855126447,0],[-71.51467407988734,-16.36979977113734,0],[-71.5161201254484,-16.36968340846589,0],[-71.51736810957408,-16.37009662016965,0],[-71.51894828082986,-16.37134864508483,0],[-71.52066409016831,-16.37146440887562,0],[-71.52235392066139,-16.37204373720918,0],[-71.52288772198816,-16.37124071105776,0],[-71.52414206132916,-16.37281265400039,0],[-71.5254775762379,-16.37266594864264,0],[-71.5273607790459,-16.37377212564005,0],[-71.52789017024865,-16.37442551444607,0],[-71.52925116993728,-16.37567700870098,0],[-71.53064266315835,-16.37628364428442,0],[-71.53138873312005,-16.37695746663243,0],[-71.53182625444404,-16.37829447138045,0],[-71.53188259755473,-16.37969280724768,0],[-71.53186012879567,-16.38066520998725,0],[-71.53212998999471,-16.38200158519004,0],[-71.53151131495629,-16.38241984076961,0],[-71.53049712828373,-16.38157948602923,0],[-71.52986964377185,-16.38150723435755,0],[-71.52732725669826,-16.38149532646901,0]]]},properties:{nombre:"Coop. cruce Chilina, Conquistador pampas de polanco,villa arequipa pampas de polanco,",dias:"martes"}},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-71.51288597903827,-16.37010196731239,0],[-71.5131389153818,-16.37029334746346,0],[-71.51357904864281,-16.37022590971833,0],[-71.51382185675017,-16.37030784887322,0],[-71.51422242018344,-16.37004658105475,0],[-71.51468382323489,-16.37023992856387,0],[-71.51545637898182,-16.37065027826876,0],[-71.51906155655742,-16.37283815567989,0],[-71.5169151656825,-16.37507379290725,0],[-71.51582775444692,-16.37635573054798,0],[-71.5162921821663,-16.37666088867865,0],[-71.51721940411753,-16.37739097103805,0],[-71.51586175825967,-16.37939550308225,0],[-71.51561691957352,-16.37979212389783,0],[-71.51502691198176,-16.38041919914474,0],[-71.51416426046167,-16.38001049606672,0],[-71.51409973861634,-16.37950850880897,0],[-71.51349307638978,-16.37880777688465,0],[-71.5130815368485,-16.37868522575492,0],[-71.51246226204846,-16.37738173007838,0],[-71.51225491692321,-16.37699582318518,0],[-71.51173948684412,-16.37668210071521,0],[-71.51081141133012,-16.37619574710091,0],[-71.51008118258734,-16.3758272224018,0],[-71.50966201972783,-16.37581231633788,0],[-71.5083168245516,-16.37465398918074,0],[-71.50782104242818,-16.37393174074725,0],[-71.50818721529188,-16.37342744354283,0],[-71.50859118109918,-16.37295143742612,0],[-71.50893090664259,-16.3725004066135,0],[-71.50849482230174,-16.37208547760325,0],[-71.50948501763772,-16.37073811922351,0],[-71.50985665777331,-16.37036766925103,0],[-71.51013397395643,-16.37004732544776,0],[-71.51026492762244,-16.36970380385867,0],[-71.51012812237012,-16.36926026392047,0],[-71.51035733209144,-16.36919219289736,0],[-71.51108507711677,-16.36902425752223,0],[-71.51158794443943,-16.36925033333157,0],[-71.51238646118684,-16.36977888846348,0],[-71.51288597903827,-16.37010196731239,0]]]},properties:{nombre:"Apurimac, Centro de salud Apurimac",dias:"martes"}},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-71.50779533759618,-16.37393588645399,0],[-71.50721905198256,-16.37339497322696,0],[-71.50591694143698,-16.3726521494782,0],[-71.50559426114377,-16.37233710975955,0],[-71.50446505920908,-16.37166878148132,0],[-71.50388355029388,-16.37154600507483,0],[-71.5034271417734,-16.37092841583486,0],[-71.50338737487124,-16.37066200001851,0],[-71.5029221791504,-16.37004650019429,0],[-71.50225369713567,-16.3700104768208,0],[-71.50099951037686,-16.36958885863315,0],[-71.50025407681456,-16.3691145821382,0],[-71.49982976556677,-16.3682504962416,0],[-71.49951512430385,-16.36732759715104,0],[-71.49921678869272,-16.36759980562376,0],[-71.49859398211879,-16.36789588452115,0],[-71.49799899129006,-16.36692361460253,0],[-71.4975079821197,-16.36605674332099,0],[-71.4973508707336,-16.36490720417324,0],[-71.49731160674169,-16.36296619386796,0],[-71.4966438433531,-16.36164705630648,0],[-71.49839181985021,-16.36076136552025,0],[-71.49900066694872,-16.36238201121484,0],[-71.50063078976044,-16.36185435022843,0],[-71.50143601357203,-16.36038444952587,0],[-71.50330181360721,-16.35987559296701,0],[-71.50455880713807,-16.36055396799689,0],[-71.50700582702773,-16.36332893406198,0],[-71.50466183758469,-16.36533567941476,0],[-71.50407258140466,-16.36488717371783,0],[-71.50356526550844,-16.36469697608165,0],[-71.50389474610384,-16.36547888917174,0],[-71.50461308715379,-16.36593222964327,0],[-71.50490492849389,-16.36625125387056,0],[-71.50539347659277,-16.36646338853732,0],[-71.50559462676134,-16.36662091929058,0],[-71.50584307827121,-16.3668611546527,0],[-71.5063037228363,-16.36669313189641,0],[-71.50644315476787,-16.36613309932661,0],[-71.50734691308243,-16.36580908661056,0],[-71.50772695492101,-16.36618442983301,0],[-71.5081558188064,-16.36659154795671,0],[-71.50856918052548,-16.3670421046312,0],[-71.50906863436286,-16.3673555196127,0],[-71.50981508595952,-16.36747598841201,0],[-71.51038531465235,-16.36775852061356,0],[-71.51068902179934,-16.36845313034112,0],[-71.51092072306588,-16.36892091690159,0],[-71.5100462717948,-16.36923145044006,0],[-71.5101573318024,-16.36930318817794,0],[-71.51026740007632,-16.36981223386038,0],[-71.50993060316281,-16.37022209046143,0],[-71.50890931152485,-16.37152235051047,0],[-71.50843503607253,-16.37211908891944,0],[-71.5089036328918,-16.37246390193088,0],[-71.50779533759618,-16.37393588645399,0]]]},properties:{nombre:`Leones del Misti
San luis`,dias:"martes"}},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-71.54756109244556,-16.3612352830779,0],[-71.54787080054886,-16.36224024584353,0],[-71.54772242024409,-16.36250034977443,0],[-71.5471886393315,-16.36259899244659,0],[-71.54705472589859,-16.3626068439409,0],[-71.54705248721905,-16.36283006041997,0],[-71.54708417029958,-16.36321785234147,0],[-71.54739221018963,-16.36348531253742,0],[-71.54790993912161,-16.36377078939786,0],[-71.54825936828159,-16.36434773559716,0],[-71.5484805367284,-16.36460489942288,0],[-71.5488249128633,-16.36492668984005,0],[-71.54886033754585,-16.36540245041502,0],[-71.54874967976049,-16.36568626577145,0],[-71.54830775841135,-16.36547716722816,0],[-71.54802291091956,-16.36546119602657,0],[-71.5479953233099,-16.36566426821278,0],[-71.54808357383524,-16.36597664806842,0],[-71.54704060006043,-16.3653116250677,0],[-71.546740742747,-16.36548913478513,0],[-71.54669625883167,-16.36597800477679,0],[-71.5464311852106,-16.36613004253962,0],[-71.54607021186523,-16.36597077470361,0],[-71.5457971470745,-16.36613957990293,0],[-71.54565684664776,-16.36609782385693,0],[-71.54558587480771,-16.36685176972091,0],[-71.54519295903002,-16.36701908864055,0],[-71.5447911677633,-16.36699415804009,0],[-71.54433629315467,-16.36691075874959,0],[-71.54406340675058,-16.36688623305354,0],[-71.54370444338183,-16.36687021572096,0],[-71.54360757810329,-16.36633207660173,0],[-71.54377239343827,-16.36583719098648,0],[-71.54376326889557,-16.36537593101314,0],[-71.54356237530244,-16.36474573751815,0],[-71.54350112902742,-16.36467841804896,0],[-71.54344004234801,-16.36473666712525,0],[-71.5435013358188,-16.36521541267293,0],[-71.54318706483025,-16.36570075394392,0],[-71.54292410201651,-16.36597761801195,0],[-71.54271298723609,-16.36581767409725,0],[-71.54269533813854,-16.3653971798113,0],[-71.54251963124148,-16.36515354918237,0],[-71.54244947401797,-16.36470879573681,0],[-71.54244077157034,-16.3644238197002,0],[-71.54225657749734,-16.36437363842479,0],[-71.54211604359638,-16.36473441524273,0],[-71.5419928408704,-16.3652045282893,0],[-71.54198338611846,-16.36588528666203,0],[-71.54187811888805,-16.36609597164278,0],[-71.54153595033904,-16.36618874616237,0],[-71.54135849559788,-16.36586797748015,0],[-71.54112787416727,-16.36521725669039,0],[-71.54112004679648,-16.36480487017423,0],[-71.54065669726906,-16.36448678572391,0],[-71.54041599801111,-16.36406961239429,0],[-71.54034682363756,-16.36394721697524,0],[-71.5398753343044,-16.36338797229578,0],[-71.5398850487608,-16.36298739407969,0],[-71.53968337062716,-16.36241101548439,0],[-71.53976306650435,-16.3621096255171,0],[-71.5397307216544,-16.36160584812478,0],[-71.53997930457834,-16.36076277332316,0],[-71.5400672673732,-16.36036118175513,0],[-71.540158996342,-16.3599814634379,0],[-71.54026579409484,-16.3589155886129,0],[-71.54040498896494,-16.35815838080152,0],[-71.54057244209226,-16.3577493662394,0],[-71.54231164287765,-16.35770935147143,0],[-71.54553194429518,-16.35753905935194,0],[-71.54606873493711,-16.35749963657083,0],[-71.54631648255757,-16.35777086458009,0],[-71.54649350890413,-16.35846713096472,0],[-71.5466709690577,-16.35940182320687,0],[-71.54696108462689,-16.36003047988379,0],[-71.54728892774288,-16.36038762708796,0],[-71.54744551026279,-16.36111486641545,0],[-71.54756109244556,-16.3612352830779,0]]]},properties:{dias:"miercoles"}},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-71.5479114836562,-16.34345241471656,0],[-71.54851237188208,-16.3432394209702,0],[-71.54829098207557,-16.34161415360729,0],[-71.54945019426707,-16.34149372515293,0],[-71.54930658467693,-16.34046955585656,0],[-71.54998389849426,-16.34051807019423,0],[-71.54938604512914,-16.34046864844443,0],[-71.54934630352655,-16.34046910233607,0],[-71.5493304134026,-16.34046928374323,0],[-71.55230630539593,-16.34048375566643,0],[-71.55250788951501,-16.34312855235438,0],[-71.55523853139916,-16.34279979463361,0],[-71.55496170107473,-16.34338417976754,0],[-71.55519362777972,-16.34367662068665,0],[-71.5552510338143,-16.34455613489404,0],[-71.55550286953317,-16.34479302710783,0],[-71.55573335847274,-16.34493136786476,0],[-71.55626209497642,-16.34568483419119,0],[-71.55639296450235,-16.34638293894387,0],[-71.55639957289034,-16.34694183964494,0],[-71.5566510118133,-16.34718341355725,0],[-71.55721807448644,-16.34756548813563,0],[-71.55736732408239,-16.34794743307494,0],[-71.55720404870559,-16.3484706731677,0],[-71.55700004461892,-16.34887399215862,0],[-71.55666943874671,-16.34933924046055,0],[-71.55618465915819,-16.34948077890018,0],[-71.55580731257203,-16.34978478059875,0],[-71.55577358213168,-16.35070101643746,0],[-71.55573812037039,-16.35194666012242,0],[-71.55527508999991,-16.35246470374501,0],[-71.55525677747183,-16.35278977617183,0],[-71.55521835883935,-16.3533402386681,0],[-71.55485665131754,-16.35370811044803,0],[-71.5541740347286,-16.35374880415979,0],[-71.55351402476259,-16.35350373436253,0],[-71.55355576733774,-16.35293283952121,0],[-71.55334306528619,-16.35238288240431,0],[-71.55304562920753,-16.35224120958887,0],[-71.55317278308213,-16.35171302420329,0],[-71.55289717129497,-16.35022453364385,0],[-71.55258037501719,-16.35008210350204,0],[-71.55180152942548,-16.34964194763169,0],[-71.55144596036634,-16.34916447099672,0],[-71.55049544948191,-16.34682745758546,0],[-71.55020504261599,-16.34676925964334,0],[-71.54917285980117,-16.34617813860643,0],[-71.54809124280678,-16.34468123394662,0],[-71.5480114175427,-16.34382981120894,0],[-71.5479114836562,-16.34345241471656,0]]]},properties:{dias:"miercoles"}},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-71.54057157159446,-16.35643870815944,0],[-71.54069680894997,-16.35598705796342,0],[-71.54065058482094,-16.35480559686497,0],[-71.5408131480987,-16.35358026914352,0],[-71.54068054923108,-16.35318092993478,0],[-71.54045709209174,-16.35184985989185,0],[-71.53988578397747,-16.34733449825979,0],[-71.54031390592822,-16.34730687398513,0],[-71.53986434824373,-16.34631116767092,0],[-71.53987087586734,-16.34496273562949,0],[-71.54026367252334,-16.34493504935065,0],[-71.54151992559429,-16.34486895417039,0],[-71.54281869119383,-16.34466103534039,0],[-71.54293072364895,-16.34479485637477,0],[-71.54305885332276,-16.34562016710699,0],[-71.5429542433558,-16.3466573882778,0],[-71.5431308402562,-16.34746208085963,0],[-71.54335919873435,-16.34745661768453,0],[-71.54346621416455,-16.34754613639246,0],[-71.54371692662835,-16.34911322796642,0],[-71.54386310019497,-16.3499487712715,0],[-71.54445623857914,-16.34990475841694,0],[-71.5444629928613,-16.34996975459494,0],[-71.54427341001625,-16.35110418630737,0],[-71.54449019446297,-16.35153611755505,0],[-71.54495022346092,-16.35154791682117,0],[-71.54524727244153,-16.35192909071359,0],[-71.54535602654659,-16.35239892611567,0],[-71.54533400285916,-16.35282417615139,0],[-71.5450984196591,-16.35302913562553,0],[-71.54550114974552,-16.3536219957902,0],[-71.54582414331469,-16.35351344545378,0],[-71.54619259436373,-16.353703285688,0],[-71.54646986251804,-16.35428821359549,0],[-71.54664119664989,-16.35441763215553,0],[-71.54711591654329,-16.35498177674935,0],[-71.54732736502018,-16.35527448201843,0],[-71.5473755177748,-16.35552463464464,0],[-71.54749502524427,-16.35636172708578,0],[-71.54765718246023,-16.35674894552156,0],[-71.54776344054608,-16.35845601932186,0],[-71.5479253686884,-16.35991144889826,0],[-71.54794180244463,-16.36015126070408,0],[-71.5475224053348,-16.36118784270309,0],[-71.54731939398542,-16.36063945753979,0],[-71.54726295574882,-16.36023358825977,0],[-71.5470069532915,-16.36001882032096,0],[-71.54672442176636,-16.3595805682126,0],[-71.54662947701435,-16.35903787060766,0],[-71.54649018857543,-16.35850020252541,0],[-71.54627355794167,-16.35772853367071,0],[-71.54607619453724,-16.357473330585,0],[-71.54433394095733,-16.35756456869418,0],[-71.54098226386705,-16.35770324799829,0],[-71.54057157159446,-16.35643870815944,0]]]},properties:{dias:"miercoles"}},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-71.54300589984594,-16.34464638491475,0],[-71.5440498523805,-16.34433183486027,0],[-71.54461434760616,-16.34417117063617,0],[-71.54701993707185,-16.34347138933376,0],[-71.54708816302016,-16.34356408141884,0],[-71.5476641883368,-16.34357872556172,0],[-71.54794145200657,-16.34409610950951,0],[-71.54787899617526,-16.34436318516326,0],[-71.54769358194872,-16.34458049938946,0],[-71.54789509197867,-16.34492043733269,0],[-71.54838134948953,-16.34551629401211,0],[-71.54864784751972,-16.34571791556537,0],[-71.54890217163498,-16.34610409355056,0],[-71.54891435740825,-16.34611333037139,0],[-71.54935742201695,-16.34637197562021,0],[-71.54961497938287,-16.34666442975836,0],[-71.55005425691911,-16.34696024043171,0],[-71.55045704190074,-16.34701391848226,0],[-71.5507677386941,-16.34742277463667,0],[-71.55092559234237,-16.34787176005648,0],[-71.55103716699732,-16.34822988505677,0],[-71.55120721042934,-16.34863388402318,0],[-71.55156618009279,-16.34937241601186,0],[-71.55169934128548,-16.34953142278813,0],[-71.5528408112198,-16.35039291163434,0],[-71.55314056434851,-16.35135616481871,0],[-71.55313744062038,-16.35181163020188,0],[-71.5530460728921,-16.35212118378731,0],[-71.55299654506524,-16.35224354086755,0],[-71.5533181228835,-16.35251015119463,0],[-71.55358136296012,-16.35299577612483,0],[-71.55346939829845,-16.35343200888747,0],[-71.55297520777619,-16.35379627336135,0],[-71.55273851304808,-16.35407818924556,0],[-71.5525091514193,-16.35432445351348,0],[-71.55205889976409,-16.35402771324731,0],[-71.55211381018916,-16.35421170512937,0],[-71.55236031977361,-16.35487638576423,0],[-71.55235533311448,-16.35536140902035,0],[-71.55226030757734,-16.35587592079848,0],[-71.55244038431736,-16.35634883180755,0],[-71.5526462430903,-16.35736644568875,0],[-71.5527988198464,-16.35800605917144,0],[-71.55275320126275,-16.35827388744459,0],[-71.55249202316543,-16.35852678225309,0],[-71.55211075826327,-16.35876290212323,0],[-71.55187762472427,-16.35810250966479,0],[-71.551859419303,-16.35779436076655,0],[-71.55125307255607,-16.35675297354045,0],[-71.55118117305157,-16.35616571373053,0],[-71.55109508721445,-16.35597037723901,0],[-71.55054445763037,-16.35608997750423,0],[-71.5501370554642,-16.35594269584222,0],[-71.5495735019071,-16.35540490186009,0],[-71.5491642767162,-16.35430226658272,0],[-71.54885319584874,-16.35344839233165,0],[-71.5487037906827,-16.35288285182082,0],[-71.54838241413029,-16.35235020672243,0],[-71.548095381411,-16.35212537785392,0],[-71.54795291049396,-16.35217331074762,0],[-71.54796572155281,-16.35256971289241,0],[-71.54781147927251,-16.35301023230884,0],[-71.54746884497197,-16.35309017503791,0],[-71.54673511424033,-16.35287325931057,0],[-71.54622991094959,-16.35246883709185,0],[-71.54603291869662,-16.35182605722398,0],[-71.5452979091538,-16.35088881432873,0],[-71.54498536520336,-16.35034731703259,0],[-71.54472558235197,-16.34972407802635,0],[-71.54459152278463,-16.34920015612443,0],[-71.54451265861114,-16.34887983496869,0],[-71.54380273337362,-16.34873446644066,0],[-71.54375042561836,-16.34826095892115,0],[-71.54383846498916,-16.34763904306196,0],[-71.54429655093358,-16.34740803836986,0],[-71.54450378165812,-16.34718027744157,0],[-71.54343072413607,-16.34617769475194,0],[-71.54300589984594,-16.34464638491475,0]]]},properties:{dias:"miercoles"}},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-71.53994610645857,-16.34442497295827,0],[-71.53972571303987,-16.3440013360442,0],[-71.53962852534794,-16.34307052672183,0],[-71.5394878613264,-16.34306089354133,0],[-71.53921222909418,-16.34280328169293,0],[-71.53886651870694,-16.34061714634341,0],[-71.53919351346784,-16.34051671662297,0],[-71.54017084621587,-16.34016010634074,0],[-71.54073753703192,-16.34004271833463,0],[-71.54076383521125,-16.33951578989707,0],[-71.54154278762621,-16.33914909349426,0],[-71.54158702120571,-16.33902067309787,0],[-71.54200743756599,-16.33893890729117,0],[-71.542357433213,-16.33893960974258,0],[-71.5427750160492,-16.33872247316963,0],[-71.54346792699434,-16.33812921918267,0],[-71.54362762857063,-16.33810168458556,0],[-71.54563987070918,-16.33765346556266,0],[-71.54563783090786,-16.33775169284188,0],[-71.54588703373466,-16.33843628398919,0],[-71.54585587906772,-16.34019951760866,0],[-71.54598013136646,-16.34064340587699,0],[-71.54643816016133,-16.34149931518521,0],[-71.54684456131412,-16.34184567577435,0],[-71.5484346957972,-16.34229529154754,0],[-71.54699004942857,-16.34345897673702,0],[-71.54401104222927,-16.34429710054394,0],[-71.54298909766943,-16.34459696935792,0],[-71.54147932849637,-16.34482318362091,0],[-71.53987430992093,-16.34488153844855,0],[-71.53994610645857,-16.34442497295827,0]]]},properties:{dias:"miercoles",nombre:""}},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-71.54338099378037,-16.33422360230755,0],[-71.54255984468597,-16.33404214570907,0],[-71.54238590350596,-16.33396938222661,0],[-71.54228140967733,-16.33365556375177,0],[-71.54229792128037,-16.33341371683835,0],[-71.54250424140803,-16.33325580797419,0],[-71.5429171927922,-16.33288592285676,0],[-71.54293004061306,-16.33218371710543,0],[-71.54289838946494,-16.33182523887535,0],[-71.54248509337934,-16.33129163336357,0],[-71.54227597603389,-16.33110795963264,0],[-71.5419374410341,-16.33103949205499,0],[-71.54164595197001,-16.33104293466932,0],[-71.54132574747982,-16.33096362113792,0],[-71.54057165186914,-16.3307693181229,0],[-71.53949621928832,-16.32932509145353,0],[-71.53902143833015,-16.32859735374703,0],[-71.53832006055653,-16.32786041425811,0],[-71.53709739019787,-16.32495852551203,0],[-71.53700384979933,-16.32450340788778,0],[-71.53698819464445,-16.32432703865178,0],[-71.53704093306013,-16.32406347351764,0],[-71.53711298407313,-16.32379827595246,0],[-71.53695064094624,-16.32335516888783,0],[-71.5369294258464,-16.32292413508066,0],[-71.53725503985045,-16.32172942915665,0],[-71.53814688031918,-16.32101740936211,0],[-71.53878402631524,-16.32087214072461,0],[-71.53903639714308,-16.32108770489977,0],[-71.53957774809214,-16.32104494815287,0],[-71.54122562038847,-16.32102918632956,0],[-71.54292608593119,-16.32454501695386,0],[-71.54280774107136,-16.32538114150855,0],[-71.54303035522663,-16.32536148590988,0],[-71.54553701174447,-16.32695746046027,0],[-71.5463676788618,-16.32757199393886,0],[-71.54666008940342,-16.32796991049311,0],[-71.546780380632,-16.32886066160691,0],[-71.54735001628536,-16.32974108408661,0],[-71.54811252198141,-16.33034282314353,0],[-71.54919580208646,-16.33037547189735,0],[-71.55050394676965,-16.33203863392323,0],[-71.55166899317197,-16.33291179266541,0],[-71.55203091233062,-16.33350144980708,0],[-71.55270086887684,-16.33416712268936,0],[-71.55335401467659,-16.33439622080372,0],[-71.55384591101779,-16.33457392286108,0],[-71.55429837864013,-16.33513955732938,0],[-71.5540293787835,-16.33578938463551,0],[-71.55383272647352,-16.33613969082687,0],[-71.55465681330674,-16.33779118233336,0],[-71.55481954696887,-16.33807714722681,0],[-71.55497953746642,-16.33889613915235,0],[-71.55522197753817,-16.33996330626462,0],[-71.55493764018021,-16.340525447335,0],[-71.55353613780251,-16.340541298029,0],[-71.55256706649739,-16.34047709707442,0],[-71.55168827746874,-16.3405130758351,0],[-71.55045441314125,-16.34052643239609,0],[-71.54923519848661,-16.34042517664042,0],[-71.54938602234823,-16.34144046178486,0],[-71.54830517090683,-16.34156754069002,0],[-71.54826995014915,-16.34223460272557,0],[-71.54713855802908,-16.34193626974539,0],[-71.54654733840313,-16.34157188666127,0],[-71.54601540202187,-16.34056199040728,0],[-71.54582954874037,-16.33979150704218,0],[-71.54604312665353,-16.33890457642077,0],[-71.54597392038963,-16.33814306051324,0],[-71.5459388163,-16.33794651560192,0],[-71.54544686047996,-16.33758118254503,0],[-71.54514750420006,-16.33751396665452,0],[-71.5449973805855,-16.33735699610329,0],[-71.5450836140709,-16.33721089239707,0],[-71.54510325488009,-16.33703939084612,0],[-71.54499075253757,-16.33690872691614,0],[-71.54473784461929,-16.33693749048345,0],[-71.54461826654595,-16.33689922809854,0],[-71.54446928940344,-16.33671366242274,0],[-71.54444516558938,-16.33639945186741,0],[-71.54439888522269,-16.33611984089423,0],[-71.54423156483935,-16.33595366187155,0],[-71.54412637498281,-16.33577341516484,0],[-71.54401076267705,-16.33536361158323,0],[-71.54408960799817,-16.33496411532668,0],[-71.54411123031444,-16.33481593580543,0],[-71.54383686611075,-16.33447584088535,0],[-71.54338099378037,-16.33422360230755,0]]]},properties:{dias:"miercoles",nombre:`la estrella 
cayma arriba izquierda`}},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-71.53921810837403,-16.34042251954249,0],[-71.53936706872673,-16.33980460065862,0],[-71.53875789844514,-16.33887484533555,0],[-71.53840677841767,-16.33796088903467,0],[-71.53835618952115,-16.33734378195765,0],[-71.53872011191731,-16.33621165749092,0],[-71.53853734088685,-16.33414585673915,0],[-71.53717322619072,-16.33293815660383,0],[-71.53696086281354,-16.33141353274278,0],[-71.5361549100454,-16.32955664868881,0],[-71.53491087149104,-16.32766556886708,0],[-71.53238826333867,-16.32436725077873,0],[-71.53534609716866,-16.3225486861011,0],[-71.53591135749197,-16.32331751795966,0],[-71.53617047849971,-16.32350793845999,0],[-71.53707250825964,-16.32490407706779,0],[-71.5375290743663,-16.32609785640399,0],[-71.53825991211833,-16.32790393487579,0],[-71.53900101751752,-16.32864054038303,0],[-71.53940998320233,-16.32935391104041,0],[-71.54005841129054,-16.33025427559641,0],[-71.54051638248156,-16.33089255703033,0],[-71.54078488659712,-16.33103423932948,0],[-71.54123546413047,-16.3311005117156,0],[-71.54170448017321,-16.33113209294169,0],[-71.5422873133861,-16.33121247277119,0],[-71.54271676781993,-16.33175391354641,0],[-71.54287483273713,-16.33278353839666,0],[-71.54274452508515,-16.33295892494767,0],[-71.54217309767752,-16.33335344288684,0],[-71.54215095382337,-16.33370703150487,0],[-71.54235202489033,-16.33402498417629,0],[-71.54330602018523,-16.33423713103541,0],[-71.54375136720626,-16.33451315809897,0],[-71.54404863664482,-16.33472306241189,0],[-71.54396170809132,-16.33528288928076,0],[-71.54395895051904,-16.33575090219267,0],[-71.54431696448151,-16.33616350685496,0],[-71.54439020234852,-16.33666189455557,0],[-71.54458194595333,-16.33688964789131,0],[-71.54474272215201,-16.33726957973754,0],[-71.54482862302623,-16.33773565028053,0],[-71.5445525974898,-16.33782320117476,0],[-71.54375298641465,-16.3380725769823,0],[-71.54353106593942,-16.33825486646647,0],[-71.54305227671085,-16.33854473602107,0],[-71.54257833765658,-16.33886181161892,0],[-71.54234877582121,-16.33896633997566,0],[-71.54194994535051,-16.33895357504005,0],[-71.5416467158724,-16.33902240762983,0],[-71.54153838429981,-16.33914975201734,0],[-71.540796875185,-16.33950862491881,0],[-71.54075687585701,-16.34006342395185,0],[-71.5403442527453,-16.34010298615463,0],[-71.53921810837403,-16.34042251954249,0]]]},properties:{dias:"miercoles",nombre:`Av bolonesi.
Radio azul`}},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-71.63101241900989,-16.29468628892009,0],[-71.63257373641676,-16.29689209270869,0],[-71.63149541255322,-16.2983553399292,0],[-71.62948590733967,-16.2969060904636,0],[-71.62894498690338,-16.29566998546308,0],[-71.62795067159642,-16.29511163783677,0],[-71.62638380722142,-16.29462271841616,0],[-71.62563712262559,-16.29412175228038,0],[-71.62559560015426,-16.29336299371375,0],[-71.62601071544037,-16.29290510606106,0],[-71.62773463245776,-16.2926394507832,0],[-71.62833456969197,-16.29225800908521,0],[-71.6279236893833,-16.29171695580457,0],[-71.62732527666776,-16.2918302229111,0],[-71.62654851864899,-16.29098405512982,0],[-71.62750729902312,-16.2899737202652,0],[-71.63251990761478,-16.29009528424369,0],[-71.63659657788675,-16.28726803222654,0],[-71.64558047916525,-16.28464472837457,0],[-71.6572502214626,-16.28312400874585,0],[-71.66124921306462,-16.28598100675297,0],[-71.66093012626682,-16.29040491200292,0],[-71.65370629583879,-16.29540720401858,0],[-71.65259440415852,-16.2972872924037,0],[-71.64906871410035,-16.2974527059084,0],[-71.64724048748889,-16.29712300632321,0],[-71.64478674823216,-16.29829425725739,0],[-71.64253680246557,-16.29830342284418,0],[-71.63780619898003,-16.29447409946152,0],[-71.63745296711828,-16.29494503960143,0],[-71.6371299134745,-16.29521495502853,0],[-71.6367774274564,-16.29546570877371,0],[-71.6362603270502,-16.29543722748793,0],[-71.63517992122894,-16.29504120149891,0],[-71.6339248741513,-16.29479309828005,0],[-71.6332465073174,-16.29454299070576,0],[-71.6328029986281,-16.29452595561667,0],[-71.63101241900989,-16.29468628892009,0]]]},properties:{dias:"miercoles",nombre:`villa milagros 
mirador los milagros
uís los milagros
kilometro 16`}},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-71.62046269178092,-16.30189859024184,0],[-71.61887474413075,-16.3004758714892,0],[-71.61985401115297,-16.29984924430335,0],[-71.62044699665465,-16.2988959938898,0],[-71.62120771916503,-16.29690411894722,0],[-71.62134795171879,-16.29502497886171,0],[-71.62146281606482,-16.29442218557308,0],[-71.62264636854138,-16.29400205143573,0],[-71.62316268330004,-16.29323049274043,0],[-71.62357452409296,-16.29294331871598,0],[-71.62488424076788,-16.29416096662211,0],[-71.6255025388467,-16.2943401327929,0],[-71.6264246624556,-16.29488701920275,0],[-71.62703083288082,-16.2950900448719,0],[-71.62824264316556,-16.29541193463129,0],[-71.62854460692614,-16.29580216005051,0],[-71.62879619875912,-16.29646379697392,0],[-71.6291953258105,-16.29696284472571,0],[-71.62897811642443,-16.29705871906614,0],[-71.62882268768664,-16.29731958683333,0],[-71.62979161355722,-16.29759159220689,0],[-71.63076361098759,-16.29831597448389,0],[-71.63086011319186,-16.30083573167236,0],[-71.6329943871979,-16.30269475312437,0],[-71.63757544697768,-16.31155784314973,0],[-71.6362055970741,-16.31464303261377,0],[-71.63478173101173,-16.31430534259219,0],[-71.63444515895986,-16.31165690181349,0],[-71.63302615417183,-16.31212523031743,0],[-71.63261302242606,-16.31302870744129,0],[-71.6328542274808,-16.31374671453086,0],[-71.63094464007843,-16.31456696379472,0],[-71.6304817571315,-16.31478811850113,0],[-71.63023194268023,-16.31622285714979,0],[-71.63110358203691,-16.31832483560747,0],[-71.63088312091507,-16.31941508826943,0],[-71.63017361894919,-16.31982942021141,0],[-71.62874924778109,-16.32038886463796,0],[-71.62844579032303,-16.31900069001811,0],[-71.62800833172716,-16.31649861931822,0],[-71.62852366353722,-16.3145500690212,0],[-71.62920926315658,-16.31321972579076,0],[-71.62728562629842,-16.31192190302801,0],[-71.62520831948748,-16.30825418127834,0],[-71.62465781936999,-16.30696424354953,0],[-71.62046269178092,-16.30189859024184,0]]]},properties:{dias:"miercoles",nombre:`municipalidad de yura
cono norte 2`}},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-71.62175032707545,-16.30331653025458,0],[-71.62041067451165,-16.30571991971549,0],[-71.62323864381415,-16.3088905290048,0],[-71.62387602102822,-16.31037782045787,0],[-71.62278492870712,-16.31181245294469,0],[-71.61878017066076,-16.31369237543786,0],[-71.61803888039411,-16.31360090688663,0],[-71.61699841965998,-16.31223745218953,0],[-71.61411746231128,-16.31479730673537,0],[-71.61106253131165,-16.31105025163093,0],[-71.60964914308884,-16.30974932437749,0],[-71.60663857820175,-16.30787909911631,0],[-71.60639688527418,-16.30773293634444,0],[-71.60612804401123,-16.30754932713171,0],[-71.6070731042094,-16.30662915037584,0],[-71.60725200001572,-16.30657284639329,0],[-71.60731659236637,-16.3066819837797,0],[-71.60799007598716,-16.30710588932455,0],[-71.60834518090569,-16.30709600412538,0],[-71.60876659718973,-16.30737308974154,0],[-71.60907896331763,-16.30736197261738,0],[-71.60943055045863,-16.30714479898572,0],[-71.60942402942224,-16.30681329024322,0],[-71.60955040910625,-16.30666023992208,0],[-71.610196812213,-16.30662727767678,0],[-71.61129483893718,-16.30677891365118,0],[-71.61155014923102,-16.3067827774436,0],[-71.61304578002908,-16.30544378479939,0],[-71.61381693813641,-16.30414267685405,0],[-71.6139442465289,-16.30376588534133,0],[-71.61416695254128,-16.30290631873641,0],[-71.61434784082151,-16.30219993320161,0],[-71.61440971666578,-16.301091323665,0],[-71.61449604668836,-16.30027233699908,0],[-71.61514843451103,-16.30073821867807,0],[-71.61604817134958,-16.30158781198232,0],[-71.61691084759441,-16.30204116650992,0],[-71.61733159473168,-16.30173720060144,0],[-71.61882675276952,-16.30051552351334,0],[-71.62046590360809,-16.30199972648662,0],[-71.62175032707545,-16.30331653025458,0]]]},properties:{dias:"miercoles",nombre:`cono norte 3
apipa`}},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-71.61160564371285,-16.31712245909844,0],[-71.60524845225765,-16.32078594478239,0],[-71.59835159142412,-16.32416135596196,0],[-71.59685884830435,-16.32280692346352,0],[-71.59640191663357,-16.32142231725141,0],[-71.59657261424148,-16.31796439733183,0],[-71.5953637840506,-16.31489459793836,0],[-71.5992215038908,-16.31395995076878,0],[-71.60076362339058,-16.31278586893129,0],[-71.60180650007138,-16.31206412299795,0],[-71.60280631220995,-16.31112203720884,0],[-71.60447224958426,-16.31016960884319,0],[-71.60513574119017,-16.30989372010932,0],[-71.6055925931713,-16.30939175663569,0],[-71.60517591668113,-16.30863117135933,0],[-71.60609800683511,-16.30776586957593,0],[-71.61084849878581,-16.31116900858029,0],[-71.61413958259118,-16.31475930579256,0],[-71.61160564371285,-16.31712245909844,0]]]},properties:{dias:"miercoles",nombre:"cono norte 4"}},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-71.57352490952336,-16.32730584396414,0],[-71.57226238828858,-16.32619278677137,0],[-71.57002642980143,-16.32369435099326,0],[-71.5686390227217,-16.32344247566348,0],[-71.56741900550067,-16.32151183439032,0],[-71.56843550988204,-16.32149409266741,0],[-71.5698659835161,-16.32321344239537,0],[-71.57009839450286,-16.3231017980599,0],[-71.57029391693173,-16.32263596398938,0],[-71.5711372083238,-16.32197537156471,0],[-71.57154881735894,-16.32219110074779,0],[-71.57217163205117,-16.32162552358137,0],[-71.57256222812623,-16.32182565566463,0],[-71.57318558750146,-16.32147559211745,0],[-71.57365295997405,-16.32164713156631,0],[-71.57474426551833,-16.32132343607715,0],[-71.5757991124205,-16.32026402193974,0],[-71.57636795171636,-16.31927567679439,0],[-71.57932840390393,-16.31647534269462,0],[-71.58067009263067,-16.31479262738346,0],[-71.5800900084161,-16.31290485209171,0],[-71.5788000032175,-16.3108363127181,0],[-71.57956095333056,-16.31023617525305,0],[-71.58095637986365,-16.31027636362568,0],[-71.58177342510014,-16.310088620688,0],[-71.58349529680416,-16.31352179745418,0],[-71.58384176746408,-16.31441388356979,0],[-71.5836662128935,-16.31526284349324,0],[-71.58474645371211,-16.31655784317845,0],[-71.58556676718605,-16.31625153229701,0],[-71.5858794567089,-16.31786519591849,0],[-71.58590073807532,-16.32007778653921,0],[-71.58557484841323,-16.32127897042064,0],[-71.58568909045731,-16.32273214296328,0],[-71.58582977990115,-16.32397409348197,0],[-71.58608530945831,-16.32572963457254,0],[-71.58521217352175,-16.32465765353387,0],[-71.5842380223858,-16.32419936062273,0],[-71.58197230024987,-16.32520642150068,0],[-71.58092403085394,-16.32528972202662,0],[-71.57909396375874,-16.32609914039257,0],[-71.57864846103108,-16.32630129039474,0],[-71.57730136445655,-16.32670023309179,0],[-71.57417717158229,-16.32728642798096,0],[-71.57352490952336,-16.32730584396414,0]]]},properties:{dias:"jueves",nombre:"Canteras , garcia calderon , sor ana, Villa Magisterial  , 54 arriba."}},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-71.58729523051873,-16.34110469192646,0],[-71.5861330169885,-16.33993044608506,0],[-71.58447865758133,-16.33758896601954,0],[-71.5833129241967,-16.33878910684016,0],[-71.58191627395108,-16.33829430848277,0],[-71.58173799348964,-16.33806471548274,0],[-71.57824173819787,-16.33448878764453,0],[-71.57734091956844,-16.33346340542298,0],[-71.57804189936884,-16.3321000238812,0],[-71.57698480846614,-16.33093410869235,0],[-71.5751999107098,-16.3293939737587,0],[-71.57452308017213,-16.32882405085498,0],[-71.57408207602943,-16.3281150357676,0],[-71.57357135649677,-16.32731743798607,0],[-71.5741771763557,-16.32730145950918,0],[-71.57465032942082,-16.32721215602291,0],[-71.5756640671661,-16.32701789204416,0],[-71.57731427517196,-16.32671050347616,0],[-71.57864484105141,-16.32631173352946,0],[-71.58092087453888,-16.32530006355661,0],[-71.58198205602521,-16.32521731307599,0],[-71.58287877859972,-16.32481676801787,0],[-71.58424452661816,-16.32421662138509,0],[-71.58520660019704,-16.32467396068218,0],[-71.5856650947727,-16.32523737611325,0],[-71.58607077266782,-16.32573682379044,0],[-71.58592632241657,-16.32634816024048,0],[-71.58696101814286,-16.32989158114174,0],[-71.58846398427056,-16.33129632449412,0],[-71.58941597546698,-16.33200231784772,0],[-71.59012877892953,-16.3328069422493,0],[-71.5914385748835,-16.33412910882744,0],[-71.59217275373874,-16.33491503318756,0],[-71.59246847679906,-16.33503299475898,0],[-71.59274611077193,-16.33512140960304,0],[-71.59038410448238,-16.33934611126137,0],[-71.5894594105249,-16.34013566195853,0],[-71.58871240365838,-16.34014747090145,0],[-71.58729523051873,-16.34110469192646,0]]]},properties:{dias:"jueves",nombre:"Villa canteras, el salvador,  8 de diciembre, magisteria, 54 abajo"}},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-71.54776352394114,-16.3210219768793,0],[-71.54630591566172,-16.32021451455975,0],[-71.54617106816637,-16.31544142737377,0],[-71.54581662048689,-16.31273545585791,0],[-71.5444452940827,-16.30705345670233,0],[-71.54927033133465,-16.30538227830616,0],[-71.55074213170268,-16.30604839672413,0],[-71.55220162603814,-16.30714037707228,0],[-71.55405727368976,-16.30883185448657,0],[-71.55716085548049,-16.31276538098715,0],[-71.56289339351903,-16.31950529030936,0],[-71.56348897462243,-16.31896694302825,0],[-71.56456928225712,-16.31891536358773,0],[-71.56549518369181,-16.3181881548367,0],[-71.56648648240821,-16.31812820320425,0],[-71.5666190272414,-16.31711383813713,0],[-71.56803472745067,-16.31681179269928,0],[-71.56851403490685,-16.31733019500825,0],[-71.56846377452392,-16.31865314909121,0],[-71.56850585286651,-16.3209159628897,0],[-71.56728036954449,-16.32130373713034,0],[-71.54776352394114,-16.3210219768793,0]]]},properties:{dias:"jueves",nombre:"Alipio ponce; Villa Maria, Cavez bedoya, Apipe"}},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-71.56100339644068,-16.33296245134935,0],[-71.5572487723312,-16.33518707751051,0],[-71.55630861383636,-16.33575712581426,0],[-71.55580351644419,-16.33663468765588,0],[-71.55577565843542,-16.33766909883687,0],[-71.55579659200144,-16.33888800911651,0],[-71.55566377019854,-16.33946664505717,0],[-71.55519233661636,-16.33949905219198,0],[-71.55494443564922,-16.33862444187852,0],[-71.55483131067687,-16.33804610465974,0],[-71.55440321668492,-16.33721755857317,0],[-71.55387668538566,-16.33616649193608,0],[-71.55409600537256,-16.33567879049201,0],[-71.55431894369555,-16.3351415833337,0],[-71.55389348750691,-16.33450949158411,0],[-71.55297407746566,-16.33399711249927,0],[-71.55298276628146,-16.33288005111267,0],[-71.55314633197844,-16.33238559495885,0],[-71.55308985663427,-16.33132649130946,0],[-71.55306701364675,-16.33113546314295,0],[-71.5530203370593,-16.32916680942641,0],[-71.55306808214428,-16.32726769014485,0],[-71.55449102855164,-16.32724140190706,0],[-71.55542081679992,-16.32725415905427,0],[-71.55724921954652,-16.32723573245324,0],[-71.56025955310106,-16.32723724113833,0],[-71.56798734684887,-16.32728550526944,0],[-71.57024057446402,-16.32728516763233,0],[-71.57145483602066,-16.32729577543327,0],[-71.57354565923079,-16.32732729198809,0],[-71.57450566516825,-16.32882938594663,0],[-71.57697468233522,-16.33095167887013,0],[-71.57802787807535,-16.33210238874747,0],[-71.5773877994762,-16.33332549443274,0],[-71.56746291977288,-16.33232352456907,0],[-71.56100339644068,-16.33296245134935,0]]]},properties:{dias:"jueves",nombre:"Alipio ponce; Villa Maria, Cavez bedoya, Apipe"}},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-71.5643375777409,-16.32725826459451,0],[-71.5564171446879,-16.32720288405423,0],[-71.552795802672,-16.32724047418718,0],[-71.54981013633976,-16.32567606108499,0],[-71.54802096053334,-16.32406953649036,0],[-71.54767847831542,-16.32108572086712,0],[-71.56733293579997,-16.32131743510701,0],[-71.56736528220749,-16.32151225119074,0],[-71.56823952481517,-16.32285785408309,0],[-71.56862130397955,-16.32346675445265,0],[-71.57006290774079,-16.32374234429179,0],[-71.57056023935807,-16.32428069023031,0],[-71.57140149975372,-16.32526188418456,0],[-71.57199968069877,-16.32599420384056,0],[-71.57349056872256,-16.32729147478358,0],[-71.57087814643393,-16.32726734773611,0],[-71.5643375777409,-16.32725826459451,0]]]},properties:{dias:"jueves",nombre:"Alipio ponce; Villa Maria, Cavez bedoya, Apipe"}},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-71.59217580527418,-16.33487472641855,0],[-71.58931131224669,-16.3317720530765,0],[-71.58812448186852,-16.33083723442914,0],[-71.58704552538185,-16.32976941379406,0],[-71.58650963321841,-16.32801035541172,0],[-71.58599750099955,-16.32630034962995,0],[-71.58612738526837,-16.32573377259742,0],[-71.58596827013969,-16.32473330790868,0],[-71.58562798040369,-16.32173803357615,0],[-71.58575351552352,-16.32068653775199,0],[-71.5860117954238,-16.31872955387656,0],[-71.58602949965983,-16.31641996309071,0],[-71.58565387220621,-16.31529896600015,0],[-71.58499605069889,-16.31410017126882,0],[-71.5840941462324,-16.3137191075727,0],[-71.58383191544377,-16.31345340500938,0],[-71.58332649704631,-16.31268326165982,0],[-71.58327642298428,-16.31145476123871,0],[-71.58327715195489,-16.31004566209542,0],[-71.58724420345635,-16.31119661535846,0],[-71.58781028144199,-16.31188223880415,0],[-71.5877958766792,-16.31297585312717,0],[-71.58882604512925,-16.31268336552888,0],[-71.58937064365915,-16.31268722669433,0],[-71.59046886712065,-16.31311301654118,0],[-71.59050301451822,-16.31557186638395,0],[-71.59316979277445,-16.31574180525325,0],[-71.59534534570766,-16.31497815593466,0],[-71.59650246581283,-16.31800664140821,0],[-71.59643076418457,-16.31881450568429,0],[-71.59638137486782,-16.32132403662723,0],[-71.59683573638506,-16.32281391153951,0],[-71.5983582059779,-16.32425888389401,0],[-71.59284740965794,-16.33509000604862,0],[-71.59217580527418,-16.33487472641855,0]]]},properties:{dias:"jueves",nombre:"ciudad municipal 2"}},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-71.55597893311995,-16.34330638246391,0],[-71.55741713078096,-16.34355743109944,0],[-71.55964385352104,-16.34495530214276,0],[-71.56046900248546,-16.3458230398871,0],[-71.56262183998581,-16.34738359203136,0],[-71.56468864032537,-16.34924296474744,0],[-71.56492266170484,-16.34943273810443,0],[-71.56420609979146,-16.3504472315181,0],[-71.56311770307923,-16.35089211619465,0],[-71.56225698940774,-16.35117858277599,0],[-71.56316382675851,-16.35172490027094,0],[-71.56300590840935,-16.35345397813327,0],[-71.56276263093827,-16.35461846180699,0],[-71.56266111897087,-16.35531250301809,0],[-71.558258656601,-16.35491879478137,0],[-71.55778577712802,-16.35458063634326,0],[-71.55809400834089,-16.3550063080177,0],[-71.55595848862673,-16.35485604235594,0],[-71.55598196448398,-16.35388430186443,0],[-71.55660796228787,-16.35268380740008,0],[-71.55587291171096,-16.35226433064361,0],[-71.55565698867937,-16.35156673594218,0],[-71.55583642295173,-16.34946453423267,0],[-71.55752465389045,-16.34825950920554,0],[-71.55762391168574,-16.34766137995019,0],[-71.55710058469283,-16.34691599070534,0],[-71.55673445135801,-16.34609876978731,0],[-71.55673953328143,-16.34521322442999,0],[-71.55635927936436,-16.34444442672149,0],[-71.55592005724914,-16.34385903869641,0],[-71.55597893311995,-16.34330638246391,0]]]},properties:{nombre:`Victor andres belaunde
Zamacola`,dias:"viernes"}},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-71.60190561032763,-16.34526035062652,0],[-71.60423452173865,-16.34718740843842,0],[-71.6047247176482,-16.34886114704426,0],[-71.60737822045697,-16.35112711867698,0],[-71.60341506881404,-16.35439563512179,0],[-71.59981990791564,-16.35570700050788,0],[-71.59858160969311,-16.35514010586745,0],[-71.59723296526064,-16.35382680238799,0],[-71.59634909639034,-16.35171422544734,0],[-71.59508547059322,-16.35028906198021,0],[-71.59424361835167,-16.34908804935694,0],[-71.59358937227255,-16.347648922404,0],[-71.60190561032763,-16.34526035062652,0]]]},properties:{nombre:`Peru arbo
 Avenida industrial`,dias:"viernes"}},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-71.58075123024096,-16.35129648382194,0],[-71.58158132526508,-16.34813803318974,0],[-71.58149287989961,-16.34293934917156,0],[-71.58230696819352,-16.34282436520358,0],[-71.58489446823621,-16.34242007071499,0],[-71.58654998352573,-16.3419262424981,0],[-71.58815631177033,-16.34063819680858,0],[-71.5888190154272,-16.34020666861418,0],[-71.5939221959314,-16.34048905333519,0],[-71.59466341128875,-16.34084432004523,0],[-71.59557271734256,-16.34202520466215,0],[-71.59666357306192,-16.34268447335435,0],[-71.59778086031343,-16.34364178970338,0],[-71.599506556351,-16.34422313575572,0],[-71.60057574819801,-16.34461997284816,0],[-71.60130854420458,-16.34519386280476,0],[-71.58075123024096,-16.35129648382194,0]]]},properties:{nombre:"Aptasa, Santa Maria",dias:"viernes"}},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-71.58149587672696,-16.34265889583582,0],[-71.5815694297617,-16.34731549808299,0],[-71.58145171441251,-16.3480152138916,0],[-71.58014270546008,-16.34868189651917,0],[-71.57941345223672,-16.34967513042607,0],[-71.57859923454866,-16.3499206455956,0],[-71.57785554498673,-16.3502614345817,0],[-71.57755281488848,-16.35082360638633,0],[-71.5765512074879,-16.35122920213472,0],[-71.57595283834908,-16.35130785824242,0],[-71.57523829787489,-16.3509438111541,0],[-71.57488238262349,-16.35109680322223,0],[-71.57504640348873,-16.35139416957222,0],[-71.57499502921831,-16.35156343592167,0],[-71.57455743154105,-16.35160345193366,0],[-71.57384187905596,-16.35176261713537,0],[-71.57371774725769,-16.35216119792005,0],[-71.57355162598635,-16.35236089771675,0],[-71.57066643262817,-16.35343547653523,0],[-71.57019970787904,-16.35404329860893,0],[-71.57014825444573,-16.35437299707973,0],[-71.56990896889762,-16.35449277255554,0],[-71.56707632715107,-16.35528281836934,0],[-71.56668057706052,-16.35508098153433,0],[-71.56638920673468,-16.3551600069558,0],[-71.5634385840938,-16.35531871715619,0],[-71.56264848616597,-16.35528897314475,0],[-71.56304757646788,-16.35336831733051,0],[-71.5634461174219,-16.3520841881343,0],[-71.56254480348724,-16.35108959290659,0],[-71.56419267443641,-16.35056641270378,0],[-71.56503254742712,-16.3493522398514,0],[-71.56535532583197,-16.34931233637289,0],[-71.56900123041463,-16.35217223264835,0],[-71.57288309285534,-16.34817360615587,0],[-71.57636639504534,-16.34385597754374,0],[-71.57649615689216,-16.34326068017634,0],[-71.57786398274243,-16.34263004196544,0],[-71.58030639071612,-16.34233677180948,0],[-71.58129060223753,-16.34227754502667,0],[-71.58219698280202,-16.34213105159654,0],[-71.58243901909825,-16.34182900514757,0],[-71.58239055787944,-16.34222881270261,0],[-71.58225961248849,-16.34244369038063,0],[-71.58223942969697,-16.34247301678719,0],[-71.58196498949145,-16.3426001646056,0],[-71.58149587672696,-16.34265889583582,0]]]},properties:{nombre:"Marañon Zamacola",dias:"viernes"}},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-71.56643286120465,-16.4003233208193,0],[-71.56648865824165,-16.40012690517306,0],[-71.5670784657786,-16.39986973723646,0],[-71.56667606704,-16.3996801595964,0],[-71.5664852310987,-16.39904951770894,0],[-71.56665045073034,-16.39875862446199,0],[-71.56717064468141,-16.39843996099729,0],[-71.56777032447656,-16.39825256789705,0],[-71.56834092441414,-16.39838158208029,0],[-71.56777043085283,-16.39752094322564,0],[-71.56771615435721,-16.39726020703343,0],[-71.56758033694518,-16.39697387277014,0],[-71.56736266766515,-16.39679191462046,0],[-71.56744433659914,-16.39608800126768,0],[-71.56801471158474,-16.39535942495407,0],[-71.56888419931573,-16.39488920420454,0],[-71.56893799408743,-16.3946815258616,0],[-71.56894750500415,-16.39376128200224,0],[-71.56916147052935,-16.39085685070876,0],[-71.57006834515748,-16.38921002304675,0],[-71.57014073574963,-16.38766256592612,0],[-71.57018844289803,-16.3857942774562,0],[-71.57022114076733,-16.3850906540715,0],[-71.57034158787056,-16.38477550778823,0],[-71.57150427195646,-16.38530863775647,0],[-71.57280459622622,-16.38592758136059,0],[-71.57502769071452,-16.3869465597195,0],[-71.5752048754543,-16.38776868153848,0],[-71.57497700461643,-16.38844541634255,0],[-71.5749124433106,-16.38976728446875,0],[-71.57471051277625,-16.39237416394122,0],[-71.57452559778213,-16.39388800854043,0],[-71.57436965169371,-16.39509460514655,0],[-71.5745069574067,-16.3957831335452,0],[-71.57464129046679,-16.39654787109156,0],[-71.57422809225946,-16.39760295984173,0],[-71.57418276120421,-16.39821201677735,0],[-71.57399286908662,-16.39897344760361,0],[-71.5729177259882,-16.3997488834019,0],[-71.5724919288583,-16.40004644432871,0],[-71.57243478673246,-16.40030824211854,0],[-71.57309218431143,-16.40476562402508,0],[-71.57034891139459,-16.40460890600777,0],[-71.56818865653797,-16.40434749247903,0],[-71.56814436304875,-16.40420555967681,0],[-71.56735457760905,-16.40436026893794,0],[-71.56567390774497,-16.40532994773633,0],[-71.56547671613757,-16.40515950629079,0],[-71.56565857566385,-16.40451291646365,0],[-71.56599405457263,-16.40453146665275,0],[-71.56613820660809,-16.40380935728371,0],[-71.56622662290039,-16.40305082469224,0],[-71.56613094171352,-16.40280555673331,0],[-71.5659610953683,-16.40214696663143,0],[-71.56606719838997,-16.40145356239306,0],[-71.56650361798988,-16.40098758763821,0],[-71.56643286120465,-16.4003233208193,0]]]},properties:{nombre:`Jose santos ataualpa
Av jose olaya
Av restauracion
Estadio de cerro colorado`,dias:"viernes"}},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-71.5572198611907,-16.38224114520562,0],[-71.56009011050863,-16.37059625482389,0],[-71.56364819545932,-16.37141882638489,0],[-71.5650960514629,-16.36980012565092,0],[-71.56545108653974,-16.36935421619836,0],[-71.56609936069792,-16.36865778339847,0],[-71.56693892603955,-16.36875536133047,0],[-71.56732311691447,-16.36983729703307,0],[-71.56720341463993,-16.37180989466133,0],[-71.5665483098747,-16.37165331907279,0],[-71.56414128646794,-16.37560068581344,0],[-71.5637776612224,-16.37570344606502,0],[-71.56326643038314,-16.37564642909511,0],[-71.56321268998006,-16.37899330703846,0],[-71.5633984840803,-16.38010509047499,0],[-71.56309321674239,-16.38107748303755,0],[-71.56126062785441,-16.38109619521147,0],[-71.56108651340998,-16.38144278697083,0],[-71.56272577902092,-16.38152233888699,0],[-71.56261403845653,-16.38269173420487,0],[-71.56244428654837,-16.38310663528732,0],[-71.56240758638064,-16.38421334146664,0],[-71.56109298411488,-16.3837539874089,0],[-71.56007512424058,-16.38367316341691,0],[-71.55995384526427,-16.38391114596119,0],[-71.55777683471064,-16.38370146714951,0],[-71.5573186381519,-16.38357838476139,0],[-71.5572198611907,-16.38224114520562,0]]]},properties:{nombre:"plaza las americas",dias:"viernes"}},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-71.5750319210709,-16.38696890750913,0],[-71.57830569257848,-16.38852847644411,0],[-71.57906047504144,-16.38882934066271,0],[-71.58300683022735,-16.39025526826329,0],[-71.58352749724581,-16.39460469258107,0],[-71.58435630213698,-16.40127437085177,0],[-71.58469692343887,-16.40452879745937,0],[-71.58630254412353,-16.4045030555224,0],[-71.58609059565012,-16.40659280081385,0],[-71.57492673073122,-16.40559366490315,0],[-71.5733536775165,-16.40531122551573,0],[-71.57317944383992,-16.40449053077121,0],[-71.57276991647599,-16.40223095305328,0],[-71.57258505366819,-16.40038554727452,0],[-71.57248127367889,-16.40026406224238,0],[-71.5728896405257,-16.3997567994148,0],[-71.5730524786595,-16.3996686549169,0],[-71.57363154291487,-16.39940497413644,0],[-71.57409260529388,-16.39870530333799,0],[-71.57416056074975,-16.39843192024095,0],[-71.57421238506875,-16.39759478984096,0],[-71.57454534525043,-16.39645494593423,0],[-71.57466335047637,-16.39585165796562,0],[-71.57443282196611,-16.39507238690671,0],[-71.5745542173639,-16.39404136078103,0],[-71.57489811452089,-16.38966324169059,0],[-71.57519339780364,-16.3878578907007,0],[-71.5750319210709,-16.38696890750913,0]]]},properties:{nombre:"Semi rural pacahcutec",dias:"viernes"}},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-71.553058084575,-16.38753163670329,0],[-71.55319736105662,-16.38753908892189,0],[-71.55311569469036,-16.38717406072549,0],[-71.55291680676937,-16.38666233779036,0],[-71.55218399196266,-16.38503611047074,0],[-71.5524080801503,-16.38490509868814,0],[-71.55299968907947,-16.38486563597621,0],[-71.55297532970307,-16.38470640506096,0],[-71.55338313995688,-16.38386598611888,0],[-71.55300937986918,-16.38348967171007,0],[-71.5529837897515,-16.38326027741506,0],[-71.55293145520544,-16.38268867066989,0],[-71.55268555507713,-16.38213014147773,0],[-71.55386024136106,-16.37965067735624,0],[-71.55345888329884,-16.37954961721488,0],[-71.55404161051288,-16.37858647804649,0],[-71.5545167675746,-16.37794266282715,0],[-71.55439708150524,-16.3771793400147,0],[-71.55424326808287,-16.37660380593765,0],[-71.55481623264662,-16.37646647507183,0],[-71.5546913791831,-16.37622092358559,0],[-71.55623918679018,-16.37732222398788,0],[-71.5570240718807,-16.37627703909711,0],[-71.55880987191665,-16.37412697344812,0],[-71.55916149214347,-16.37385247088213,0],[-71.55899733965968,-16.37448895864384,0],[-71.5581998110383,-16.37803480874683,0],[-71.55727590962432,-16.38368603046028,0],[-71.55732825376236,-16.38431099804758,0],[-71.55728960816546,-16.38493096919189,0],[-71.5574264903032,-16.38694939313843,0],[-71.5568578985609,-16.38910941890347,0],[-71.55512228130618,-16.38899737788758,0],[-71.55407224251422,-16.38826626016308,0],[-71.55325369454926,-16.38962880986106,0],[-71.55282399908303,-16.38959101841701,0],[-71.55203496954904,-16.38949240237882,0],[-71.55164839901678,-16.38951145902544,0],[-71.55120442518736,-16.38947216436718,0],[-71.55030690426162,-16.38916783172142,0],[-71.54978292003993,-16.38891883794696,0],[-71.553058084575,-16.38753163670329,0]]]},properties:{nombre:"cerro colorado tradicional",dias:"viernes"}},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-71.55958811608777,-16.39371123675008,0],[-71.56051681702334,-16.3923496922724,0],[-71.56128517695511,-16.39237621182807,0],[-71.56152573920885,-16.39192098226254,0],[-71.56268985582976,-16.3920434132433,0],[-71.56492427540064,-16.39184288316411,0],[-71.56473126209119,-16.38981188737066,0],[-71.56426012759661,-16.38777691618563,0],[-71.56279438405203,-16.38698314044723,0],[-71.56335171833827,-16.38649051651444,0],[-71.56428223352823,-16.38655355124425,0],[-71.5650249361367,-16.385488692336,0],[-71.56599889919,-16.38569308189717,0],[-71.56598389436377,-16.38746585934826,0],[-71.56604516489485,-16.39030657551557,0],[-71.5663729014135,-16.39028403051318,0],[-71.5663923354883,-16.38969978134992,0],[-71.56694317795419,-16.38842513747239,0],[-71.56633414582429,-16.38762166372228,0],[-71.56656181309849,-16.38688966581486,0],[-71.56632361023907,-16.38591633645583,0],[-71.56673563764323,-16.38527953802728,0],[-71.5672638720394,-16.38506372628843,0],[-71.56709157270491,-16.38352941916087,0],[-71.56724950863021,-16.38322632878383,0],[-71.57034376721982,-16.38472882068724,0],[-71.57002508785737,-16.38918573046657,0],[-71.56915959737536,-16.39104809666919,0],[-71.56886797857484,-16.39488034592256,0],[-71.56800897127931,-16.39537360380304,0],[-71.56734801650167,-16.39444478082455,0],[-71.56715564513092,-16.39414596457132,0],[-71.56658897974768,-16.39442036251954,0],[-71.56661517947416,-16.39474240892945,0],[-71.5662638434319,-16.39547853873556,0],[-71.56566622147606,-16.3948306322378,0],[-71.56585213464548,-16.39398350947338,0],[-71.56592139324815,-16.393731227601,0],[-71.5633698360148,-16.39343590862125,0],[-71.56329875673892,-16.39404990556096,0],[-71.5630139934894,-16.3944882840701,0],[-71.56244891049857,-16.39395608277438,0],[-71.56216883942746,-16.39351802776899,0],[-71.561909965349,-16.39347217062139,0],[-71.5615123337044,-16.39321931685771,0],[-71.56141770442733,-16.39346838084768,0],[-71.5611374656714,-16.39366846796031,0],[-71.56150841013348,-16.39397126982894,0],[-71.56143537466646,-16.39451858072016,0],[-71.5612258193075,-16.39480739080107,0],[-71.56106500068616,-16.39507069730204,0],[-71.56136225673166,-16.39529344246473,0],[-71.56135946392047,-16.39582150819031,0],[-71.56103146313899,-16.39617736887917,0],[-71.56175542567544,-16.39608998592549,0],[-71.56153564258558,-16.39681523279294,0],[-71.56106610950243,-16.39686730482211,0],[-71.56010025123328,-16.39655814860723,0],[-71.55982300064633,-16.39607006505102,0],[-71.55997204684579,-16.3957188475391,0],[-71.55974389419877,-16.39527831070156,0],[-71.55979709701977,-16.3947738298846,0],[-71.56006200998169,-16.39384239340813,0],[-71.55958811608777,-16.39371123675008,0]]]},properties:{nombre:`Libertad buganvilas
gonzales prada`,dias:"viernes"}},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-71.56701929228997,-16.38205064307986,0],[-71.56714821958845,-16.38176298147474,0],[-71.56690936798935,-16.38109442452178,0],[-71.56681350828498,-16.3805790706722,0],[-71.56611518008563,-16.3804621818747,0],[-71.56604604821604,-16.38009945137901,0],[-71.56638015824916,-16.3797854934261,0],[-71.5667905817853,-16.37978841430351,0],[-71.56691590006805,-16.37897946254867,0],[-71.5673197079463,-16.37844098912487,0],[-71.56764671284304,-16.37731626781687,0],[-71.56776235599841,-16.3771444413305,0],[-71.56677810943675,-16.37634542415936,0],[-71.56641564969486,-16.37610901610257,0],[-71.56635416068416,-16.37564237745372,0],[-71.56552820849785,-16.37517867499819,0],[-71.56560746730392,-16.37494384410215,0],[-71.56638472162088,-16.374890019883,0],[-71.56641450782752,-16.3749011887942,0],[-71.56672329200089,-16.37445711430948,0],[-71.5668897818776,-16.37404649303953,0],[-71.56685520364343,-16.37340233900586,0],[-71.56703086772148,-16.37253991316084,0],[-71.56696626529416,-16.37228780827167,0],[-71.5667515011197,-16.37193416434643,0],[-71.5667757055572,-16.3717753211439,0],[-71.56723947251389,-16.37172578994476,0],[-71.56730029644223,-16.37082762714853,0],[-71.56756543317539,-16.37105193500719,0],[-71.56756261287816,-16.37105883820242,0],[-71.56730557035064,-16.371869962934,0],[-71.56797320895787,-16.37312777934296,0],[-71.56846345346086,-16.37438502427048,0],[-71.56945579470077,-16.37431135903296,0],[-71.57007005104123,-16.37424471025742,0],[-71.57067507198772,-16.3744248214132,0],[-71.5707022810436,-16.3746721129617,0],[-71.57037402339301,-16.37495752466655,0],[-71.5704894114962,-16.37530379831096,0],[-71.5713934898913,-16.37598783431835,0],[-71.5715935654782,-16.37638544760371,0],[-71.57181632040552,-16.37697049901362,0],[-71.57309710243078,-16.37785486154071,0],[-71.57356663937517,-16.37831910215346,0],[-71.57459808135657,-16.37886706686153,0],[-71.57486139082684,-16.37929334764507,0],[-71.57599395132338,-16.38061391098199,0],[-71.57653684834222,-16.38138279048443,0],[-71.57732327138872,-16.38224338744255,0],[-71.57931366897526,-16.38467403216789,0],[-71.58007009084008,-16.3856563361928,0],[-71.58089887140055,-16.38669350526198,0],[-71.58195726140964,-16.38796876757366,0],[-71.58260440619183,-16.38888399400927,0],[-71.58278557795389,-16.38931864887621,0],[-71.58286347142214,-16.39010645437491,0],[-71.58070887930205,-16.38939010067892,0],[-71.57907263024369,-16.38879589214464,0],[-71.57708270930675,-16.3879021953707,0],[-71.57620931593921,-16.38751265823022,0],[-71.57411986040874,-16.3864906520489,0],[-71.57030467459963,-16.38469143237021,0],[-71.56724389419362,-16.38320286340233,0],[-71.56672092453864,-16.3830234757223,0],[-71.56637863730965,-16.38263012909176,0],[-71.5664696572783,-16.38240093030798,0],[-71.56701929228997,-16.38205064307986,0]]]},properties:{nombre:`Alto libertad
la libertad`,dias:"viernes"}},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-71.51136891758311,-16.43462001972224,0],[-71.5107120342975,-16.4348620016375,0],[-71.50933070091325,-16.43606632647523,0],[-71.50917955302829,-16.4374838979569,0],[-71.50872928679631,-16.43964481581003,0],[-71.50801343414732,-16.43952179869569,0],[-71.50693449962479,-16.43969210577286,0],[-71.50613473050488,-16.44151605709114,0],[-71.50630782376186,-16.44163622364952,0],[-71.5063318902338,-16.44168453669084,0],[-71.50643173073513,-16.44170819950197,0],[-71.50660528754646,-16.44180410894207,0],[-71.50667898636519,-16.44187634221287,0],[-71.50604258690149,-16.44233920078858,0],[-71.50523884973042,-16.44246433457023,0],[-71.50381045203287,-16.44355403089829,0],[-71.50199337727855,-16.44489013981366,0],[-71.50082220521497,-16.44684729200182,0],[-71.50032138092541,-16.44765279007386,0],[-71.4993711779485,-16.45029911415983,0],[-71.49967705460817,-16.450915673525,0],[-71.5000076453232,-16.45143801915994,0],[-71.49916550518414,-16.45275142331649,0],[-71.4980903348663,-16.4525126791529,0],[-71.49814167767443,-16.45315860747309,0],[-71.49751655570067,-16.45399729307009,0],[-71.49746638776338,-16.4539973832353,0],[-71.49734098529113,-16.45399760935213,0],[-71.4972406812639,-16.4539977890888,0],[-71.49709047446818,-16.45409373919774,0],[-71.49694034488536,-16.45421359495261,0],[-71.49674021957699,-16.45438135045984,0],[-71.49666520100143,-16.45445322164998,0],[-71.49649002510196,-16.45454914566533,0],[-71.49528788982207,-16.45502192102035,0],[-71.49518902329287,-16.45564231818824,0],[-71.49571712567143,-16.45611545071828,0],[-71.49476356585082,-16.45827414879007,0],[-71.49376361329055,-16.45865969781586,0],[-71.49194652781566,-16.46089430940216,0],[-71.4895267181409,-16.46214259493549,0],[-71.48812186222962,-16.46234806067221,0],[-71.48594707953181,-16.4631952740145,0],[-71.48354201374218,-16.46362349525892,0],[-71.48261641533159,-16.46230870185815,0],[-71.48036257332254,-16.46057100344266,0],[-71.48037007911005,-16.46047918964705,0],[-71.48040227618054,-16.46040973944893,0],[-71.48046653596936,-16.46027125086589,0],[-71.48054894027125,-16.4601790864256,0],[-71.48065819781027,-16.46004175738738,0],[-71.48081762288415,-16.45983734581104,0],[-71.4811069681452,-16.45950149085197,0],[-71.48141942407189,-16.45914421059976,0],[-71.48153927796106,-16.45901048613582,0],[-71.47915897129825,-16.45761256597727,0],[-71.48000221099873,-16.45562898233398,0],[-71.48393154827804,-16.45728839019919,0],[-71.48492728226283,-16.45629317578345,0],[-71.48667781451962,-16.45651878437923,0],[-71.4893477399918,-16.45877841233455,0],[-71.49053204934992,-16.46021914923987,0],[-71.49135577299938,-16.46037028453328,0],[-71.49140862660325,-16.45977970222975,0],[-71.49063370759092,-16.45901807484944,0],[-71.48927738320086,-16.45701876960584,0],[-71.48829513733298,-16.45526770881718,0],[-71.48780607587541,-16.45400517957582,0],[-71.48693630228517,-16.45312014802422,0],[-71.48644960590474,-16.45300719440031,0],[-71.48636278651274,-16.45255274821157,0],[-71.48715160127425,-16.45210954099689,0],[-71.48691307877182,-16.45206037072431,0],[-71.48664306575908,-16.45198199777824,0],[-71.48600752761052,-16.45194785973524,0],[-71.48557765654311,-16.45177142854607,0],[-71.48515137578258,-16.45166512552771,0],[-71.4849299930794,-16.45127757527704,0],[-71.48570249744414,-16.45061414523527,0],[-71.48580932029864,-16.45040640298279,0],[-71.48566995760686,-16.4498542578979,0],[-71.48447839455565,-16.44924192681459,0],[-71.48378172721966,-16.44913573524353,0],[-71.48321500767727,-16.44905087467417,0],[-71.48317676284708,-16.44829146448653,0],[-71.48318576206081,-16.44753655426192,0],[-71.48370565651295,-16.44657011783101,0],[-71.48383772166846,-16.44643440385996,0],[-71.48397318823795,-16.44597506742833,0],[-71.48377807588433,-16.44537645764584,0],[-71.4833482042225,-16.4446811617019,0],[-71.48299981962863,-16.44434625373427,0],[-71.48255216882126,-16.44429443153339,0],[-71.48214044013093,-16.44441515430773,0],[-71.48100467516115,-16.44555015387673,0],[-71.47993990493329,-16.4440290208833,0],[-71.47992784466084,-16.44395956787416,0],[-71.47998196299002,-16.44395967144738,0],[-71.48003590090339,-16.44395973015689,0],[-71.4801246322643,-16.44393372861029,0],[-71.48018756135137,-16.44393379980781,0],[-71.48024149041076,-16.44393386062642,0],[-71.48027743806077,-16.44393390116788,0],[-71.48031338144438,-16.4439339415139,0],[-71.48042118687894,-16.44393406321731,0],[-71.48051964716058,-16.44393405760556,0],[-71.48058195193056,-16.44393392384706,0],[-71.480697144348,-16.44389906639144,0],[-71.48081208829262,-16.44383815926042,0],[-71.48085672234328,-16.44382944971175,0],[-71.48094623138554,-16.44382073907587,0],[-71.48100006649038,-16.44382074081779,0],[-71.48104492912208,-16.44382074229883,0],[-71.48113501081033,-16.44383816991685,0],[-71.48117106054367,-16.44384687707649,0],[-71.48314926972505,-16.44384264212372,0],[-71.48323895457798,-16.44341363726908,0],[-71.48323457173927,-16.44263344643239,0],[-71.48312129523153,-16.44147074843322,0],[-71.48339051623137,-16.44019400864544,0],[-71.48408474956722,-16.44021902298652,0],[-71.48453366383487,-16.44087819330185,0],[-71.48480462289987,-16.44206638203555,0],[-71.48497149971693,-16.44254638233596,0],[-71.48538589593649,-16.44367879108589,0],[-71.48547437681903,-16.4445187556639,0],[-71.48547431894782,-16.44494943506835,0],[-71.48582853888077,-16.44580557338021,0],[-71.48601064469752,-16.4463454907897,0],[-71.48657056635012,-16.44660909384553,0],[-71.48634021039905,-16.44732886712164,0],[-71.48611575461992,-16.44748432018286,0],[-71.48570314712983,-16.44721108796368,0],[-71.4853391742776,-16.44683007695957,0],[-71.4849898598794,-16.44654960021008,0],[-71.48464166094088,-16.44634134829027,0],[-71.48423637561315,-16.44645081651662,0],[-71.48366583882648,-16.44729655500771,0],[-71.48329710162311,-16.44817117173131,0],[-71.48379969195233,-16.44867991437948,0],[-71.4850932077715,-16.44921753399646,0],[-71.48561952067219,-16.44941806662739,0],[-71.48605012620244,-16.44944102980456,0],[-71.48630945145628,-16.44969286076093,0],[-71.48624549867374,-16.45005447441991,0],[-71.48616854047981,-16.45026406879716,0],[-71.48613929394061,-16.45060804440347,0],[-71.48634866168223,-16.45034607659829,0],[-71.48674651741197,-16.4502484328234,0],[-71.48679617414106,-16.45058450806507,0],[-71.48665228784652,-16.4511229055031,0],[-71.48682800632977,-16.45157003894771,0],[-71.48740876900439,-16.45168794127278,0],[-71.48826820142517,-16.45177363541202,0],[-71.48905808156199,-16.45129292016076,0],[-71.48965938831003,-16.45069817496205,0],[-71.49015158543571,-16.4501609315043,0],[-71.49078961225821,-16.44978486572187,0],[-71.49137446080945,-16.44941854771214,0],[-71.491080542044,-16.44877036437815,0],[-71.49098600595994,-16.44811549349888,0],[-71.49072425829472,-16.44714529272828,0],[-71.49104835499084,-16.44722242939781,0],[-71.49162151708619,-16.44727298496425,0],[-71.49210410962883,-16.44719136844643,0],[-71.49302566995536,-16.44737550505333,0],[-71.49379005327921,-16.4475894825041,0],[-71.49443945267627,-16.44729253541132,0],[-71.49540579549688,-16.44739975922696,0],[-71.49644202327694,-16.44757556478657,0],[-71.49711599414714,-16.44768404898383,0],[-71.49724957220654,-16.44757550364126,0],[-71.4967996724407,-16.44722527748246,0],[-71.49652728309051,-16.44694515570829,0],[-71.49491216834123,-16.44591865737689,0],[-71.494754751868,-16.44524426807485,0],[-71.49434595389509,-16.4446517282591,0],[-71.49425993109242,-16.4437630487067,0],[-71.49414670890896,-16.44350831790473,0],[-71.49349574450424,-16.44333681442597,0],[-71.49291842447525,-16.44219600839803,0],[-71.49138762180154,-16.44183138288875,0],[-71.49167012829082,-16.44170820627187,0],[-71.49203823536942,-16.44163875906749,0],[-71.49239944080638,-16.44143013863666,0],[-71.49279815437231,-16.44150670595767,0],[-71.493601343449,-16.44211508624973,0],[-71.49374900830104,-16.44247943388946,0],[-71.49378708858485,-16.44283024912973,0],[-71.49408270803302,-16.44293211899101,0],[-71.49449591704803,-16.44286256351798,0],[-71.49490355597031,-16.44290992538953,0],[-71.49538889833102,-16.44312742783525,0],[-71.49588683129497,-16.44337050469444,0],[-71.49648634829191,-16.44390787361248,0],[-71.49698002740067,-16.44454469067059,0],[-71.49762761139463,-16.44543959159831,0],[-71.49785102517733,-16.44576564234416,0],[-71.49821644368274,-16.44636557181105,0],[-71.49834370155601,-16.44680234413487,0],[-71.49846888973676,-16.44762453712069,0],[-71.49867987895377,-16.4477932413578,0],[-71.49885242354442,-16.4472134696263,0],[-71.49946307843706,-16.44684378708523,0],[-71.49998734715867,-16.44524497999843,0],[-71.50172969322887,-16.4440659723928,0],[-71.50259864770125,-16.44331157446457,0],[-71.50386260949443,-16.44226849795212,0],[-71.50531395015747,-16.43980188763088,0],[-71.5068138487039,-16.43728143435406,0],[-71.50738794222161,-16.43522077898595,0],[-71.50891536634508,-16.43438419936103,0],[-71.51019156884658,-16.43353960399857,0],[-71.51078564659147,-16.43334591300211,0],[-71.51136891758311,-16.43462001972224,0]]]},properties:{dias:"viernes"}},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-71.49225365848623,-16.46241741984569,0],[-71.49307552120837,-16.46264341919298,0],[-71.49388117377468,-16.46600482168881,0],[-71.49126086411495,-16.46621342521679,0],[-71.48767591666942,-16.46803970787619,0],[-71.48678099801792,-16.47236013225335,0],[-71.48651563345713,-16.47460473341233,0],[-71.48160270512767,-16.47804267786786,0],[-71.48120057883732,-16.47909469503515,0],[-71.47965264978578,-16.48530361067196,0],[-71.48125065817497,-16.48732933703058,0],[-71.48050103280163,-16.49029555951689,0],[-71.48130420035267,-16.49192320181956,0],[-71.47696941549746,-16.49501147223327,0],[-71.47676802794997,-16.49509986328081,0],[-71.47640561155426,-16.49523190160201,0],[-71.47604784556646,-16.49540697314291,0],[-71.47588421619051,-16.49540694757183,0],[-71.46919579846616,-16.49613741103503,0],[-71.4657206853595,-16.49369364735186,0],[-71.46418170470152,-16.49221481299949,0],[-71.4594530840919,-16.48922498771498,0],[-71.4629735193553,-16.48650658888318,0],[-71.46402017108994,-16.4832683952279,0],[-71.45378519630646,-16.4849855048727,0],[-71.45854981118147,-16.48072896698733,0],[-71.45811696402242,-16.47849159098524,0],[-71.46033122388764,-16.47607742514409,0],[-71.45845277092734,-16.4730041442854,0],[-71.4534829636633,-16.47273732058175,0],[-71.45464766551483,-16.47040525995452,0],[-71.46298781649598,-16.46843722391524,0],[-71.46801643942565,-16.46603040314748,0],[-71.47125960191981,-16.46570859880726,0],[-71.47337756862122,-16.46570912827257,0],[-71.47689968673188,-16.4662728373424,0],[-71.4797329132808,-16.46562894692074,0],[-71.48136452732871,-16.46530265124994,0],[-71.48312327456098,-16.4649733818071,0],[-71.4857710465226,-16.46438988648508,0],[-71.48922583882924,-16.46284629270187,0],[-71.49144850303207,-16.46169109736542,0],[-71.49225365848623,-16.46241741984569,0]]]},properties:{dias:"viernes"}}],F6={type:rT,features:iT};function nT(z){let M,U="Pongase en contacto con nosotros para el precio del envío.";return{c(){M=nn("p"),M.textContent=U,this.h()},l(J){M=on(J,"P",{class:!0,"data-svelte-h":!0}),nu(M)!=="svelte-1rmtvpd"&&(M.textContent=U),this.h()},h(){Li(M,"class","svelte-4xbij2")},m(J,le){ou(J,M,le)},p:am,d(J){J&&Qi(M)}}}function oT(z){let M,U,J="Costo de envío:",le,he,qe,et=z[0].price.toFixed(2)+"",s,ze,pt,Ze,St="Día de envío:",ct,dr,_r=z[0].dia+"",ur;return{c(){M=nn("div"),U=nn("p"),U.textContent=J,le=pa(),he=nn("p"),qe=Np("S/ "),s=Np(et),ze=pa(),pt=nn("div"),Ze=nn("p"),Ze.textContent=St,ct=pa(),dr=nn("p"),ur=Np(_r),this.h()},l(Lr){M=on(Lr,"DIV",{class:!0});var Dr=gs(M);U=on(Dr,"P",{class:!0,"data-svelte-h":!0}),nu(U)!=="svelte-lusg0s"&&(U.textContent=J),le=ma(Dr),he=on(Dr,"P",{class:!0});var Br=gs(he);qe=Vp(Br,"S/ "),s=Vp(Br,et),Br.forEach(Qi),Dr.forEach(Qi),ze=ma(Lr),pt=on(Lr,"DIV",{class:!0});var Vt=gs(pt);Ze=on(Vt,"P",{class:!0,"data-svelte-h":!0}),nu(Ze)!=="svelte-8zmgh8"&&(Ze.textContent=St),ct=ma(Vt),dr=on(Vt,"P",{class:!0});var Ut=gs(dr);ur=Vp(Ut,_r),Ut.forEach(Qi),Vt.forEach(Qi),this.h()},h(){Li(U,"class","svelte-4xbij2"),Li(he,"class","svelte-4xbij2"),Li(M,"class","fc svelte-4xbij2"),Li(Ze,"class","svelte-4xbij2"),Li(dr,"class","svelte-4xbij2"),Li(pt,"class","fc svelte-4xbij2")},m(Lr,Dr){ou(Lr,M,Dr),bi(M,U),bi(M,le),bi(M,he),bi(he,qe),bi(he,s),ou(Lr,ze,Dr),ou(Lr,pt,Dr),bi(pt,Ze),bi(pt,ct),bi(pt,dr),bi(dr,ur)},p(Lr,Dr){Dr&1&&et!==(et=Lr[0].price.toFixed(2)+"")&&_3(s,et),Dr&1&&_r!==(_r=Lr[0].dia+"")&&_3(ur,_r)},d(Lr){Lr&&(Qi(M),Qi(ze),Qi(pt))}}}function sT(z){let M,U,J,le,he,qe="Seleccione su ubicación",et,s,ze,pt,Ze,St,ct="Por favor seleccione la dirección de envío en el mapa",dr,_r,ur,Lr="Continuar";function Dr(Ut,Fr){return Ut[0].price!==void 0?oT:nT}let Br=Dr(z),Vt=Br(z);return{c(){M=nn("link"),U=pa(),J=nn("main"),le=nn("div"),he=nn("h1"),he.textContent=qe,et=pa(),s=nn("div"),ze=nn("div"),pt=pa(),Ze=nn("div"),St=nn("p"),St.textContent=ct,dr=pa(),Vt.c(),_r=pa(),ur=nn("a"),ur.textContent=Lr,this.h()},l(Ut){const Fr=N8("svelte-9l0kuo",document.head);M=on(Fr,"LINK",{href:!0,rel:!0}),Fr.forEach(Qi),U=ma(Ut),J=on(Ut,"MAIN",{class:!0});var ti=gs(J);le=on(ti,"DIV",{class:!0});var ai=gs(le);he=on(ai,"H1",{class:!0,"data-svelte-h":!0}),nu(he)!=="svelte-seql32"&&(he.textContent=qe),et=ma(ai),s=on(ai,"DIV",{class:!0});var Oi=gs(s);ze=on(Oi,"DIV",{id:!0,class:!0}),gs(ze).forEach(Qi),pt=ma(Oi),Ze=on(Oi,"DIV",{class:!0});var sr=gs(Ze);St=on(sr,"P",{class:!0,"data-svelte-h":!0}),nu(St)!=="svelte-1rkhof"&&(St.textContent=ct),dr=ma(sr),Vt.l(sr),_r=ma(sr),ur=on(sr,"A",{href:!0,class:!0,"data-svelte-h":!0}),nu(ur)!=="svelte-gwl7vf"&&(ur.textContent=Lr),sr.forEach(Qi),Oi.forEach(Qi),ai.forEach(Qi),ti.forEach(Qi),this.h()},h(){Li(M,"href","https://api.mapbox.com/mapbox-gl-js/v3.4.0/mapbox-gl.css"),Li(M,"rel","stylesheet"),Li(he,"class","title"),Li(ze,"id","map"),Li(ze,"class","svelte-4xbij2"),Li(St,"class","nm svelte-4xbij2"),Li(ur,"href","/carrito"),Li(ur,"class","btn btn-main"),Li(Ze,"class","info svelte-4xbij2"),Li(s,"class","cols svelte-4xbij2"),Li(le,"class","ma"),Li(J,"class","svelte-4xbij2")},m(Ut,Fr){bi(document.head,M),ou(Ut,U,Fr),ou(Ut,J,Fr),bi(J,le),bi(le,he),bi(le,et),bi(le,s),bi(s,ze),bi(s,pt),bi(s,Ze),bi(Ze,St),bi(Ze,dr),Vt.m(Ze,null),bi(Ze,_r),bi(Ze,ur)},p(Ut,[Fr]){Br===(Br=Dr(Ut))&&Vt?Vt.p(Ut,Fr):(Vt.d(1),Vt=Br(Ut),Vt&&(Vt.c(),Vt.m(Ze,_r)))},i:am,o:am,d(Ut){Ut&&(Qi(U),Qi(J)),Qi(M),Vt.d()}}}function aT(z,M,U){let J;O8(z,go,he=>U(0,J=he));function le(he){for(const qe of F6.features){const et=Vd(qe.geometry.coordinates);if(Yg(he,et))return qe.properties}return null}return k8(()=>{let he=new Up.Map({container:"map",center:[-71.536973,-16.398822],zoom:12,style:"mapbox://styles/mapbox/light-v11",accessToken:"pk.eyJ1IjoiYWxhbi0yNSIsImEiOiJjbGViaGI4aDkwcHpxM25udTAwaWcyczFrIn0.MZhpce5K1n4Gi7xBVGFj6Q"}),qe=new Up.Marker().setLngLat([-71.536973,-16.398822]).addTo(he);he.addControl(new Up.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0,showUserHeading:!0})),he.on("load",()=>{he.addSource("zones",{type:"geojson",data:F6});const ze=["match",["get","dias"]],pt=["match",["get","dias"]];ze.push("lunes","rgba(222,50,76,0.3)"),ze.push("martes","rgba(244,137,95, 0.3)"),ze.push("miercoles","rgba(248,225,111, 0.3)"),ze.push("jueves","rgba(149,207,146, 0.3)"),ze.push("viernes","rgba(54,154,204, 0.3)"),ze.push("sabado","rgba(150,86,162, 0.3)"),ze.push("rgba(0, 0, 0, 0)"),pt.push("lunes","#de324c"),pt.push("martes","#f4895f"),pt.push("miercoles","#f8e16f"),pt.push("jueves","#95cf92"),pt.push("viernes","#369acc"),pt.push("sabado","#9656a2"),pt.push("rgb(0, 0, 0)"),he.addLayer({id:"zones-fill",type:"fill",source:"zones",paint:{"fill-color":ze}}),he.addLayer({id:"zones-line",type:"line",source:"zones",paint:{"line-color":pt,"line-width":1}})}),he.on("move",ze=>{qe.setLngLat(he.getCenter())}),Bo(go,J.isSet=!0,J),Bo(go,J.price=3,J),Bo(go,J.dia="Lunes y Sábado",J),Bo(go,J.coords=he.getCenter().toArray(),J);const et={lunes:5,martes:5,miercoles:5,jueves:5,viernes:5,sabado:5},s={lunes:"Lunes",martes:"Martes",miercoles:"Miércoles",jueves:"Jueves",viernes:"Viernes",sabado:"Sábado"};he.on("moveend",ze=>{let pt=le(he.getCenter().toArray());Bo(go,J.isSet=!0,J),Bo(go,J.price=et[pt==null?void 0:pt.dias],J),Bo(go,J.dia=s[pt==null?void 0:pt.dias],J),(pt.nombre=="centro arriba"||pt.nombre=="centro abajo")&&(Bo(go,J.price=3,J),Bo(go,J.dia="Lunes y Sábado",J)),Bo(go,J.coords=he.getCenter().toArray(),J)})}),[J]}class dT extends B8{constructor(M){super(),F8(this,M,aT,sT,L8,{})}}export{dT as component};
